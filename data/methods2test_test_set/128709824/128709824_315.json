{"test_class": {"identifier": "BytebuddyProxyTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final static Logger LOGGER = LoggerFactory.getLogger(BytebuddyProxyTest.class);", "modifier": "private final static", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(BytebuddyProxyTest.class)", "var_name": "LOGGER"}], "file": "core-impl/proxy/src/test/java/com/alipay/sofa/rpc/proxy/bytebuddy/BytebuddyProxyTest.java"}, "test_case": {"identifier": "getProxy", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void getProxy() throws Exception {\n        BytebuddyProxy proxy = new BytebuddyProxy();\n        AbstractTestClass testClass = null;\n        try {\n            testClass = proxy.getProxy(AbstractTestClass.class, new TestInvoker());\n        } catch (Exception e) {\n            LOGGER.info(e.getMessage());\n        }\n        Assert.assertNotNull(testClass);\n\n        TestInvoker invoker = new TestInvoker();\n        TestInterface testInterface = proxy.getProxy(TestInterface.class, invoker);\n        Assert.assertNotNull(testInterface);\n\n        Class clazz = testInterface.getClass().getInterfaces()[0];\n        Assert.assertEquals(TestInterface.class, clazz);\n\n        Assert.assertEquals(proxy.getInvoker(testInterface).getClass(), TestInvoker.class);\n        Assert.assertEquals(testInterface.toString(), invoker.toString());\n        Assert.assertEquals(testInterface.hashCode(), invoker.hashCode());\n\n        TestInterface another1 = proxy.getProxy(TestInterface.class, invoker);\n        TestInterface another2 = proxy.getProxy(TestInterface.class, new TestInvoker());\n        Assert.assertFalse(testInterface.equals(invoker));\n\n        //because of cache\n        Assert.assertTrue(testInterface.equals(another2));\n\n        Assert.assertEquals(testInterface, another1);\n\n        Assert.assertEquals(678, another1.sayNum(true));\n        SofaRequest request = invoker.getRequest();\n        Assert.assertEquals(TestInterface.class.getCanonicalName(), request.getInterfaceName());\n        Assert.assertEquals(\"sayNum\", request.getMethodName());\n        Assert.assertEquals(\"boolean\", request.getMethodArgSigs()[0]);\n        Assert.assertEquals(true, request.getMethodArgs()[0]);\n        Assert.assertNotNull(request.getMethod());\n\n        Assert.assertEquals(\"sayHello\", another1.sayHello(\"xxxx\"));\n        another1.sayNoting();\n        Assert.assertArrayEquals(new int[] { 6, 7, 8 }, another1.sayNums(null, new HashMap()));\n        Assert.assertNull(another1.sayNum2(1.2D));\n\n        boolean error = false;\n        try {\n            another1.throwbiz1();\n        } catch (Throwable e) {\n            error = true;\n        }\n        Assert.assertFalse(error);\n\n        error = false;\n        try {\n            another1.throwbiz2();\n        } catch (Throwable e) {\n            error = true;\n        }\n        Assert.assertFalse(error);\n\n        try {\n            another1.throwRPC();\n        } catch (Throwable e) {\n            error = true;\n        }\n        Assert.assertTrue(error);\n    }", "signature": "void getProxy()", "full_signature": "@Test public void getProxy()", "class_method_signature": "BytebuddyProxyTest.getProxy()", "testcase": true, "constructor": false, "invocations": ["getProxy", "info", "getMessage", "assertNotNull", "getProxy", "assertNotNull", "getInterfaces", "getClass", "assertEquals", "assertEquals", "getClass", "getInvoker", "assertEquals", "toString", "toString", "assertEquals", "hashCode", "hashCode", "getProxy", "getProxy", "assertFalse", "equals", "assertTrue", "equals", "assertEquals", "assertEquals", "sayNum", "getRequest", "assertEquals", "getCanonicalName", "getInterfaceName", "assertEquals", "getMethodName", "assertEquals", "getMethodArgSigs", "assertEquals", "getMethodArgs", "assertNotNull", "getMethod", "assertEquals", "sayHello", "sayNoting", "assertArrayEquals", "sayNums", "assertNull", "sayNum2", "throwbiz1", "assertFalse", "throwbiz2", "assertFalse", "throwRPC", "assertTrue"]}, "focal_class": {"identifier": "BytebuddyProxy", "superclass": "", "interfaces": "implements Proxy", "fields": [{"original_string": "private static final Map<Class, Class> PROXY_CLASS_MAP = new ConcurrentHashMap<Class, Class>();", "modifier": "private static final", "type": "Map<Class, Class>", "declarator": "PROXY_CLASS_MAP = new ConcurrentHashMap<Class, Class>()", "var_name": "PROXY_CLASS_MAP"}], "methods": [{"identifier": "getProxy", "parameters": "(Class<T> interfaceClass, Invoker proxyInvoker)", "modifiers": "@Override public", "return": "T", "signature": "T getProxy(Class<T> interfaceClass, Invoker proxyInvoker)", "full_signature": "@Override public T getProxy(Class<T> interfaceClass, Invoker proxyInvoker)", "class_method_signature": "BytebuddyProxy.getProxy(Class<T> interfaceClass, Invoker proxyInvoker)", "testcase": false, "constructor": false}, {"identifier": "getInvoker", "parameters": "(Object proxyObject)", "modifiers": "@Override public", "return": "Invoker", "signature": "Invoker getInvoker(Object proxyObject)", "full_signature": "@Override public Invoker getInvoker(Object proxyObject)", "class_method_signature": "BytebuddyProxy.getInvoker(Object proxyObject)", "testcase": false, "constructor": false}, {"identifier": "parseInvoker", "parameters": "(Object proxyObject)", "modifiers": "public static", "return": "Invoker", "signature": "Invoker parseInvoker(Object proxyObject)", "full_signature": "public static Invoker parseInvoker(Object proxyObject)", "class_method_signature": "BytebuddyProxy.parseInvoker(Object proxyObject)", "testcase": false, "constructor": false}], "file": "core-impl/proxy/src/main/java/com/alipay/sofa/rpc/proxy/bytebuddy/BytebuddyProxy.java"}, "focal_method": {"identifier": "getProxy", "parameters": "(Class<T> interfaceClass, Invoker proxyInvoker)", "modifiers": "@Override public", "return": "T", "body": "@Override\n    public <T> T getProxy(Class<T> interfaceClass, Invoker proxyInvoker) {\n\n        Class<? extends T> cls = PROXY_CLASS_MAP.get(interfaceClass);\n        if (cls == null) {\n            cls = new ByteBuddy()\n                .subclass(interfaceClass)\n                .method(\n                    ElementMatchers.isDeclaredBy(interfaceClass).or(ElementMatchers.isEquals())\n                        .or(ElementMatchers.isToString().or(ElementMatchers.isHashCode())))\n                .intercept(MethodDelegation.to(new BytebuddyInvocationHandler(proxyInvoker), \"handler\"))\n                .make()\n                .load(interfaceClass.getClassLoader(), ClassLoadingStrategy.Default.INJECTION)\n                .getLoaded();\n\n            PROXY_CLASS_MAP.put(interfaceClass, cls);\n        }\n        try {\n            return cls.newInstance();\n        } catch (Throwable t) {\n            throw new SofaRpcRuntimeException(LogCodes.getLog(LogCodes.ERROR_PROXY_CONSTRUCT, \"bytebuddy\"), t);\n        }\n\n    }", "signature": "T getProxy(Class<T> interfaceClass, Invoker proxyInvoker)", "full_signature": "@Override public T getProxy(Class<T> interfaceClass, Invoker proxyInvoker)", "class_method_signature": "BytebuddyProxy.getProxy(Class<T> interfaceClass, Invoker proxyInvoker)", "testcase": false, "constructor": false, "invocations": ["get", "getLoaded", "load", "make", "intercept", "method", "subclass", "or", "or", "isDeclaredBy", "isEquals", "or", "isToString", "isHashCode", "to", "getClassLoader", "put", "newInstance", "getLog"]}, "repository": {"repo_id": 128709824, "url": "https://github.com/sofastack/sofa-rpc", "stars": 3001, "created": "4/9/2018 3:32:04 AM +00:00", "updates": "2020-01-22T02:08:51+00:00", "fork": "False", "license": "licensed"}}