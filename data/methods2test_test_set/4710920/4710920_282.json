{"test_class": {"identifier": "EtcdMetadataReportTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String TEST_SERVICE = \"org.apache.dubbo.metadata.store.etcd.EtcdMetadata4TstService\";", "modifier": "private static final", "type": "String", "declarator": "TEST_SERVICE = \"org.apache.dubbo.metadata.store.etcd.EtcdMetadata4TstService\"", "var_name": "TEST_SERVICE"}, {"original_string": "private EtcdCluster etcdCluster = EtcdClusterFactory.buildCluster(getClass().getSimpleName(), 1, false);", "modifier": "private", "type": "EtcdCluster", "declarator": "etcdCluster = EtcdClusterFactory.buildCluster(getClass().getSimpleName(), 1, false)", "var_name": "etcdCluster"}, {"original_string": "private Client etcdClientForTest;", "modifier": "private", "type": "Client", "declarator": "etcdClientForTest", "var_name": "etcdClientForTest"}, {"original_string": "private EtcdMetadataReport etcdMetadataReport;", "modifier": "private", "type": "EtcdMetadataReport", "declarator": "etcdMetadataReport", "var_name": "etcdMetadataReport"}, {"original_string": "private URL registryUrl;", "modifier": "private", "type": "URL", "declarator": "registryUrl", "var_name": "registryUrl"}, {"original_string": "private EtcdMetadataReportFactory etcdMetadataReportFactory;", "modifier": "private", "type": "EtcdMetadataReportFactory", "declarator": "etcdMetadataReportFactory", "var_name": "etcdMetadataReportFactory"}], "file": "dubbo-metadata/dubbo-metadata-report-etcd/src/test/java/org/apache/dubbo/metadata/store/etcd/EtcdMetadataReportTest.java"}, "test_case": {"identifier": "testDoSaveMetadata", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testDoSaveMetadata() throws ExecutionException, InterruptedException {\n        String version = \"1.0.0\";\n        String group = null;\n        String application = \"etc-metadata-report-consumer-test\";\n        String revision = \"90980\";\n        String protocol = \"xxx\";\n        URL url = generateURL(TEST_SERVICE, version, group, application);\n        ServiceMetadataIdentifier serviceMetadataIdentifier = new ServiceMetadataIdentifier(TEST_SERVICE, version,\n                group, \"provider\", revision, protocol);\n        etcdMetadataReport.doSaveMetadata(serviceMetadataIdentifier, url);\n\n        CompletableFuture<GetResponse> response = etcdClientForTest.getKVClient().get(ByteSequence.from(\n                etcdMetadataReport.getNodeKey(serviceMetadataIdentifier), StandardCharsets.UTF_8));\n        String fileContent = response.get().getKvs().get(0).getValue().toString(StandardCharsets.UTF_8);\n        Assertions.assertNotNull(fileContent);\n\n        Assertions.assertEquals(fileContent, URL.encode(url.toFullString()));\n    }", "signature": "void testDoSaveMetadata()", "full_signature": "@Test public void testDoSaveMetadata()", "class_method_signature": "EtcdMetadataReportTest.testDoSaveMetadata()", "testcase": true, "constructor": false, "invocations": ["generateURL", "doSaveMetadata", "get", "getKVClient", "from", "getNodeKey", "toString", "getValue", "get", "getKvs", "get", "assertNotNull", "assertEquals", "encode", "toFullString"]}, "focal_class": {"identifier": "EtcdMetadataReport", "superclass": "extends AbstractMetadataReport", "interfaces": "", "fields": [{"original_string": "private final static Logger logger = LoggerFactory.getLogger(EtcdMetadataReport.class);", "modifier": "private final static", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(EtcdMetadataReport.class)", "var_name": "logger"}, {"original_string": "private final String root;", "modifier": "private final", "type": "String", "declarator": "root", "var_name": "root"}, {"original_string": "private final JEtcdClient etcdClient;", "modifier": "private final", "type": "JEtcdClient", "declarator": "etcdClient", "var_name": "etcdClient"}], "methods": [{"identifier": "EtcdMetadataReport", "parameters": "(URL url)", "modifiers": "public", "return": "", "signature": " EtcdMetadataReport(URL url)", "full_signature": "public  EtcdMetadataReport(URL url)", "class_method_signature": "EtcdMetadataReport.EtcdMetadataReport(URL url)", "testcase": false, "constructor": true}, {"identifier": "doStoreProviderMetadata", "parameters": "(MetadataIdentifier providerMetadataIdentifier, String serviceDefinitions)", "modifiers": "@Override protected", "return": "void", "signature": "void doStoreProviderMetadata(MetadataIdentifier providerMetadataIdentifier, String serviceDefinitions)", "full_signature": "@Override protected void doStoreProviderMetadata(MetadataIdentifier providerMetadataIdentifier, String serviceDefinitions)", "class_method_signature": "EtcdMetadataReport.doStoreProviderMetadata(MetadataIdentifier providerMetadataIdentifier, String serviceDefinitions)", "testcase": false, "constructor": false}, {"identifier": "doStoreConsumerMetadata", "parameters": "(MetadataIdentifier consumerMetadataIdentifier, String value)", "modifiers": "@Override protected", "return": "void", "signature": "void doStoreConsumerMetadata(MetadataIdentifier consumerMetadataIdentifier, String value)", "full_signature": "@Override protected void doStoreConsumerMetadata(MetadataIdentifier consumerMetadataIdentifier, String value)", "class_method_signature": "EtcdMetadataReport.doStoreConsumerMetadata(MetadataIdentifier consumerMetadataIdentifier, String value)", "testcase": false, "constructor": false}, {"identifier": "doSaveMetadata", "parameters": "(ServiceMetadataIdentifier serviceMetadataIdentifier, URL url)", "modifiers": "@Override protected", "return": "void", "signature": "void doSaveMetadata(ServiceMetadataIdentifier serviceMetadataIdentifier, URL url)", "full_signature": "@Override protected void doSaveMetadata(ServiceMetadataIdentifier serviceMetadataIdentifier, URL url)", "class_method_signature": "EtcdMetadataReport.doSaveMetadata(ServiceMetadataIdentifier serviceMetadataIdentifier, URL url)", "testcase": false, "constructor": false}, {"identifier": "doRemoveMetadata", "parameters": "(ServiceMetadataIdentifier serviceMetadataIdentifier)", "modifiers": "@Override protected", "return": "void", "signature": "void doRemoveMetadata(ServiceMetadataIdentifier serviceMetadataIdentifier)", "full_signature": "@Override protected void doRemoveMetadata(ServiceMetadataIdentifier serviceMetadataIdentifier)", "class_method_signature": "EtcdMetadataReport.doRemoveMetadata(ServiceMetadataIdentifier serviceMetadataIdentifier)", "testcase": false, "constructor": false}, {"identifier": "doGetExportedURLs", "parameters": "(ServiceMetadataIdentifier metadataIdentifier)", "modifiers": "@Override protected", "return": "List<String>", "signature": "List<String> doGetExportedURLs(ServiceMetadataIdentifier metadataIdentifier)", "full_signature": "@Override protected List<String> doGetExportedURLs(ServiceMetadataIdentifier metadataIdentifier)", "class_method_signature": "EtcdMetadataReport.doGetExportedURLs(ServiceMetadataIdentifier metadataIdentifier)", "testcase": false, "constructor": false}, {"identifier": "doSaveSubscriberData", "parameters": "(SubscriberMetadataIdentifier subscriberMetadataIdentifier, String urlListStr)", "modifiers": "@Override protected", "return": "void", "signature": "void doSaveSubscriberData(SubscriberMetadataIdentifier subscriberMetadataIdentifier, String urlListStr)", "full_signature": "@Override protected void doSaveSubscriberData(SubscriberMetadataIdentifier subscriberMetadataIdentifier, String urlListStr)", "class_method_signature": "EtcdMetadataReport.doSaveSubscriberData(SubscriberMetadataIdentifier subscriberMetadataIdentifier, String urlListStr)", "testcase": false, "constructor": false}, {"identifier": "doGetSubscribedURLs", "parameters": "(SubscriberMetadataIdentifier subscriberMetadataIdentifier)", "modifiers": "@Override protected", "return": "String", "signature": "String doGetSubscribedURLs(SubscriberMetadataIdentifier subscriberMetadataIdentifier)", "full_signature": "@Override protected String doGetSubscribedURLs(SubscriberMetadataIdentifier subscriberMetadataIdentifier)", "class_method_signature": "EtcdMetadataReport.doGetSubscribedURLs(SubscriberMetadataIdentifier subscriberMetadataIdentifier)", "testcase": false, "constructor": false}, {"identifier": "getServiceDefinition", "parameters": "(MetadataIdentifier metadataIdentifier)", "modifiers": "@Override public", "return": "String", "signature": "String getServiceDefinition(MetadataIdentifier metadataIdentifier)", "full_signature": "@Override public String getServiceDefinition(MetadataIdentifier metadataIdentifier)", "class_method_signature": "EtcdMetadataReport.getServiceDefinition(MetadataIdentifier metadataIdentifier)", "testcase": false, "constructor": false}, {"identifier": "storeMetadata", "parameters": "(MetadataIdentifier identifier, String v)", "modifiers": "private", "return": "void", "signature": "void storeMetadata(MetadataIdentifier identifier, String v)", "full_signature": "private void storeMetadata(MetadataIdentifier identifier, String v)", "class_method_signature": "EtcdMetadataReport.storeMetadata(MetadataIdentifier identifier, String v)", "testcase": false, "constructor": false}, {"identifier": "getNodeKey", "parameters": "(BaseMetadataIdentifier identifier)", "modifiers": "", "return": "String", "signature": "String getNodeKey(BaseMetadataIdentifier identifier)", "full_signature": " String getNodeKey(BaseMetadataIdentifier identifier)", "class_method_signature": "EtcdMetadataReport.getNodeKey(BaseMetadataIdentifier identifier)", "testcase": false, "constructor": false}, {"identifier": "toRootDir", "parameters": "()", "modifiers": "", "return": "String", "signature": "String toRootDir()", "full_signature": " String toRootDir()", "class_method_signature": "EtcdMetadataReport.toRootDir()", "testcase": false, "constructor": false}], "file": "dubbo-metadata/dubbo-metadata-report-etcd/src/main/java/org/apache/dubbo/metadata/store/etcd/EtcdMetadataReport.java"}, "focal_method": {"identifier": "doSaveMetadata", "parameters": "(ServiceMetadataIdentifier serviceMetadataIdentifier, URL url)", "modifiers": "@Override protected", "return": "void", "body": "@Override\n    protected void doSaveMetadata(ServiceMetadataIdentifier serviceMetadataIdentifier, URL url) {\n        String key = getNodeKey(serviceMetadataIdentifier);\n        if (!etcdClient.put(key, URL.encode(url.toFullString()))) {\n            logger.error(\"Failed to put \" + serviceMetadataIdentifier + \" to etcd, value: \" + url);\n        }\n    }", "signature": "void doSaveMetadata(ServiceMetadataIdentifier serviceMetadataIdentifier, URL url)", "full_signature": "@Override protected void doSaveMetadata(ServiceMetadataIdentifier serviceMetadataIdentifier, URL url)", "class_method_signature": "EtcdMetadataReport.doSaveMetadata(ServiceMetadataIdentifier serviceMetadataIdentifier, URL url)", "testcase": false, "constructor": false, "invocations": ["getNodeKey", "put", "encode", "toFullString", "error"]}, "repository": {"repo_id": 4710920, "url": "https://github.com/apache/dubbo", "stars": 30960, "created": "6/19/2012 7:56:02 AM +00:00", "updates": "2020-01-27T14:21:03+00:00", "fork": "False", "license": "licensed"}}