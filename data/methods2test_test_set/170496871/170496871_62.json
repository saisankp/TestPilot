{"test_class": {"identifier": "LocalPendingTransactionsTrackerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static ScheduledExecutorService timeoutExecutor;", "modifier": "private static", "type": "ScheduledExecutorService", "declarator": "timeoutExecutor", "var_name": "timeoutExecutor"}, {"original_string": "private LocalPendingTransactionsTracker tracker;", "modifier": "private", "type": "LocalPendingTransactionsTracker", "declarator": "tracker", "var_name": "tracker"}], "file": "modules/core/src/test/java/org/apache/ignite/internal/processors/cache/transactions/LocalPendingTransactionsTrackerTest.java"}, "test_case": {"identifier": "testCurrentlyPreparedTxs", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testCurrentlyPreparedTxs() {\n        txPrepare(1);\n        txKeyWrite(1, 10);\n        txKeyWrite(1, 11);\n\n        txPrepare(2);\n        txKeyWrite(2, 20);\n        txKeyWrite(2, 21);\n        txKeyWrite(2, 22);\n\n        txPrepare(3);\n        txKeyWrite(3, 30);\n\n        txCommit(2);\n\n        tracker.writeLockState();\n\n        try {\n            Set<GridCacheVersion> currentlyPreparedTxs = tracker.currentlyPreparedTxs();\n\n            assertEquals(2, currentlyPreparedTxs.size());\n            assertTrue(currentlyPreparedTxs.contains(nearXidVersion(1)));\n            assertTrue(currentlyPreparedTxs.contains(nearXidVersion(3)));\n        }\n        finally {\n            tracker.writeUnlockState();\n        }\n\n        txKeyWrite(3, 31);\n        txCommit(3);\n\n        tracker.writeLockState();\n\n        try {\n            Set<GridCacheVersion> currentlyPreparedTxs = tracker.currentlyPreparedTxs();\n\n            assertEquals(1, currentlyPreparedTxs.size());\n            assertTrue(currentlyPreparedTxs.contains(nearXidVersion(1)));\n        }\n        finally {\n            tracker.writeUnlockState();\n        }\n    }", "signature": "void testCurrentlyPreparedTxs()", "full_signature": "@Test public void testCurrentlyPreparedTxs()", "class_method_signature": "LocalPendingTransactionsTrackerTest.testCurrentlyPreparedTxs()", "testcase": true, "constructor": false, "invocations": ["txPrepare", "txKeyWrite", "txKeyWrite", "txPrepare", "txKeyWrite", "txKeyWrite", "txKeyWrite", "txPrepare", "txKeyWrite", "txCommit", "writeLockState", "currentlyPreparedTxs", "assertEquals", "size", "assertTrue", "contains", "nearXidVersion", "assertTrue", "contains", "nearXidVersion", "writeUnlockState", "txKeyWrite", "txCommit", "writeLockState", "currentlyPreparedTxs", "assertEquals", "size", "assertTrue", "contains", "nearXidVersion", "writeUnlockState"]}, "focal_class": {"identifier": "LocalPendingTransactionsTracker", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final GridCacheSharedContext<?, ?> cctx;", "modifier": "private final", "type": "GridCacheSharedContext<?, ?>", "declarator": "cctx", "var_name": "cctx"}, {"original_string": "private final IgniteLogger log;", "modifier": "private final", "type": "IgniteLogger", "declarator": "log", "var_name": "log"}, {"original_string": "private final Set<GridCacheVersion> currentlyCommittingTxs = U.newConcurrentHashSet();", "modifier": "private final", "type": "Set<GridCacheVersion>", "declarator": "currentlyCommittingTxs = U.newConcurrentHashSet()", "var_name": "currentlyCommittingTxs"}, {"original_string": "private volatile boolean enabled = IgniteSystemProperties.getBoolean(IGNITE_PENDING_TX_TRACKER_ENABLED, false);", "modifier": "private volatile", "type": "boolean", "declarator": "enabled = IgniteSystemProperties.getBoolean(IGNITE_PENDING_TX_TRACKER_ENABLED, false)", "var_name": "enabled"}, {"original_string": "private final ConcurrentHashMap<GridCacheVersion, Integer> preparedCommittedTxsCounters = new ConcurrentHashMap<>();", "modifier": "private final", "type": "ConcurrentHashMap<GridCacheVersion, Integer>", "declarator": "preparedCommittedTxsCounters = new ConcurrentHashMap<>()", "var_name": "preparedCommittedTxsCounters"}, {"original_string": "private volatile GridConcurrentHashSet<GridCacheVersion> trackedPreparedTxs = new GridConcurrentHashSet<>();", "modifier": "private volatile", "type": "GridConcurrentHashSet<GridCacheVersion>", "declarator": "trackedPreparedTxs = new GridConcurrentHashSet<>()", "var_name": "trackedPreparedTxs"}, {"original_string": "private volatile GridConcurrentHashSet<GridCacheVersion> trackedCommittedTxs = new GridConcurrentHashSet<>();", "modifier": "private volatile", "type": "GridConcurrentHashSet<GridCacheVersion>", "declarator": "trackedCommittedTxs = new GridConcurrentHashSet<>()", "var_name": "trackedCommittedTxs"}, {"original_string": "private volatile ConcurrentHashMap<KeyCacheObject, Set<GridCacheVersion>> writtenKeysToNearXidVer = new ConcurrentHashMap<>();", "modifier": "private volatile", "type": "ConcurrentHashMap<KeyCacheObject, Set<GridCacheVersion>>", "declarator": "writtenKeysToNearXidVer = new ConcurrentHashMap<>()", "var_name": "writtenKeysToNearXidVer"}, {"original_string": "private volatile ConcurrentHashMap<GridCacheVersion, Set<GridCacheVersion>> dependentTransactionsGraph = new ConcurrentHashMap<>();", "modifier": "private volatile", "type": "ConcurrentHashMap<GridCacheVersion, Set<GridCacheVersion>>", "declarator": "dependentTransactionsGraph = new ConcurrentHashMap<>()", "var_name": "dependentTransactionsGraph"}, {"original_string": "private final ReentrantReadWriteLock stateLock = new ReentrantReadWriteLock();", "modifier": "private final", "type": "ReentrantReadWriteLock", "declarator": "stateLock = new ReentrantReadWriteLock()", "var_name": "stateLock"}, {"original_string": "private final AtomicBoolean trackPrepared = new AtomicBoolean(false);", "modifier": "private final", "type": "AtomicBoolean", "declarator": "trackPrepared = new AtomicBoolean(false)", "var_name": "trackPrepared"}, {"original_string": "private final AtomicBoolean trackCommitted = new AtomicBoolean(false);", "modifier": "private final", "type": "AtomicBoolean", "declarator": "trackCommitted = new AtomicBoolean(false)", "var_name": "trackCommitted"}, {"original_string": "private volatile TxFinishAwaiting txFinishAwaiting;", "modifier": "private volatile", "type": "TxFinishAwaiting", "declarator": "txFinishAwaiting", "var_name": "txFinishAwaiting"}], "methods": [{"identifier": "LocalPendingTransactionsTracker", "parameters": "(GridCacheSharedContext<?, ?> cctx)", "modifiers": "public", "return": "", "signature": " LocalPendingTransactionsTracker(GridCacheSharedContext<?, ?> cctx)", "full_signature": "public  LocalPendingTransactionsTracker(GridCacheSharedContext<?, ?> cctx)", "class_method_signature": "LocalPendingTransactionsTracker.LocalPendingTransactionsTracker(GridCacheSharedContext<?, ?> cctx)", "testcase": false, "constructor": true}, {"identifier": "enable", "parameters": "()", "modifiers": "", "return": "void", "signature": "void enable()", "full_signature": " void enable()", "class_method_signature": "LocalPendingTransactionsTracker.enable()", "testcase": false, "constructor": false}, {"identifier": "enabled", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean enabled()", "full_signature": "public boolean enabled()", "class_method_signature": "LocalPendingTransactionsTracker.enabled()", "testcase": false, "constructor": false}, {"identifier": "currentlyPreparedTxs", "parameters": "()", "modifiers": "public", "return": "Set<GridCacheVersion>", "signature": "Set<GridCacheVersion> currentlyPreparedTxs()", "full_signature": "public Set<GridCacheVersion> currentlyPreparedTxs()", "class_method_signature": "LocalPendingTransactionsTracker.currentlyPreparedTxs()", "testcase": false, "constructor": false}, {"identifier": "startTrackingPrepared", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void startTrackingPrepared()", "full_signature": "public void startTrackingPrepared()", "class_method_signature": "LocalPendingTransactionsTracker.startTrackingPrepared()", "testcase": false, "constructor": false}, {"identifier": "stopTrackingPrepared", "parameters": "()", "modifiers": "public", "return": "Set<GridCacheVersion>", "signature": "Set<GridCacheVersion> stopTrackingPrepared()", "full_signature": "public Set<GridCacheVersion> stopTrackingPrepared()", "class_method_signature": "LocalPendingTransactionsTracker.stopTrackingPrepared()", "testcase": false, "constructor": false}, {"identifier": "startTrackingCommitted", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void startTrackingCommitted()", "full_signature": "public void startTrackingCommitted()", "class_method_signature": "LocalPendingTransactionsTracker.startTrackingCommitted()", "testcase": false, "constructor": false}, {"identifier": "stopTrackingCommitted", "parameters": "()", "modifiers": "public", "return": "TrackCommittedResult", "signature": "TrackCommittedResult stopTrackingCommitted()", "full_signature": "public TrackCommittedResult stopTrackingCommitted()", "class_method_signature": "LocalPendingTransactionsTracker.stopTrackingCommitted()", "testcase": false, "constructor": false}, {"identifier": "startTxFinishAwaiting", "parameters": "(\n        long preparedTxsTimeout, long committingTxsTimeout)", "modifiers": "public", "return": "Set<GridCacheVersion>", "signature": "Set<GridCacheVersion> startTxFinishAwaiting(\n        long preparedTxsTimeout, long committingTxsTimeout)", "full_signature": "public Set<GridCacheVersion> startTxFinishAwaiting(\n        long preparedTxsTimeout, long committingTxsTimeout)", "class_method_signature": "LocalPendingTransactionsTracker.startTxFinishAwaiting(\n        long preparedTxsTimeout, long committingTxsTimeout)", "testcase": false, "constructor": false}, {"identifier": "awaitPendingTxsFinished", "parameters": "(\n        Set<GridCacheVersion> globalCommittingTxs\n    )", "modifiers": "public", "return": "IgniteInternalFuture<Set<GridCacheVersion>>", "signature": "IgniteInternalFuture<Set<GridCacheVersion>> awaitPendingTxsFinished(\n        Set<GridCacheVersion> globalCommittingTxs\n    )", "full_signature": "public IgniteInternalFuture<Set<GridCacheVersion>> awaitPendingTxsFinished(\n        Set<GridCacheVersion> globalCommittingTxs\n    )", "class_method_signature": "LocalPendingTransactionsTracker.awaitPendingTxsFinished(\n        Set<GridCacheVersion> globalCommittingTxs\n    )", "testcase": false, "constructor": false}, {"identifier": "writeLockState", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void writeLockState()", "full_signature": "public void writeLockState()", "class_method_signature": "LocalPendingTransactionsTracker.writeLockState()", "testcase": false, "constructor": false}, {"identifier": "writeUnlockState", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void writeUnlockState()", "full_signature": "public void writeUnlockState()", "class_method_signature": "LocalPendingTransactionsTracker.writeUnlockState()", "testcase": false, "constructor": false}, {"identifier": "onTxPrepared", "parameters": "(GridCacheVersion nearXidVer)", "modifiers": "public", "return": "void", "signature": "void onTxPrepared(GridCacheVersion nearXidVer)", "full_signature": "public void onTxPrepared(GridCacheVersion nearXidVer)", "class_method_signature": "LocalPendingTransactionsTracker.onTxPrepared(GridCacheVersion nearXidVer)", "testcase": false, "constructor": false}, {"identifier": "onTxCommitted", "parameters": "(GridCacheVersion nearXidVer)", "modifiers": "public", "return": "void", "signature": "void onTxCommitted(GridCacheVersion nearXidVer)", "full_signature": "public void onTxCommitted(GridCacheVersion nearXidVer)", "class_method_signature": "LocalPendingTransactionsTracker.onTxCommitted(GridCacheVersion nearXidVer)", "testcase": false, "constructor": false}, {"identifier": "onTxRolledBack", "parameters": "(GridCacheVersion nearXidVer)", "modifiers": "public", "return": "void", "signature": "void onTxRolledBack(GridCacheVersion nearXidVer)", "full_signature": "public void onTxRolledBack(GridCacheVersion nearXidVer)", "class_method_signature": "LocalPendingTransactionsTracker.onTxRolledBack(GridCacheVersion nearXidVer)", "testcase": false, "constructor": false}, {"identifier": "onKeysWritten", "parameters": "(GridCacheVersion nearXidVer, List<KeyCacheObject> keys)", "modifiers": "public", "return": "void", "signature": "void onKeysWritten(GridCacheVersion nearXidVer, List<KeyCacheObject> keys)", "full_signature": "public void onKeysWritten(GridCacheVersion nearXidVer, List<KeyCacheObject> keys)", "class_method_signature": "LocalPendingTransactionsTracker.onKeysWritten(GridCacheVersion nearXidVer, List<KeyCacheObject> keys)", "testcase": false, "constructor": false}, {"identifier": "onKeysRead", "parameters": "(GridCacheVersion nearXidVer, List<KeyCacheObject> keys)", "modifiers": "public", "return": "void", "signature": "void onKeysRead(GridCacheVersion nearXidVer, List<KeyCacheObject> keys)", "full_signature": "public void onKeysRead(GridCacheVersion nearXidVer, List<KeyCacheObject> keys)", "class_method_signature": "LocalPendingTransactionsTracker.onKeysRead(GridCacheVersion nearXidVer, List<KeyCacheObject> keys)", "testcase": false, "constructor": false}, {"identifier": "reset", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void reset()", "full_signature": "public void reset()", "class_method_signature": "LocalPendingTransactionsTracker.reset()", "testcase": false, "constructor": false}, {"identifier": "checkTxFinishFutureDone", "parameters": "(GridCacheVersion nearXidVer)", "modifiers": "private", "return": "void", "signature": "void checkTxFinishFutureDone(GridCacheVersion nearXidVer)", "full_signature": "private void checkTxFinishFutureDone(GridCacheVersion nearXidVer)", "class_method_signature": "LocalPendingTransactionsTracker.checkTxFinishFutureDone(GridCacheVersion nearXidVer)", "testcase": false, "constructor": false}], "file": "modules/core/src/main/java/org/apache/ignite/internal/processors/cache/transactions/LocalPendingTransactionsTracker.java"}, "focal_method": {"identifier": "currentlyPreparedTxs", "parameters": "()", "modifiers": "public", "return": "Set<GridCacheVersion>", "body": "public Set<GridCacheVersion> currentlyPreparedTxs() {\n        assert stateLock.writeLock().isHeldByCurrentThread();\n\n        return U.sealSet(preparedCommittedTxsCounters.keySet());\n    }", "signature": "Set<GridCacheVersion> currentlyPreparedTxs()", "full_signature": "public Set<GridCacheVersion> currentlyPreparedTxs()", "class_method_signature": "LocalPendingTransactionsTracker.currentlyPreparedTxs()", "testcase": false, "constructor": false, "invocations": ["isHeldByCurrentThread", "writeLock", "sealSet", "keySet"]}, "repository": {"repo_id": 170496871, "url": "https://github.com/gridgain/gridgain", "stars": 46, "created": "2/13/2019 11:31:35 AM +00:00", "updates": "2020-01-27T16:02:24+00:00", "fork": "False", "license": "licensed"}}