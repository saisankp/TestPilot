{"test_class": {"identifier": "TenderPercentagesExcelControllerTest", "superclass": "extends AbstractExcelControllerTest", "interfaces": "", "fields": [{"original_string": "@Autowired\n    private TenderPercentagesExcelController tenderPercentagesExcelController;", "modifier": "@Autowired\n    private", "type": "TenderPercentagesExcelController", "declarator": "tenderPercentagesExcelController", "var_name": "tenderPercentagesExcelController"}], "file": "web/src/test/java/org/devgateway/ocds/web/rest/controller/excelchart/TenderPercentagesExcelControllerTest.java"}, "test_case": {"identifier": "tendersWithLinkedProcurementPlanExcelChart", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void tendersWithLinkedProcurementPlanExcelChart() throws Exception {\n        LangYearFilterPagingRequest filter = getLangYearFilterMockRequest();\n        tenderPercentagesExcelController.tendersWithLinkedProcurementPlanExcelChart(\n                filter,\n                mockHttpServletResponse);\n\n        final byte[] responseOutput = mockHttpServletResponse.getContentAsByteArray();\n        final Workbook workbook = new XSSFWorkbook(new ByteArrayInputStream(responseOutput));\n        Assert.assertNotNull(workbook);\n\n        final Sheet sheet = workbook.getSheet(ChartType.area.toString());\n        Assert.assertNotNull(\"check chart type, sheet name should be the same as the type\", sheet);\n\n        final XSSFDrawing drawing = (XSSFDrawing) sheet.getDrawingPatriarch();\n        final List<XSSFChart> charts =  drawing.getCharts();\n        Assert.assertEquals(\"number of charts\", 1, charts.size());\n\n        final XSSFChart chart = charts.get(0);\n        Assert.assertEquals(\"chart title\",\n                translationService.getValue(filter.getLanguage(), \"charts:percentWithTenders:title\")\n                , chart.getTitle().getString());\n\n        final List<? extends XSSFChartAxis> axis = chart.getAxis();\n        Assert.assertEquals(\"number of axis\", 2, axis.size());\n\n        final CTChart ctChart = chart.getCTChart();\n        Assert.assertEquals(\"Check if we have 1 area chart\", 1, ctChart.getPlotArea().getAreaChartArray().length);\n    }", "signature": "void tendersWithLinkedProcurementPlanExcelChart()", "full_signature": "@Test public void tendersWithLinkedProcurementPlanExcelChart()", "class_method_signature": "TenderPercentagesExcelControllerTest.tendersWithLinkedProcurementPlanExcelChart()", "testcase": true, "constructor": false, "invocations": ["getLangYearFilterMockRequest", "tendersWithLinkedProcurementPlanExcelChart", "getContentAsByteArray", "assertNotNull", "getSheet", "toString", "assertNotNull", "getDrawingPatriarch", "getCharts", "assertEquals", "size", "get", "assertEquals", "getValue", "getLanguage", "getString", "getTitle", "getAxis", "assertEquals", "size", "getCTChart", "assertEquals", "getAreaChartArray", "getPlotArea"]}, "focal_class": {"identifier": "TenderPercentagesExcelController", "superclass": "extends ExcelChartOCDSController", "interfaces": "", "fields": [{"original_string": "@Autowired\n    private ExcelChartGenerator excelChartGenerator;", "modifier": "@Autowired\n    private", "type": "ExcelChartGenerator", "declarator": "excelChartGenerator", "var_name": "excelChartGenerator"}, {"original_string": "@Autowired\n    private ExcelChartHelper excelChartHelper;", "modifier": "@Autowired\n    private", "type": "ExcelChartHelper", "declarator": "excelChartHelper", "var_name": "excelChartHelper"}, {"original_string": "@Autowired\n    private TenderPercentagesController tenderPercentagesController;", "modifier": "@Autowired\n    private", "type": "TenderPercentagesController", "declarator": "tenderPercentagesController", "var_name": "tenderPercentagesController"}], "methods": [{"identifier": "cancelledFundingPercentageExcelChart", "parameters": "(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                     final HttpServletResponse response)", "modifiers": "@ApiOperation(value = \"Exports *Cancelled funding (percentage)* dashboard in Excel format.\") @RequestMapping(value = \"/api/ocds/cancelledFundingPercentageExcelChart\", method = {RequestMethod.GET, RequestMethod.POST}) public", "return": "void", "signature": "void cancelledFundingPercentageExcelChart(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                     final HttpServletResponse response)", "full_signature": "@ApiOperation(value = \"Exports *Cancelled funding (percentage)* dashboard in Excel format.\") @RequestMapping(value = \"/api/ocds/cancelledFundingPercentageExcelChart\", method = {RequestMethod.GET, RequestMethod.POST}) public void cancelledFundingPercentageExcelChart(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                     final HttpServletResponse response)", "class_method_signature": "TenderPercentagesExcelController.cancelledFundingPercentageExcelChart(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                     final HttpServletResponse response)", "testcase": false, "constructor": false}, {"identifier": "percentTendersUsingEBidExcelChart", "parameters": "(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                  final HttpServletResponse response)", "modifiers": "@ApiOperation(value = \"Exports *Percent of Tenders Using e-Bid* dashboard in Excel format.\") @RequestMapping(value = \"/api/ocds/percentTendersUsingEBidExcelChart\", method = {RequestMethod.GET, RequestMethod.POST}) public", "return": "void", "signature": "void percentTendersUsingEBidExcelChart(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                  final HttpServletResponse response)", "full_signature": "@ApiOperation(value = \"Exports *Percent of Tenders Using e-Bid* dashboard in Excel format.\") @RequestMapping(value = \"/api/ocds/percentTendersUsingEBidExcelChart\", method = {RequestMethod.GET, RequestMethod.POST}) public void percentTendersUsingEBidExcelChart(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                  final HttpServletResponse response)", "class_method_signature": "TenderPercentagesExcelController.percentTendersUsingEBidExcelChart(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                  final HttpServletResponse response)", "testcase": false, "constructor": false}, {"identifier": "numberTendersUsingEBidExcelChart", "parameters": "(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                 final HttpServletResponse response)", "modifiers": "@ApiOperation(value = \"Exports *Number of eBid Awards* dashboard in Excel format.\") @RequestMapping(value = \"/api/ocds/numberTendersUsingEBidExcelChart\", method = {RequestMethod.GET, RequestMethod.POST}) public", "return": "void", "signature": "void numberTendersUsingEBidExcelChart(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                 final HttpServletResponse response)", "full_signature": "@ApiOperation(value = \"Exports *Number of eBid Awards* dashboard in Excel format.\") @RequestMapping(value = \"/api/ocds/numberTendersUsingEBidExcelChart\", method = {RequestMethod.GET, RequestMethod.POST}) public void numberTendersUsingEBidExcelChart(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                 final HttpServletResponse response)", "class_method_signature": "TenderPercentagesExcelController.numberTendersUsingEBidExcelChart(@ModelAttribute @Valid final LangYearFilterPagingRequest filter,\n                                                 final HttpServletResponse response)", "testcase": false, "constructor": false}, {"identifier": "tendersWithLinkedProcurementPlanExcelChart", "parameters": "(@ModelAttribute @Valid\n                                                           final LangYearFilterPagingRequest filter,\n                                                           final HttpServletResponse response)", "modifiers": "@ApiOperation(value = \"Exports *Percentage of plans with tender* dashboard in Excel format.\") @RequestMapping(value = \"/api/ocds/tendersWithLinkedProcurementPlanExcelChart\", method = {RequestMethod.GET, RequestMethod.POST}) public", "return": "void", "signature": "void tendersWithLinkedProcurementPlanExcelChart(@ModelAttribute @Valid\n                                                           final LangYearFilterPagingRequest filter,\n                                                           final HttpServletResponse response)", "full_signature": "@ApiOperation(value = \"Exports *Percentage of plans with tender* dashboard in Excel format.\") @RequestMapping(value = \"/api/ocds/tendersWithLinkedProcurementPlanExcelChart\", method = {RequestMethod.GET, RequestMethod.POST}) public void tendersWithLinkedProcurementPlanExcelChart(@ModelAttribute @Valid\n                                                           final LangYearFilterPagingRequest filter,\n                                                           final HttpServletResponse response)", "class_method_signature": "TenderPercentagesExcelController.tendersWithLinkedProcurementPlanExcelChart(@ModelAttribute @Valid\n                                                           final LangYearFilterPagingRequest filter,\n                                                           final HttpServletResponse response)", "testcase": false, "constructor": false}], "file": "web/src/main/java/org/devgateway/ocds/web/rest/controller/excelchart/TenderPercentagesExcelController.java"}, "focal_method": {"identifier": "tendersWithLinkedProcurementPlanExcelChart", "parameters": "(@ModelAttribute @Valid\n                                                           final LangYearFilterPagingRequest filter,\n                                                           final HttpServletResponse response)", "modifiers": "@ApiOperation(value = \"Exports *Percentage of plans with tender* dashboard in Excel format.\") @RequestMapping(value = \"/api/ocds/tendersWithLinkedProcurementPlanExcelChart\", method = {RequestMethod.GET, RequestMethod.POST}) public", "return": "void", "body": "@ApiOperation(value = \"Exports *Percentage of plans with tender* dashboard in Excel format.\")\n    @RequestMapping(value = \"/api/ocds/tendersWithLinkedProcurementPlanExcelChart\",\n            method = {RequestMethod.GET, RequestMethod.POST})\n    public void tendersWithLinkedProcurementPlanExcelChart(@ModelAttribute @Valid\n                                                           final LangYearFilterPagingRequest filter,\n                                                           final HttpServletResponse response) throws IOException {\n        final String chartTitle = translationService.getValue(filter.getLanguage(),\n                \"charts:percentWithTenders:title\");\n\n\n\n        // fetch the data that will be displayed in the chart\n        final List<Document> percentTendersWithLinkedProcurementPlan = tenderPercentagesController\n                .percentTendersWithLinkedProcurementPlan(filter);\n\n        final List<?> categories = excelChartHelper.getCategoriesFromDBObject(getExportYearMonthXAxis(filter),\n                percentTendersWithLinkedProcurementPlan);\n        final List<List<? extends Number>> values = new ArrayList<>();\n\n        final List<Number> percentTenders = excelChartHelper.getValuesFromDBObject(\n                percentTendersWithLinkedProcurementPlan, categories, getExportYearMonthXAxis(filter),\n                TenderPercentagesController.Keys.PERCENT_TENDERS);\n        values.add(percentTenders);\n\n        final List<String> seriesTitle = Arrays.asList(\n                translationService.getValue(filter.getLanguage(),\n                        \"charts:percentWithTenders:yAxisTitle\"));\n\n        response.setContentType(\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\");\n        response.setHeader(\"Content-Disposition\", \"attachment; filename=\" + chartTitle + \".xlsx\");\n        response.getOutputStream().write(\n                excelChartGenerator.getExcelChart(\n                        ChartType.area,\n                        chartTitle,\n                        seriesTitle,\n                        categories, values));\n    }", "signature": "void tendersWithLinkedProcurementPlanExcelChart(@ModelAttribute @Valid\n                                                           final LangYearFilterPagingRequest filter,\n                                                           final HttpServletResponse response)", "full_signature": "@ApiOperation(value = \"Exports *Percentage of plans with tender* dashboard in Excel format.\") @RequestMapping(value = \"/api/ocds/tendersWithLinkedProcurementPlanExcelChart\", method = {RequestMethod.GET, RequestMethod.POST}) public void tendersWithLinkedProcurementPlanExcelChart(@ModelAttribute @Valid\n                                                           final LangYearFilterPagingRequest filter,\n                                                           final HttpServletResponse response)", "class_method_signature": "TenderPercentagesExcelController.tendersWithLinkedProcurementPlanExcelChart(@ModelAttribute @Valid\n                                                           final LangYearFilterPagingRequest filter,\n                                                           final HttpServletResponse response)", "testcase": false, "constructor": false, "invocations": ["getValue", "getLanguage", "percentTendersWithLinkedProcurementPlan", "getCategoriesFromDBObject", "getExportYearMonthXAxis", "getValuesFromDBObject", "getExportYearMonthXAxis", "add", "asList", "getValue", "getLanguage", "setContentType", "setHeader", "write", "getOutputStream", "getExcelChart"]}, "repository": {"repo_id": 59118773, "url": "https://github.com/devgateway/oc-explorer", "language": "Java", "is_fork": false, "fork_count": 2, "stargazer_count": 5, "size": 9004, "license": "licensed"}}