{"test_class": {"identifier": "AbstractConditionShardLocatorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private TestAbstractConditionShardLocator test = new TestAbstractConditionShardLocator();", "modifier": "private", "type": "TestAbstractConditionShardLocator", "declarator": "test = new TestAbstractConditionShardLocator()", "var_name": "test"}, {"original_string": "private TestAbstractConditionShardLocator test2 = new TestAbstractConditionShardLocator() {\n        @Override\n        public Set<String> locateForEqual(ConditionContext context) {\n            return set(context.getValue().toString());\n        }\n    };", "modifier": "private", "type": "TestAbstractConditionShardLocator", "declarator": "test2 = new TestAbstractConditionShardLocator() {\n        @Override\n        public Set<String> locateForEqual(ConditionContext context) {\n            return set(context.getValue().toString());\n        }\n    }", "var_name": "test2"}], "file": "das-client/src/test/java/com/ppdai/das/strategy/AbstractConditionShardLocatorTest.java"}, "test_case": {"identifier": "testLocateForCombination", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testLocateForCombination() {\n        assertEquals(set(\"2\",  \"3\"), \n                test2.locateForCombination(exp(OperatorEnum.EQUAL, \"1\"), OperatorEnum.EQUAL, \"2\", OperatorEnum.EQUAL, \"3\"));\n        \n        ConditionContext ctx = new ShardingContext(\"appId\", \"logicDbName\", set(\"2\", \"3\"), new Hints(), ConditionList.andList()).create(new ColumnCondition(OperatorEnum.EQUAL, \"tableName\", \"col\", \"\"));\n        \n        // Test for full shards\n        assertEquals(set(\"2\", \"3\"), test2.locateForCombination(ctx, OperatorEnum.EQUAL, \"2\", OperatorEnum.EQUAL, \"3\"));\n    }", "signature": "void testLocateForCombination()", "full_signature": "@Test public void testLocateForCombination()", "class_method_signature": "AbstractConditionShardLocatorTest.testLocateForCombination()", "testcase": true, "constructor": false, "invocations": ["assertEquals", "set", "locateForCombination", "exp", "create", "set", "andList", "assertEquals", "set", "locateForCombination"]}, "focal_class": {"identifier": "AbstractConditionShardLocator", "superclass": "", "interfaces": "", "fields": [], "methods": [{"identifier": "locateForEqual", "parameters": "(CTX context)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForEqual(CTX context)", "full_signature": "public abstract Set<String> locateForEqual(CTX context)", "class_method_signature": "AbstractConditionShardLocator.locateForEqual(CTX context)", "testcase": false, "constructor": false}, {"identifier": "locateForNotEqual", "parameters": "(CTX ctx)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForNotEqual(CTX ctx)", "full_signature": "public abstract Set<String> locateForNotEqual(CTX ctx)", "class_method_signature": "AbstractConditionShardLocator.locateForNotEqual(CTX ctx)", "testcase": false, "constructor": false}, {"identifier": "locateForGreaterThan", "parameters": "(CTX context)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForGreaterThan(CTX context)", "full_signature": "public abstract Set<String> locateForGreaterThan(CTX context)", "class_method_signature": "AbstractConditionShardLocator.locateForGreaterThan(CTX context)", "testcase": false, "constructor": false}, {"identifier": "locateForGreaterThanOrEqual", "parameters": "(CTX ctx)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForGreaterThanOrEqual(CTX ctx)", "full_signature": "public abstract Set<String> locateForGreaterThanOrEqual(CTX ctx)", "class_method_signature": "AbstractConditionShardLocator.locateForGreaterThanOrEqual(CTX ctx)", "testcase": false, "constructor": false}, {"identifier": "locateForLessThan", "parameters": "(CTX context)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForLessThan(CTX context)", "full_signature": "public abstract Set<String> locateForLessThan(CTX context)", "class_method_signature": "AbstractConditionShardLocator.locateForLessThan(CTX context)", "testcase": false, "constructor": false}, {"identifier": "locateForLessThanOrEqual", "parameters": "(CTX ctx)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForLessThanOrEqual(CTX ctx)", "full_signature": "public abstract Set<String> locateForLessThanOrEqual(CTX ctx)", "class_method_signature": "AbstractConditionShardLocator.locateForLessThanOrEqual(CTX ctx)", "testcase": false, "constructor": false}, {"identifier": "locateForBetween", "parameters": "(CTX ctx)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForBetween(CTX ctx)", "full_signature": "public abstract Set<String> locateForBetween(CTX ctx)", "class_method_signature": "AbstractConditionShardLocator.locateForBetween(CTX ctx)", "testcase": false, "constructor": false}, {"identifier": "locateForNotBetween", "parameters": "(CTX ctx)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForNotBetween(CTX ctx)", "full_signature": "public abstract Set<String> locateForNotBetween(CTX ctx)", "class_method_signature": "AbstractConditionShardLocator.locateForNotBetween(CTX ctx)", "testcase": false, "constructor": false}, {"identifier": "locateForIn", "parameters": "(CTX context)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForIn(CTX context)", "full_signature": "public abstract Set<String> locateForIn(CTX context)", "class_method_signature": "AbstractConditionShardLocator.locateForIn(CTX context)", "testcase": false, "constructor": false}, {"identifier": "locateForNotIn", "parameters": "(CTX context)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForNotIn(CTX context)", "full_signature": "public abstract Set<String> locateForNotIn(CTX context)", "class_method_signature": "AbstractConditionShardLocator.locateForNotIn(CTX context)", "testcase": false, "constructor": false}, {"identifier": "locateForLike", "parameters": "(CTX context)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForLike(CTX context)", "full_signature": "public abstract Set<String> locateForLike(CTX context)", "class_method_signature": "AbstractConditionShardLocator.locateForLike(CTX context)", "testcase": false, "constructor": false}, {"identifier": "locateForNotLike", "parameters": "(CTX context)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForNotLike(CTX context)", "full_signature": "public abstract Set<String> locateForNotLike(CTX context)", "class_method_signature": "AbstractConditionShardLocator.locateForNotLike(CTX context)", "testcase": false, "constructor": false}, {"identifier": "locateForIsNull", "parameters": "(CTX context)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForIsNull(CTX context)", "full_signature": "public abstract Set<String> locateForIsNull(CTX context)", "class_method_signature": "AbstractConditionShardLocator.locateForIsNull(CTX context)", "testcase": false, "constructor": false}, {"identifier": "locateForIsNotNull", "parameters": "(CTX context)", "modifiers": "public abstract", "return": "Set<String>", "signature": "Set<String> locateForIsNotNull(CTX context)", "full_signature": "public abstract Set<String> locateForIsNotNull(CTX context)", "class_method_signature": "AbstractConditionShardLocator.locateForIsNotNull(CTX context)", "testcase": false, "constructor": false}, {"identifier": "getAllShards", "parameters": "(CTX context)", "modifiers": "public", "return": "Set<String>", "signature": "Set<String> getAllShards(CTX context)", "full_signature": "public Set<String> getAllShards(CTX context)", "class_method_signature": "AbstractConditionShardLocator.getAllShards(CTX context)", "testcase": false, "constructor": false}, {"identifier": "createConditionContext", "parameters": "(CTX conditionContext, OperatorEnum newOperator, Object newValue)", "modifiers": "@SuppressWarnings(\"unchecked\") protected", "return": "CTX", "signature": "CTX createConditionContext(CTX conditionContext, OperatorEnum newOperator, Object newValue)", "full_signature": "@SuppressWarnings(\"unchecked\") protected CTX createConditionContext(CTX conditionContext, OperatorEnum newOperator, Object newValue)", "class_method_signature": "AbstractConditionShardLocator.createConditionContext(CTX conditionContext, OperatorEnum newOperator, Object newValue)", "testcase": false, "constructor": false}, {"identifier": "locateForCombination", "parameters": "(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "modifiers": "protected", "return": "Set<String>", "signature": "Set<String> locateForCombination(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "full_signature": "protected Set<String> locateForCombination(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "class_method_signature": "AbstractConditionShardLocator.locateForCombination(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "testcase": false, "constructor": false}, {"identifier": "locateForIntersection", "parameters": "(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "modifiers": "protected", "return": "Set<String>", "signature": "Set<String> locateForIntersection(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "full_signature": "protected Set<String> locateForIntersection(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "class_method_signature": "AbstractConditionShardLocator.locateForIntersection(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "testcase": false, "constructor": false}, {"identifier": "exclude", "parameters": "(CTX context, Set<String> shards)", "modifiers": "protected", "return": "Set<String>", "signature": "Set<String> exclude(CTX context, Set<String> shards)", "full_signature": "protected Set<String> exclude(CTX context, Set<String> shards)", "class_method_signature": "AbstractConditionShardLocator.exclude(CTX context, Set<String> shards)", "testcase": false, "constructor": false}, {"identifier": "isAlreadyAllShards", "parameters": "(Set<String> allShards, Set<String> shards)", "modifiers": "protected", "return": "boolean", "signature": "boolean isAlreadyAllShards(Set<String> allShards, Set<String> shards)", "full_signature": "protected boolean isAlreadyAllShards(Set<String> allShards, Set<String> shards)", "class_method_signature": "AbstractConditionShardLocator.isAlreadyAllShards(Set<String> allShards, Set<String> shards)", "testcase": false, "constructor": false}, {"identifier": "toSet", "parameters": "(String id)", "modifiers": "protected", "return": "Set<String>", "signature": "Set<String> toSet(String id)", "full_signature": "protected Set<String> toSet(String id)", "class_method_signature": "AbstractConditionShardLocator.toSet(String id)", "testcase": false, "constructor": false}, {"identifier": "locateShards", "parameters": "(CTX context)", "modifiers": "public", "return": "Set<String>", "signature": "Set<String> locateShards(CTX context)", "full_signature": "public Set<String> locateShards(CTX context)", "class_method_signature": "AbstractConditionShardLocator.locateShards(CTX context)", "testcase": false, "constructor": false}], "file": "das-client/src/main/java/com/ppdai/das/strategy/AbstractConditionShardLocator.java"}, "focal_method": {"identifier": "locateForCombination", "parameters": "(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "modifiers": "protected", "return": "Set<String>", "body": "protected Set<String> locateForCombination(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2) {\n        // Wrap into a new Set in case what return is read-only.\n        Set<String> range = new HashSet<>(locateShards(createConditionContext(context, op1, value1)));\n        \n        if(isAlreadyAllShards(getAllShards(context), range)) {\n            return range;\n        }\n        \n        range.addAll(locateShards(createConditionContext(context, op2, value2)));\n        return range;\n    }", "signature": "Set<String> locateForCombination(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "full_signature": "protected Set<String> locateForCombination(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "class_method_signature": "AbstractConditionShardLocator.locateForCombination(CTX context, OperatorEnum op1, Object value1, OperatorEnum op2, Object value2)", "testcase": false, "constructor": false, "invocations": ["locateShards", "createConditionContext", "isAlreadyAllShards", "getAllShards", "addAll", "locateShards", "createConditionContext"]}, "repository": {"repo_id": 214933909, "url": "https://github.com/ppdaicorp/das", "stars": 55, "created": "10/14/2019 2:49:17 AM +00:00", "updates": "2020-01-20T09:24:23+00:00", "fork": "False", "license": "licensed"}}