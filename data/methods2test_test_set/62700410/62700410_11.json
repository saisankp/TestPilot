{"test_class": {"identifier": "TestNativeImageLoader", "superclass": "", "interfaces": "", "fields": [{"original_string": "static final long seed = 10;", "modifier": "static final", "type": "long", "declarator": "seed = 10", "var_name": "seed"}, {"original_string": "static final Random rng = new Random(seed);", "modifier": "static final", "type": "Random", "declarator": "rng = new Random(seed)", "var_name": "rng"}], "file": "datavec-data/datavec-data-image/src/test/java/org/datavec/image/loader/TestNativeImageLoader.java"}, "test_case": {"identifier": "testBufferRealloc", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testBufferRealloc() throws Exception {\n        Field f = NativeImageLoader.class.getDeclaredField(\"buffer\");\n        Field m = NativeImageLoader.class.getDeclaredField(\"bufferMat\");\n        f.setAccessible(true);\n        m.setAccessible(true);\n\n        File f1 = new ClassPathResource(\"voc/2007/JPEGImages/000005.jpg\").getFile();\n        File f2 = new ClassPathResource(\"voc/2007/JPEGImages/000007.jpg\").getFile();\n\n        //Start with a large buffer\n        byte[] buffer = new byte[20*1024*1024];\n        Mat bufferMat = new Mat(buffer);\n\n        NativeImageLoader loader = new NativeImageLoader(28, 28, 1);\n        f.set(loader, buffer);\n        m.set(loader, bufferMat);\n\n        INDArray img1LargeBuffer = loader.asMatrix(f1);\n        INDArray img2LargeBuffer = loader.asMatrix(f2);\n\n        //Check multiple reads:\n        INDArray img1LargeBuffer2 = loader.asMatrix(f1);\n        INDArray img1LargeBuffer3 = loader.asMatrix(f1);\n        assertEquals(img1LargeBuffer2, img1LargeBuffer3);\n\n        INDArray img2LargeBuffer2 = loader.asMatrix(f1);\n        INDArray img2LargeBuffer3 = loader.asMatrix(f1);\n        assertEquals(img2LargeBuffer2, img2LargeBuffer3);\n\n        //Clear the buffer and re-read:\n        f.set(loader, null);\n        INDArray img1NoBuffer1 = loader.asMatrix(f1);\n        INDArray img1NoBuffer2 = loader.asMatrix(f1);\n        assertEquals(img1LargeBuffer, img1NoBuffer1);\n        assertEquals(img1LargeBuffer, img1NoBuffer2);\n\n        f.set(loader, null);\n        INDArray img2NoBuffer1 = loader.asMatrix(f2);\n        INDArray img2NoBuffer2 = loader.asMatrix(f2);\n        assertEquals(img2LargeBuffer, img2NoBuffer1);\n        assertEquals(img2LargeBuffer, img2NoBuffer2);\n\n        //Assign much too small buffer:\n        buffer = new byte[10];\n        bufferMat = new Mat(buffer);\n        f.set(loader, buffer);\n        m.set(loader, bufferMat);\n        INDArray img1SmallBuffer1 = loader.asMatrix(f1);\n        INDArray img1SmallBuffer2 = loader.asMatrix(f1);\n        assertEquals(img1LargeBuffer, img1SmallBuffer1);\n        assertEquals(img1LargeBuffer, img1SmallBuffer2);\n\n        f.set(loader, buffer);\n        m.set(loader, bufferMat);\n        INDArray img2SmallBuffer1 = loader.asMatrix(f2);\n        INDArray img2SmallBuffer2 = loader.asMatrix(f2);\n        assertEquals(img2LargeBuffer, img2SmallBuffer1);\n        assertEquals(img2LargeBuffer, img2SmallBuffer2);\n\n        //Assign an exact buffer:\n        try(InputStream is = new FileInputStream(f1)){\n            byte[] temp = IOUtils.toByteArray(is);\n            buffer = new byte[temp.length];\n            bufferMat = new Mat(buffer);\n        }\n        f.set(loader, buffer);\n        m.set(loader, bufferMat);\n\n        INDArray img1ExactBuffer = loader.asMatrix(f1);\n        assertEquals(img1LargeBuffer, img1ExactBuffer);\n    }", "signature": "void testBufferRealloc()", "full_signature": "@Test public void testBufferRealloc()", "class_method_signature": "TestNativeImageLoader.testBufferRealloc()", "testcase": true, "constructor": false, "invocations": ["getDeclaredField", "getDeclaredField", "setAccessible", "setAccessible", "getFile", "getFile", "set", "set", "asMatrix", "asMatrix", "asMatrix", "asMatrix", "assertEquals", "asMatrix", "asMatrix", "assertEquals", "set", "asMatrix", "asMatrix", "assertEquals", "assertEquals", "set", "asMatrix", "asMatrix", "assertEquals", "assertEquals", "set", "set", "asMatrix", "asMatrix", "assertEquals", "assertEquals", "set", "set", "asMatrix", "asMatrix", "assertEquals", "assertEquals", "toByteArray", "set", "set", "asMatrix", "assertEquals"]}, "focal_class": {"identifier": "NativeImageLoader", "superclass": "extends BaseImageLoader", "interfaces": "", "fields": [{"original_string": "private static final int MIN_BUFFER_STEP_SIZE = 1024*1024;", "modifier": "private static final", "type": "int", "declarator": "MIN_BUFFER_STEP_SIZE = 1024*1024", "var_name": "MIN_BUFFER_STEP_SIZE"}, {"original_string": "private byte[] buffer = null;", "modifier": "private", "type": "byte[]", "declarator": "buffer = null", "var_name": "buffer"}, {"original_string": "private Mat bufferMat = null;", "modifier": "private", "type": "Mat", "declarator": "bufferMat = null", "var_name": "bufferMat"}, {"original_string": "public static final String[] ALLOWED_FORMATS = {\"bmp\", \"gif\", \"jpg\", \"jpeg\", \"jp2\", \"pbm\", \"pgm\", \"ppm\", \"pnm\",\n                    \"png\", \"tif\", \"tiff\", \"exr\", \"webp\", \"BMP\", \"GIF\", \"JPG\", \"JPEG\", \"JP2\", \"PBM\", \"PGM\", \"PPM\", \"PNM\",\n                    \"PNG\", \"TIF\", \"TIFF\", \"EXR\", \"WEBP\"};", "modifier": "public static final", "type": "String[]", "declarator": "ALLOWED_FORMATS = {\"bmp\", \"gif\", \"jpg\", \"jpeg\", \"jp2\", \"pbm\", \"pgm\", \"ppm\", \"pnm\",\n                    \"png\", \"tif\", \"tiff\", \"exr\", \"webp\", \"BMP\", \"GIF\", \"JPG\", \"JPEG\", \"JP2\", \"PBM\", \"PGM\", \"PPM\", \"PNM\",\n                    \"PNG\", \"TIF\", \"TIFF\", \"EXR\", \"WEBP\"}", "var_name": "ALLOWED_FORMATS"}, {"original_string": "protected OpenCVFrameConverter.ToMat converter = new OpenCVFrameConverter.ToMat();", "modifier": "protected", "type": "OpenCVFrameConverter.ToMat", "declarator": "converter = new OpenCVFrameConverter.ToMat()", "var_name": "converter"}], "methods": [{"identifier": "NativeImageLoader", "parameters": "()", "modifiers": "public", "return": "", "signature": " NativeImageLoader()", "full_signature": "public  NativeImageLoader()", "class_method_signature": "NativeImageLoader.NativeImageLoader()", "testcase": false, "constructor": true}, {"identifier": "NativeImageLoader", "parameters": "(int height, int width)", "modifiers": "public", "return": "", "signature": " NativeImageLoader(int height, int width)", "full_signature": "public  NativeImageLoader(int height, int width)", "class_method_signature": "NativeImageLoader.NativeImageLoader(int height, int width)", "testcase": false, "constructor": true}, {"identifier": "NativeImageLoader", "parameters": "(int height, int width, int channels)", "modifiers": "public", "return": "", "signature": " NativeImageLoader(int height, int width, int channels)", "full_signature": "public  NativeImageLoader(int height, int width, int channels)", "class_method_signature": "NativeImageLoader.NativeImageLoader(int height, int width, int channels)", "testcase": false, "constructor": true}, {"identifier": "NativeImageLoader", "parameters": "(int height, int width, int channels, boolean centerCropIfNeeded)", "modifiers": "public", "return": "", "signature": " NativeImageLoader(int height, int width, int channels, boolean centerCropIfNeeded)", "full_signature": "public  NativeImageLoader(int height, int width, int channels, boolean centerCropIfNeeded)", "class_method_signature": "NativeImageLoader.NativeImageLoader(int height, int width, int channels, boolean centerCropIfNeeded)", "testcase": false, "constructor": true}, {"identifier": "NativeImageLoader", "parameters": "(int height, int width, int channels, ImageTransform imageTransform)", "modifiers": "public", "return": "", "signature": " NativeImageLoader(int height, int width, int channels, ImageTransform imageTransform)", "full_signature": "public  NativeImageLoader(int height, int width, int channels, ImageTransform imageTransform)", "class_method_signature": "NativeImageLoader.NativeImageLoader(int height, int width, int channels, ImageTransform imageTransform)", "testcase": false, "constructor": true}, {"identifier": "NativeImageLoader", "parameters": "(int height, int width, int channels, MultiPageMode mode)", "modifiers": "public", "return": "", "signature": " NativeImageLoader(int height, int width, int channels, MultiPageMode mode)", "full_signature": "public  NativeImageLoader(int height, int width, int channels, MultiPageMode mode)", "class_method_signature": "NativeImageLoader.NativeImageLoader(int height, int width, int channels, MultiPageMode mode)", "testcase": false, "constructor": true}, {"identifier": "NativeImageLoader", "parameters": "(NativeImageLoader other)", "modifiers": "protected", "return": "", "signature": " NativeImageLoader(NativeImageLoader other)", "full_signature": "protected  NativeImageLoader(NativeImageLoader other)", "class_method_signature": "NativeImageLoader.NativeImageLoader(NativeImageLoader other)", "testcase": false, "constructor": true}, {"identifier": "getAllowedFormats", "parameters": "()", "modifiers": "@Override public", "return": "String[]", "signature": "String[] getAllowedFormats()", "full_signature": "@Override public String[] getAllowedFormats()", "class_method_signature": "NativeImageLoader.getAllowedFormats()", "testcase": false, "constructor": false}, {"identifier": "asRowVector", "parameters": "(File f)", "modifiers": "@Override public", "return": "INDArray", "signature": "INDArray asRowVector(File f)", "full_signature": "@Override public INDArray asRowVector(File f)", "class_method_signature": "NativeImageLoader.asRowVector(File f)", "testcase": false, "constructor": false}, {"identifier": "asRowVector", "parameters": "(InputStream is)", "modifiers": "@Override public", "return": "INDArray", "signature": "INDArray asRowVector(InputStream is)", "full_signature": "@Override public INDArray asRowVector(InputStream is)", "class_method_signature": "NativeImageLoader.asRowVector(InputStream is)", "testcase": false, "constructor": false}, {"identifier": "asRowVector", "parameters": "(Object image)", "modifiers": "public", "return": "INDArray", "signature": "INDArray asRowVector(Object image)", "full_signature": "public INDArray asRowVector(Object image)", "class_method_signature": "NativeImageLoader.asRowVector(Object image)", "testcase": false, "constructor": false}, {"identifier": "asRowVector", "parameters": "(Frame image)", "modifiers": "public", "return": "INDArray", "signature": "INDArray asRowVector(Frame image)", "full_signature": "public INDArray asRowVector(Frame image)", "class_method_signature": "NativeImageLoader.asRowVector(Frame image)", "testcase": false, "constructor": false}, {"identifier": "asRowVector", "parameters": "(Mat image)", "modifiers": "public", "return": "INDArray", "signature": "INDArray asRowVector(Mat image)", "full_signature": "public INDArray asRowVector(Mat image)", "class_method_signature": "NativeImageLoader.asRowVector(Mat image)", "testcase": false, "constructor": false}, {"identifier": "convert", "parameters": "(PIX pix)", "modifiers": "static", "return": "Mat", "signature": "Mat convert(PIX pix)", "full_signature": "static Mat convert(PIX pix)", "class_method_signature": "NativeImageLoader.convert(PIX pix)", "testcase": false, "constructor": false}, {"identifier": "asMatrix", "parameters": "(File f)", "modifiers": "@Override public", "return": "INDArray", "signature": "INDArray asMatrix(File f)", "full_signature": "@Override public INDArray asMatrix(File f)", "class_method_signature": "NativeImageLoader.asMatrix(File f)", "testcase": false, "constructor": false}, {"identifier": "asMatrix", "parameters": "(InputStream is)", "modifiers": "@Override public", "return": "INDArray", "signature": "INDArray asMatrix(InputStream is)", "full_signature": "@Override public INDArray asMatrix(InputStream is)", "class_method_signature": "NativeImageLoader.asMatrix(InputStream is)", "testcase": false, "constructor": false}, {"identifier": "streamToMat", "parameters": "(InputStream is)", "modifiers": "private", "return": "Mat", "signature": "Mat streamToMat(InputStream is)", "full_signature": "private Mat streamToMat(InputStream is)", "class_method_signature": "NativeImageLoader.streamToMat(InputStream is)", "testcase": false, "constructor": false}, {"identifier": "asImageMatrix", "parameters": "(File f)", "modifiers": "@Override public", "return": "Image", "signature": "Image asImageMatrix(File f)", "full_signature": "@Override public Image asImageMatrix(File f)", "class_method_signature": "NativeImageLoader.asImageMatrix(File f)", "testcase": false, "constructor": false}, {"identifier": "asImageMatrix", "parameters": "(InputStream is)", "modifiers": "@Override public", "return": "Image", "signature": "Image asImageMatrix(InputStream is)", "full_signature": "@Override public Image asImageMatrix(InputStream is)", "class_method_signature": "NativeImageLoader.asImageMatrix(InputStream is)", "testcase": false, "constructor": false}, {"identifier": "asMatrix", "parameters": "(Object image)", "modifiers": "public", "return": "INDArray", "signature": "INDArray asMatrix(Object image)", "full_signature": "public INDArray asMatrix(Object image)", "class_method_signature": "NativeImageLoader.asMatrix(Object image)", "testcase": false, "constructor": false}, {"identifier": "fillNDArray", "parameters": "(Mat image, INDArray ret)", "modifiers": "protected", "return": "void", "signature": "void fillNDArray(Mat image, INDArray ret)", "full_signature": "protected void fillNDArray(Mat image, INDArray ret)", "class_method_signature": "NativeImageLoader.fillNDArray(Mat image, INDArray ret)", "testcase": false, "constructor": false}, {"identifier": "asMatrixView", "parameters": "(InputStream is, INDArray view)", "modifiers": "public", "return": "void", "signature": "void asMatrixView(InputStream is, INDArray view)", "full_signature": "public void asMatrixView(InputStream is, INDArray view)", "class_method_signature": "NativeImageLoader.asMatrixView(InputStream is, INDArray view)", "testcase": false, "constructor": false}, {"identifier": "asMatrixView", "parameters": "(File f, INDArray view)", "modifiers": "public", "return": "void", "signature": "void asMatrixView(File f, INDArray view)", "full_signature": "public void asMatrixView(File f, INDArray view)", "class_method_signature": "NativeImageLoader.asMatrixView(File f, INDArray view)", "testcase": false, "constructor": false}, {"identifier": "asMatrixView", "parameters": "(Mat image, INDArray view)", "modifiers": "public", "return": "void", "signature": "void asMatrixView(Mat image, INDArray view)", "full_signature": "public void asMatrixView(Mat image, INDArray view)", "class_method_signature": "NativeImageLoader.asMatrixView(Mat image, INDArray view)", "testcase": false, "constructor": false}, {"identifier": "asMatrix", "parameters": "(Frame image)", "modifiers": "public", "return": "INDArray", "signature": "INDArray asMatrix(Frame image)", "full_signature": "public INDArray asMatrix(Frame image)", "class_method_signature": "NativeImageLoader.asMatrix(Frame image)", "testcase": false, "constructor": false}, {"identifier": "asMatrix", "parameters": "(Mat image)", "modifiers": "public", "return": "INDArray", "signature": "INDArray asMatrix(Mat image)", "full_signature": "public INDArray asMatrix(Mat image)", "class_method_signature": "NativeImageLoader.asMatrix(Mat image)", "testcase": false, "constructor": false}, {"identifier": "transformImage", "parameters": "(Mat image, INDArray ret)", "modifiers": "protected", "return": "INDArray", "signature": "INDArray transformImage(Mat image, INDArray ret)", "full_signature": "protected INDArray transformImage(Mat image, INDArray ret)", "class_method_signature": "NativeImageLoader.transformImage(Mat image, INDArray ret)", "testcase": false, "constructor": false}, {"identifier": "centerCropIfNeeded", "parameters": "(Mat img)", "modifiers": "protected", "return": "Mat", "signature": "Mat centerCropIfNeeded(Mat img)", "full_signature": "protected Mat centerCropIfNeeded(Mat img)", "class_method_signature": "NativeImageLoader.centerCropIfNeeded(Mat img)", "testcase": false, "constructor": false}, {"identifier": "scalingIfNeed", "parameters": "(Mat image)", "modifiers": "protected", "return": "Mat", "signature": "Mat scalingIfNeed(Mat image)", "full_signature": "protected Mat scalingIfNeed(Mat image)", "class_method_signature": "NativeImageLoader.scalingIfNeed(Mat image)", "testcase": false, "constructor": false}, {"identifier": "scalingIfNeed", "parameters": "(Mat image, int dstHeight, int dstWidth)", "modifiers": "protected", "return": "Mat", "signature": "Mat scalingIfNeed(Mat image, int dstHeight, int dstWidth)", "full_signature": "protected Mat scalingIfNeed(Mat image, int dstHeight, int dstWidth)", "class_method_signature": "NativeImageLoader.scalingIfNeed(Mat image, int dstHeight, int dstWidth)", "testcase": false, "constructor": false}, {"identifier": "asWritable", "parameters": "(File f)", "modifiers": "public", "return": "ImageWritable", "signature": "ImageWritable asWritable(File f)", "full_signature": "public ImageWritable asWritable(File f)", "class_method_signature": "NativeImageLoader.asWritable(File f)", "testcase": false, "constructor": false}, {"identifier": "asMatrix", "parameters": "(ImageWritable writable)", "modifiers": "public", "return": "INDArray", "signature": "INDArray asMatrix(ImageWritable writable)", "full_signature": "public INDArray asMatrix(ImageWritable writable)", "class_method_signature": "NativeImageLoader.asMatrix(ImageWritable writable)", "testcase": false, "constructor": false}, {"identifier": "asFrame", "parameters": "(INDArray array)", "modifiers": "public", "return": "Frame", "signature": "Frame asFrame(INDArray array)", "full_signature": "public Frame asFrame(INDArray array)", "class_method_signature": "NativeImageLoader.asFrame(INDArray array)", "testcase": false, "constructor": false}, {"identifier": "asFrame", "parameters": "(INDArray array, int dataType)", "modifiers": "public", "return": "Frame", "signature": "Frame asFrame(INDArray array, int dataType)", "full_signature": "public Frame asFrame(INDArray array, int dataType)", "class_method_signature": "NativeImageLoader.asFrame(INDArray array, int dataType)", "testcase": false, "constructor": false}, {"identifier": "asMat", "parameters": "(INDArray array)", "modifiers": "public", "return": "Mat", "signature": "Mat asMat(INDArray array)", "full_signature": "public Mat asMat(INDArray array)", "class_method_signature": "NativeImageLoader.asMat(INDArray array)", "testcase": false, "constructor": false}, {"identifier": "asMat", "parameters": "(INDArray array, int dataType)", "modifiers": "public", "return": "Mat", "signature": "Mat asMat(INDArray array, int dataType)", "full_signature": "public Mat asMat(INDArray array, int dataType)", "class_method_signature": "NativeImageLoader.asMat(INDArray array, int dataType)", "testcase": false, "constructor": false}, {"identifier": "asMatrix", "parameters": "(BytePointer bytes, int length)", "modifiers": "private", "return": "INDArray", "signature": "INDArray asMatrix(BytePointer bytes, int length)", "full_signature": "private INDArray asMatrix(BytePointer bytes, int length)", "class_method_signature": "NativeImageLoader.asMatrix(BytePointer bytes, int length)", "testcase": false, "constructor": false}], "file": "datavec-data/datavec-data-image/src/main/java/org/datavec/image/loader/NativeImageLoader.java"}, "focal_method": {"identifier": "asMatrix", "parameters": "(File f)", "modifiers": "@Override public", "return": "INDArray", "body": "@Override\n    public INDArray asMatrix(File f) throws IOException {\n        try (BufferedInputStream bis = new BufferedInputStream(new FileInputStream(f))) {\n            return asMatrix(bis);\n        }\n    }", "signature": "INDArray asMatrix(File f)", "full_signature": "@Override public INDArray asMatrix(File f)", "class_method_signature": "NativeImageLoader.asMatrix(File f)", "testcase": false, "constructor": false, "invocations": ["asMatrix"]}, "repository": {"repo_id": 62700410, "url": "https://github.com/deeplearning4j/DataVec", "language": "Java", "is_fork": false, "fork_count": 174, "stargazer_count": 260, "size": 39842, "license": "licensed"}}