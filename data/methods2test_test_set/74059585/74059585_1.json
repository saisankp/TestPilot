{"test_class": {"identifier": "TracingCommandListenerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final BsonDocument findCommand = BsonDocument\n      .parse(\"{'find': 'test-collection', 'batchSize': 20}\");", "modifier": "private static final", "type": "BsonDocument", "declarator": "findCommand = BsonDocument\n      .parse(\"{'find': 'test-collection', 'batchSize': 20}\")", "var_name": "findCommand"}, {"original_string": "private static final CommandStartedEvent findStartEvent = new CommandStartedEvent(1, null,\n      \"test-database\", \"find\", findCommand);", "modifier": "private static final", "type": "CommandStartedEvent", "declarator": "findStartEvent = new CommandStartedEvent(1, null,\n      \"test-database\", \"find\", findCommand)", "var_name": "findStartEvent"}, {"original_string": "private static final CommandSucceededEvent findSucceededEvent = new CommandSucceededEvent(1, null,\n      \"find\", new BsonDocument(), 150);", "modifier": "private static final", "type": "CommandSucceededEvent", "declarator": "findSucceededEvent = new CommandSucceededEvent(1, null,\n      \"find\", new BsonDocument(), 150)", "var_name": "findSucceededEvent"}, {"original_string": "private static final CommandFailedEvent findFailedEvent = new CommandFailedEvent(1, null, \"find\",\n      125, new Throwable(\"Error!\"));", "modifier": "private static final", "type": "CommandFailedEvent", "declarator": "findFailedEvent = new CommandFailedEvent(1, null, \"find\",\n      125, new Throwable(\"Error!\"))", "var_name": "findFailedEvent"}, {"original_string": "private static final BsonDocument createCommand = BsonDocument\n      .parse(\"{'create': 'test-collection2'}\");", "modifier": "private static final", "type": "BsonDocument", "declarator": "createCommand = BsonDocument\n      .parse(\"{'create': 'test-collection2'}\")", "var_name": "createCommand"}, {"original_string": "private static final CommandStartedEvent createStartEvent = new CommandStartedEvent(2, null,\n      \"test-database\", \"create\", createCommand);", "modifier": "private static final", "type": "CommandStartedEvent", "declarator": "createStartEvent = new CommandStartedEvent(2, null,\n      \"test-database\", \"create\", createCommand)", "var_name": "createStartEvent"}, {"original_string": "private TestTracer tracer;", "modifier": "private", "type": "TestTracer", "declarator": "tracer", "var_name": "tracer"}, {"original_string": "private TracingCommandListener commandListener;", "modifier": "private", "type": "TracingCommandListener", "declarator": "commandListener", "var_name": "commandListener"}], "file": "mongodb/src/test/java/com/google/cloud/trace/mongodb/TracingCommandListenerTest.java"}, "test_case": {"identifier": "testCommandSucceeded", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testCommandSucceeded() {\n    commandListener.commandStarted(findStartEvent);\n    StartSpanEvent startEvent = tracer.startSpanEvents.get(0);\n    tracer.reset();\n    commandListener.commandSucceeded(findSucceededEvent);\n    assertThat(tracer.endSpanEvents).hasSize(1);\n    EndSpanEvent endSpanEvent = tracer.endSpanEvents.get(0);\n    assertThat(endSpanEvent.getTraceContext()).isEqualTo(startEvent.getTraceContext());\n    assertThat(endSpanEvent.getEndSpanOptions()).isNull();\n    assertThat(tracer.annotateEvents).hasSize(1);\n    AnnotateEvent annotateEvent = tracer.annotateEvents.get(0);\n    assertThat(annotateEvent.getTraceContext()).isEqualTo(endSpanEvent.getTraceContext());\n    assertThat(annotateEvent.getLabels().getLabels()).contains(\n        new Label(\"/mongodb/status\", \"SUCCESS\")\n    );\n  }", "signature": "void testCommandSucceeded()", "full_signature": "@Test public void testCommandSucceeded()", "class_method_signature": "TracingCommandListenerTest.testCommandSucceeded()", "testcase": true, "constructor": false, "invocations": ["commandStarted", "get", "reset", "commandSucceeded", "hasSize", "assertThat", "get", "isEqualTo", "assertThat", "getTraceContext", "getTraceContext", "isNull", "assertThat", "getEndSpanOptions", "hasSize", "assertThat", "get", "isEqualTo", "assertThat", "getTraceContext", "getTraceContext", "contains", "assertThat", "getLabels", "getLabels"]}, "focal_class": {"identifier": "TracingCommandListener", "superclass": "", "interfaces": "implements CommandListener", "fields": [{"original_string": "private final Tracer tracer;", "modifier": "private final", "type": "Tracer", "declarator": "tracer", "var_name": "tracer"}, {"original_string": "private static final Map<String, String> collectionKeyByCommand = new HashMap<String, String>();", "modifier": "private static final", "type": "Map<String, String>", "declarator": "collectionKeyByCommand = new HashMap<String, String>()", "var_name": "collectionKeyByCommand"}, {"original_string": "private static final ThreadLocal<MongoDBCommandTraceContext> contexts =\n      new ThreadLocal<MongoDBCommandTraceContext>();", "modifier": "private static final", "type": "ThreadLocal<MongoDBCommandTraceContext>", "declarator": "contexts =\n      new ThreadLocal<MongoDBCommandTraceContext>()", "var_name": "contexts"}], "methods": [{"identifier": "TracingCommandListener", "parameters": "()", "modifiers": "public", "return": "", "signature": " TracingCommandListener()", "full_signature": "public  TracingCommandListener()", "class_method_signature": "TracingCommandListener.TracingCommandListener()", "testcase": false, "constructor": true}, {"identifier": "TracingCommandListener", "parameters": "(Tracer tracer)", "modifiers": "public", "return": "", "signature": " TracingCommandListener(Tracer tracer)", "full_signature": "public  TracingCommandListener(Tracer tracer)", "class_method_signature": "TracingCommandListener.TracingCommandListener(Tracer tracer)", "testcase": false, "constructor": true}, {"identifier": "commandStarted", "parameters": "(CommandStartedEvent event)", "modifiers": "public", "return": "void", "signature": "void commandStarted(CommandStartedEvent event)", "full_signature": "public void commandStarted(CommandStartedEvent event)", "class_method_signature": "TracingCommandListener.commandStarted(CommandStartedEvent event)", "testcase": false, "constructor": false}, {"identifier": "commandSucceeded", "parameters": "(CommandSucceededEvent event)", "modifiers": "public", "return": "void", "signature": "void commandSucceeded(CommandSucceededEvent event)", "full_signature": "public void commandSucceeded(CommandSucceededEvent event)", "class_method_signature": "TracingCommandListener.commandSucceeded(CommandSucceededEvent event)", "testcase": false, "constructor": false}, {"identifier": "commandFailed", "parameters": "(CommandFailedEvent event)", "modifiers": "public", "return": "void", "signature": "void commandFailed(CommandFailedEvent event)", "full_signature": "public void commandFailed(CommandFailedEvent event)", "class_method_signature": "TracingCommandListener.commandFailed(CommandFailedEvent event)", "testcase": false, "constructor": false}], "file": "mongodb/src/main/java/com/google/cloud/trace/mongodb/TracingCommandListener.java"}, "focal_method": {"identifier": "commandSucceeded", "parameters": "(CommandSucceededEvent event)", "modifiers": "public", "return": "void", "body": "public void commandSucceeded(CommandSucceededEvent event) {\n    MongoDBCommandTraceContext commandContext = contexts.get();\n    if (commandContext == null || commandContext.getRequestId() != event.getRequestId()) {\n      contexts.remove();\n      return;\n    }\n    Labels.Builder labels = Labels.builder();\n    labels.add(MongoLabels.STATUS, \"SUCCESS\");\n    tracer.annotateSpan(commandContext.getContext(), labels.build());\n    tracer.endSpan(commandContext.getContext());\n    contexts.remove();\n  }", "signature": "void commandSucceeded(CommandSucceededEvent event)", "full_signature": "public void commandSucceeded(CommandSucceededEvent event)", "class_method_signature": "TracingCommandListener.commandSucceeded(CommandSucceededEvent event)", "testcase": false, "constructor": false, "invocations": ["get", "getRequestId", "getRequestId", "remove", "builder", "add", "annotateSpan", "getContext", "build", "endSpan", "getContext", "remove"]}, "repository": {"repo_id": 74059585, "url": "https://github.com/GoogleCloudPlatform/cloud-trace-java-instrumentation", "language": "Java", "is_fork": false, "fork_count": 9, "stargazer_count": 10, "size": 141, "license": "licensed"}}