{"test_class": {"identifier": "KubeClusterMembershipConnectorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Duration TIMEOUT = Duration.ofSeconds(30);", "modifier": "private static final", "type": "Duration", "declarator": "TIMEOUT = Duration.ofSeconds(30)", "var_name": "TIMEOUT"}, {"original_string": "private static final ClusterMember LOCAL_MEMBER_UNREGISTERED = activeClusterMember(\"local\").toBuilder()\n            .withRegistered(false)\n            .build();", "modifier": "private static final", "type": "ClusterMember", "declarator": "LOCAL_MEMBER_UNREGISTERED = activeClusterMember(\"local\").toBuilder()\n            .withRegistered(false)\n            .build()", "var_name": "LOCAL_MEMBER_UNREGISTERED"}, {"original_string": "private final TitusRuntime titusRuntime = TitusRuntimes.internal();", "modifier": "private final", "type": "TitusRuntime", "declarator": "titusRuntime = TitusRuntimes.internal()", "var_name": "titusRuntime"}, {"original_string": "private final KubeClusterMembershipConfiguration configuration = Archaius2Ext.newConfiguration(KubeClusterMembershipConfiguration.class,\n            \"titus.ext.kube.reRegistrationIntervalMs\", \"100\"\n    );", "modifier": "private final", "type": "KubeClusterMembershipConfiguration", "declarator": "configuration = Archaius2Ext.newConfiguration(KubeClusterMembershipConfiguration.class,\n            \"titus.ext.kube.reRegistrationIntervalMs\", \"100\"\n    )", "var_name": "configuration"}, {"original_string": "private final StubbedKubeExecutors kubeExecutors = new StubbedKubeExecutors(LOCAL_MEMBER_UNREGISTERED.getMemberId());", "modifier": "private final", "type": "StubbedKubeExecutors", "declarator": "kubeExecutors = new StubbedKubeExecutors(LOCAL_MEMBER_UNREGISTERED.getMemberId())", "var_name": "kubeExecutors"}, {"original_string": "private KubeClusterMembershipConnector connector;", "modifier": "private", "type": "KubeClusterMembershipConnector", "declarator": "connector", "var_name": "connector"}, {"original_string": "private TitusRxSubscriber<ClusterMembershipEvent> connectorEvents = new TitusRxSubscriber<>();", "modifier": "private", "type": "TitusRxSubscriber<ClusterMembershipEvent>", "declarator": "connectorEvents = new TitusRxSubscriber<>()", "var_name": "connectorEvents"}], "file": "titus-common-ext/kube/src/test/java/com/netflix/titus/ext/kube/clustermembership/connector/KubeClusterMembershipConnectorTest.java"}, "test_case": {"identifier": "testUnregistrationConnectionError", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testUnregistrationConnectionError() throws InterruptedException {\n        doRegister();\n\n        kubeExecutors.failOnMembershipUpdate(new RuntimeException(\"Simulated membership update error\"), Integer.MAX_VALUE);\n        try {\n            connector.unregister(ClusterMemberGenerator::clusterMemberUnregistrationRevision).block();\n            fail(\"Failure expected\");\n        } catch (Exception ignore) {\n        }\n        kubeExecutors.doNotFailOnMembershipUpdate();\n        doUnregister();\n    }", "signature": "void testUnregistrationConnectionError()", "full_signature": "@Test public void testUnregistrationConnectionError()", "class_method_signature": "KubeClusterMembershipConnectorTest.testUnregistrationConnectionError()", "testcase": true, "constructor": false, "invocations": ["doRegister", "failOnMembershipUpdate", "block", "unregister", "fail", "doNotFailOnMembershipUpdate", "doUnregister"]}, "focal_class": {"identifier": "KubeClusterMembershipConnector", "superclass": "", "interfaces": "implements ClusterMembershipConnector", "fields": [{"original_string": "private static final Logger logger = LoggerFactory.getLogger(KubeClusterMembershipConnector.class);", "modifier": "private static final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(KubeClusterMembershipConnector.class)", "var_name": "logger"}, {"original_string": "private static final Duration SHUTDOWN_TIMEOUT = Duration.ofMillis(500000);", "modifier": "private static final", "type": "Duration", "declarator": "SHUTDOWN_TIMEOUT = Duration.ofMillis(500000)", "var_name": "SHUTDOWN_TIMEOUT"}, {"original_string": "private final Scheduler scheduler;", "modifier": "private final", "type": "Scheduler", "declarator": "scheduler", "var_name": "scheduler"}, {"original_string": "private final OneOffReconciler<KubeClusterState> reconciler;", "modifier": "private final", "type": "OneOffReconciler<KubeClusterState>", "declarator": "reconciler", "var_name": "reconciler"}, {"original_string": "private final KubeContext context;", "modifier": "private final", "type": "KubeContext", "declarator": "context", "var_name": "context"}, {"original_string": "private final Disposable membershipSubscription;", "modifier": "private final", "type": "Disposable", "declarator": "membershipSubscription", "var_name": "membershipSubscription"}, {"original_string": "private final Disposable leaderElectionSubscription;", "modifier": "private final", "type": "Disposable", "declarator": "leaderElectionSubscription", "var_name": "leaderElectionSubscription"}, {"original_string": "private final Disposable reconcilerEventsSubscription;", "modifier": "private final", "type": "Disposable", "declarator": "reconcilerEventsSubscription", "var_name": "reconcilerEventsSubscription"}], "methods": [{"identifier": "KubeClusterMembershipConnector", "parameters": "(ClusterMember initial,\n                                          KubeMembershipExecutor kubeMembershipExecutor,\n                                          KubeLeaderElectionExecutor kubeLeaderElectionExecutor,\n                                          KubeClusterMembershipConfiguration configuration,\n                                          TitusRuntime titusRuntime)", "modifiers": "public", "return": "", "signature": " KubeClusterMembershipConnector(ClusterMember initial,\n                                          KubeMembershipExecutor kubeMembershipExecutor,\n                                          KubeLeaderElectionExecutor kubeLeaderElectionExecutor,\n                                          KubeClusterMembershipConfiguration configuration,\n                                          TitusRuntime titusRuntime)", "full_signature": "public  KubeClusterMembershipConnector(ClusterMember initial,\n                                          KubeMembershipExecutor kubeMembershipExecutor,\n                                          KubeLeaderElectionExecutor kubeLeaderElectionExecutor,\n                                          KubeClusterMembershipConfiguration configuration,\n                                          TitusRuntime titusRuntime)", "class_method_signature": "KubeClusterMembershipConnector.KubeClusterMembershipConnector(ClusterMember initial,\n                                          KubeMembershipExecutor kubeMembershipExecutor,\n                                          KubeLeaderElectionExecutor kubeLeaderElectionExecutor,\n                                          KubeClusterMembershipConfiguration configuration,\n                                          TitusRuntime titusRuntime)", "testcase": false, "constructor": true}, {"identifier": "shutdown", "parameters": "()", "modifiers": "@PreDestroy public", "return": "void", "signature": "void shutdown()", "full_signature": "@PreDestroy public void shutdown()", "class_method_signature": "KubeClusterMembershipConnector.shutdown()", "testcase": false, "constructor": false}, {"identifier": "getLocalClusterMemberRevision", "parameters": "()", "modifiers": "@Override public", "return": "ClusterMembershipRevision<ClusterMember>", "signature": "ClusterMembershipRevision<ClusterMember> getLocalClusterMemberRevision()", "full_signature": "@Override public ClusterMembershipRevision<ClusterMember> getLocalClusterMemberRevision()", "class_method_signature": "KubeClusterMembershipConnector.getLocalClusterMemberRevision()", "testcase": false, "constructor": false}, {"identifier": "getClusterMemberSiblings", "parameters": "()", "modifiers": "@Override public", "return": "Map<String, ClusterMembershipRevision<ClusterMember>>", "signature": "Map<String, ClusterMembershipRevision<ClusterMember>> getClusterMemberSiblings()", "full_signature": "@Override public Map<String, ClusterMembershipRevision<ClusterMember>> getClusterMemberSiblings()", "class_method_signature": "KubeClusterMembershipConnector.getClusterMemberSiblings()", "testcase": false, "constructor": false}, {"identifier": "getLocalLeadershipRevision", "parameters": "()", "modifiers": "@Override public", "return": "ClusterMembershipRevision<ClusterMemberLeadership>", "signature": "ClusterMembershipRevision<ClusterMemberLeadership> getLocalLeadershipRevision()", "full_signature": "@Override public ClusterMembershipRevision<ClusterMemberLeadership> getLocalLeadershipRevision()", "class_method_signature": "KubeClusterMembershipConnector.getLocalLeadershipRevision()", "testcase": false, "constructor": false}, {"identifier": "findCurrentLeader", "parameters": "()", "modifiers": "@Override public", "return": "Optional<ClusterMembershipRevision<ClusterMemberLeadership>>", "signature": "Optional<ClusterMembershipRevision<ClusterMemberLeadership>> findCurrentLeader()", "full_signature": "@Override public Optional<ClusterMembershipRevision<ClusterMemberLeadership>> findCurrentLeader()", "class_method_signature": "KubeClusterMembershipConnector.findCurrentLeader()", "testcase": false, "constructor": false}, {"identifier": "register", "parameters": "(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "modifiers": "@Override public", "return": "Mono<ClusterMembershipRevision<ClusterMember>>", "signature": "Mono<ClusterMembershipRevision<ClusterMember>> register(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "full_signature": "@Override public Mono<ClusterMembershipRevision<ClusterMember>> register(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "class_method_signature": "KubeClusterMembershipConnector.register(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "testcase": false, "constructor": false}, {"identifier": "unregister", "parameters": "(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "modifiers": "@Override public", "return": "Mono<ClusterMembershipRevision<ClusterMember>>", "signature": "Mono<ClusterMembershipRevision<ClusterMember>> unregister(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "full_signature": "@Override public Mono<ClusterMembershipRevision<ClusterMember>> unregister(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "class_method_signature": "KubeClusterMembershipConnector.unregister(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "testcase": false, "constructor": false}, {"identifier": "joinLeadershipGroup", "parameters": "()", "modifiers": "@Override public", "return": "Mono<Void>", "signature": "Mono<Void> joinLeadershipGroup()", "full_signature": "@Override public Mono<Void> joinLeadershipGroup()", "class_method_signature": "KubeClusterMembershipConnector.joinLeadershipGroup()", "testcase": false, "constructor": false}, {"identifier": "leaveLeadershipGroup", "parameters": "(boolean onlyNonLeader)", "modifiers": "@Override public", "return": "Mono<Boolean>", "signature": "Mono<Boolean> leaveLeadershipGroup(boolean onlyNonLeader)", "full_signature": "@Override public Mono<Boolean> leaveLeadershipGroup(boolean onlyNonLeader)", "class_method_signature": "KubeClusterMembershipConnector.leaveLeadershipGroup(boolean onlyNonLeader)", "testcase": false, "constructor": false}, {"identifier": "membershipChangeEvents", "parameters": "()", "modifiers": "@Override public", "return": "Flux<ClusterMembershipEvent>", "signature": "Flux<ClusterMembershipEvent> membershipChangeEvents()", "full_signature": "@Override public Flux<ClusterMembershipEvent> membershipChangeEvents()", "class_method_signature": "KubeClusterMembershipConnector.membershipChangeEvents()", "testcase": false, "constructor": false}], "file": "titus-common-ext/kube/src/main/java/com/netflix/titus/ext/kube/clustermembership/connector/KubeClusterMembershipConnector.java"}, "focal_method": {"identifier": "unregister", "parameters": "(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "modifiers": "@Override public", "return": "Mono<ClusterMembershipRevision<ClusterMember>>", "body": "@Override\n    public Mono<ClusterMembershipRevision<ClusterMember>> unregister(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate) {\n        return reconciler.apply(current ->\n                KubeRegistrationActions.unregisterLocal(context, current, selfUpdate).map(f -> f.apply(current))\n        ).map(KubeClusterState::getLocalMemberRevision);\n    }", "signature": "Mono<ClusterMembershipRevision<ClusterMember>> unregister(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "full_signature": "@Override public Mono<ClusterMembershipRevision<ClusterMember>> unregister(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "class_method_signature": "KubeClusterMembershipConnector.unregister(Function<ClusterMember, ClusterMembershipRevision<ClusterMember>> selfUpdate)", "testcase": false, "constructor": false, "invocations": ["map", "apply", "map", "unregisterLocal", "apply"]}, "repository": {"repo_id": 107330274, "url": "https://github.com/Netflix/titus-control-plane", "stars": 241, "created": "10/17/2017 10:20:55 PM +00:00", "updates": "2020-01-25T13:01:05+00:00", "fork": "False", "license": "licensed"}}