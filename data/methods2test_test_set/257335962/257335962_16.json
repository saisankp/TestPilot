{"test_class": {"identifier": "ServerLogServiceTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Autowired\n    private ServerLogService serverLogService;", "modifier": "@Autowired\n    private", "type": "ServerLogService", "declarator": "serverLogService", "var_name": "serverLogService"}], "file": "lzpeng-boot-server/src/test/java/com/lzpeng/project/monitor/service/ServerLogServiceTest.java"}, "test_case": {"identifier": "query", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void query() {\n        QueryResult<ServerLog> query = serverLogService.query(1, 3, null);\n        log.info(\"{}\", query);\n    }", "signature": "void query()", "full_signature": "@Test public void query()", "class_method_signature": "ServerLogServiceTest.query()", "testcase": true, "constructor": false, "invocations": ["query", "info"]}, "focal_class": {"identifier": "ServerLogService", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Value(\"${logging.file.name}\")\n    private String logFilePath;", "modifier": "@Value(\"${logging.file.name}\")\n    private", "type": "String", "declarator": "logFilePath", "var_name": "logFilePath"}, {"original_string": "private File logFileContent;", "modifier": "private", "type": "File", "declarator": "logFileContent", "var_name": "logFileContent"}, {"original_string": "@Autowired\n    private FileInfoService fileInfoService;", "modifier": "@Autowired\n    private", "type": "FileInfoService", "declarator": "fileInfoService", "var_name": "fileInfoService"}], "methods": [{"identifier": "init", "parameters": "()", "modifiers": "@PostConstruct private", "return": "void", "signature": "void init()", "full_signature": "@PostConstruct private void init()", "class_method_signature": "ServerLogService.init()", "testcase": false, "constructor": false}, {"identifier": "findAll", "parameters": "(ServerLog model)", "modifiers": "public", "return": "List<ServerLog>", "signature": "List<ServerLog> findAll(ServerLog model)", "full_signature": "public List<ServerLog> findAll(ServerLog model)", "class_method_signature": "ServerLogService.findAll(ServerLog model)", "testcase": false, "constructor": false}, {"identifier": "query", "parameters": "(int page, int size, ServerLog model)", "modifiers": "public", "return": "QueryResult<ServerLog>", "signature": "QueryResult<ServerLog> query(int page, int size, ServerLog model)", "full_signature": "public QueryResult<ServerLog> query(int page, int size, ServerLog model)", "class_method_signature": "ServerLogService.query(int page, int size, ServerLog model)", "testcase": false, "constructor": false}, {"identifier": "downloadLogFile", "parameters": "(String fileName, HttpServletResponse response)", "modifiers": "public", "return": "void", "signature": "void downloadLogFile(String fileName, HttpServletResponse response)", "full_signature": "public void downloadLogFile(String fileName, HttpServletResponse response)", "class_method_signature": "ServerLogService.downloadLogFile(String fileName, HttpServletResponse response)", "testcase": false, "constructor": false}], "file": "lzpeng-boot-server/src/main/java/com/lzpeng/project/monitor/service/ServerLogService.java"}, "focal_method": {"identifier": "query", "parameters": "(int page, int size, ServerLog model)", "modifiers": "public", "return": "QueryResult<ServerLog>", "body": "public QueryResult<ServerLog> query(int page, int size, ServerLog model) {\n        File[] logFiles = logFileContent.listFiles(); // \u6240\u6709\u65e5\u5fd7\u6587\u4ef6\n        int count = logFiles.length; // \u65e5\u5fd7\u6587\u4ef6\u4e2a\u6570\n        int skipCount = (page - 1) * size; // \u9700\u8981\u8df3\u8fc7\u7684\u6587\u4ef6\u4e2a\u6570\n        int totalPages = (int) Math.ceil(count / (double) size); // \u65e5\u5fd7\u6587\u4ef6\u603b\u9875\u6570\n        if (skipCount > count) {\n            page = totalPages;\n            skipCount = (page - 1) * size; // \u4fee\u6539\u9700\u8981\u8df3\u8fc7\u7684\u6587\u4ef6\u4e2a\u6570\n        }\n        List<ServerLog> serverLogList = Stream.of(logFiles)\n                .sorted(Comparator.comparing(FileUtil::lastModifiedTime, Comparator.reverseOrder()))\n                .skip(skipCount)\n                .limit(size)\n                .map(logFile -> {\n                    ServerLog serverLog = new ServerLog();\n                    serverLog.setFileName(logFile.getName());\n                    serverLog.setSize(logFile.length());\n                    serverLog.setLastModifiedTime(FileUtil.lastModifiedTime(logFile));\n                    try {\n                        serverLog.setCanonicalPath(logFile.getCanonicalPath());\n                    } catch (IOException e) {\n                        e.printStackTrace();\n                    }\n                    return serverLog;\n                })\n                .collect(Collectors.toList());\n        return new QueryResult(serverLogList, count, page, totalPages);\n    }", "signature": "QueryResult<ServerLog> query(int page, int size, ServerLog model)", "full_signature": "public QueryResult<ServerLog> query(int page, int size, ServerLog model)", "class_method_signature": "ServerLogService.query(int page, int size, ServerLog model)", "testcase": false, "constructor": false, "invocations": ["listFiles", "ceil", "collect", "map", "limit", "skip", "sorted", "of", "comparing", "reverseOrder", "setFileName", "getName", "setSize", "length", "setLastModifiedTime", "lastModifiedTime", "setCanonicalPath", "getCanonicalPath", "printStackTrace", "toList"]}, "repository": {"repo_id": 257335962, "url": "https://github.com/lzpeng723/minimal-boot", "language": "Java", "is_fork": false, "fork_count": 3, "stargazer_count": 25, "size": 2632, "license": "licensed"}}