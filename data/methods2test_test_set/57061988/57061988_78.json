{"test_class": {"identifier": "EncryptedValueDataServiceTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@MockBean\n  private EncryptedValueRepository encryptedValueRepository;", "modifier": "@MockBean\n  private", "type": "EncryptedValueRepository", "declarator": "encryptedValueRepository", "var_name": "encryptedValueRepository"}, {"original_string": "@MockBean\n  private Encryptor encryptor;", "modifier": "@MockBean\n  private", "type": "Encryptor", "declarator": "encryptor", "var_name": "encryptor"}, {"original_string": "private EncryptedValueDataService subject;", "modifier": "private", "type": "EncryptedValueDataService", "declarator": "subject", "var_name": "subject"}], "file": "components/encryption/src/test/java/org/cloudfoundry/credhub/data/EncryptedValueDataServiceTest.java"}, "test_case": {"identifier": "rotate", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void rotate() throws Exception {\n    final EncryptedValue newEncryption = new EncryptedValue(UUID.randomUUID(), \"expected value\".getBytes(UTF_8),\n      \"nonce\".getBytes(UTF_8));\n    final EncryptedValue value = new EncryptedValue();\n    value.setEncryptedValue(\"bytes\".getBytes(UTF_8));\n    value.setEncryptionKeyUuid(UUID.randomUUID());\n    value.setNonce(\"nonce\".getBytes(UTF_8));\n    when(encryptor.decrypt(any(EncryptedValue.class))).thenReturn(\"expected value\");\n    when(encryptor.encrypt(\"expected value\")).thenReturn(newEncryption);\n    subject.rotate(value);\n\n    verify(encryptedValueRepository).saveAndFlush(newEncryption);\n    assertThat(newEncryption.getUuid(), equalTo(value.getUuid()));\n  }", "signature": "void rotate()", "full_signature": "@Test public void rotate()", "class_method_signature": "EncryptedValueDataServiceTest.rotate()", "testcase": true, "constructor": false, "invocations": ["randomUUID", "getBytes", "getBytes", "setEncryptedValue", "getBytes", "setEncryptionKeyUuid", "randomUUID", "setNonce", "getBytes", "thenReturn", "when", "decrypt", "any", "thenReturn", "when", "encrypt", "rotate", "saveAndFlush", "verify", "assertThat", "getUuid", "equalTo", "getUuid"]}, "focal_class": {"identifier": "EncryptedValueDataService", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final EncryptedValueRepository encryptedValueRepository;", "modifier": "private final", "type": "EncryptedValueRepository", "declarator": "encryptedValueRepository", "var_name": "encryptedValueRepository"}, {"original_string": "private final Encryptor encryptor;", "modifier": "private final", "type": "Encryptor", "declarator": "encryptor", "var_name": "encryptor"}], "methods": [{"identifier": "EncryptedValueDataService", "parameters": "(\n    final EncryptedValueRepository encryptedValueRepository,\n    final Encryptor encryptor)", "modifiers": "@Autowired protected", "return": "", "signature": " EncryptedValueDataService(\n    final EncryptedValueRepository encryptedValueRepository,\n    final Encryptor encryptor)", "full_signature": "@Autowired protected  EncryptedValueDataService(\n    final EncryptedValueRepository encryptedValueRepository,\n    final Encryptor encryptor)", "class_method_signature": "EncryptedValueDataService.EncryptedValueDataService(\n    final EncryptedValueRepository encryptedValueRepository,\n    final Encryptor encryptor)", "testcase": false, "constructor": true}, {"identifier": "countAllByCanaryUuid", "parameters": "(final UUID uuid)", "modifiers": "public", "return": "Long", "signature": "Long countAllByCanaryUuid(final UUID uuid)", "full_signature": "public Long countAllByCanaryUuid(final UUID uuid)", "class_method_signature": "EncryptedValueDataService.countAllByCanaryUuid(final UUID uuid)", "testcase": false, "constructor": false}, {"identifier": "findByCanaryUuids", "parameters": "(final List<UUID> canaryUuids)", "modifiers": "public", "return": "Slice<EncryptedValue>", "signature": "Slice<EncryptedValue> findByCanaryUuids(final List<UUID> canaryUuids)", "full_signature": "public Slice<EncryptedValue> findByCanaryUuids(final List<UUID> canaryUuids)", "class_method_signature": "EncryptedValueDataService.findByCanaryUuids(final List<UUID> canaryUuids)", "testcase": false, "constructor": false}, {"identifier": "rotate", "parameters": "(final EncryptedValue encryptedValue)", "modifiers": "public", "return": "void", "signature": "void rotate(final EncryptedValue encryptedValue)", "full_signature": "public void rotate(final EncryptedValue encryptedValue)", "class_method_signature": "EncryptedValueDataService.rotate(final EncryptedValue encryptedValue)", "testcase": false, "constructor": false}], "file": "components/encryption/src/main/java/org/cloudfoundry/credhub/data/EncryptedValueDataService.java"}, "focal_method": {"identifier": "rotate", "parameters": "(final EncryptedValue encryptedValue)", "modifiers": "public", "return": "void", "body": "public void rotate(final EncryptedValue encryptedValue) {\n    final String decryptedValue = encryptor.decrypt(encryptedValue);\n    final EncryptedValue newEncryptedValue = encryptor.encrypt(decryptedValue);\n    newEncryptedValue.setUuid(encryptedValue.getUuid());\n    encryptedValueRepository.saveAndFlush(newEncryptedValue);\n  }", "signature": "void rotate(final EncryptedValue encryptedValue)", "full_signature": "public void rotate(final EncryptedValue encryptedValue)", "class_method_signature": "EncryptedValueDataService.rotate(final EncryptedValue encryptedValue)", "testcase": false, "constructor": false, "invocations": ["decrypt", "encrypt", "setUuid", "getUuid", "saveAndFlush"]}, "repository": {"repo_id": 57061988, "url": "https://github.com/cloudfoundry-incubator/credhub", "stars": 167, "created": "4/25/2016 5:30:51 PM +00:00", "updates": "2020-01-27T21:31:19+00:00", "fork": "False", "license": "licensed"}}