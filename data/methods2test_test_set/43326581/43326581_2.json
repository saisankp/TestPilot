{"test_class": {"identifier": "AttachmentAwareDatabaseHandlerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "AttachmentAwareDatabaseHandler handler;", "modifier": "", "type": "AttachmentAwareDatabaseHandler", "declarator": "handler", "var_name": "handler"}], "file": "backend/src-common/src/test/java/org/eclipse/sw360/datahandler/db/AttachmentAwareDatabaseHandlerTest.java"}, "test_case": {"identifier": "testGetAllAttachmentsToKeepCanHandleNull", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testGetAllAttachmentsToKeepCanHandleNull() throws Exception {\n\n        // Test what happens if `changedAttachments` are `null`\n        //  ->  only not-accepted attachments should be deleted\n        Attachment attachmentAccepted1 = new Attachment().setAttachmentContentId(\"acceptedAtt1\").setFilename(\"att1.file\").setCheckStatus(CheckStatus.ACCEPTED);\n        Attachment attachmentRejected1 = new Attachment().setAttachmentContentId(\"rejectedAtt1\").setFilename(\"att2.file\").setCheckStatus(CheckStatus.REJECTED);\n        Attachment attachmentRejected2 = new Attachment().setAttachmentContentId(\"rejectedAtt2\").setFilename(\"att3.file\").setCheckStatus(CheckStatus.NOTCHECKED);\n\n        Set<Attachment> attachments = new HashSet<>();\n        attachments.add(attachmentAccepted1);\n        attachments.add(attachmentRejected1);\n        attachments.add(attachmentRejected2);\n\n        Set<Attachment> attachmentsToKeep = handler.getAllAttachmentsToKeep(attachments, null);\n        assertEquals(1, attachmentsToKeep.size());\n        assertTrue(attachmentsToKeep.contains(attachmentAccepted1));\n        assertFalse(attachmentsToKeep.contains(attachmentRejected1));\n        assertFalse(attachmentsToKeep.contains(attachmentRejected2));\n\n        // Test what happens if `originalAttachments` are `null`  (this means adding of attachments)\n        //  ->  all should be added\n        attachmentsToKeep = handler.getAllAttachmentsToKeep(null, attachments);\n        assertEquals(3, attachmentsToKeep.size());\n        assertTrue(attachmentsToKeep.contains(attachmentAccepted1));\n        assertTrue(attachmentsToKeep.contains(attachmentRejected1));\n        assertTrue(attachmentsToKeep.contains(attachmentRejected2));\n    }", "signature": "void testGetAllAttachmentsToKeepCanHandleNull()", "full_signature": "@Test public void testGetAllAttachmentsToKeepCanHandleNull()", "class_method_signature": "AttachmentAwareDatabaseHandlerTest.testGetAllAttachmentsToKeepCanHandleNull()", "testcase": true, "constructor": false, "invocations": ["setCheckStatus", "setFilename", "setAttachmentContentId", "setCheckStatus", "setFilename", "setAttachmentContentId", "setCheckStatus", "setFilename", "setAttachmentContentId", "add", "add", "add", "getAllAttachmentsToKeep", "assertEquals", "size", "assertTrue", "contains", "assertFalse", "contains", "assertFalse", "contains", "getAllAttachmentsToKeep", "assertEquals", "size", "assertTrue", "contains", "assertTrue", "contains", "assertTrue", "contains"]}, "focal_class": {"identifier": "AttachmentAwareDatabaseHandler", "superclass": "", "interfaces": "", "fields": [], "methods": [{"identifier": "getAllAttachmentsToKeep", "parameters": "(Set<Attachment> originalAttachments, Set<Attachment> changedAttachments)", "modifiers": "public", "return": "Set<Attachment>", "signature": "Set<Attachment> getAllAttachmentsToKeep(Set<Attachment> originalAttachments, Set<Attachment> changedAttachments)", "full_signature": "public Set<Attachment> getAllAttachmentsToKeep(Set<Attachment> originalAttachments, Set<Attachment> changedAttachments)", "class_method_signature": "AttachmentAwareDatabaseHandler.getAllAttachmentsToKeep(Set<Attachment> originalAttachments, Set<Attachment> changedAttachments)", "testcase": false, "constructor": false}, {"identifier": "AttachmentAwareDatabaseHandler", "parameters": "()", "modifiers": "public", "return": "", "signature": " AttachmentAwareDatabaseHandler()", "full_signature": "public  AttachmentAwareDatabaseHandler()", "class_method_signature": "AttachmentAwareDatabaseHandler.AttachmentAwareDatabaseHandler()", "testcase": false, "constructor": true}], "file": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/AttachmentAwareDatabaseHandler.java"}, "focal_method": {"identifier": "getAllAttachmentsToKeep", "parameters": "(Set<Attachment> originalAttachments, Set<Attachment> changedAttachments)", "modifiers": "public", "return": "Set<Attachment>", "body": "public Set<Attachment> getAllAttachmentsToKeep(Set<Attachment> originalAttachments, Set<Attachment> changedAttachments) {\n        Set <Attachment> attachmentsToKeep = new HashSet<>();\n        attachmentsToKeep.addAll(nullToEmptySet(changedAttachments));\n        Set<String> alreadyPresentIdsInAttachmentsToKeep = nullToEmptyCollection(attachmentsToKeep).stream().map(Attachment::getAttachmentContentId).collect(Collectors.toSet());\n\n        // prevent deletion of already accepted attachments\n        Set<Attachment> acceptedAttachmentsNotYetToKeep = nullToEmptySet(originalAttachments).stream().filter(a -> (a.getCheckStatus() == CheckStatus.ACCEPTED && !alreadyPresentIdsInAttachmentsToKeep.contains(a.getAttachmentContentId()))).collect(Collectors.toSet());\n        attachmentsToKeep.addAll(acceptedAttachmentsNotYetToKeep);\n\n        return attachmentsToKeep;\n    }", "signature": "Set<Attachment> getAllAttachmentsToKeep(Set<Attachment> originalAttachments, Set<Attachment> changedAttachments)", "full_signature": "public Set<Attachment> getAllAttachmentsToKeep(Set<Attachment> originalAttachments, Set<Attachment> changedAttachments)", "class_method_signature": "AttachmentAwareDatabaseHandler.getAllAttachmentsToKeep(Set<Attachment> originalAttachments, Set<Attachment> changedAttachments)", "testcase": false, "constructor": false, "invocations": ["addAll", "nullToEmptySet", "collect", "map", "stream", "nullToEmptyCollection", "toSet", "collect", "filter", "stream", "nullToEmptySet", "getCheckStatus", "contains", "getAttachmentContentId", "toSet", "addAll"]}, "repository": {"repo_id": 43326581, "url": "https://github.com/sw360/sw360portal", "language": "Java", "is_fork": false, "fork_count": 23, "stargazer_count": 31, "size": 8770, "license": "licensed"}}