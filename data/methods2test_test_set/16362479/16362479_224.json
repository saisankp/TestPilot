{"test_class": {"identifier": "LeaderTest", "superclass": "extends AbstractLeaderTest<Leader>", "interfaces": "", "fields": [{"original_string": "static final String FOLLOWER_ID = \"follower\";", "modifier": "static final", "type": "String", "declarator": "FOLLOWER_ID = \"follower\"", "var_name": "FOLLOWER_ID"}, {"original_string": "public static final String LEADER_ID = \"leader\";", "modifier": "public static final", "type": "String", "declarator": "LEADER_ID = \"leader\"", "var_name": "LEADER_ID"}, {"original_string": "private final TestActorRef<ForwardMessageToBehaviorActor> leaderActor = actorFactory.createTestActor(\n            Props.create(ForwardMessageToBehaviorActor.class), actorFactory.generateActorId(\"leader\"));", "modifier": "private final", "type": "TestActorRef<ForwardMessageToBehaviorActor>", "declarator": "leaderActor = actorFactory.createTestActor(\n            Props.create(ForwardMessageToBehaviorActor.class), actorFactory.generateActorId(\"leader\"))", "var_name": "leaderActor"}, {"original_string": "private final TestActorRef<ForwardMessageToBehaviorActor> followerActor = actorFactory.createTestActor(\n            Props.create(ForwardMessageToBehaviorActor.class), actorFactory.generateActorId(\"follower\"));", "modifier": "private final", "type": "TestActorRef<ForwardMessageToBehaviorActor>", "declarator": "followerActor = actorFactory.createTestActor(\n            Props.create(ForwardMessageToBehaviorActor.class), actorFactory.generateActorId(\"follower\"))", "var_name": "followerActor"}, {"original_string": "private Leader leader;", "modifier": "private", "type": "Leader", "declarator": "leader", "var_name": "leader"}, {"original_string": "private final short payloadVersion = 5;", "modifier": "private final", "type": "short", "declarator": "payloadVersion = 5", "var_name": "payloadVersion"}], "file": "opendaylight/md-sal/sal-akka-raft/src/test/java/org/opendaylight/controller/cluster/raft/behaviors/LeaderTest.java"}, "test_case": {"identifier": "testFollowerCatchUpWithAppendEntriesMaxDataSizeExceeded", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testFollowerCatchUpWithAppendEntriesMaxDataSizeExceeded() {\n        logStart(\"testFollowerCatchUpWithAppendEntriesMaxDataSizeExceeded\");\n\n        MockRaftActorContext leaderActorContext = createActorContextWithFollower();\n        ((DefaultConfigParamsImpl)leaderActorContext.getConfigParams()).setHeartBeatInterval(\n                new FiniteDuration(1000, TimeUnit.SECONDS));\n        ((DefaultConfigParamsImpl)leaderActorContext.getConfigParams()).setSnapshotChunkSize(2);\n\n        leaderActorContext.setReplicatedLog(\n                new MockRaftActorContext.MockReplicatedLogBuilder().createEntries(0, 4, 1).build());\n        long leaderCommitIndex = 3;\n        leaderActorContext.setCommitIndex(leaderCommitIndex);\n        leaderActorContext.setLastApplied(leaderCommitIndex);\n\n        final ReplicatedLogEntry leadersFirstLogEntry = leaderActorContext.getReplicatedLog().get(0);\n        final ReplicatedLogEntry leadersSecondLogEntry = leaderActorContext.getReplicatedLog().get(1);\n        final ReplicatedLogEntry leadersThirdLogEntry = leaderActorContext.getReplicatedLog().get(2);\n        final ReplicatedLogEntry leadersFourthLogEntry = leaderActorContext.getReplicatedLog().get(3);\n\n        MockRaftActorContext followerActorContext = createFollowerActorContextWithLeader();\n\n        followerActorContext.setReplicatedLog(new MockRaftActorContext.MockReplicatedLogBuilder().build());\n        followerActorContext.setCommitIndex(-1);\n        followerActorContext.setLastApplied(-1);\n\n        Follower follower = new Follower(followerActorContext);\n        followerActor.underlyingActor().setBehavior(follower);\n        followerActorContext.setCurrentBehavior(follower);\n\n        leader = new Leader(leaderActorContext);\n\n        AppendEntries appendEntries = MessageCollectorActor.expectFirstMatching(followerActor, AppendEntries.class);\n        final AppendEntriesReply appendEntriesReply = MessageCollectorActor.expectFirstMatching(leaderActor,\n                AppendEntriesReply.class);\n\n        MessageCollectorActor.clearMessages(followerActor);\n        MessageCollectorActor.clearMessages(leaderActor);\n\n        // Verify initial AppendEntries sent with the leader's current commit index.\n        assertEquals(\"getLeaderCommit\", -1, appendEntries.getLeaderCommit());\n        assertEquals(\"Log entries size\", 0, appendEntries.getEntries().size());\n        assertEquals(\"getPrevLogIndex\", 2, appendEntries.getPrevLogIndex());\n\n        leaderActor.underlyingActor().setBehavior(leader);\n        leaderActorContext.setCurrentBehavior(leader);\n\n        leader.handleMessage(followerActor, appendEntriesReply);\n\n        List<AppendEntries> appendEntriesList = MessageCollectorActor.expectMatching(followerActor,\n                AppendEntries.class, 2);\n        MessageCollectorActor.expectMatching(leaderActor, AppendEntriesReply.class, 2);\n\n        appendEntries = appendEntriesList.get(0);\n        assertEquals(\"getLeaderCommit\", leaderCommitIndex, appendEntries.getLeaderCommit());\n        assertEquals(\"getPrevLogIndex\", -1, appendEntries.getPrevLogIndex());\n        assertEquals(\"Log entries size\", 2, appendEntries.getEntries().size());\n\n        assertEquals(\"First entry index\", 0, appendEntries.getEntries().get(0).getIndex());\n        assertEquals(\"First entry data\", leadersFirstLogEntry.getData(),\n                appendEntries.getEntries().get(0).getData());\n        assertEquals(\"Second entry index\", 1, appendEntries.getEntries().get(1).getIndex());\n        assertEquals(\"Second entry data\", leadersSecondLogEntry.getData(),\n                appendEntries.getEntries().get(1).getData());\n\n        appendEntries = appendEntriesList.get(1);\n        assertEquals(\"getLeaderCommit\", leaderCommitIndex, appendEntries.getLeaderCommit());\n        assertEquals(\"getPrevLogIndex\", 1, appendEntries.getPrevLogIndex());\n        assertEquals(\"Log entries size\", 2, appendEntries.getEntries().size());\n\n        assertEquals(\"First entry index\", 2, appendEntries.getEntries().get(0).getIndex());\n        assertEquals(\"First entry data\", leadersThirdLogEntry.getData(),\n                appendEntries.getEntries().get(0).getData());\n        assertEquals(\"Second entry index\", 3, appendEntries.getEntries().get(1).getIndex());\n        assertEquals(\"Second entry data\", leadersFourthLogEntry.getData(),\n                appendEntries.getEntries().get(1).getData());\n\n        FollowerLogInformation followerInfo = leader.getFollower(FOLLOWER_ID);\n        assertEquals(\"getNextIndex\", 4, followerInfo.getNextIndex());\n\n        MessageCollectorActor.expectMatching(followerActor, ApplyState.class, 4);\n\n        assertEquals(\"Follower's commit index\", 3, followerActorContext.getCommitIndex());\n        assertEquals(\"Follower's lastIndex\", 3, followerActorContext.getReplicatedLog().lastIndex());\n    }", "signature": "void testFollowerCatchUpWithAppendEntriesMaxDataSizeExceeded()", "full_signature": "@Test public void testFollowerCatchUpWithAppendEntriesMaxDataSizeExceeded()", "class_method_signature": "LeaderTest.testFollowerCatchUpWithAppendEntriesMaxDataSizeExceeded()", "testcase": true, "constructor": false, "invocations": ["logStart", "createActorContextWithFollower", "setHeartBeatInterval", "getConfigParams", "setSnapshotChunkSize", "getConfigParams", "setReplicatedLog", "build", "createEntries", "setCommitIndex", "setLastApplied", "get", "getReplicatedLog", "get", "getReplicatedLog", "get", "getReplicatedLog", "get", "getReplicatedLog", "createFollowerActorContextWithLeader", "setReplicatedLog", "build", "setCommitIndex", "setLastApplied", "setBehavior", "underlyingActor", "setCurrentBehavior", "expectFirstMatching", "expectFirstMatching", "clearMessages", "clearMessages", "assertEquals", "getLeaderCommit", "assertEquals", "size", "getEntries", "assertEquals", "getPrevLogIndex", "setBehavior", "underlyingActor", "setCurrentBehavior", "handleMessage", "expectMatching", "expectMatching", "get", "assertEquals", "getLeaderCommit", "assertEquals", "getPrevLogIndex", "assertEquals", "size", "getEntries", "assertEquals", "getIndex", "get", "getEntries", "assertEquals", "getData", "getData", "get", "getEntries", "assertEquals", "getIndex", "get", "getEntries", "assertEquals", "getData", "getData", "get", "getEntries", "get", "assertEquals", "getLeaderCommit", "assertEquals", "getPrevLogIndex", "assertEquals", "size", "getEntries", "assertEquals", "getIndex", "get", "getEntries", "assertEquals", "getData", "getData", "get", "getEntries", "assertEquals", "getIndex", "get", "getEntries", "assertEquals", "getData", "getData", "get", "getEntries", "getFollower", "assertEquals", "getNextIndex", "expectMatching", "assertEquals", "getCommitIndex", "assertEquals", "lastIndex", "getReplicatedLog"]}, "focal_class": {"identifier": "Leader", "superclass": "extends AbstractLeader", "interfaces": "", "fields": [{"original_string": "@VisibleForTesting\n    static final Object ISOLATED_LEADER_CHECK = new Object();", "modifier": "@VisibleForTesting\n    static final", "type": "Object", "declarator": "ISOLATED_LEADER_CHECK = new Object()", "var_name": "ISOLATED_LEADER_CHECK"}, {"original_string": "private final Stopwatch isolatedLeaderCheck = Stopwatch.createStarted();", "modifier": "private final", "type": "Stopwatch", "declarator": "isolatedLeaderCheck = Stopwatch.createStarted()", "var_name": "isolatedLeaderCheck"}, {"original_string": "private @Nullable LeadershipTransferContext leadershipTransferContext;", "modifier": "private @Nullable", "type": "LeadershipTransferContext", "declarator": "leadershipTransferContext", "var_name": "leadershipTransferContext"}], "methods": [{"identifier": "Leader", "parameters": "(final RaftActorContext context, @Nullable final AbstractLeader initializeFromLeader)", "modifiers": "", "return": "", "signature": " Leader(final RaftActorContext context, @Nullable final AbstractLeader initializeFromLeader)", "full_signature": "  Leader(final RaftActorContext context, @Nullable final AbstractLeader initializeFromLeader)", "class_method_signature": "Leader.Leader(final RaftActorContext context, @Nullable final AbstractLeader initializeFromLeader)", "testcase": false, "constructor": true}, {"identifier": "Leader", "parameters": "(final RaftActorContext context)", "modifiers": "public", "return": "", "signature": " Leader(final RaftActorContext context)", "full_signature": "public  Leader(final RaftActorContext context)", "class_method_signature": "Leader.Leader(final RaftActorContext context)", "testcase": false, "constructor": true}, {"identifier": "handleMessage", "parameters": "(final ActorRef sender, final Object originalMessage)", "modifiers": "@Override public", "return": "RaftActorBehavior", "signature": "RaftActorBehavior handleMessage(final ActorRef sender, final Object originalMessage)", "full_signature": "@Override public RaftActorBehavior handleMessage(final ActorRef sender, final Object originalMessage)", "class_method_signature": "Leader.handleMessage(final ActorRef sender, final Object originalMessage)", "testcase": false, "constructor": false}, {"identifier": "beforeSendHeartbeat", "parameters": "()", "modifiers": "@Override protected", "return": "void", "signature": "void beforeSendHeartbeat()", "full_signature": "@Override protected void beforeSendHeartbeat()", "class_method_signature": "Leader.beforeSendHeartbeat()", "testcase": false, "constructor": false}, {"identifier": "handleAppendEntriesReply", "parameters": "(final ActorRef sender,\n            final AppendEntriesReply appendEntriesReply)", "modifiers": "@Override protected", "return": "RaftActorBehavior", "signature": "RaftActorBehavior handleAppendEntriesReply(final ActorRef sender,\n            final AppendEntriesReply appendEntriesReply)", "full_signature": "@Override protected RaftActorBehavior handleAppendEntriesReply(final ActorRef sender,\n            final AppendEntriesReply appendEntriesReply)", "class_method_signature": "Leader.handleAppendEntriesReply(final ActorRef sender,\n            final AppendEntriesReply appendEntriesReply)", "testcase": false, "constructor": false}, {"identifier": "transferLeadership", "parameters": "(@NonNull final RaftActorLeadershipTransferCohort leadershipTransferCohort)", "modifiers": "public", "return": "void", "signature": "void transferLeadership(@NonNull final RaftActorLeadershipTransferCohort leadershipTransferCohort)", "full_signature": "public void transferLeadership(@NonNull final RaftActorLeadershipTransferCohort leadershipTransferCohort)", "class_method_signature": "Leader.transferLeadership(@NonNull final RaftActorLeadershipTransferCohort leadershipTransferCohort)", "testcase": false, "constructor": false}, {"identifier": "tryToCompleteLeadershipTransfer", "parameters": "(final String followerId)", "modifiers": "private", "return": "void", "signature": "void tryToCompleteLeadershipTransfer(final String followerId)", "full_signature": "private void tryToCompleteLeadershipTransfer(final String followerId)", "class_method_signature": "Leader.tryToCompleteLeadershipTransfer(final String followerId)", "testcase": false, "constructor": false}, {"identifier": "close", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void close()", "full_signature": "@Override public void close()", "class_method_signature": "Leader.close()", "testcase": false, "constructor": false}, {"identifier": "markFollowerActive", "parameters": "(final String followerId)", "modifiers": "@VisibleForTesting", "return": "void", "signature": "void markFollowerActive(final String followerId)", "full_signature": "@VisibleForTesting void markFollowerActive(final String followerId)", "class_method_signature": "Leader.markFollowerActive(final String followerId)", "testcase": false, "constructor": false}, {"identifier": "markFollowerInActive", "parameters": "(final String followerId)", "modifiers": "@VisibleForTesting", "return": "void", "signature": "void markFollowerInActive(final String followerId)", "full_signature": "@VisibleForTesting void markFollowerInActive(final String followerId)", "class_method_signature": "Leader.markFollowerInActive(final String followerId)", "testcase": false, "constructor": false}], "file": "opendaylight/md-sal/sal-akka-raft/src/main/java/org/opendaylight/controller/cluster/raft/behaviors/Leader.java"}, "focal_method": {"identifier": "handleMessage", "parameters": "(final ActorRef sender, final Object originalMessage)", "modifiers": "@Override public", "return": "RaftActorBehavior", "body": "@Override\n    public RaftActorBehavior handleMessage(final ActorRef sender, final Object originalMessage) {\n        requireNonNull(sender, \"sender should not be null\");\n\n        if (ISOLATED_LEADER_CHECK.equals(originalMessage)) {\n            if (isLeaderIsolated()) {\n                log.warn(\"{}: At least {} followers need to be active, Switching {} from Leader to IsolatedLeader\",\n                    context.getId(), getMinIsolatedLeaderPeerCount(), getLeaderId());\n                return internalSwitchBehavior(new IsolatedLeader(context, this));\n            } else {\n                return this;\n            }\n        } else {\n            return super.handleMessage(sender, originalMessage);\n        }\n    }", "signature": "RaftActorBehavior handleMessage(final ActorRef sender, final Object originalMessage)", "full_signature": "@Override public RaftActorBehavior handleMessage(final ActorRef sender, final Object originalMessage)", "class_method_signature": "Leader.handleMessage(final ActorRef sender, final Object originalMessage)", "testcase": false, "constructor": false, "invocations": ["requireNonNull", "equals", "isLeaderIsolated", "warn", "getId", "getMinIsolatedLeaderPeerCount", "getLeaderId", "internalSwitchBehavior", "handleMessage"]}, "repository": {"repo_id": 16362479, "url": "https://github.com/opendaylight/controller", "stars": 313, "created": "1/29/2014 11:10:45 PM +00:00", "updates": "2020-01-20T11:02:36+00:00", "fork": "False", "license": "licensed"}}