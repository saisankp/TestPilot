{"test_class": {"identifier": "KiePMMLDroolsModelFactoryUtilsTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String TEMPLATE_SOURCE = \"Template.tmpl\";", "modifier": "private static final", "type": "String", "declarator": "TEMPLATE_SOURCE = \"Template.tmpl\"", "var_name": "TEMPLATE_SOURCE"}, {"original_string": "private static final String TEMPLATE_CLASS_NAME = \"Template\";", "modifier": "private static final", "type": "String", "declarator": "TEMPLATE_CLASS_NAME = \"Template\"", "var_name": "TEMPLATE_CLASS_NAME"}, {"original_string": "private static CompilationUnit COMPILATION_UNIT;", "modifier": "private static", "type": "CompilationUnit", "declarator": "COMPILATION_UNIT", "var_name": "COMPILATION_UNIT"}, {"original_string": "private static ClassOrInterfaceDeclaration MODEL_TEMPLATE;", "modifier": "private static", "type": "ClassOrInterfaceDeclaration", "declarator": "MODEL_TEMPLATE", "var_name": "MODEL_TEMPLATE"}], "file": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/test/java/org/kie/pmml/models/drools/utils/KiePMMLDroolsModelFactoryUtilsTest.java"}, "test_case": {"identifier": "getKiePMMLModelCompilationUnit", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void getKiePMMLModelCompilationUnit() {\n        DataDictionary dataDictionary = new DataDictionary();\n        String targetFieldString = \"target.field\";\n        FieldName targetFieldName = FieldName.create(targetFieldString);\n        dataDictionary.addDataFields(new DataField(targetFieldName, OpType.CONTINUOUS, DataType.DOUBLE));\n        String modelName = \"ModelName\";\n        Model model = new TreeModel();\n        model.setModelName(modelName);\n        model.setMiningFunction(MiningFunction.CLASSIFICATION);\n        MiningField targetMiningField = new MiningField(targetFieldName);\n        targetMiningField.setUsageType(MiningField.UsageType.TARGET);\n        MiningSchema miningSchema = new MiningSchema();\n        miningSchema.addMiningFields(targetMiningField);\n        model.setMiningSchema(miningSchema);\n        Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap = new HashMap<>();\n        fieldTypeMap.put(targetFieldString, new KiePMMLOriginalTypeGeneratedType(targetFieldString,\n                                                                                 getSanitizedClassName(targetFieldString)));\n        String packageName = \"net.test\";\n        CompilationUnit retrieved = KiePMMLDroolsModelFactoryUtils.getKiePMMLModelCompilationUnit(dataDictionary,\n                                                                                                  model, fieldTypeMap\n                , packageName, TEMPLATE_SOURCE, TEMPLATE_CLASS_NAME);\n        assertEquals(packageName, retrieved.getPackageDeclaration().get().getNameAsString());\n        ConstructorDeclaration constructorDeclaration =\n                retrieved.getClassByName(modelName).get().getDefaultConstructor().get();\n        MINING_FUNCTION miningFunction = MINING_FUNCTION.CLASSIFICATION;\n        PMML_MODEL pmmlModel = PMML_MODEL.byName(model.getClass().getSimpleName());\n        Map<String, Expression> assignExpressionMap = new HashMap<>();\n        assignExpressionMap.put(\"targetField\", new StringLiteralExpr(targetFieldString));\n        assignExpressionMap.put(\"miningFunction\",\n                                new NameExpr(miningFunction.getClass().getName() + \".\" + miningFunction.name()));\n        assignExpressionMap.put(\"pmmlMODEL\", new NameExpr(pmmlModel.getClass().getName() + \".\" + pmmlModel.name()));\n        assertTrue(commonEvaluateAssignExpr(constructorDeclaration.getBody(), assignExpressionMap));\n        int expectedMethodCallExprs = assignExpressionMap.size() + fieldTypeMap.size() + 1; // The last \"1\" is for\n        // the super invocation\n        commonEvaluateFieldTypeMap(constructorDeclaration.getBody(), fieldTypeMap, expectedMethodCallExprs);\n    }", "signature": "void getKiePMMLModelCompilationUnit()", "full_signature": "@Test public void getKiePMMLModelCompilationUnit()", "class_method_signature": "KiePMMLDroolsModelFactoryUtilsTest.getKiePMMLModelCompilationUnit()", "testcase": true, "constructor": false, "invocations": ["create", "addDataFields", "setModelName", "setMiningFunction", "setUsageType", "addMiningFields", "setMiningSchema", "put", "getSanitizedClassName", "getKiePMMLModelCompilationUnit", "assertEquals", "getNameAsString", "get", "getPackageDeclaration", "get", "getDefaultConstructor", "get", "getClassByName", "byName", "getSimpleName", "getClass", "put", "put", "getName", "getClass", "name", "put", "getName", "getClass", "name", "assertTrue", "commonEvaluateAssignExpr", "getBody", "size", "size", "commonEvaluateFieldTypeMap", "getBody"]}, "focal_class": {"identifier": "KiePMMLDroolsModelFactoryUtils", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger logger = LoggerFactory.getLogger(KiePMMLDroolsModelFactoryUtils.class.getName());", "modifier": "private static final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(KiePMMLDroolsModelFactoryUtils.class.getName())", "var_name": "logger"}, {"original_string": "static final String GETKMODULEPACKAGENAME_METHOD = \"getKModulePackageName\";", "modifier": "static final", "type": "String", "declarator": "GETKMODULEPACKAGENAME_METHOD = \"getKModulePackageName\"", "var_name": "GETKMODULEPACKAGENAME_METHOD"}], "methods": [{"identifier": "KiePMMLDroolsModelFactoryUtils", "parameters": "()", "modifiers": "private", "return": "", "signature": " KiePMMLDroolsModelFactoryUtils()", "full_signature": "private  KiePMMLDroolsModelFactoryUtils()", "class_method_signature": "KiePMMLDroolsModelFactoryUtils.KiePMMLDroolsModelFactoryUtils()", "testcase": false, "constructor": true}, {"identifier": "getKiePMMLModelCompilationUnit", "parameters": "(final DataDictionary dataDictionary,\n                                                                 final Model model,\n                                                                 final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap,\n                                                                 final String packageName,\n                                                                 final String javaTemplate,\n                                                                 final String modelClassName)", "modifiers": "public static", "return": "CompilationUnit", "signature": "CompilationUnit getKiePMMLModelCompilationUnit(final DataDictionary dataDictionary,\n                                                                 final Model model,\n                                                                 final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap,\n                                                                 final String packageName,\n                                                                 final String javaTemplate,\n                                                                 final String modelClassName)", "full_signature": "public static CompilationUnit getKiePMMLModelCompilationUnit(final DataDictionary dataDictionary,\n                                                                 final Model model,\n                                                                 final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap,\n                                                                 final String packageName,\n                                                                 final String javaTemplate,\n                                                                 final String modelClassName)", "class_method_signature": "KiePMMLDroolsModelFactoryUtils.getKiePMMLModelCompilationUnit(final DataDictionary dataDictionary,\n                                                                 final Model model,\n                                                                 final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap,\n                                                                 final String packageName,\n                                                                 final String javaTemplate,\n                                                                 final String modelClassName)", "testcase": false, "constructor": false}, {"identifier": "setConstructor", "parameters": "(final Model model,\n                               final ConstructorDeclaration constructorDeclaration,\n                               final SimpleName tableName,\n                               final String targetField,\n                               final MINING_FUNCTION miningFunction)", "modifiers": "static", "return": "void", "signature": "void setConstructor(final Model model,\n                               final ConstructorDeclaration constructorDeclaration,\n                               final SimpleName tableName,\n                               final String targetField,\n                               final MINING_FUNCTION miningFunction)", "full_signature": "static void setConstructor(final Model model,\n                               final ConstructorDeclaration constructorDeclaration,\n                               final SimpleName tableName,\n                               final String targetField,\n                               final MINING_FUNCTION miningFunction)", "class_method_signature": "KiePMMLDroolsModelFactoryUtils.setConstructor(final Model model,\n                               final ConstructorDeclaration constructorDeclaration,\n                               final SimpleName tableName,\n                               final String targetField,\n                               final MINING_FUNCTION miningFunction)", "testcase": false, "constructor": false}, {"identifier": "addFieldTypeMapPopulation", "parameters": "(BlockStmt body, Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap)", "modifiers": "static", "return": "void", "signature": "void addFieldTypeMapPopulation(BlockStmt body, Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap)", "full_signature": "static void addFieldTypeMapPopulation(BlockStmt body, Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap)", "class_method_signature": "KiePMMLDroolsModelFactoryUtils.addFieldTypeMapPopulation(BlockStmt body, Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap)", "testcase": false, "constructor": false}, {"identifier": "populateGetKModulePackageName", "parameters": "(final MethodDeclaration getKModulePackageNameMethod, final String packageName)", "modifiers": "static", "return": "void", "signature": "void populateGetKModulePackageName(final MethodDeclaration getKModulePackageNameMethod, final String packageName)", "full_signature": "static void populateGetKModulePackageName(final MethodDeclaration getKModulePackageNameMethod, final String packageName)", "class_method_signature": "KiePMMLDroolsModelFactoryUtils.populateGetKModulePackageName(final MethodDeclaration getKModulePackageNameMethod, final String packageName)", "testcase": false, "constructor": false}], "file": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/utils/KiePMMLDroolsModelFactoryUtils.java"}, "focal_method": {"identifier": "getKiePMMLModelCompilationUnit", "parameters": "(final DataDictionary dataDictionary,\n                                                                 final Model model,\n                                                                 final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap,\n                                                                 final String packageName,\n                                                                 final String javaTemplate,\n                                                                 final String modelClassName)", "modifiers": "public static", "return": "CompilationUnit", "body": "public static CompilationUnit getKiePMMLModelCompilationUnit(final DataDictionary dataDictionary,\n                                                                 final Model model,\n                                                                 final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap,\n                                                                 final String packageName,\n                                                                 final String javaTemplate,\n                                                                 final String modelClassName) {\n        logger.trace(\"getKiePMMLModelCompilationUnit {} {} {}\", dataDictionary, model, packageName);\n        String className = getSanitizedClassName(model.getModelName());\n        CompilationUnit cloneCU = JavaParserUtils.getKiePMMLModelCompilationUnit(className, packageName, javaTemplate, modelClassName);\n        ClassOrInterfaceDeclaration modelTemplate = cloneCU.getClassByName(className)\n                .orElseThrow(() -> new KiePMMLException(MAIN_CLASS_NOT_FOUND + \": \" + className));\n        MINING_FUNCTION miningFunction = MINING_FUNCTION.byName(model.getMiningFunction().value());\n        final ConstructorDeclaration constructorDeclaration = modelTemplate.getDefaultConstructor().orElseThrow(() -> new KiePMMLInternalException(String.format(MISSING_DEFAULT_CONSTRUCTOR, modelTemplate.getName())));\n        String targetField = getTargetFieldName(dataDictionary, model).orElse(null);\n        List<KiePMMLOutputField> outputFields = getOutputFields(model);\n        setConstructor(model, constructorDeclaration, modelTemplate.getName(), targetField, miningFunction);\n        addOutputFieldsPopulation(constructorDeclaration.getBody(), outputFields);\n        addFieldTypeMapPopulation(constructorDeclaration.getBody(), fieldTypeMap);\n        final MethodDeclaration getKModulePackageNameMethod = modelTemplate.getMethodsByName(GETKMODULEPACKAGENAME_METHOD).get(0);\n        populateGetKModulePackageName(getKModulePackageNameMethod, packageName);\n        return cloneCU;\n    }", "signature": "CompilationUnit getKiePMMLModelCompilationUnit(final DataDictionary dataDictionary,\n                                                                 final Model model,\n                                                                 final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap,\n                                                                 final String packageName,\n                                                                 final String javaTemplate,\n                                                                 final String modelClassName)", "full_signature": "public static CompilationUnit getKiePMMLModelCompilationUnit(final DataDictionary dataDictionary,\n                                                                 final Model model,\n                                                                 final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap,\n                                                                 final String packageName,\n                                                                 final String javaTemplate,\n                                                                 final String modelClassName)", "class_method_signature": "KiePMMLDroolsModelFactoryUtils.getKiePMMLModelCompilationUnit(final DataDictionary dataDictionary,\n                                                                 final Model model,\n                                                                 final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap,\n                                                                 final String packageName,\n                                                                 final String javaTemplate,\n                                                                 final String modelClassName)", "testcase": false, "constructor": false, "invocations": ["trace", "getSanitizedClassName", "getModelName", "getKiePMMLModelCompilationUnit", "orElseThrow", "getClassByName", "byName", "value", "getMiningFunction", "orElseThrow", "getDefaultConstructor", "format", "getName", "orElse", "getTargetFieldName", "getOutputFields", "setConstructor", "getName", "addOutputFieldsPopulation", "getBody", "addFieldTypeMapPopulation", "getBody", "get", "getMethodsByName", "populateGetKModulePackageName"]}, "repository": {"repo_id": 1381673, "url": "https://github.com/kiegroup/drools", "stars": 2733, "created": "2/18/2011 8:37:05 AM +00:00", "updates": "2020-01-27T13:12:15+00:00", "fork": "False", "license": "licensed"}}