{"test_class": {"identifier": "urn_perun_user_attribute_def_virt_userOrganizationsTest", "superclass": "extends AbstractPerunIntegrationTest", "interfaces": "", "fields": [{"original_string": "private User user;", "modifier": "private", "type": "User", "declarator": "user", "var_name": "user"}, {"original_string": "private Member member;", "modifier": "private", "type": "Member", "declarator": "member", "var_name": "member"}, {"original_string": "private Member member2;", "modifier": "private", "type": "Member", "declarator": "member2", "var_name": "member2"}, {"original_string": "private Vo vo;", "modifier": "private", "type": "Vo", "declarator": "vo", "var_name": "vo"}, {"original_string": "private Vo vo2;", "modifier": "private", "type": "Vo", "declarator": "vo2", "var_name": "vo2"}, {"original_string": "private urn_perun_user_attribute_def_virt_userOrganizations classInstance;", "modifier": "private", "type": "urn_perun_user_attribute_def_virt_userOrganizations", "declarator": "classInstance", "var_name": "classInstance"}, {"original_string": "private static final String A_M_organization = AttributesManager.NS_MEMBER_ATTR_DEF + \":organization\";", "modifier": "private static final", "type": "String", "declarator": "A_M_organization = AttributesManager.NS_MEMBER_ATTR_DEF + \":organization\"", "var_name": "A_M_organization"}], "file": "perun-core/src/test/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_user_attribute_def_virt_userOrganizationsTest.java"}, "test_case": {"identifier": "getAttributeValue", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n\tpublic void getAttributeValue() throws Exception {\n\t\t// Set values of member organization attribute\n\t\tAttribute organization = perun.getAttributesManagerBl().getAttribute(sess, member, A_M_organization);\n\t\torganization.setValue(\"some value\");\n\t\tperun.getAttributesManager().setAttribute(sess, member, organization);\n\t\torganization = perun.getAttributesManagerBl().getAttribute(sess, member2, A_M_organization);\n\t\torganization.setValue(\"different value\");\n\t\tperun.getAttributesManager().setAttribute(sess, member2, organization);\n\n\t\tAttributeDefinition attr = new AttributeDefinition();\n\t\tattr.setNamespace(AttributesManager.NS_USER_ATTR_VIRT);\n\t\tattr.setFriendlyName(\"userOrganizations\");\n\t\tattr.setType(HashMap.class.getName());\n\n\t\tAttribute attribute = new Attribute(attr);\n\n\t\tperun.getAttributesManager().createAttribute(sess, attribute);\n\n\t\tMap<String, String> value = classInstance.getAttributeValue((PerunSessionImpl) sess, user, attribute).valueAsMap();\n\n\t\tassertEquals(\"Attribute should have 2 elements.\", 2, value.size());\n\t\tassertTrue(\"Attribute should contain short name of first vo as a key.\", value.containsKey(vo.getShortName()));\n\t\tassertTrue(\"Attribute should contain short name of second vo as a key.\", value.containsKey(vo2.getShortName()));\n\t\tassertEquals(\"some value should be a value to short name of first vo.\", \"some value\", value.get(vo.getShortName()));\n\t\tassertEquals(\"different value should be a value to short name of second vo.\", \"different value\", value.get(vo2.getShortName()));\n\t}", "signature": "void getAttributeValue()", "full_signature": "@Test public void getAttributeValue()", "class_method_signature": "urn_perun_user_attribute_def_virt_userOrganizationsTest.getAttributeValue()", "testcase": true, "constructor": false, "invocations": ["getAttribute", "getAttributesManagerBl", "setValue", "setAttribute", "getAttributesManager", "getAttribute", "getAttributesManagerBl", "setValue", "setAttribute", "getAttributesManager", "setNamespace", "setFriendlyName", "setType", "getName", "createAttribute", "getAttributesManager", "valueAsMap", "getAttributeValue", "assertEquals", "size", "assertTrue", "containsKey", "getShortName", "assertTrue", "containsKey", "getShortName", "assertEquals", "get", "getShortName", "assertEquals", "get", "getShortName"]}, "focal_class": {"identifier": "urn_perun_user_attribute_def_virt_userOrganizations", "superclass": "extends UserVirtualAttributesModuleAbstract", "interfaces": "implements UserVirtualAttributesModuleImplApi", "fields": [{"original_string": "private static final String A_M_organization = AttributesManager.NS_MEMBER_ATTR_DEF + \":organization\";", "modifier": "private static final", "type": "String", "declarator": "A_M_organization = AttributesManager.NS_MEMBER_ATTR_DEF + \":organization\"", "var_name": "A_M_organization"}], "methods": [{"identifier": "getAttributeValue", "parameters": "(PerunSessionImpl perunSession, User user, AttributeDefinition attributeDefinition)", "modifiers": "@Override public", "return": "Attribute", "signature": "Attribute getAttributeValue(PerunSessionImpl perunSession, User user, AttributeDefinition attributeDefinition)", "full_signature": "@Override public Attribute getAttributeValue(PerunSessionImpl perunSession, User user, AttributeDefinition attributeDefinition)", "class_method_signature": "urn_perun_user_attribute_def_virt_userOrganizations.getAttributeValue(PerunSessionImpl perunSession, User user, AttributeDefinition attributeDefinition)", "testcase": false, "constructor": false}, {"identifier": "getAttributeDefinition", "parameters": "()", "modifiers": "@Override public", "return": "AttributeDefinition", "signature": "AttributeDefinition getAttributeDefinition()", "full_signature": "@Override public AttributeDefinition getAttributeDefinition()", "class_method_signature": "urn_perun_user_attribute_def_virt_userOrganizations.getAttributeDefinition()", "testcase": false, "constructor": false}], "file": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_user_attribute_def_virt_userOrganizations.java"}, "focal_method": {"identifier": "getAttributeValue", "parameters": "(PerunSessionImpl perunSession, User user, AttributeDefinition attributeDefinition)", "modifiers": "@Override public", "return": "Attribute", "body": "@Override\n\tpublic Attribute getAttributeValue(PerunSessionImpl perunSession, User user, AttributeDefinition attributeDefinition) {\n\t\tMap<String, String> userOrganizations = new LinkedHashMap<>();\n\t\tList<Vo> vos = perunSession.getPerunBl().getUsersManagerBl().getVosWhereUserIsMember(perunSession, user);\n\n\t\tfor (Vo vo : vos) {\n\t\t\ttry {\n\t\t\t\tMember member = perunSession.getPerunBl().getMembersManagerBl().getMemberByUser(perunSession, vo, user);\n\t\t\t\tString value = perunSession.getPerunBl().getAttributesManagerBl().getAttribute(perunSession, member, A_M_organization).valueAsString();\n\t\t\t\tif (value != null) userOrganizations.put(vo.getShortName(), value);\n\t\t\t} catch (MemberNotExistsException e) {\n\t\t\t\tthrow new ConsistencyErrorException(e);\n\t\t\t} catch (WrongAttributeAssignmentException | AttributeNotExistsException e) {\n\t\t\t\tthrow new InternalErrorException(e);\n\t\t\t}\n\t\t}\n\n\t\tAttribute attribute = new Attribute(attributeDefinition);\n\t\tattribute.setValue(userOrganizations);\n\t\treturn attribute;\n\t}", "signature": "Attribute getAttributeValue(PerunSessionImpl perunSession, User user, AttributeDefinition attributeDefinition)", "full_signature": "@Override public Attribute getAttributeValue(PerunSessionImpl perunSession, User user, AttributeDefinition attributeDefinition)", "class_method_signature": "urn_perun_user_attribute_def_virt_userOrganizations.getAttributeValue(PerunSessionImpl perunSession, User user, AttributeDefinition attributeDefinition)", "testcase": false, "constructor": false, "invocations": ["getVosWhereUserIsMember", "getUsersManagerBl", "getPerunBl", "getMemberByUser", "getMembersManagerBl", "getPerunBl", "valueAsString", "getAttribute", "getAttributesManagerBl", "getPerunBl", "put", "getShortName", "setValue"]}, "repository": {"repo_id": 4085998, "url": "https://github.com/CESNET/perun", "stars": 38, "created": "4/20/2012 11:55:38 AM +00:00", "updates": "2020-01-27T09:51:13+00:00", "fork": "False", "license": "licensed"}}