{"test_class": {"identifier": "OpentsdbMetricReaderTest", "superclass": "", "interfaces": "", "fields": [], "file": "gateway/metrics/importer/opentsdb/src/test/java/com/alipay/sofa/lookout/gateway/metrics/importer/opentsdb/OpentsdbMetricReaderTest.java"}, "test_case": {"identifier": "testRead", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testRead() throws UnsupportedEncodingException {\n        OpentsdbMetricReader reader = new OpentsdbMetricReader();\n\n        RawMetric metric = new RawMetric();\n        metric\n            .setRawBody(\"{\\\"metric\\\":\\\"jvm.mem.free\\\",\\\"value\\\":1.2,\\\"timestamp\\\":1557844146565,\\\"tags\\\":{\\\"app\\\":\\\"demo\\\"}}\"\n                .getBytes(\"UTF-8\"));\n        Stream<Metric> metricStream = reader.read(metric);\n        Metric m = metricStream.collect(Collectors.toList()).get(0);\n        Assert.assertTrue(m.toString().contains(\"jvm.mem.free\"));\n    }", "signature": "void testRead()", "full_signature": "@Test public void testRead()", "class_method_signature": "OpentsdbMetricReaderTest.testRead()", "testcase": true, "constructor": false, "invocations": ["setRawBody", "getBytes", "read", "get", "collect", "toList", "assertTrue", "contains", "toString"]}, "focal_class": {"identifier": "OpentsdbMetricReader", "superclass": "extends AbstractReader<RawMetric, Metric>", "interfaces": "", "fields": [{"original_string": "private static final char ARRAY_START = '[';", "modifier": "private static final", "type": "char", "declarator": "ARRAY_START = '['", "var_name": "ARRAY_START"}], "methods": [{"identifier": "read", "parameters": "(RawMetric rawMetric)", "modifiers": "@Override public", "return": "Stream<Metric>", "signature": "Stream<Metric> read(RawMetric rawMetric)", "full_signature": "@Override public Stream<Metric> read(RawMetric rawMetric)", "class_method_signature": "OpentsdbMetricReader.read(RawMetric rawMetric)", "testcase": false, "constructor": false}], "file": "gateway/metrics/importer/opentsdb/src/main/java/com/alipay/sofa/lookout/gateway/metrics/importer/opentsdb/OpentsdbMetricReader.java"}, "focal_method": {"identifier": "read", "parameters": "(RawMetric rawMetric)", "modifiers": "@Override public", "return": "Stream<Metric>", "body": "@Override\n    public Stream<Metric> read(RawMetric rawMetric) {\n        String bodyStr = readUTF8(rawMetric.getRawBody());\n\n        // \u4e0a\u4f20\u7684\u53ef\u80fd\u662f\u4e00\u4e2a\u6570\u7ec4\n        if (bodyStr.charAt(0) == ARRAY_START) {\n            JSONArray array = JSON.parseArray(bodyStr);\n            return array.stream()\n                    .map(o -> OpentsdbConverter.convertToModel((JSONObject) o));\n        } else {\n            return Stream.of(OpentsdbConverter.convertToModel(JSON.parseObject(bodyStr)));\n        }\n    }", "signature": "Stream<Metric> read(RawMetric rawMetric)", "full_signature": "@Override public Stream<Metric> read(RawMetric rawMetric)", "class_method_signature": "OpentsdbMetricReader.read(RawMetric rawMetric)", "testcase": false, "constructor": false, "invocations": ["readUTF8", "getRawBody", "charAt", "parseArray", "map", "stream", "convertToModel", "of", "convertToModel", "parseObject"]}, "repository": {"repo_id": 133381280, "url": "https://github.com/sofastack/sofa-lookout", "language": "Java", "is_fork": false, "fork_count": 113, "stargazer_count": 318, "size": 1394, "license": "licensed"}}