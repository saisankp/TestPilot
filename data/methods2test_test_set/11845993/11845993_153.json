{"test_class": {"identifier": "StagemonitorMetricsServletTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private StagemonitorMetricsServlet servlet;", "modifier": "private", "type": "StagemonitorMetricsServlet", "declarator": "servlet", "var_name": "servlet"}, {"original_string": "private Metric2Registry registry;", "modifier": "private", "type": "Metric2Registry", "declarator": "registry", "var_name": "registry"}], "file": "stagemonitor-web-servlet/src/test/java/org/stagemonitor/web/servlet/widget/StagemonitorMetricsServletTest.java"}, "test_case": {"identifier": "getMeter", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n\tpublic void getMeter() throws Exception {\n\t\tregistry.meter(name(\"foo\").tag(\"bar\", \"baz\").build()).mark();\n\t\tfinal MockHttpServletResponse resp = new MockHttpServletResponse();\n\t\tservlet.doGet(new MockHttpServletRequest(), resp);\n\t\tfinal double mean_rate = JsonUtils.getMapper().readTree(resp.getContentAsString()).get(0).get(\"values\").get(\"mean_rate\").doubleValue();\n\t\tassertTrue(\"Expected m1 rate of > 0, but got \" + mean_rate, mean_rate > 0);\n\t}", "signature": "void getMeter()", "full_signature": "@Test public void getMeter()", "class_method_signature": "StagemonitorMetricsServletTest.getMeter()", "testcase": true, "constructor": false, "invocations": ["mark", "meter", "build", "tag", "name", "doGet", "doubleValue", "get", "get", "get", "readTree", "getMapper", "getContentAsString", "assertTrue"]}, "focal_class": {"identifier": "StagemonitorMetricsServlet", "superclass": "extends HttpServlet", "interfaces": "", "fields": [{"original_string": "private final transient Metric2Registry registry;", "modifier": "private final transient", "type": "Metric2Registry", "declarator": "registry", "var_name": "registry"}, {"original_string": "private final transient ServletPlugin   servletPlugin;", "modifier": "private final transient", "type": "ServletPlugin", "declarator": "servletPlugin", "var_name": "servletPlugin"}, {"original_string": "private final transient ObjectMapper    mapper;", "modifier": "private final transient", "type": "ObjectMapper", "declarator": "mapper", "var_name": "mapper"}], "methods": [{"identifier": "StagemonitorMetricsServlet", "parameters": "()", "modifiers": "public", "return": "", "signature": " StagemonitorMetricsServlet()", "full_signature": "public  StagemonitorMetricsServlet()", "class_method_signature": "StagemonitorMetricsServlet.StagemonitorMetricsServlet()", "testcase": false, "constructor": true}, {"identifier": "StagemonitorMetricsServlet", "parameters": "(Metric2Registry registry, ServletPlugin servletPlugin, ObjectMapper mapper)", "modifiers": "public", "return": "", "signature": " StagemonitorMetricsServlet(Metric2Registry registry, ServletPlugin servletPlugin, ObjectMapper mapper)", "full_signature": "public  StagemonitorMetricsServlet(Metric2Registry registry, ServletPlugin servletPlugin, ObjectMapper mapper)", "class_method_signature": "StagemonitorMetricsServlet.StagemonitorMetricsServlet(Metric2Registry registry, ServletPlugin servletPlugin, ObjectMapper mapper)", "testcase": false, "constructor": true}, {"identifier": "doGet", "parameters": "(HttpServletRequest req, HttpServletResponse resp)", "modifiers": "@Override protected", "return": "void", "signature": "void doGet(HttpServletRequest req, HttpServletResponse resp)", "full_signature": "@Override protected void doGet(HttpServletRequest req, HttpServletResponse resp)", "class_method_signature": "StagemonitorMetricsServlet.doGet(HttpServletRequest req, HttpServletResponse resp)", "testcase": false, "constructor": false}, {"identifier": "getWriter", "parameters": "(HttpServletRequest request)", "modifiers": "private", "return": "ObjectWriter", "signature": "ObjectWriter getWriter(HttpServletRequest request)", "full_signature": "private ObjectWriter getWriter(HttpServletRequest request)", "class_method_signature": "StagemonitorMetricsServlet.getWriter(HttpServletRequest request)", "testcase": false, "constructor": false}, {"identifier": "registerMetricsRegistryModule", "parameters": "(HttpServletRequest request, ObjectMapper objectMapperCopy)", "modifiers": "private", "return": "void", "signature": "void registerMetricsRegistryModule(HttpServletRequest request, ObjectMapper objectMapperCopy)", "full_signature": "private void registerMetricsRegistryModule(HttpServletRequest request, ObjectMapper objectMapperCopy)", "class_method_signature": "StagemonitorMetricsServlet.registerMetricsRegistryModule(HttpServletRequest request, ObjectMapper objectMapperCopy)", "testcase": false, "constructor": false}], "file": "stagemonitor-web-servlet/src/main/java/org/stagemonitor/web/servlet/widget/StagemonitorMetricsServlet.java"}, "focal_method": {"identifier": "doGet", "parameters": "(HttpServletRequest req, HttpServletResponse resp)", "modifiers": "@Override protected", "return": "void", "body": "@Override\n\tprotected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n\t\tresp.setContentType(\"application/json\");\n\t\tif (servletPlugin.getMetricsServletAllowedOrigin() != null) {\n\t\t\tresp.setHeader(\"Access-Control-Allow-Origin\", servletPlugin.getMetricsServletAllowedOrigin());\n\t\t}\n\t\tresp.setHeader(\"Cache-Control\", \"must-revalidate,no-cache,no-store\");\n\t\tresp.setStatus(HttpServletResponse.SC_OK);\n\n\t\ttry (OutputStream output = resp.getOutputStream()) {\n\t\t\tString jsonpParamName = servletPlugin.getMetricsServletJsonpParamName();\n\t\t\tif (jsonpParamName != null && req.getParameter(jsonpParamName) != null) {\n\t\t\t\tgetWriter(req).writeValue(output, new JSONPObject(req.getParameter(jsonpParamName), registry));\n\t\t\t} else {\n\t\t\t\tgetWriter(req).writeValue(output, registry);\n\t\t\t}\n\t\t}\n\t}", "signature": "void doGet(HttpServletRequest req, HttpServletResponse resp)", "full_signature": "@Override protected void doGet(HttpServletRequest req, HttpServletResponse resp)", "class_method_signature": "StagemonitorMetricsServlet.doGet(HttpServletRequest req, HttpServletResponse resp)", "testcase": false, "constructor": false, "invocations": ["setContentType", "getMetricsServletAllowedOrigin", "setHeader", "getMetricsServletAllowedOrigin", "setHeader", "setStatus", "getOutputStream", "getMetricsServletJsonpParamName", "getParameter", "writeValue", "getWriter", "getParameter", "writeValue", "getWriter"]}, "repository": {"repo_id": 11845993, "url": "https://github.com/stagemonitor/stagemonitor", "language": "Java", "is_fork": false, "fork_count": 268, "stargazer_count": 1585, "size": 10342, "license": "licensed"}}