{"test_class": {"identifier": "KeyStoreJwkKeyResolverTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final ClassLoader classLoader = this.getClass().getClassLoader();", "modifier": "private final", "type": "ClassLoader", "declarator": "classLoader = this.getClass().getClassLoader()", "var_name": "classLoader"}, {"original_string": "private final DefaultJwsHeader baseJwsHeader = new DefaultJwsHeader();", "modifier": "private final", "type": "DefaultJwsHeader", "declarator": "baseJwsHeader = new DefaultJwsHeader()", "var_name": "baseJwsHeader"}, {"original_string": "private final KeyStore baseKeyStore = new KeyStore() {\n        public String getPublicKey(String domain, String service, String keyId) {\n            return null;\n        }\n    };", "modifier": "private final", "type": "KeyStore", "declarator": "baseKeyStore = new KeyStore() {\n        public String getPublicKey(String domain, String service, String keyId) {\n            return null;\n        }\n    }", "var_name": "baseKeyStore"}, {"original_string": "private final SigningKeyResolver basejwksResolver = new SigningKeyResolver() {\n        public Key resolveSigningKey(JwsHeader header, Claims claims) { return null; }\n        public Key resolveSigningKey(JwsHeader header, String plaintext) { return null; }\n    };", "modifier": "private final", "type": "SigningKeyResolver", "declarator": "basejwksResolver = new SigningKeyResolver() {\n        public Key resolveSigningKey(JwsHeader header, Claims claims) { return null; }\n        public Key resolveSigningKey(JwsHeader header, String plaintext) { return null; }\n    }", "var_name": "basejwksResolver"}, {"original_string": "private final PublicKey basePublicKey = new PublicKey() {\n        private static final long serialVersionUID = 1L;\n        public String getFormat() { return null; }\n        public byte[] getEncoded() { return null; }\n        public String getAlgorithm() { return null; }\n    };", "modifier": "private final", "type": "PublicKey", "declarator": "basePublicKey = new PublicKey() {\n        private static final long serialVersionUID = 1L;\n        public String getFormat() { return null; }\n        public byte[] getEncoded() { return null; }\n        public String getAlgorithm() { return null; }\n    }", "var_name": "basePublicKey"}], "file": "libs/java/auth_core/src/test/java/com/yahoo/athenz/auth/oauth/parser/KeyStoreJwkKeyResolverTest.java"}, "test_case": {"identifier": "testResolveSigningKeyForJwe", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testResolveSigningKeyForJwe() throws MalformedURLException {\n        KeyStoreJwkKeyResolver resolver = new KeyStoreJwkKeyResolver(null, \"file:///\", null);\n        assertNull(resolver.resolveSigningKey(null, (String) null));\n        assertNull(resolver.resolveSigningKey(null, \"\"));\n        assertNull(resolver.resolveSigningKey(baseJwsHeader, \"plaintext\"));\n    }", "signature": "void testResolveSigningKeyForJwe()", "full_signature": "@Test public void testResolveSigningKeyForJwe()", "class_method_signature": "KeyStoreJwkKeyResolverTest.testResolveSigningKeyForJwe()", "testcase": true, "constructor": false, "invocations": ["assertNull", "resolveSigningKey", "assertNull", "resolveSigningKey", "assertNull", "resolveSigningKey"]}, "focal_class": {"identifier": "KeyStoreJwkKeyResolver", "superclass": "", "interfaces": "implements SigningKeyResolver", "fields": [{"original_string": "private static final Logger LOG = LoggerFactory.getLogger(KeyStoreJwkKeyResolver.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOG = LoggerFactory.getLogger(KeyStoreJwkKeyResolver.class)", "var_name": "LOG"}, {"original_string": "private static final String SYS_AUTH_DOMAIN = \"sys.auth\";", "modifier": "private static final", "type": "String", "declarator": "SYS_AUTH_DOMAIN = \"sys.auth\"", "var_name": "SYS_AUTH_DOMAIN"}, {"original_string": "private KeyStore keyStore = null;", "modifier": "private", "type": "KeyStore", "declarator": "keyStore = null", "var_name": "keyStore"}, {"original_string": "private SigningKeyResolver jwksResolver = null;", "modifier": "private", "type": "SigningKeyResolver", "declarator": "jwksResolver = null", "var_name": "jwksResolver"}], "methods": [{"identifier": "KeyStoreJwkKeyResolver", "parameters": "(KeyStore keyStore, String url, SSLContext sslContext)", "modifiers": "public", "return": "", "signature": " KeyStoreJwkKeyResolver(KeyStore keyStore, String url, SSLContext sslContext)", "full_signature": "public  KeyStoreJwkKeyResolver(KeyStore keyStore, String url, SSLContext sslContext)", "class_method_signature": "KeyStoreJwkKeyResolver.KeyStoreJwkKeyResolver(KeyStore keyStore, String url, SSLContext sslContext)", "testcase": false, "constructor": true}, {"identifier": "resolveSigningKey", "parameters": "(JwsHeader header, Claims claims)", "modifiers": "@Override @SuppressWarnings(\"rawtypes\") public", "return": "Key", "signature": "Key resolveSigningKey(JwsHeader header, Claims claims)", "full_signature": "@Override @SuppressWarnings(\"rawtypes\") public Key resolveSigningKey(JwsHeader header, Claims claims)", "class_method_signature": "KeyStoreJwkKeyResolver.resolveSigningKey(JwsHeader header, Claims claims)", "testcase": false, "constructor": false}, {"identifier": "resolveSigningKey", "parameters": "(JwsHeader header, String plaintext)", "modifiers": "@Override @SuppressWarnings(\"rawtypes\") public", "return": "Key", "signature": "Key resolveSigningKey(JwsHeader header, String plaintext)", "full_signature": "@Override @SuppressWarnings(\"rawtypes\") public Key resolveSigningKey(JwsHeader header, String plaintext)", "class_method_signature": "KeyStoreJwkKeyResolver.resolveSigningKey(JwsHeader header, String plaintext)", "testcase": false, "constructor": false}], "file": "libs/java/auth_core/src/main/java/com/yahoo/athenz/auth/oauth/parser/KeyStoreJwkKeyResolver.java"}, "focal_method": {"identifier": "resolveSigningKey", "parameters": "(JwsHeader header, Claims claims)", "modifiers": "@Override @SuppressWarnings(\"rawtypes\") public", "return": "Key", "body": "@Override\n    @SuppressWarnings(\"rawtypes\")\n    public Key resolveSigningKey(JwsHeader header, Claims claims) {\n        String keyId = header.getKeyId();\n        if (keyId == null || keyId.isEmpty()) {\n            if (LOG.isDebugEnabled()) {\n                LOG.debug(\"KeyStoreJwkKeyResolver:resolveSigningKey: invalid key ID \" + keyId);\n            }\n            return null;\n        }\n\n        // 1. find in key store\n        String issuer = claims.getIssuer();\n        if (this.keyStore != null && issuer != null && !issuer.isEmpty()) {\n            String[] ds = AthenzUtils.splitPrincipalName(issuer);\n            if (ds == null) {\n                if (LOG.isDebugEnabled()) {\n                    LOG.debug(\"KeyStoreJwkKeyResolver:resolveSigningKey: skip using KeyStore, invalid issuer \" + issuer);\n                }\n            } else {\n                String domain = ds[0];\n                String service = ds[1];\n\n                if (!SYS_AUTH_DOMAIN.equals(domain)) {\n                    LOG.debug(\"KeyStoreJwkKeyResolver:resolveSigningKey: skip using KeyStore, invalid domain \" + domain);\n                } else {\n                    String publicKey = this.keyStore.getPublicKey(domain, service, keyId);\n                    if (publicKey != null && !publicKey.isEmpty()) {\n                        try {\n                            if (LOG.isDebugEnabled()) {\n                                LOG.debug(\"KeyStoreJwkKeyResolver:resolveSigningKey: will use public key from key store: ({}, {}, {})\", domain, service, keyId);\n                            }\n                            return Crypto.loadPublicKey(publicKey);\n                        } catch (Throwable t) {\n                            LOG.warn(\"KeyStoreJwkKeyResolver:resolveSigningKey: invalid public key format\", t);\n                        }\n                    }\n                }\n            }\n        }\n\n        // 2. find in JWKS\n        if (LOG.isDebugEnabled()) {\n            LOG.debug(\"KeyStoreJwkKeyResolver:resolveSigningKey: will use public key from JWKS: ({})\", keyId);\n        }\n        return this.jwksResolver.resolveSigningKey(header, claims);\n    }", "signature": "Key resolveSigningKey(JwsHeader header, Claims claims)", "full_signature": "@Override @SuppressWarnings(\"rawtypes\") public Key resolveSigningKey(JwsHeader header, Claims claims)", "class_method_signature": "KeyStoreJwkKeyResolver.resolveSigningKey(JwsHeader header, Claims claims)", "testcase": false, "constructor": false, "invocations": ["getKeyId", "isEmpty", "isDebugEnabled", "debug", "getIssuer", "isEmpty", "splitPrincipalName", "isDebugEnabled", "debug", "equals", "debug", "getPublicKey", "isEmpty", "isDebugEnabled", "debug", "loadPublicKey", "warn", "isDebugEnabled", "debug", "resolveSigningKey"]}, "repository": {"repo_id": 73948366, "url": "https://github.com/yahoo/athenz", "stars": 394, "created": "11/16/2016 6:23:08 PM +00:00", "updates": "2020-01-27T15:36:13+00:00", "fork": "False", "license": "licensed"}}