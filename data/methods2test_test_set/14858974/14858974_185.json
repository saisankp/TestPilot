{"test_class": {"identifier": "DataModelVersionCheckTest", "superclass": "", "interfaces": "", "fields": [], "file": "server/src/test/java/org/axway/grapes/server/webapp/healthcheck/DataModelVersionCheckTest.java"}, "test_case": {"identifier": "checkUnhealthy", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n\tpublic void checkUnhealthy() {\n\t\tDataBaseConfig dataBaseConfig = mock(DataBaseConfig.class);\n\t\twhen(dataBaseConfig.getHost()).thenReturn(\"localhost\");\n\t\twhen(dataBaseConfig.getPort()).thenReturn(8074);\n\n        DataModelVersionCheck dbCheck = new DataModelVersionCheck(dataBaseConfig);\n\t\tResult result = dbCheck.check();\n\t\t\n\t\tassertNotNull(result);\n\t\tassertFalse(result.isHealthy());\n\t\t\n\t}", "signature": "void checkUnhealthy()", "full_signature": "@Test public void checkUnhealthy()", "class_method_signature": "DataModelVersionCheckTest.checkUnhealthy()", "testcase": true, "constructor": false, "invocations": ["mock", "thenReturn", "when", "getHost", "thenReturn", "when", "getPort", "check", "assertNotNull", "assertFalse", "isHealthy"]}, "focal_class": {"identifier": "DataModelVersionCheck", "superclass": "extends HealthCheck", "interfaces": "", "fields": [{"original_string": "private final DataBaseConfig config;", "modifier": "private final", "type": "DataBaseConfig", "declarator": "config", "var_name": "config"}], "methods": [{"identifier": "DataModelVersionCheck", "parameters": "(final DataBaseConfig dataBaseConfig)", "modifiers": "public", "return": "", "signature": " DataModelVersionCheck(final DataBaseConfig dataBaseConfig)", "full_signature": "public  DataModelVersionCheck(final DataBaseConfig dataBaseConfig)", "class_method_signature": "DataModelVersionCheck.DataModelVersionCheck(final DataBaseConfig dataBaseConfig)", "testcase": false, "constructor": true}, {"identifier": "check", "parameters": "()", "modifiers": "@Override protected", "return": "Result", "signature": "Result check()", "full_signature": "@Override protected Result check()", "class_method_signature": "DataModelVersionCheck.check()", "testcase": false, "constructor": false}], "file": "server/src/main/java/org/axway/grapes/server/webapp/healthcheck/DataModelVersionCheck.java"}, "focal_method": {"identifier": "check", "parameters": "()", "modifiers": "@Override protected", "return": "Result", "body": "@Override\n\tprotected Result check() {\n        Mongo mongo = null;\n        \n\t\ttry{\n\t\t\tfinal ServerAddress adress = new ServerAddress(config.getHost() , config.getPort());\n            mongo = new MongoClient(adress);\n            final DB db = mongo.getDB(config.getDatastore());\n\n            if(config.getUser() != null && config.getPwd() != null){\n                db.authenticate(config.getUser(), config.getPwd());\n            }\n\n            final Jongo jongo = new Jongo(db);\n            final DbGrapesInfo info = jongo.getCollection(DbCollections.DB_GRAPES_INFO).findOne().as(DbGrapesInfo.class);\n\n            if(info == null){\n                return Result.healthy(\"not found\\n\");\n            }\n\n            return Result.healthy(info.getDatamodelVersion()+'\\n');\n\t\t}\n\t\tcatch (Exception e) {\n\t\t\treturn Result.unhealthy(e);\n\t\t}\n        finally{\n            if(mongo != null){\n                mongo.close();\n            }\n        }\n\t}", "signature": "Result check()", "full_signature": "@Override protected Result check()", "class_method_signature": "DataModelVersionCheck.check()", "testcase": false, "constructor": false, "invocations": ["getHost", "getPort", "getDB", "getDatastore", "getUser", "getPwd", "authenticate", "getUser", "getPwd", "as", "findOne", "getCollection", "healthy", "healthy", "getDatamodelVersion", "unhealthy", "close"]}, "repository": {"repo_id": 14858974, "url": "https://github.com/Axway/Grapes", "language": "Java", "is_fork": false, "fork_count": 9, "stargazer_count": 8, "size": 3620, "license": "licensed"}}