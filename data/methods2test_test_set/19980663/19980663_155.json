{"test_class": {"identifier": "ElasticsearchQueryStoreTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final ObjectMapper mapper = new ObjectMapper();", "modifier": "private static final", "type": "ObjectMapper", "declarator": "mapper = new ObjectMapper()", "var_name": "mapper"}, {"original_string": "private static ElasticsearchConnection elasticsearchConnection;", "modifier": "private static", "type": "ElasticsearchConnection", "declarator": "elasticsearchConnection", "var_name": "elasticsearchConnection"}, {"original_string": "private static HazelcastInstance hazelcastInstance;", "modifier": "private static", "type": "HazelcastInstance", "declarator": "hazelcastInstance", "var_name": "hazelcastInstance"}, {"original_string": "private DataStore dataStore;", "modifier": "private", "type": "DataStore", "declarator": "dataStore", "var_name": "dataStore"}, {"original_string": "private ElasticsearchQueryStore queryStore;", "modifier": "private", "type": "ElasticsearchQueryStore", "declarator": "queryStore", "var_name": "queryStore"}, {"original_string": "private TableMetadataManager tableMetadataManager;", "modifier": "private", "type": "TableMetadataManager", "declarator": "tableMetadataManager", "var_name": "tableMetadataManager"}, {"original_string": "private TextNodeRemoverConfiguration removerConfiguration;", "modifier": "private", "type": "TextNodeRemoverConfiguration", "declarator": "removerConfiguration", "var_name": "removerConfiguration"}], "file": "foxtrot-core/src/test/java/com/flipkart/foxtrot/core/querystore/impl/ElasticsearchQueryStoreTest.java"}, "test_case": {"identifier": "testSaveBulkEmptyList", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testSaveBulkEmptyList() throws Exception {\n        List<Document> list = new Vector<Document>();\n        try {\n            queryStore.save(TestUtils.TEST_TABLE_NAME, list);\n            fail();\n        } catch (FoxtrotException ex) {\n            assertEquals(ErrorCode.INVALID_REQUEST, ex.getCode());\n        }\n    }", "signature": "void testSaveBulkEmptyList()", "full_signature": "@Test public void testSaveBulkEmptyList()", "class_method_signature": "ElasticsearchQueryStoreTest.testSaveBulkEmptyList()", "testcase": true, "constructor": false, "invocations": ["save", "fail", "assertEquals", "getCode"]}, "focal_class": {"identifier": "ElasticsearchQueryStore", "superclass": "", "interfaces": "implements QueryStore", "fields": [{"original_string": "private static final Logger logger = LoggerFactory.getLogger(ElasticsearchQueryStore.class.getSimpleName());", "modifier": "private static final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(ElasticsearchQueryStore.class.getSimpleName())", "var_name": "logger"}, {"original_string": "private static final String TABLE_META = \"tableMeta\";", "modifier": "private static final", "type": "String", "declarator": "TABLE_META = \"tableMeta\"", "var_name": "TABLE_META"}, {"original_string": "private static final String DATA_STORE = \"dataStore\";", "modifier": "private static final", "type": "String", "declarator": "DATA_STORE = \"dataStore\"", "var_name": "DATA_STORE"}, {"original_string": "private static final String QUERY_STORE = \"queryStore\";", "modifier": "private static final", "type": "String", "declarator": "QUERY_STORE = \"queryStore\"", "var_name": "QUERY_STORE"}, {"original_string": "private static final String UNKNOWN_TABLE_ERROR_MESSAGE = \"unknown_table table:%s\";", "modifier": "private static final", "type": "String", "declarator": "UNKNOWN_TABLE_ERROR_MESSAGE = \"unknown_table table:%s\"", "var_name": "UNKNOWN_TABLE_ERROR_MESSAGE"}, {"original_string": "private final ElasticsearchConnection connection;", "modifier": "private final", "type": "ElasticsearchConnection", "declarator": "connection", "var_name": "connection"}, {"original_string": "private final DataStore dataStore;", "modifier": "private final", "type": "DataStore", "declarator": "dataStore", "var_name": "dataStore"}, {"original_string": "private final TableMetadataManager tableMetadataManager;", "modifier": "private final", "type": "TableMetadataManager", "declarator": "tableMetadataManager", "var_name": "tableMetadataManager"}, {"original_string": "private final List<IndexerEventMutator> mutators;", "modifier": "private final", "type": "List<IndexerEventMutator>", "declarator": "mutators", "var_name": "mutators"}, {"original_string": "private final ObjectMapper mapper;", "modifier": "private final", "type": "ObjectMapper", "declarator": "mapper", "var_name": "mapper"}, {"original_string": "private final CardinalityConfig cardinalityConfig;", "modifier": "private final", "type": "CardinalityConfig", "declarator": "cardinalityConfig", "var_name": "cardinalityConfig"}], "methods": [{"identifier": "ElasticsearchQueryStore", "parameters": "(TableMetadataManager tableMetadataManager,\n                                   ElasticsearchConnection connection,\n                                   DataStore dataStore,\n                                   List<IndexerEventMutator> mutators,\n                                   ObjectMapper mapper,\n                                   CardinalityConfig cardinalityConfig)", "modifiers": "@Inject public", "return": "", "signature": " ElasticsearchQueryStore(TableMetadataManager tableMetadataManager,\n                                   ElasticsearchConnection connection,\n                                   DataStore dataStore,\n                                   List<IndexerEventMutator> mutators,\n                                   ObjectMapper mapper,\n                                   CardinalityConfig cardinalityConfig)", "full_signature": "@Inject public  ElasticsearchQueryStore(TableMetadataManager tableMetadataManager,\n                                   ElasticsearchConnection connection,\n                                   DataStore dataStore,\n                                   List<IndexerEventMutator> mutators,\n                                   ObjectMapper mapper,\n                                   CardinalityConfig cardinalityConfig)", "class_method_signature": "ElasticsearchQueryStore.ElasticsearchQueryStore(TableMetadataManager tableMetadataManager,\n                                   ElasticsearchConnection connection,\n                                   DataStore dataStore,\n                                   List<IndexerEventMutator> mutators,\n                                   ObjectMapper mapper,\n                                   CardinalityConfig cardinalityConfig)", "testcase": false, "constructor": true}, {"identifier": "initializeTable", "parameters": "(String table)", "modifiers": "@Override @Timed public", "return": "void", "signature": "void initializeTable(String table)", "full_signature": "@Override @Timed public void initializeTable(String table)", "class_method_signature": "ElasticsearchQueryStore.initializeTable(String table)", "testcase": false, "constructor": false}, {"identifier": "save", "parameters": "(String table, Document document)", "modifiers": "@Override @Timed public", "return": "void", "signature": "void save(String table, Document document)", "full_signature": "@Override @Timed public void save(String table, Document document)", "class_method_signature": "ElasticsearchQueryStore.save(String table, Document document)", "testcase": false, "constructor": false}, {"identifier": "save", "parameters": "(String table, List<Document> documents)", "modifiers": "@Override @Timed public", "return": "void", "signature": "void save(String table, List<Document> documents)", "full_signature": "@Override @Timed public void save(String table, List<Document> documents)", "class_method_signature": "ElasticsearchQueryStore.save(String table, List<Document> documents)", "testcase": false, "constructor": false}, {"identifier": "get", "parameters": "(String table, String id)", "modifiers": "@Override @Timed public", "return": "Document", "signature": "Document get(String table, String id)", "full_signature": "@Override @Timed public Document get(String table, String id)", "class_method_signature": "ElasticsearchQueryStore.get(String table, String id)", "testcase": false, "constructor": false}, {"identifier": "getAll", "parameters": "(String table, List<String> ids)", "modifiers": "@Override public", "return": "List<Document>", "signature": "List<Document> getAll(String table, List<String> ids)", "full_signature": "@Override public List<Document> getAll(String table, List<String> ids)", "class_method_signature": "ElasticsearchQueryStore.getAll(String table, List<String> ids)", "testcase": false, "constructor": false}, {"identifier": "getAll", "parameters": "(String table, List<String> ids, boolean bypassMetalookup)", "modifiers": "@Override @Timed public", "return": "List<Document>", "signature": "List<Document> getAll(String table, List<String> ids, boolean bypassMetalookup)", "full_signature": "@Override @Timed public List<Document> getAll(String table, List<String> ids, boolean bypassMetalookup)", "class_method_signature": "ElasticsearchQueryStore.getAll(String table, List<String> ids, boolean bypassMetalookup)", "testcase": false, "constructor": false}, {"identifier": "cleanupAll", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void cleanupAll()", "full_signature": "@Override public void cleanupAll()", "class_method_signature": "ElasticsearchQueryStore.cleanupAll()", "testcase": false, "constructor": false}, {"identifier": "cleanup", "parameters": "(final String table)", "modifiers": "@Override @Timed public", "return": "void", "signature": "void cleanup(final String table)", "full_signature": "@Override @Timed public void cleanup(final String table)", "class_method_signature": "ElasticsearchQueryStore.cleanup(final String table)", "testcase": false, "constructor": false}, {"identifier": "cleanup", "parameters": "(Set<String> tables)", "modifiers": "@Override @Timed public", "return": "void", "signature": "void cleanup(Set<String> tables)", "full_signature": "@Override @Timed public void cleanup(Set<String> tables)", "class_method_signature": "ElasticsearchQueryStore.cleanup(Set<String> tables)", "testcase": false, "constructor": false}, {"identifier": "getClusterHealth", "parameters": "()", "modifiers": "@Override public", "return": "ClusterHealthResponse", "signature": "ClusterHealthResponse getClusterHealth()", "full_signature": "@Override public ClusterHealthResponse getClusterHealth()", "class_method_signature": "ElasticsearchQueryStore.getClusterHealth()", "testcase": false, "constructor": false}, {"identifier": "getNodeStats", "parameters": "()", "modifiers": "@Override public", "return": "NodesStatsResponse", "signature": "NodesStatsResponse getNodeStats()", "full_signature": "@Override public NodesStatsResponse getNodeStats()", "class_method_signature": "ElasticsearchQueryStore.getNodeStats()", "testcase": false, "constructor": false}, {"identifier": "getIndicesStats", "parameters": "()", "modifiers": "@Override public", "return": "IndicesStatsResponse", "signature": "IndicesStatsResponse getIndicesStats()", "full_signature": "@Override public IndicesStatsResponse getIndicesStats()", "class_method_signature": "ElasticsearchQueryStore.getIndicesStats()", "testcase": false, "constructor": false}, {"identifier": "getFieldMappings", "parameters": "(String table)", "modifiers": "@Override public", "return": "TableFieldMapping", "signature": "TableFieldMapping getFieldMappings(String table)", "full_signature": "@Override public TableFieldMapping getFieldMappings(String table)", "class_method_signature": "ElasticsearchQueryStore.getFieldMappings(String table)", "testcase": false, "constructor": false}, {"identifier": "convert", "parameters": "(String table, Document document)", "modifiers": "private", "return": "Map<String, Object>", "signature": "Map<String, Object> convert(String table, Document document)", "full_signature": "private Map<String, Object> convert(String table, Document document)", "class_method_signature": "ElasticsearchQueryStore.convert(String table, Document document)", "testcase": false, "constructor": false}, {"identifier": "deleteIndices", "parameters": "(List<String> indicesToDelete)", "modifiers": "private", "return": "void", "signature": "void deleteIndices(List<String> indicesToDelete)", "full_signature": "private void deleteIndices(List<String> indicesToDelete)", "class_method_signature": "ElasticsearchQueryStore.deleteIndices(List<String> indicesToDelete)", "testcase": false, "constructor": false}, {"identifier": "getIndicesToDelete", "parameters": "(Set<String> tables, Set<String> currentIndices)", "modifiers": "private", "return": "List<String>", "signature": "List<String> getIndicesToDelete(Set<String> tables, Set<String> currentIndices)", "full_signature": "private List<String> getIndicesToDelete(Set<String> tables, Set<String> currentIndices)", "class_method_signature": "ElasticsearchQueryStore.getIndicesToDelete(Set<String> tables, Set<String> currentIndices)", "testcase": false, "constructor": false}], "file": "foxtrot-core/src/main/java/com/flipkart/foxtrot/core/querystore/impl/ElasticsearchQueryStore.java"}, "focal_method": {"identifier": "save", "parameters": "(String table, Document document)", "modifiers": "@Override @Timed public", "return": "void", "body": "@Override\n    @Timed\n    public void save(String table, Document document) {\n        table = ElasticsearchUtils.getValidTableName(table);\n        Stopwatch stopwatch = Stopwatch.createStarted();\n        String action = StringUtils.EMPTY;\n        try {\n            if(!tableMetadataManager.exists(table)) {\n                throw FoxtrotExceptions.createBadRequestException(table, String.format(UNKNOWN_TABLE_ERROR_MESSAGE, table));\n            }\n            if(new DateTime().plusDays(1)\n                       .minus(document.getTimestamp())\n                       .getMillis() < 0) {\n                return;\n            }\n            action = TABLE_META;\n            stopwatch.reset()\n                    .start();\n            final Table tableMeta = tableMetadataManager.get(table);\n            logger.debug(\"TableMetaGetTook:{}\", stopwatch.elapsed(TimeUnit.MILLISECONDS));\n\n            MetricUtil.getInstance()\n                    .registerActionSuccess(action, table, stopwatch.elapsed(TimeUnit.MILLISECONDS));\n            stopwatch.reset()\n                    .start();\n\n            action = DATA_STORE;\n            final Document translatedDocument = dataStore.save(tableMeta, document);\n            logger.debug(\"DataStoreTook:{}\", stopwatch.elapsed(TimeUnit.MILLISECONDS));\n\n            MetricUtil.getInstance()\n                    .registerActionSuccess(action, table, stopwatch.elapsed(TimeUnit.MILLISECONDS));\n            stopwatch.reset()\n                    .start();\n\n            action = QUERY_STORE;\n            long timestamp = translatedDocument.getTimestamp();\n            connection.getClient()\n                    .prepareIndex()\n                    .setIndex(ElasticsearchUtils.getCurrentIndex(table, timestamp))\n                    .setType(ElasticsearchUtils.DOCUMENT_TYPE_NAME)\n                    .setId(translatedDocument.getId())\n                    .setSource(convert(table, translatedDocument))\n                    .execute()\n                    .get(2, TimeUnit.SECONDS);\n            logger.debug(\"QueryStoreTook:{}\", stopwatch.elapsed(TimeUnit.MILLISECONDS));\n\n            MetricUtil.getInstance()\n                    .registerActionSuccess(action, table, stopwatch.elapsed(TimeUnit.MILLISECONDS));\n        } catch (InterruptedException | ExecutionException | TimeoutException e) {\n            MetricUtil.getInstance()\n                    .registerActionFailure(action, table, stopwatch.elapsed(TimeUnit.MILLISECONDS));\n            Thread.currentThread()\n                    .interrupt();\n            throw FoxtrotExceptions.createExecutionException(table, e);\n        }\n    }", "signature": "void save(String table, Document document)", "full_signature": "@Override @Timed public void save(String table, Document document)", "class_method_signature": "ElasticsearchQueryStore.save(String table, Document document)", "testcase": false, "constructor": false, "invocations": ["getValidTableName", "createStarted", "exists", "createBadRequestException", "format", "getMillis", "minus", "plusDays", "getTimestamp", "start", "reset", "get", "debug", "elapsed", "registerActionSuccess", "getInstance", "elapsed", "start", "reset", "save", "debug", "elapsed", "registerActionSuccess", "getInstance", "elapsed", "start", "reset", "getTimestamp", "get", "execute", "setSource", "setId", "setType", "setIndex", "prepareIndex", "getClient", "getCurrentIndex", "getId", "convert", "debug", "elapsed", "registerActionSuccess", "getInstance", "elapsed", "registerActionFailure", "getInstance", "elapsed", "interrupt", "currentThread", "createExecutionException"]}, "repository": {"repo_id": 19980663, "url": "https://github.com/Flipkart/foxtrot", "stars": 22, "created": "5/20/2014 12:52:55 PM +00:00", "updates": "2020-01-07T07:05:03+00:00", "fork": "False", "license": "licensed"}}