{"test_class": {"identifier": "HDFSFileStreamSourceTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String[] HOSTS = {\"localhost\"};", "modifier": "private static final", "type": "String[]", "declarator": "HOSTS = {\"localhost\"}", "var_name": "HOSTS"}, {"original_string": "private static final String BASE_DIR = \"/minidfsTest\";", "modifier": "private static final", "type": "String", "declarator": "BASE_DIR = \"/minidfsTest\"", "var_name": "BASE_DIR"}, {"original_string": "private static final int NUM_FILES_IN_DIR = 4;", "modifier": "private static final", "type": "int", "declarator": "NUM_FILES_IN_DIR = 4", "var_name": "NUM_FILES_IN_DIR"}, {"original_string": "private static final int NUM_NOISE_FILES_IN_DIR = 2;", "modifier": "private static final", "type": "int", "declarator": "NUM_NOISE_FILES_IN_DIR = 2", "var_name": "NUM_NOISE_FILES_IN_DIR"}, {"original_string": "private HDFSFileStreamSource streamSource;", "modifier": "private", "type": "HDFSFileStreamSource", "declarator": "streamSource", "var_name": "streamSource"}, {"original_string": "private Configuration config;", "modifier": "private", "type": "Configuration", "declarator": "config", "var_name": "config"}, {"original_string": "private MiniDFSCluster hdfsCluster;", "modifier": "private", "type": "MiniDFSCluster", "declarator": "hdfsCluster", "var_name": "hdfsCluster"}, {"original_string": "private String hdfsURI;", "modifier": "private", "type": "String", "declarator": "hdfsURI", "var_name": "hdfsURI"}], "file": "samoa-api/src/test/java/com/yahoo/labs/samoa/streams/fs/HDFSFileStreamSourceTest.java"}, "test_case": {"identifier": "testGetNextInputStream", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n\tpublic void testGetNextInputStream() {\n\t\t// write input files & noise files\n\t\twriteSimpleFiles(BASE_DIR,\"txt\",NUM_FILES_IN_DIR);\n\t\t\t\t\t\n\t\t// init with path to input dir\n\t\tstreamSource.init(config, BASE_DIR, \"txt\");\n\t\t\t\t\n\t\t// call getNextInputStream & assertions\n\t\tSet<String> contents = new HashSet<String>();\n\t\tfor (int i=1; i<=NUM_FILES_IN_DIR; i++) {\n\t\t\tcontents.add(Integer.toString(i));\n\t\t}\n\t\tfor (int i=0; i< NUM_FILES_IN_DIR; i++) {\n\t\t\tInputStream inStream = streamSource.getNextInputStream();\n\t\t\tassertNotNull(\"Unexpected end of input stream list.\",inStream);\n\t\t\t\n\t\t\tBufferedReader rd = new BufferedReader(new InputStreamReader(inStream));\n\t\t\tString inputRead = null;\n\t\t\ttry {\n\t\t\t\tinputRead = rd.readLine();\n\t\t\t} catch (IOException ioe) {\n\t\t\t\tfail(\"Fail reading from stream at index:\"+i + ioe.getMessage());\n\t\t\t}\n\t\t\tassertTrue(\"File content is incorrect.\",contents.contains(inputRead));\n\t\t\tIterator<String> it = contents.iterator();\n\t\t\twhile (it.hasNext()) {\n\t\t\t\tif (it.next().equals(inputRead)) {\n\t\t\t\t\tit.remove();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// assert that another call to getNextInputStream will return null\n\t\tassertNull(\"Call getNextInputStream after the last file did not return null.\",streamSource.getNextInputStream());\n\t}", "signature": "void testGetNextInputStream()", "full_signature": "@Test public void testGetNextInputStream()", "class_method_signature": "HDFSFileStreamSourceTest.testGetNextInputStream()", "testcase": true, "constructor": false, "invocations": ["writeSimpleFiles", "init", "add", "toString", "getNextInputStream", "assertNotNull", "readLine", "fail", "getMessage", "assertTrue", "contains", "iterator", "hasNext", "equals", "next", "remove", "assertNull", "getNextInputStream"]}, "focal_class": {"identifier": "HDFSFileStreamSource", "superclass": "", "interfaces": "implements FileStreamSource", "fields": [{"original_string": "private static final long serialVersionUID = -3887354805787167400L;", "modifier": "private static final", "type": "long", "declarator": "serialVersionUID = -3887354805787167400L", "var_name": "serialVersionUID"}, {"original_string": "private transient InputStream fileStream;", "modifier": "private transient", "type": "InputStream", "declarator": "fileStream", "var_name": "fileStream"}, {"original_string": "private transient Configuration config;", "modifier": "private transient", "type": "Configuration", "declarator": "config", "var_name": "config"}, {"original_string": "private List<String> filePaths;", "modifier": "private", "type": "List<String>", "declarator": "filePaths", "var_name": "filePaths"}, {"original_string": "private int currentIndex;", "modifier": "private", "type": "int", "declarator": "currentIndex", "var_name": "currentIndex"}], "methods": [{"identifier": "HDFSFileStreamSource", "parameters": "()", "modifiers": "public", "return": "", "signature": " HDFSFileStreamSource()", "full_signature": "public  HDFSFileStreamSource()", "class_method_signature": "HDFSFileStreamSource.HDFSFileStreamSource()", "testcase": false, "constructor": true}, {"identifier": "init", "parameters": "(String path, String ext)", "modifiers": "public", "return": "void", "signature": "void init(String path, String ext)", "full_signature": "public void init(String path, String ext)", "class_method_signature": "HDFSFileStreamSource.init(String path, String ext)", "testcase": false, "constructor": false}, {"identifier": "init", "parameters": "(Configuration config, String path, String ext)", "modifiers": "public", "return": "void", "signature": "void init(Configuration config, String path, String ext)", "full_signature": "public void init(Configuration config, String path, String ext)", "class_method_signature": "HDFSFileStreamSource.init(Configuration config, String path, String ext)", "testcase": false, "constructor": false}, {"identifier": "getDefaultConfig", "parameters": "()", "modifiers": "private", "return": "Configuration", "signature": "Configuration getDefaultConfig()", "full_signature": "private Configuration getDefaultConfig()", "class_method_signature": "HDFSFileStreamSource.getDefaultConfig()", "testcase": false, "constructor": false}, {"identifier": "reset", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void reset()", "full_signature": "public void reset()", "class_method_signature": "HDFSFileStreamSource.reset()", "testcase": false, "constructor": false}, {"identifier": "closeFileStream", "parameters": "()", "modifiers": "private", "return": "void", "signature": "void closeFileStream()", "full_signature": "private void closeFileStream()", "class_method_signature": "HDFSFileStreamSource.closeFileStream()", "testcase": false, "constructor": false}, {"identifier": "getNextInputStream", "parameters": "()", "modifiers": "public", "return": "InputStream", "signature": "InputStream getNextInputStream()", "full_signature": "public InputStream getNextInputStream()", "class_method_signature": "HDFSFileStreamSource.getNextInputStream()", "testcase": false, "constructor": false}, {"identifier": "getCurrentInputStream", "parameters": "()", "modifiers": "public", "return": "InputStream", "signature": "InputStream getCurrentInputStream()", "full_signature": "public InputStream getCurrentInputStream()", "class_method_signature": "HDFSFileStreamSource.getCurrentInputStream()", "testcase": false, "constructor": false}, {"identifier": "getFilePathListSize", "parameters": "()", "modifiers": "protected", "return": "int", "signature": "int getFilePathListSize()", "full_signature": "protected int getFilePathListSize()", "class_method_signature": "HDFSFileStreamSource.getFilePathListSize()", "testcase": false, "constructor": false}, {"identifier": "getFilePathAt", "parameters": "(int index)", "modifiers": "protected", "return": "String", "signature": "String getFilePathAt(int index)", "full_signature": "protected String getFilePathAt(int index)", "class_method_signature": "HDFSFileStreamSource.getFilePathAt(int index)", "testcase": false, "constructor": false}], "file": "samoa-api/src/main/java/com/yahoo/labs/samoa/streams/fs/HDFSFileStreamSource.java"}, "focal_method": {"identifier": "getNextInputStream", "parameters": "()", "modifiers": "public", "return": "InputStream", "body": "public InputStream getNextInputStream() {\n\t\tthis.closeFileStream();\n\t\tif (this.currentIndex >= (this.filePaths.size()-1)) return null;\n\t\t\n\t\tthis.currentIndex++;\n\t\tString filePath = this.filePaths.get(currentIndex);\n\t\t\n\t\tPath hdfsPath = new Path(filePath);\n        FileSystem fs;\n        try {\n        \tfs = FileSystem.get(config);\n            fileStream = fs.open(hdfsPath);\n        }\n        catch(IOException ioe) {\n            this.closeFileStream();\n            throw new RuntimeException(\"Failed opening file:\"+filePath,ioe);\n        }\n        \n        return fileStream;\n\t}", "signature": "InputStream getNextInputStream()", "full_signature": "public InputStream getNextInputStream()", "class_method_signature": "HDFSFileStreamSource.getNextInputStream()", "testcase": false, "constructor": false, "invocations": ["closeFileStream", "size", "get", "get", "open", "closeFileStream"]}, "repository": {"repo_id": 13505122, "url": "https://github.com/YahooArchive/samoa", "language": "Java", "is_fork": false, "fork_count": 82, "stargazer_count": 424, "size": 6642, "license": "licensed"}}