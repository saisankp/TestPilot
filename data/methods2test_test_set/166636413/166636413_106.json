{"test_class": {"identifier": "FormMetadataMigratorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private SharedPreferences sharedPreferences;", "modifier": "private", "type": "SharedPreferences", "declarator": "sharedPreferences", "var_name": "sharedPreferences"}, {"original_string": "private final PrintStream printStream = System.out;", "modifier": "private final", "type": "PrintStream", "declarator": "printStream = System.out", "var_name": "printStream"}, {"original_string": "private final List<String> affectedKeys = Arrays.asList(\n            KEY_METADATA_MIGRATED,\n            KEY_METADATA_USERNAME,\n            KEY_METADATA_PHONENUMBER,\n            KEY_METADATA_EMAIL,\n            KEY_USERNAME,\n            KEY_SELECTED_GOOGLE_ACCOUNT);", "modifier": "private final", "type": "List<String>", "declarator": "affectedKeys = Arrays.asList(\n            KEY_METADATA_MIGRATED,\n            KEY_METADATA_USERNAME,\n            KEY_METADATA_PHONENUMBER,\n            KEY_METADATA_EMAIL,\n            KEY_USERNAME,\n            KEY_SELECTED_GOOGLE_ACCOUNT)", "var_name": "affectedKeys"}, {"original_string": "private final String[][] sourceKeyValuePairs = {\n            {KEY_USERNAME,                  \"a user\"},\n            {KEY_SELECTED_GOOGLE_ACCOUNT,   \"a Google email address\"}\n    };", "modifier": "private final", "type": "String[][]", "declarator": "sourceKeyValuePairs = {\n            {KEY_USERNAME,                  \"a user\"},\n            {KEY_SELECTED_GOOGLE_ACCOUNT,   \"a Google email address\"}\n    }", "var_name": "sourceKeyValuePairs"}, {"original_string": "private final String[][] modifiedMetadataValuePairs = {\n            {KEY_METADATA_USERNAME,         \"a user--changed\"},\n            {KEY_METADATA_PHONENUMBER,      \"a phone number--changed\"},\n            {KEY_METADATA_EMAIL,            \"an email--changed\"},\n    };", "modifier": "private final", "type": "String[][]", "declarator": "modifiedMetadataValuePairs = {\n            {KEY_METADATA_USERNAME,         \"a user--changed\"},\n            {KEY_METADATA_PHONENUMBER,      \"a phone number--changed\"},\n            {KEY_METADATA_EMAIL,            \"an email--changed\"},\n    }", "var_name": "modifiedMetadataValuePairs"}], "file": "collect_app/src/test/java/org/odk/collect/android/preferences/FormMetadataMigratorTest.java"}, "test_case": {"identifier": "shouldMigrateDataCorrectly", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void shouldMigrateDataCorrectly() {\n        setPreferencesToPreMigrationValues();\n        displayAffectedPreferences(\"Before calling migrate\");\n\n        migrate(sharedPreferences);\n        displayAffectedPreferences(\"After calling migrate\");\n        checkPostMigrationValues();\n\n        setPreferencesToValues(modifiedMetadataValuePairs);\n        displayAffectedPreferences(\"After changing metadata\");\n        migrate(sharedPreferences);\n        displayAffectedPreferences(\"After calling migrate again\");\n        ensureSecondMigrationCallPreservesMetadata();\n    }", "signature": "void shouldMigrateDataCorrectly()", "full_signature": "@Test public void shouldMigrateDataCorrectly()", "class_method_signature": "FormMetadataMigratorTest.shouldMigrateDataCorrectly()", "testcase": true, "constructor": false, "invocations": ["setPreferencesToPreMigrationValues", "displayAffectedPreferences", "migrate", "displayAffectedPreferences", "checkPostMigrationValues", "setPreferencesToValues", "displayAffectedPreferences", "migrate", "displayAffectedPreferences", "ensureSecondMigrationCallPreservesMetadata"]}, "focal_class": {"identifier": "FormMetadataMigrator", "superclass": "", "interfaces": "", "fields": [{"original_string": "static final String[][] SOURCE_TARGET_VALUE_PAIRS = {\n            {KEY_USERNAME,                  KEY_METADATA_USERNAME},\n            {KEY_SELECTED_GOOGLE_ACCOUNT,   KEY_METADATA_EMAIL}\n    };", "modifier": "static final", "type": "String[][]", "declarator": "SOURCE_TARGET_VALUE_PAIRS = {\n            {KEY_USERNAME,                  KEY_METADATA_USERNAME},\n            {KEY_SELECTED_GOOGLE_ACCOUNT,   KEY_METADATA_EMAIL}\n    }", "var_name": "SOURCE_TARGET_VALUE_PAIRS"}], "methods": [{"identifier": "FormMetadataMigrator", "parameters": "()", "modifiers": "private", "return": "", "signature": " FormMetadataMigrator()", "full_signature": "private  FormMetadataMigrator()", "class_method_signature": "FormMetadataMigrator.FormMetadataMigrator()", "testcase": false, "constructor": true}, {"identifier": "migrate", "parameters": "(SharedPreferences sharedPreferences)", "modifiers": "@SuppressLint(\"ApplySharedPref\") public static", "return": "void", "signature": "void migrate(SharedPreferences sharedPreferences)", "full_signature": "@SuppressLint(\"ApplySharedPref\") public static void migrate(SharedPreferences sharedPreferences)", "class_method_signature": "FormMetadataMigrator.migrate(SharedPreferences sharedPreferences)", "testcase": false, "constructor": false}], "file": "collect_app/src/main/java/org/odk/collect/android/preferences/FormMetadataMigrator.java"}, "focal_method": {"identifier": "migrate", "parameters": "(SharedPreferences sharedPreferences)", "modifiers": "@SuppressLint(\"ApplySharedPref\") public static", "return": "void", "body": "@SuppressLint(\"ApplySharedPref\")\n    public static void migrate(SharedPreferences sharedPreferences) {\n        boolean migrationAlreadyDone = sharedPreferences.getBoolean(KEY_METADATA_MIGRATED, false);\n        Timber.i(\"migrate called, %s\",\n                migrationAlreadyDone ? \"migration already done\" : \"will migrate\");\n\n        if (!migrationAlreadyDone) {\n            SharedPreferences.Editor editor = sharedPreferences.edit();\n\n            for (String[] pair : SOURCE_TARGET_VALUE_PAIRS) {\n                String migratingValue = sharedPreferences.getString(pair[0], \"\").trim();\n                if (!migratingValue.isEmpty()) {\n                    Timber.i(\"Copying %s from %s to %s\", migratingValue, pair[0], pair[1]);\n                    editor.putString(pair[1], migratingValue);\n                }\n            }\n\n            // Save that we\u2019ve migrated the values\n            editor.putBoolean(KEY_METADATA_MIGRATED, true);\n            editor.commit();\n        }\n    }", "signature": "void migrate(SharedPreferences sharedPreferences)", "full_signature": "@SuppressLint(\"ApplySharedPref\") public static void migrate(SharedPreferences sharedPreferences)", "class_method_signature": "FormMetadataMigrator.migrate(SharedPreferences sharedPreferences)", "testcase": false, "constructor": false, "invocations": ["getBoolean", "i", "edit", "trim", "getString", "isEmpty", "i", "putString", "putBoolean", "commit"]}, "repository": {"repo_id": 166636413, "url": "https://github.com/fieldsight/fieldsight-mobile", "language": "Java", "is_fork": false, "fork_count": 4, "stargazer_count": 14, "size": 41030, "license": "licensed"}}