{"test_class": {"identifier": "SingleGroupAddressHolderTest", "superclass": "", "interfaces": "", "fields": [], "file": "core-impl/client/src/test/java/com/alipay/sofa/rpc/client/SingleGroupAddressHolderTest.java"}, "test_case": {"identifier": "updateAllProviders", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void updateAllProviders() throws Exception {\n        SingleGroupAddressHolder addressHolder = new SingleGroupAddressHolder(null);\n        List<ProviderGroup> current;\n        // \u66f4\u65b0\u4e3a\u5355\u4e2a\n        List<ProviderGroup> ps0 = new ArrayList<ProviderGroup>();\n        ps0.add(new ProviderGroup(\"xx\", Arrays.asList(ProviderHelper.toProviderInfo(\"127.0.0.1:12200\"),\n            ProviderHelper.toProviderInfo(\"127.0.0.1:12201\"))));\n        ps0.add(new ProviderGroup(ADDRESS_DIRECT_GROUP, Arrays.asList(ProviderHelper.toProviderInfo(\"127.0.0.1:12203\"))));\n        addressHolder.updateAllProviders(ps0);\n\n        current = addressHolder.getProviderGroups();\n        Assert.assertTrue(current.size() == 2);\n        Assert.assertTrue(current.get(0).size() == 2);\n        Assert.assertTrue(addressHolder.getProviderGroup(\"xxx\").size() == 2);\n        Assert.assertTrue(addressHolder.getProviderGroup(ADDRESS_DIRECT_GROUP).size() == 1);\n        Assert.assertTrue(addressHolder.getAllProviderSize() == 3);\n\n        // \u589e\u52a0\n        List<ProviderGroup> ps1 = new ArrayList<ProviderGroup>();\n        ps1.add(new ProviderGroup(\"xx\", Arrays.asList(ProviderHelper.toProviderInfo(\"127.0.0.1:12200\"),\n            ProviderHelper.toProviderInfo(\"127.0.0.1:12201\"))));\n        ps1.add(new ProviderGroup(\"yy\", Arrays.asList(ProviderHelper.toProviderInfo(\"127.0.0.1:12202\"),\n            ProviderHelper.toProviderInfo(\"127.0.0.1:12203\"))));\n        addressHolder.updateAllProviders(ps1);\n\n        current = addressHolder.getProviderGroups();\n        Assert.assertTrue(current.size() == 2);\n        Assert.assertTrue(current.get(0).size() == 4);\n        Assert.assertTrue(addressHolder.getProviderGroup(\"xxx\").size() == 4);\n        Assert.assertTrue(addressHolder.getAllProviderSize() == 4);\n\n        // \u66f4\u65b0\u4e3a\u7a7a\n        List<ProviderGroup> ps2 = new ArrayList<ProviderGroup>();\n        addressHolder.updateAllProviders(ps2);\n\n        current = addressHolder.getProviderGroups();\n        Assert.assertTrue(current.size() == 2);\n        Assert.assertTrue(current.get(0).size() == 0);\n        Assert.assertTrue(addressHolder.getProviderGroup(\"xxx\").size() == 0);\n        Assert.assertTrue(addressHolder.getAllProviderSize() == 0);\n\n        // \u66f4\u65b0\u4e3a\u591a\u4e2a\uff0c\u6709\u4ea4\u53c9\n        List<ProviderGroup> ps3 = new ArrayList<ProviderGroup>();\n        ps3.add(new ProviderGroup(\"xx\", Arrays.asList(ProviderHelper.toProviderInfo(\"127.0.0.1:12200\"),\n            ProviderHelper.toProviderInfo(\"127.0.0.1:12201\"))));\n        ps3.add(new ProviderGroup(\"yy\", Arrays.asList(ProviderHelper.toProviderInfo(\"127.0.0.1:12201\"),\n            ProviderHelper.toProviderInfo(\"127.0.0.1:12202\"))));\n        addressHolder.updateAllProviders(ps3);\n\n        current = addressHolder.getProviderGroups();\n        Assert.assertTrue(current.size() == 2);\n        Assert.assertTrue(current.get(0).size() == 3);\n        Assert.assertTrue(addressHolder.getProviderGroup(\"xxx\").size() == 3);\n        Assert.assertTrue(addressHolder.getAllProviderSize() == 3);\n\n        // \u51cf\u5c11\n        List<ProviderGroup> ps4 = new ArrayList<ProviderGroup>();\n        ps4.add(new ProviderGroup(\"yy\", Arrays.asList(ProviderHelper.toProviderInfo(\"127.0.0.1:12203\"),\n            ProviderHelper.toProviderInfo(\"127.0.0.1:12204\"))));\n        addressHolder.updateAllProviders(ps4);\n\n        current = addressHolder.getProviderGroups();\n        Assert.assertTrue(current.size() == 2);\n        Assert.assertTrue(current.get(0).size() == 2);\n        Assert.assertTrue(addressHolder.getProviderGroup(\"xxx\").size() == 2);\n        Assert.assertTrue(addressHolder.getAllProviderSize() == 2);\n    }", "signature": "void updateAllProviders()", "full_signature": "@Test public void updateAllProviders()", "class_method_signature": "SingleGroupAddressHolderTest.updateAllProviders()", "testcase": true, "constructor": false, "invocations": ["add", "asList", "toProviderInfo", "toProviderInfo", "add", "asList", "toProviderInfo", "updateAllProviders", "getProviderGroups", "assertTrue", "size", "assertTrue", "size", "get", "assertTrue", "size", "getProviderGroup", "assertTrue", "size", "getProviderGroup", "assertTrue", "getAllProviderSize", "add", "asList", "toProviderInfo", "toProviderInfo", "add", "asList", "toProviderInfo", "toProviderInfo", "updateAllProviders", "getProviderGroups", "assertTrue", "size", "assertTrue", "size", "get", "assertTrue", "size", "getProviderGroup", "assertTrue", "getAllProviderSize", "updateAllProviders", "getProviderGroups", "assertTrue", "size", "assertTrue", "size", "get", "assertTrue", "size", "getProviderGroup", "assertTrue", "getAllProviderSize", "add", "asList", "toProviderInfo", "toProviderInfo", "add", "asList", "toProviderInfo", "toProviderInfo", "updateAllProviders", "getProviderGroups", "assertTrue", "size", "assertTrue", "size", "get", "assertTrue", "size", "getProviderGroup", "assertTrue", "getAllProviderSize", "add", "asList", "toProviderInfo", "toProviderInfo", "updateAllProviders", "getProviderGroups", "assertTrue", "size", "assertTrue", "size", "get", "assertTrue", "size", "getProviderGroup", "assertTrue", "getAllProviderSize"]}, "focal_class": {"identifier": "SingleGroupAddressHolder", "superclass": "extends AddressHolder", "interfaces": "", "fields": [{"original_string": "protected ProviderGroup        directUrlGroup;", "modifier": "protected", "type": "ProviderGroup", "declarator": "directUrlGroup", "var_name": "directUrlGroup"}, {"original_string": "protected ProviderGroup        registryGroup;", "modifier": "protected", "type": "ProviderGroup", "declarator": "registryGroup", "var_name": "registryGroup"}, {"original_string": "private ReentrantReadWriteLock lock  = new ReentrantReadWriteLock();", "modifier": "private", "type": "ReentrantReadWriteLock", "declarator": "lock  = new ReentrantReadWriteLock()", "var_name": "lock"}, {"original_string": "private Lock                   rLock = lock.readLock();", "modifier": "private", "type": "Lock", "declarator": "rLock = lock.readLock()", "var_name": "rLock"}, {"original_string": "private Lock                   wLock = lock.writeLock();", "modifier": "private", "type": "Lock", "declarator": "wLock = lock.writeLock()", "var_name": "wLock"}], "methods": [{"identifier": "SingleGroupAddressHolder", "parameters": "(ConsumerBootstrap consumerBootstrap)", "modifiers": "protected", "return": "", "signature": " SingleGroupAddressHolder(ConsumerBootstrap consumerBootstrap)", "full_signature": "protected  SingleGroupAddressHolder(ConsumerBootstrap consumerBootstrap)", "class_method_signature": "SingleGroupAddressHolder.SingleGroupAddressHolder(ConsumerBootstrap consumerBootstrap)", "testcase": false, "constructor": true}, {"identifier": "getProviderInfos", "parameters": "(String groupName)", "modifiers": "@Override public", "return": "List<ProviderInfo>", "signature": "List<ProviderInfo> getProviderInfos(String groupName)", "full_signature": "@Override public List<ProviderInfo> getProviderInfos(String groupName)", "class_method_signature": "SingleGroupAddressHolder.getProviderInfos(String groupName)", "testcase": false, "constructor": false}, {"identifier": "getProviderGroup", "parameters": "(String groupName)", "modifiers": "@Override public", "return": "ProviderGroup", "signature": "ProviderGroup getProviderGroup(String groupName)", "full_signature": "@Override public ProviderGroup getProviderGroup(String groupName)", "class_method_signature": "SingleGroupAddressHolder.getProviderGroup(String groupName)", "testcase": false, "constructor": false}, {"identifier": "getProviderGroups", "parameters": "()", "modifiers": "@Override public", "return": "List<ProviderGroup>", "signature": "List<ProviderGroup> getProviderGroups()", "full_signature": "@Override public List<ProviderGroup> getProviderGroups()", "class_method_signature": "SingleGroupAddressHolder.getProviderGroups()", "testcase": false, "constructor": false}, {"identifier": "getAllProviderSize", "parameters": "()", "modifiers": "@Override public", "return": "int", "signature": "int getAllProviderSize()", "full_signature": "@Override public int getAllProviderSize()", "class_method_signature": "SingleGroupAddressHolder.getAllProviderSize()", "testcase": false, "constructor": false}, {"identifier": "addProvider", "parameters": "(ProviderGroup providerGroup)", "modifiers": "@Override public", "return": "void", "signature": "void addProvider(ProviderGroup providerGroup)", "full_signature": "@Override public void addProvider(ProviderGroup providerGroup)", "class_method_signature": "SingleGroupAddressHolder.addProvider(ProviderGroup providerGroup)", "testcase": false, "constructor": false}, {"identifier": "removeProvider", "parameters": "(ProviderGroup providerGroup)", "modifiers": "@Override public", "return": "void", "signature": "void removeProvider(ProviderGroup providerGroup)", "full_signature": "@Override public void removeProvider(ProviderGroup providerGroup)", "class_method_signature": "SingleGroupAddressHolder.removeProvider(ProviderGroup providerGroup)", "testcase": false, "constructor": false}, {"identifier": "updateProviders", "parameters": "(ProviderGroup providerGroup)", "modifiers": "@Override public", "return": "void", "signature": "void updateProviders(ProviderGroup providerGroup)", "full_signature": "@Override public void updateProviders(ProviderGroup providerGroup)", "class_method_signature": "SingleGroupAddressHolder.updateProviders(ProviderGroup providerGroup)", "testcase": false, "constructor": false}, {"identifier": "updateAllProviders", "parameters": "(List<ProviderGroup> providerGroups)", "modifiers": "@Override public", "return": "void", "signature": "void updateAllProviders(List<ProviderGroup> providerGroups)", "full_signature": "@Override public void updateAllProviders(List<ProviderGroup> providerGroups)", "class_method_signature": "SingleGroupAddressHolder.updateAllProviders(List<ProviderGroup> providerGroups)", "testcase": false, "constructor": false}], "file": "core-impl/client/src/main/java/com/alipay/sofa/rpc/client/SingleGroupAddressHolder.java"}, "focal_method": {"identifier": "updateAllProviders", "parameters": "(List<ProviderGroup> providerGroups)", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void updateAllProviders(List<ProviderGroup> providerGroups) {\n        ConcurrentHashSet<ProviderInfo> tmpDirectUrl = new ConcurrentHashSet<ProviderInfo>();\n        ConcurrentHashSet<ProviderInfo> tmpRegistry = new ConcurrentHashSet<ProviderInfo>();\n        for (ProviderGroup providerGroup : providerGroups) {\n            if (!ProviderHelper.isEmpty(providerGroup)) {\n                if (RpcConstants.ADDRESS_DIRECT_GROUP.equals(providerGroup.getName())) {\n                    tmpDirectUrl.addAll(providerGroup.getProviderInfos());\n                } else {\n                    tmpRegistry.addAll(providerGroup.getProviderInfos());\n                }\n            }\n        }\n        wLock.lock();\n        try {\n            this.directUrlGroup.setProviderInfos(new ArrayList<ProviderInfo>(tmpDirectUrl));\n            this.registryGroup.setProviderInfos(new ArrayList<ProviderInfo>(tmpRegistry));\n        } finally {\n            wLock.unlock();\n        }\n    }", "signature": "void updateAllProviders(List<ProviderGroup> providerGroups)", "full_signature": "@Override public void updateAllProviders(List<ProviderGroup> providerGroups)", "class_method_signature": "SingleGroupAddressHolder.updateAllProviders(List<ProviderGroup> providerGroups)", "testcase": false, "constructor": false, "invocations": ["isEmpty", "equals", "getName", "addAll", "getProviderInfos", "addAll", "getProviderInfos", "lock", "setProviderInfos", "setProviderInfos", "unlock"]}, "repository": {"repo_id": 128709824, "url": "https://github.com/sofastack/sofa-rpc", "stars": 3001, "created": "4/9/2018 3:32:04 AM +00:00", "updates": "2020-01-22T02:08:51+00:00", "fork": "False", "license": "licensed"}}