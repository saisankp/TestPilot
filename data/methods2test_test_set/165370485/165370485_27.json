{"test_class": {"identifier": "Socks5AcceptorHandlerTest", "superclass": "extends Mockito", "interfaces": "", "fields": [{"original_string": "private Socks5ConnectionsRegistry connectionsRegistry = mock(Socks5ConnectionsRegistry.class);", "modifier": "private", "type": "Socks5ConnectionsRegistry", "declarator": "connectionsRegistry = mock(Socks5ConnectionsRegistry.class)", "var_name": "connectionsRegistry"}, {"original_string": "private IoSession session = mock(IoSession.class);", "modifier": "private", "type": "IoSession", "declarator": "session = mock(IoSession.class)", "var_name": "session"}, {"original_string": "private Socks5AcceptorHandler handler = new Socks5AcceptorHandler(connectionsRegistry);", "modifier": "private", "type": "Socks5AcceptorHandler", "declarator": "handler = new Socks5AcceptorHandler(connectionsRegistry)", "var_name": "handler"}], "file": "server/extensions/xep0065-socks/src/test/java/org/apache/vysper/xmpp/extension/xep0065_socks/Socks5AcceptorHandlerTest.java"}, "test_case": {"identifier": "messageReceivedActivated", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void messageReceivedActivated() throws Exception {\n        IoSession other = mock(IoSession.class);\n        \n        when(session.getAttribute(Socks5AcceptorHandler.STATE_KEY)).thenReturn(ProxyState.CONNECTED);\n        Socks5Pair pair = new Socks5Pair(session, connectionsRegistry, \"foo\");\n        pair.setRequester(other);\n        pair.activate();\n        when(session.getAttribute(Socks5AcceptorHandler.PAIR_KEY)).thenReturn(pair);\n        \n        IoBuffer buffer = IoBuffer.wrap(new byte[]{0x6C, 0x6F, 0x63});\n        \n        handler.messageReceived(session, buffer);\n\n        verify(other).write(buffer);\n    }", "signature": "void messageReceivedActivated()", "full_signature": "@Test public void messageReceivedActivated()", "class_method_signature": "Socks5AcceptorHandlerTest.messageReceivedActivated()", "testcase": true, "constructor": false, "invocations": ["mock", "thenReturn", "when", "getAttribute", "setRequester", "activate", "thenReturn", "when", "getAttribute", "wrap", "messageReceived", "write", "verify"]}, "focal_class": {"identifier": "Socks5AcceptorHandler", "superclass": "extends IoHandlerAdapter", "interfaces": "", "fields": [{"original_string": "public static final AttributeKey STATE_KEY = new AttributeKey(Socks5AcceptorHandler.class, \"state\");", "modifier": "public static final", "type": "AttributeKey", "declarator": "STATE_KEY = new AttributeKey(Socks5AcceptorHandler.class, \"state\")", "var_name": "STATE_KEY"}, {"original_string": "public static final AttributeKey PAIR_KEY = new AttributeKey(Socks5AcceptorHandler.class, \"pair\");", "modifier": "public static final", "type": "AttributeKey", "declarator": "PAIR_KEY = new AttributeKey(Socks5AcceptorHandler.class, \"pair\")", "var_name": "PAIR_KEY"}, {"original_string": "private static final byte SOCKS_VERSION = 5;", "modifier": "private static final", "type": "byte", "declarator": "SOCKS_VERSION = 5", "var_name": "SOCKS_VERSION"}, {"original_string": "private static final byte AUTH_NO_AUTH = 0;", "modifier": "private static final", "type": "byte", "declarator": "AUTH_NO_AUTH = 0", "var_name": "AUTH_NO_AUTH"}, {"original_string": "private static final byte AUTH_USERNAME_PASSWORD = 2;", "modifier": "private static final", "type": "byte", "declarator": "AUTH_USERNAME_PASSWORD = 2", "var_name": "AUTH_USERNAME_PASSWORD"}, {"original_string": "private static final byte AUTH_NOT_SUPPORTED = 0x55;", "modifier": "private static final", "type": "byte", "declarator": "AUTH_NOT_SUPPORTED = 0x55", "var_name": "AUTH_NOT_SUPPORTED"}, {"original_string": "private final Logger log = LoggerFactory.getLogger(Socks5AcceptorHandler.class);", "modifier": "private final", "type": "Logger", "declarator": "log = LoggerFactory.getLogger(Socks5AcceptorHandler.class)", "var_name": "log"}, {"original_string": "private Socks5ConnectionsRegistry connections;", "modifier": "private", "type": "Socks5ConnectionsRegistry", "declarator": "connections", "var_name": "connections"}], "methods": [{"identifier": "Socks5AcceptorHandler", "parameters": "(Socks5ConnectionsRegistry connections)", "modifiers": "public", "return": "", "signature": " Socks5AcceptorHandler(Socks5ConnectionsRegistry connections)", "full_signature": "public  Socks5AcceptorHandler(Socks5ConnectionsRegistry connections)", "class_method_signature": "Socks5AcceptorHandler.Socks5AcceptorHandler(Socks5ConnectionsRegistry connections)", "testcase": false, "constructor": true}, {"identifier": "sessionOpened", "parameters": "(IoSession session)", "modifiers": "public", "return": "void", "signature": "void sessionOpened(IoSession session)", "full_signature": "public void sessionOpened(IoSession session)", "class_method_signature": "Socks5AcceptorHandler.sessionOpened(IoSession session)", "testcase": false, "constructor": false}, {"identifier": "sessionIdle", "parameters": "(IoSession session, IdleStatus status)", "modifiers": "public", "return": "void", "signature": "void sessionIdle(IoSession session, IdleStatus status)", "full_signature": "public void sessionIdle(IoSession session, IdleStatus status)", "class_method_signature": "Socks5AcceptorHandler.sessionIdle(IoSession session, IdleStatus status)", "testcase": false, "constructor": false}, {"identifier": "messageReceived", "parameters": "(final IoSession session, Object message)", "modifiers": "public", "return": "void", "signature": "void messageReceived(final IoSession session, Object message)", "full_signature": "public void messageReceived(final IoSession session, Object message)", "class_method_signature": "Socks5AcceptorHandler.messageReceived(final IoSession session, Object message)", "testcase": false, "constructor": false}, {"identifier": "sessionClosed", "parameters": "(IoSession session)", "modifiers": "public", "return": "void", "signature": "void sessionClosed(IoSession session)", "full_signature": "public void sessionClosed(IoSession session)", "class_method_signature": "Socks5AcceptorHandler.sessionClosed(IoSession session)", "testcase": false, "constructor": false}, {"identifier": "exceptionCaught", "parameters": "(IoSession session, Throwable cause)", "modifiers": "public", "return": "void", "signature": "void exceptionCaught(IoSession session, Throwable cause)", "full_signature": "public void exceptionCaught(IoSession session, Throwable cause)", "class_method_signature": "Socks5AcceptorHandler.exceptionCaught(IoSession session, Throwable cause)", "testcase": false, "constructor": false}, {"identifier": "setState", "parameters": "(final IoSession session, ProxyState state)", "modifiers": "private", "return": "void", "signature": "void setState(final IoSession session, ProxyState state)", "full_signature": "private void setState(final IoSession session, ProxyState state)", "class_method_signature": "Socks5AcceptorHandler.setState(final IoSession session, ProxyState state)", "testcase": false, "constructor": false}, {"identifier": "getState", "parameters": "(final IoSession session)", "modifiers": "private", "return": "ProxyState", "signature": "ProxyState getState(final IoSession session)", "full_signature": "private ProxyState getState(final IoSession session)", "class_method_signature": "Socks5AcceptorHandler.getState(final IoSession session)", "testcase": false, "constructor": false}, {"identifier": "getPair", "parameters": "(final IoSession session)", "modifiers": "private", "return": "Socks5Pair", "signature": "Socks5Pair getPair(final IoSession session)", "full_signature": "private Socks5Pair getPair(final IoSession session)", "class_method_signature": "Socks5AcceptorHandler.getPair(final IoSession session)", "testcase": false, "constructor": false}], "file": "server/extensions/xep0065-socks/src/main/java/org/apache/vysper/xmpp/extension/xep0065_socks/Socks5AcceptorHandler.java"}, "focal_method": {"identifier": "messageReceived", "parameters": "(final IoSession session, Object message)", "modifiers": "public", "return": "void", "body": "public void messageReceived(final IoSession session, Object message) throws Exception {\n        IoBuffer buffer = (IoBuffer) message;\n\n        ProxyState state = getState(session);\n\n        try {\n            if (state == ProxyState.OPENED) {\n                OpeningPacket packet = new OpeningPacket(buffer);\n\n                if (packet.isAuthSupported()) {\n                    // no auth\n                    setState(session, ProxyState.INITIATED);\n                    session.write(packet.createResponse());\n                    log.info(\"SOCKS5 session initiated\");\n                } else {\n                    // not supported\n                    session.write(packet.createResponse());\n                    session.close(false);\n                    log.info(\"SOCKS5 session closed\");\n                }\n\n            } else if (state == ProxyState.INITIATED) {\n                InitiatingPacket packet = new InitiatingPacket(buffer);\n\n                session.write(packet.createResponse());\n                setState(session, ProxyState.CONNECTED);\n\n                String hash = packet.getAddress();\n                Socks5Pair pair = connections.register(hash, session);\n\n                session.setAttribute(PAIR_KEY, pair);\n            } else {\n                Socks5Pair pair = getPair(session);\n                if (pair != null && pair.isActivated()) {\n                    pair.getOther(session).write(message);\n                } else {\n                    // writing before activated, close\n                    pair.close();\n                }\n            }\n        } catch (IllegalArgumentException e) {\n            session.close(false);\n            log.info(\"SOCKS5 session closed\");\n        }\n    }", "signature": "void messageReceived(final IoSession session, Object message)", "full_signature": "public void messageReceived(final IoSession session, Object message)", "class_method_signature": "Socks5AcceptorHandler.messageReceived(final IoSession session, Object message)", "testcase": false, "constructor": false, "invocations": ["getState", "isAuthSupported", "setState", "write", "createResponse", "info", "write", "createResponse", "close", "info", "write", "createResponse", "setState", "getAddress", "register", "setAttribute", "getPair", "isActivated", "write", "getOther", "close", "close", "info"]}, "repository": {"repo_id": 165370485, "url": "https://github.com/apache/mina-vysper", "language": "Java", "is_fork": false, "fork_count": 6, "stargazer_count": 8, "size": 29305, "license": "licensed"}}