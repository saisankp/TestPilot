{"test_class": {"identifier": "UpgradeUtilTest", "superclass": "", "interfaces": "", "fields": [], "file": "modules/hms-core/src/test/java/com/vmware/vrack/hms/utils/UpgradeUtilTest.java"}, "test_case": {"identifier": "testRollbackUpgradeWithNullSpec", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testRollbackUpgradeWithNullSpec()\n    {\n\n        assertFalse( UpgradeUtil.rollbackUpgrade( null ) );\n    }", "signature": "void testRollbackUpgradeWithNullSpec()", "full_signature": "@Test public void testRollbackUpgradeWithNullSpec()", "class_method_signature": "UpgradeUtilTest.testRollbackUpgradeWithNullSpec()", "testcase": true, "constructor": false, "invocations": ["assertFalse", "rollbackUpgrade"]}, "focal_class": {"identifier": "UpgradeUtil", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger logger = LoggerFactory.getLogger( UpgradeUtil.class );", "modifier": "private static final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger( UpgradeUtil.class )", "var_name": "logger"}, {"original_string": "private static final String HMS_PARENT_DIR = \"hms.parent.dir\";", "modifier": "private static final", "type": "String", "declarator": "HMS_PARENT_DIR = \"hms.parent.dir\"", "var_name": "HMS_PARENT_DIR"}, {"original_string": "private static final String HMS_DIR = \"hms.dir\";", "modifier": "private static final", "type": "String", "declarator": "HMS_DIR = \"hms.dir\"", "var_name": "HMS_DIR"}, {"original_string": "private static final String UPGRADE_SCRIPT = \"hms.upgrade.script\";", "modifier": "private static final", "type": "String", "declarator": "UPGRADE_SCRIPT = \"hms.upgrade.script\"", "var_name": "UPGRADE_SCRIPT"}, {"original_string": "private static final String ROLLABACK_SCRIPT = \"hms.rollback.script\";", "modifier": "private static final", "type": "String", "declarator": "ROLLABACK_SCRIPT = \"hms.rollback.script\"", "var_name": "ROLLABACK_SCRIPT"}, {"original_string": "private static final String HMS_UPGRADE_DIR = \"hms.upgrade.dir\";", "modifier": "private static final", "type": "String", "declarator": "HMS_UPGRADE_DIR = \"hms.upgrade.dir\"", "var_name": "HMS_UPGRADE_DIR"}], "methods": [{"identifier": "UpgradeUtil", "parameters": "()", "modifiers": "private", "return": "", "signature": " UpgradeUtil()", "full_signature": "private  UpgradeUtil()", "class_method_signature": "UpgradeUtil.UpgradeUtil()", "testcase": false, "constructor": true}, {"identifier": "initiateUpgrade", "parameters": "( final String upgradeId, final String upgradeBinaryFileName )", "modifiers": "public static", "return": "boolean", "signature": "boolean initiateUpgrade( final String upgradeId, final String upgradeBinaryFileName )", "full_signature": "public static boolean initiateUpgrade( final String upgradeId, final String upgradeBinaryFileName )", "class_method_signature": "UpgradeUtil.initiateUpgrade( final String upgradeId, final String upgradeBinaryFileName )", "testcase": false, "constructor": false}, {"identifier": "rollbackUpgrade", "parameters": "( RollbackSpec rollbackSpec )", "modifiers": "public static", "return": "boolean", "signature": "boolean rollbackUpgrade( RollbackSpec rollbackSpec )", "full_signature": "public static boolean rollbackUpgrade( RollbackSpec rollbackSpec )", "class_method_signature": "UpgradeUtil.rollbackUpgrade( RollbackSpec rollbackSpec )", "testcase": false, "constructor": false}, {"identifier": "validateUpgradeRequest", "parameters": "( OobUpgradeSpec upgradeSpec )", "modifiers": "public static", "return": "Response", "signature": "Response validateUpgradeRequest( OobUpgradeSpec upgradeSpec )", "full_signature": "public static Response validateUpgradeRequest( OobUpgradeSpec upgradeSpec )", "class_method_signature": "UpgradeUtil.validateUpgradeRequest( OobUpgradeSpec upgradeSpec )", "testcase": false, "constructor": false}, {"identifier": "validateUpgradeBinaryChecksum", "parameters": "( final OobUpgradeSpec upgradeSpec )", "modifiers": "public static", "return": "Response", "signature": "Response validateUpgradeBinaryChecksum( final OobUpgradeSpec upgradeSpec )", "full_signature": "public static Response validateUpgradeBinaryChecksum( final OobUpgradeSpec upgradeSpec )", "class_method_signature": "UpgradeUtil.validateUpgradeBinaryChecksum( final OobUpgradeSpec upgradeSpec )", "testcase": false, "constructor": false}, {"identifier": "validateUpgradeScripts", "parameters": "( final String upgradeId )", "modifiers": "public static", "return": "Response", "signature": "Response validateUpgradeScripts( final String upgradeId )", "full_signature": "public static Response validateUpgradeScripts( final String upgradeId )", "class_method_signature": "UpgradeUtil.validateUpgradeScripts( final String upgradeId )", "testcase": false, "constructor": false}, {"identifier": "getUpgradeStatusResponse", "parameters": "( final String upgradeId, final Status status,\n                                                      final String message )", "modifiers": "private static", "return": "Response", "signature": "Response getUpgradeStatusResponse( final String upgradeId, final Status status,\n                                                      final String message )", "full_signature": "private static Response getUpgradeStatusResponse( final String upgradeId, final Status status,\n                                                      final String message )", "class_method_signature": "UpgradeUtil.getUpgradeStatusResponse( final String upgradeId, final Status status,\n                                                      final String message )", "testcase": false, "constructor": false}, {"identifier": "validateRollbackRequest", "parameters": "( RollbackSpec rollbackSpec )", "modifiers": "public static", "return": "void", "signature": "void validateRollbackRequest( RollbackSpec rollbackSpec )", "full_signature": "public static void validateRollbackRequest( RollbackSpec rollbackSpec )", "class_method_signature": "UpgradeUtil.validateRollbackRequest( RollbackSpec rollbackSpec )", "testcase": false, "constructor": false}, {"identifier": "isRollbackScriptExists", "parameters": "( final String upgradeId )", "modifiers": "private static", "return": "boolean", "signature": "boolean isRollbackScriptExists( final String upgradeId )", "full_signature": "private static boolean isRollbackScriptExists( final String upgradeId )", "class_method_signature": "UpgradeUtil.isRollbackScriptExists( final String upgradeId )", "testcase": false, "constructor": false}, {"identifier": "isBackupDirExists", "parameters": "( final String upgradeId )", "modifiers": "private static", "return": "boolean", "signature": "boolean isBackupDirExists( final String upgradeId )", "full_signature": "private static boolean isBackupDirExists( final String upgradeId )", "class_method_signature": "UpgradeUtil.isBackupDirExists( final String upgradeId )", "testcase": false, "constructor": false}, {"identifier": "getFileName", "parameters": "( final Map<String, List<InputPart>> formDataMap )", "modifiers": "public static", "return": "String", "signature": "String getFileName( final Map<String, List<InputPart>> formDataMap )", "full_signature": "public static String getFileName( final Map<String, List<InputPart>> formDataMap )", "class_method_signature": "UpgradeUtil.getFileName( final Map<String, List<InputPart>> formDataMap )", "testcase": false, "constructor": false}, {"identifier": "getUpgradeId", "parameters": "( final Map<String, List<InputPart>> formDataMap )", "modifiers": "public static", "return": "String", "signature": "String getUpgradeId( final Map<String, List<InputPart>> formDataMap )", "full_signature": "public static String getUpgradeId( final Map<String, List<InputPart>> formDataMap )", "class_method_signature": "UpgradeUtil.getUpgradeId( final Map<String, List<InputPart>> formDataMap )", "testcase": false, "constructor": false}, {"identifier": "getProperty", "parameters": "( final String propertyName, final Map<String, List<InputPart>> formDataMap )", "modifiers": "private static", "return": "String", "signature": "String getProperty( final String propertyName, final Map<String, List<InputPart>> formDataMap )", "full_signature": "private static String getProperty( final String propertyName, final Map<String, List<InputPart>> formDataMap )", "class_method_signature": "UpgradeUtil.getProperty( final String propertyName, final Map<String, List<InputPart>> formDataMap )", "testcase": false, "constructor": false}, {"identifier": "getFileContent", "parameters": "( final Map<String, List<InputPart>> formDataMap )", "modifiers": "public static", "return": "byte[]", "signature": "byte[] getFileContent( final Map<String, List<InputPart>> formDataMap )", "full_signature": "public static byte[] getFileContent( final Map<String, List<InputPart>> formDataMap )", "class_method_signature": "UpgradeUtil.getFileContent( final Map<String, List<InputPart>> formDataMap )", "testcase": false, "constructor": false}, {"identifier": "deleteUpgradeFiles", "parameters": "( final String upgradeId )", "modifiers": "public static", "return": "void", "signature": "void deleteUpgradeFiles( final String upgradeId )", "full_signature": "public static void deleteUpgradeFiles( final String upgradeId )", "class_method_signature": "UpgradeUtil.deleteUpgradeFiles( final String upgradeId )", "testcase": false, "constructor": false}, {"identifier": "getHmsUpgradeDir", "parameters": "()", "modifiers": "public static", "return": "String", "signature": "String getHmsUpgradeDir()", "full_signature": "public static String getHmsUpgradeDir()", "class_method_signature": "UpgradeUtil.getHmsUpgradeDir()", "testcase": false, "constructor": false}, {"identifier": "getUpgradeDir", "parameters": "( final String upgradeId )", "modifiers": "public static", "return": "String", "signature": "String getUpgradeDir( final String upgradeId )", "full_signature": "public static String getUpgradeDir( final String upgradeId )", "class_method_signature": "UpgradeUtil.getUpgradeDir( final String upgradeId )", "testcase": false, "constructor": false}], "file": "modules/hms-core/src/main/java/com/vmware/vrack/hms/utils/UpgradeUtil.java"}, "focal_method": {"identifier": "rollbackUpgrade", "parameters": "( RollbackSpec rollbackSpec )", "modifiers": "public static", "return": "boolean", "body": "public static boolean rollbackUpgrade( RollbackSpec rollbackSpec )\n    {\n\n        if ( rollbackSpec == null )\n        {\n            logger.debug( \"RollbackSpec is null.\" );\n            return false;\n        }\n\n        final String upgradeId = rollbackSpec.getId();\n        if ( StringUtils.isBlank( upgradeId ) )\n        {\n            logger.debug( \"RollbackSpec id is either null or blank.\" );\n            return false;\n        }\n\n        final String upgradeDir = UpgradeUtil.getUpgradeDir( upgradeId );\n        final String rollbackScript = HmsConfigHolder.getHMSConfigProperty( ROLLABACK_SCRIPT );\n        final String hmsParentDir = HmsConfigHolder.getHMSConfigProperty( HMS_PARENT_DIR );\n        final String hmsDir = HmsConfigHolder.getHMSConfigProperty( HMS_DIR );\n\n        if ( rollbackScript != null && hmsParentDir != null && hmsDir != null )\n        {\n\n            final String rollbackScriptAbsPath = FilenameUtils.concat( upgradeDir, rollbackScript );\n            List<String> cmdWithArgs = new ArrayList<String>();\n\n            // SCRIPT TO BE EXECUTED\n            cmdWithArgs.add( 0, rollbackScriptAbsPath );\n\n            // HMS_TOKEN\n            cmdWithArgs.add( 1, upgradeId );\n\n            // HMS_SCRIPT_DIR\n            cmdWithArgs.add( 2, upgradeDir );\n\n            // HMS_OOB_BACKUP_DIR_FULLPATH\n            String backupDirAbsPath = FilenameUtils.concat( hmsParentDir, \"hms_backup_\" + upgradeId );\n            cmdWithArgs.add( 3, backupDirAbsPath );\n\n            // HMS_DIR_FULLPATH\n            cmdWithArgs.add( 4, hmsDir );\n\n            int exitValue = ProcessUtil.getCommandExitValue( cmdWithArgs );\n            if ( exitValue == 0 )\n            {\n                return true;\n            }\n            else\n            {\n                logger.debug( \"Error while executing rollback script. Script execution returned: {}\", exitValue );\n                return false;\n            }\n        }\n        else\n        {\n            logger.info( \"Either HMS directory or HMS parent direcotry or rollbackScript not configured.\"\n                + \" [ hmsDir: {}; hmsParentDir: {}; rollbackScript: {}.\", hmsDir, hmsParentDir, rollbackScript );\n            return false;\n        }\n    }", "signature": "boolean rollbackUpgrade( RollbackSpec rollbackSpec )", "full_signature": "public static boolean rollbackUpgrade( RollbackSpec rollbackSpec )", "class_method_signature": "UpgradeUtil.rollbackUpgrade( RollbackSpec rollbackSpec )", "testcase": false, "constructor": false, "invocations": ["debug", "getId", "isBlank", "debug", "getUpgradeDir", "getHMSConfigProperty", "getHMSConfigProperty", "getHMSConfigProperty", "concat", "add", "add", "add", "concat", "add", "add", "getCommandExitValue", "debug", "info"]}, "repository": {"repo_id": 61566208, "url": "https://github.com/vmware-archive/OHMS", "language": "Java", "is_fork": false, "fork_count": 6, "stargazer_count": 14, "size": 16092, "license": "licensed"}}