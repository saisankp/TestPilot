{"test_class": {"identifier": "TracingQueryInterceptorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Mock JdbcConnection connection;", "modifier": "@Mock", "type": "JdbcConnection", "declarator": "connection", "var_name": "connection"}, {"original_string": "@Mock Span span;", "modifier": "@Mock", "type": "Span", "declarator": "span", "var_name": "span"}, {"original_string": "String url = \"jdbc:mysql://myhost:5555/mydatabase\";", "modifier": "", "type": "String", "declarator": "url = \"jdbc:mysql://myhost:5555/mydatabase\"", "var_name": "url"}], "file": "instrumentation/mysql8/src/test/java/brave/mysql8/TracingQueryInterceptorTest.java"}, "test_case": {"identifier": "parseServerIpAndPort_doesntCrash", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test public void parseServerIpAndPort_doesntCrash() {\n    when(connection.getURL()).thenThrow(new RuntimeException());\n\n    TracingQueryInterceptor.parseServerIpAndPort(connection, span);\n\n    verifyNoMoreInteractions(span);\n  }", "signature": "void parseServerIpAndPort_doesntCrash()", "full_signature": "@Test public void parseServerIpAndPort_doesntCrash()", "class_method_signature": "TracingQueryInterceptorTest.parseServerIpAndPort_doesntCrash()", "testcase": true, "constructor": false, "invocations": ["thenThrow", "when", "getURL", "parseServerIpAndPort", "verifyNoMoreInteractions"]}, "focal_class": {"identifier": "TracingQueryInterceptor", "superclass": "", "interfaces": "implements QueryInterceptor", "fields": [{"original_string": "private MysqlConnection connection;", "modifier": "private", "type": "MysqlConnection", "declarator": "connection", "var_name": "connection"}, {"original_string": "private boolean interceptingExceptions;", "modifier": "private", "type": "boolean", "declarator": "interceptingExceptions", "var_name": "interceptingExceptions"}], "methods": [{"identifier": "preProcess", "parameters": "(Supplier<String> sqlSupplier, Query interceptedQuery)", "modifiers": "@Override public", "return": "T", "signature": "T preProcess(Supplier<String> sqlSupplier, Query interceptedQuery)", "full_signature": "@Override public T preProcess(Supplier<String> sqlSupplier, Query interceptedQuery)", "class_method_signature": "TracingQueryInterceptor.preProcess(Supplier<String> sqlSupplier, Query interceptedQuery)", "testcase": false, "constructor": false}, {"identifier": "postProcess", "parameters": "(Supplier<String> sql, Query interceptedQuery,\n    T originalResultSet, ServerSession serverSession)", "modifiers": "@Override public", "return": "T", "signature": "T postProcess(Supplier<String> sql, Query interceptedQuery,\n    T originalResultSet, ServerSession serverSession)", "full_signature": "@Override public T postProcess(Supplier<String> sql, Query interceptedQuery,\n    T originalResultSet, ServerSession serverSession)", "class_method_signature": "TracingQueryInterceptor.postProcess(Supplier<String> sql, Query interceptedQuery,\n    T originalResultSet, ServerSession serverSession)", "testcase": false, "constructor": false}, {"identifier": "parseServerIpAndPort", "parameters": "(MysqlConnection connection, Span span)", "modifiers": "static", "return": "void", "signature": "void parseServerIpAndPort(MysqlConnection connection, Span span)", "full_signature": "static void parseServerIpAndPort(MysqlConnection connection, Span span)", "class_method_signature": "TracingQueryInterceptor.parseServerIpAndPort(MysqlConnection connection, Span span)", "testcase": false, "constructor": false}, {"identifier": "getDatabaseName", "parameters": "(MysqlConnection connection)", "modifiers": "private static", "return": "String", "signature": "String getDatabaseName(MysqlConnection connection)", "full_signature": "private static String getDatabaseName(MysqlConnection connection)", "class_method_signature": "TracingQueryInterceptor.getDatabaseName(MysqlConnection connection)", "testcase": false, "constructor": false}, {"identifier": "getHost", "parameters": "(MysqlConnection connection)", "modifiers": "private static", "return": "String", "signature": "String getHost(MysqlConnection connection)", "full_signature": "private static String getHost(MysqlConnection connection)", "class_method_signature": "TracingQueryInterceptor.getHost(MysqlConnection connection)", "testcase": false, "constructor": false}, {"identifier": "executeTopLevelOnly", "parameters": "()", "modifiers": "@Override public", "return": "boolean", "signature": "boolean executeTopLevelOnly()", "full_signature": "@Override public boolean executeTopLevelOnly()", "class_method_signature": "TracingQueryInterceptor.executeTopLevelOnly()", "testcase": false, "constructor": false}, {"identifier": "init", "parameters": "(MysqlConnection mysqlConnection, Properties properties,\n    Log log)", "modifiers": "@Override public", "return": "QueryInterceptor", "signature": "QueryInterceptor init(MysqlConnection mysqlConnection, Properties properties,\n    Log log)", "full_signature": "@Override public QueryInterceptor init(MysqlConnection mysqlConnection, Properties properties,\n    Log log)", "class_method_signature": "TracingQueryInterceptor.init(MysqlConnection mysqlConnection, Properties properties,\n    Log log)", "testcase": false, "constructor": false}, {"identifier": "destroy", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void destroy()", "full_signature": "@Override public void destroy()", "class_method_signature": "TracingQueryInterceptor.destroy()", "testcase": false, "constructor": false}], "file": "instrumentation/mysql8/src/main/java/brave/mysql8/TracingQueryInterceptor.java"}, "focal_method": {"identifier": "parseServerIpAndPort", "parameters": "(MysqlConnection connection, Span span)", "modifiers": "static", "return": "void", "body": "static void parseServerIpAndPort(MysqlConnection connection, Span span) {\n    try {\n      URI url = URI.create(connection.getURL().substring(5)); // strip \"jdbc:\"\n      String remoteServiceName = connection.getProperties().getProperty(\"zipkinServiceName\");\n      if (remoteServiceName == null || \"\".equals(remoteServiceName)) {\n        String databaseName = getDatabaseName(connection);\n        if (databaseName != null && !databaseName.isEmpty()) {\n          remoteServiceName = \"mysql-\" + databaseName;\n        } else {\n          remoteServiceName = \"mysql\";\n        }\n      }\n      span.remoteServiceName(remoteServiceName);\n      String host = getHost(connection);\n      if (host != null) {\n        span.remoteIpAndPort(host, url.getPort() == -1 ? 3306 : url.getPort());\n      }\n    } catch (Exception e) {\n      // remote address is optional\n    }\n  }", "signature": "void parseServerIpAndPort(MysqlConnection connection, Span span)", "full_signature": "static void parseServerIpAndPort(MysqlConnection connection, Span span)", "class_method_signature": "TracingQueryInterceptor.parseServerIpAndPort(MysqlConnection connection, Span span)", "testcase": false, "constructor": false, "invocations": ["create", "substring", "getURL", "getProperty", "getProperties", "equals", "getDatabaseName", "isEmpty", "remoteServiceName", "getHost", "remoteIpAndPort", "getPort", "getPort"]}, "repository": {"repo_id": 9278888, "url": "https://github.com/openzipkin/brave", "stars": 1754, "created": "4/7/2013 3:48:18 PM +00:00", "updates": "2020-01-26T11:52:41+00:00", "fork": "False", "license": "licensed"}}