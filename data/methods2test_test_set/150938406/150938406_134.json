{"test_class": {"identifier": "KMeansUtilTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final FastDistance distance = new EuclideanDistance();", "modifier": "private final", "type": "FastDistance", "declarator": "distance = new EuclideanDistance()", "var_name": "distance"}, {"original_string": "private final int vectorSize = 2;", "modifier": "private final", "type": "int", "declarator": "vectorSize = 2", "var_name": "vectorSize"}, {"original_string": "private final int length = 10;", "modifier": "private final", "type": "int", "declarator": "length = 10", "var_name": "length"}, {"original_string": "private final List<Row> modelRows = Arrays.asList(\n        Row.of(0L, \"{\\\"vectorCol\\\":\\\"\\\\\\\"Y\\\\\\\"\\\",\\\"latitudeCol\\\":null,\\\"longitudeCol\\\":null,\"\n            + \"\\\"distanceType\\\":\\\"\\\\\\\"EUCLIDEAN\\\\\\\"\\\",\\\"k\\\":\\\"2\\\",\\\"vectorSize\\\":\\\"3\\\"}\"),\n        Row.of(1048576L, \"{\\\"clusterId\\\":0,\\\"weight\\\":3.0,\\\"vec\\\":{\\\"data\\\":[9.1,9.1,9.1]}}\"),\n        Row.of(2097152L, \"{\\\"clusterId\\\":1,\\\"weight\\\":3.0,\\\"vec\\\":{\\\"data\\\":[0.1,0.1,0.1]}}\")\n    );", "modifier": "private final", "type": "List<Row>", "declarator": "modelRows = Arrays.asList(\n        Row.of(0L, \"{\\\"vectorCol\\\":\\\"\\\\\\\"Y\\\\\\\"\\\",\\\"latitudeCol\\\":null,\\\"longitudeCol\\\":null,\"\n            + \"\\\"distanceType\\\":\\\"\\\\\\\"EUCLIDEAN\\\\\\\"\\\",\\\"k\\\":\\\"2\\\",\\\"vectorSize\\\":\\\"3\\\"}\"),\n        Row.of(1048576L, \"{\\\"clusterId\\\":0,\\\"weight\\\":3.0,\\\"vec\\\":{\\\"data\\\":[9.1,9.1,9.1]}}\"),\n        Row.of(2097152L, \"{\\\"clusterId\\\":1,\\\"weight\\\":3.0,\\\"vec\\\":{\\\"data\\\":[0.1,0.1,0.1]}}\")\n    )", "var_name": "modelRows"}], "file": "core/src/test/java/com/alibaba/alink/operator/common/clustering/kmeans/KMeansUtilTest.java"}, "test_case": {"identifier": "updateSumMatrixTest", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void updateSumMatrixTest() {\n        int sampleWeight = 1;\n        KMeansPredictModelData predictModelData = new KMeansModelDataConverter().load(modelRows);\n        List<FastDistanceVectorData> samples = new ArrayList<>();\n        List<Vector> vectorList = new ArrayList<>();\n        for (int i = 0; i < length; i++) {\n            vectorList.add(DenseVector.ones(predictModelData.params.vectorSize).scale(i));\n        }\n        vectorList.forEach(vec -> samples\n            .add((predictModelData.params.distanceType.getFastDistance()).prepareVectorData(Tuple2.of(vec, null))));\n\n        DenseMatrix distanceMatrix = new DenseMatrix(predictModelData.params.k, 1);\n        double[] sumMatrix = new double[predictModelData.params.k * (predictModelData.params.vectorSize + 1)];\n        for (FastDistanceVectorData sample : samples) {\n            KMeansUtil.updateSumMatrix(\n                sample,\n                sampleWeight,\n                predictModelData.centroids,\n                predictModelData.params.vectorSize,\n                sumMatrix,\n                predictModelData.params.k,\n                predictModelData.params.distanceType.getFastDistance(),\n                distanceMatrix);\n        }\n\n        Arrays.equals(sumMatrix, new double[] {35.0, 35.0, 35.0, 5.0, 10.0, 10.0, 10.0, 5.0});\n    }", "signature": "void updateSumMatrixTest()", "full_signature": "@Test public void updateSumMatrixTest()", "class_method_signature": "KMeansUtilTest.updateSumMatrixTest()", "testcase": true, "constructor": false, "invocations": ["load", "add", "scale", "ones", "forEach", "add", "prepareVectorData", "getFastDistance", "of", "updateSumMatrix", "getFastDistance", "equals"]}, "focal_class": {"identifier": "KMeansUtil", "superclass": "", "interfaces": "implements Serializable", "fields": [], "methods": [{"identifier": "buildCentroidsMatrix", "parameters": "(List<FastDistanceVectorData> vectors,\n                                                              FastDistance distance,\n                                                              int vectorSize)", "modifiers": "public static", "return": "FastDistanceMatrixData", "signature": "FastDistanceMatrixData buildCentroidsMatrix(List<FastDistanceVectorData> vectors,\n                                                              FastDistance distance,\n                                                              int vectorSize)", "full_signature": "public static FastDistanceMatrixData buildCentroidsMatrix(List<FastDistanceVectorData> vectors,\n                                                              FastDistance distance,\n                                                              int vectorSize)", "class_method_signature": "KMeansUtil.buildCentroidsMatrix(List<FastDistanceVectorData> vectors,\n                                                              FastDistance distance,\n                                                              int vectorSize)", "testcase": false, "constructor": false}, {"identifier": "updateSumMatrix", "parameters": "(FastDistanceVectorData sample,\n                                      long sampleWeight,\n                                      FastDistanceMatrixData centroids,\n                                      int vectorSize,\n                                      double[] sumMatrix,\n                                      int k,\n                                      FastDistance fastDistance,\n                                      DenseMatrix distanceMatrix)", "modifiers": "public static", "return": "int", "signature": "int updateSumMatrix(FastDistanceVectorData sample,\n                                      long sampleWeight,\n                                      FastDistanceMatrixData centroids,\n                                      int vectorSize,\n                                      double[] sumMatrix,\n                                      int k,\n                                      FastDistance fastDistance,\n                                      DenseMatrix distanceMatrix)", "full_signature": "public static int updateSumMatrix(FastDistanceVectorData sample,\n                                      long sampleWeight,\n                                      FastDistanceMatrixData centroids,\n                                      int vectorSize,\n                                      double[] sumMatrix,\n                                      int k,\n                                      FastDistance fastDistance,\n                                      DenseMatrix distanceMatrix)", "class_method_signature": "KMeansUtil.updateSumMatrix(FastDistanceVectorData sample,\n                                      long sampleWeight,\n                                      FastDistanceMatrixData centroids,\n                                      int vectorSize,\n                                      double[] sumMatrix,\n                                      int k,\n                                      FastDistance fastDistance,\n                                      DenseMatrix distanceMatrix)", "testcase": false, "constructor": false}, {"identifier": "getClosestClusterIndex", "parameters": "(FastDistanceVectorData sample,\n                                                                 FastDistanceMatrixData centroids,\n                                                                 int k,\n                                                                 FastDistance distance,\n                                                                 DenseMatrix distanceMatrix)", "modifiers": "public static", "return": "Tuple2<Integer, Double>", "signature": "Tuple2<Integer, Double> getClosestClusterIndex(FastDistanceVectorData sample,\n                                                                 FastDistanceMatrixData centroids,\n                                                                 int k,\n                                                                 FastDistance distance,\n                                                                 DenseMatrix distanceMatrix)", "full_signature": "public static Tuple2<Integer, Double> getClosestClusterIndex(FastDistanceVectorData sample,\n                                                                 FastDistanceMatrixData centroids,\n                                                                 int k,\n                                                                 FastDistance distance,\n                                                                 DenseMatrix distanceMatrix)", "class_method_signature": "KMeansUtil.getClosestClusterIndex(FastDistanceVectorData sample,\n                                                                 FastDistanceMatrixData centroids,\n                                                                 int k,\n                                                                 FastDistance distance,\n                                                                 DenseMatrix distanceMatrix)", "testcase": false, "constructor": false}, {"identifier": "getClusterDistances", "parameters": "(FastDistanceVectorData sample,\n                                               FastDistanceMatrixData centroids,\n                                               FastDistance distance,\n                                               DenseMatrix distanceMatrix)", "modifiers": "public static", "return": "double[]", "signature": "double[] getClusterDistances(FastDistanceVectorData sample,\n                                               FastDistanceMatrixData centroids,\n                                               FastDistance distance,\n                                               DenseMatrix distanceMatrix)", "full_signature": "public static double[] getClusterDistances(FastDistanceVectorData sample,\n                                               FastDistanceMatrixData centroids,\n                                               FastDistance distance,\n                                               DenseMatrix distanceMatrix)", "class_method_signature": "KMeansUtil.getClusterDistances(FastDistanceVectorData sample,\n                                               FastDistanceMatrixData centroids,\n                                               FastDistance distance,\n                                               DenseMatrix distanceMatrix)", "testcase": false, "constructor": false}, {"identifier": "getClosestClusterIndex", "parameters": "(KMeansTrainModelData trainModelData,\n                                                                 Vector sample,\n                                                                 ContinuousDistance distance)", "modifiers": "public static", "return": "Tuple2<Integer, Double>", "signature": "Tuple2<Integer, Double> getClosestClusterIndex(KMeansTrainModelData trainModelData,\n                                                                 Vector sample,\n                                                                 ContinuousDistance distance)", "full_signature": "public static Tuple2<Integer, Double> getClosestClusterIndex(KMeansTrainModelData trainModelData,\n                                                                 Vector sample,\n                                                                 ContinuousDistance distance)", "class_method_signature": "KMeansUtil.getClosestClusterIndex(KMeansTrainModelData trainModelData,\n                                                                 Vector sample,\n                                                                 ContinuousDistance distance)", "testcase": false, "constructor": false}, {"identifier": "getClusterDistances", "parameters": "(KMeansTrainModelData trainModelData,\n                                               Vector sample,\n                                               ContinuousDistance distance)", "modifiers": "public static", "return": "double[]", "signature": "double[] getClusterDistances(KMeansTrainModelData trainModelData,\n                                               Vector sample,\n                                               ContinuousDistance distance)", "full_signature": "public static double[] getClusterDistances(KMeansTrainModelData trainModelData,\n                                               Vector sample,\n                                               ContinuousDistance distance)", "class_method_signature": "KMeansUtil.getClusterDistances(KMeansTrainModelData trainModelData,\n                                               Vector sample,\n                                               ContinuousDistance distance)", "testcase": false, "constructor": false}, {"identifier": "getMinPointIndex", "parameters": "(double[] data, int endIndex)", "modifiers": "public static", "return": "int", "signature": "int getMinPointIndex(double[] data, int endIndex)", "full_signature": "public static int getMinPointIndex(double[] data, int endIndex)", "class_method_signature": "KMeansUtil.getMinPointIndex(double[] data, int endIndex)", "testcase": false, "constructor": false}, {"identifier": "getKmeansPredictColIdxs", "parameters": "(KMeansTrainModelData.ParamSummary params, String[] dataCols)", "modifiers": "public static", "return": "int[]", "signature": "int[] getKmeansPredictColIdxs(KMeansTrainModelData.ParamSummary params, String[] dataCols)", "full_signature": "public static int[] getKmeansPredictColIdxs(KMeansTrainModelData.ParamSummary params, String[] dataCols)", "class_method_signature": "KMeansUtil.getKmeansPredictColIdxs(KMeansTrainModelData.ParamSummary params, String[] dataCols)", "testcase": false, "constructor": false}, {"identifier": "getKMeansPredictVector", "parameters": "(int[] colIdxs, Row row)", "modifiers": "public static", "return": "Vector", "signature": "Vector getKMeansPredictVector(int[] colIdxs, Row row)", "full_signature": "public static Vector getKMeansPredictVector(int[] colIdxs, Row row)", "class_method_signature": "KMeansUtil.getKMeansPredictVector(int[] colIdxs, Row row)", "testcase": false, "constructor": false}, {"identifier": "transformPredictDataToTrainData", "parameters": "(KMeansPredictModelData predictModelData)", "modifiers": "public static", "return": "KMeansTrainModelData", "signature": "KMeansTrainModelData transformPredictDataToTrainData(KMeansPredictModelData predictModelData)", "full_signature": "public static KMeansTrainModelData transformPredictDataToTrainData(KMeansPredictModelData predictModelData)", "class_method_signature": "KMeansUtil.transformPredictDataToTrainData(KMeansPredictModelData predictModelData)", "testcase": false, "constructor": false}, {"identifier": "transformTrainDataToPredictData", "parameters": "(KMeansTrainModelData trainModelData)", "modifiers": "public static", "return": "KMeansPredictModelData", "signature": "KMeansPredictModelData transformTrainDataToPredictData(KMeansTrainModelData trainModelData)", "full_signature": "public static KMeansPredictModelData transformTrainDataToPredictData(KMeansTrainModelData trainModelData)", "class_method_signature": "KMeansUtil.transformTrainDataToPredictData(KMeansTrainModelData trainModelData)", "testcase": false, "constructor": false}, {"identifier": "getProbArrayFromDistanceArray", "parameters": "(double[] distances)", "modifiers": "public static", "return": "double[]", "signature": "double[] getProbArrayFromDistanceArray(double[] distances)", "full_signature": "public static double[] getProbArrayFromDistanceArray(double[] distances)", "class_method_signature": "KMeansUtil.getProbArrayFromDistanceArray(double[] distances)", "testcase": false, "constructor": false}, {"identifier": "loadModelForTrain", "parameters": "(Params params, Iterable<String> data)", "modifiers": "public static", "return": "KMeansTrainModelData", "signature": "KMeansTrainModelData loadModelForTrain(Params params, Iterable<String> data)", "full_signature": "public static KMeansTrainModelData loadModelForTrain(Params params, Iterable<String> data)", "class_method_signature": "KMeansUtil.loadModelForTrain(Params params, Iterable<String> data)", "testcase": false, "constructor": false}], "file": "core/src/main/java/com/alibaba/alink/operator/common/clustering/kmeans/KMeansUtil.java"}, "focal_method": {"identifier": "updateSumMatrix", "parameters": "(FastDistanceVectorData sample,\n                                      long sampleWeight,\n                                      FastDistanceMatrixData centroids,\n                                      int vectorSize,\n                                      double[] sumMatrix,\n                                      int k,\n                                      FastDistance fastDistance,\n                                      DenseMatrix distanceMatrix)", "modifiers": "public static", "return": "int", "body": "public static int updateSumMatrix(FastDistanceVectorData sample,\n                                      long sampleWeight,\n                                      FastDistanceMatrixData centroids,\n                                      int vectorSize,\n                                      double[] sumMatrix,\n                                      int k,\n                                      FastDistance fastDistance,\n                                      DenseMatrix distanceMatrix) {\n        Preconditions.checkNotNull(sumMatrix);\n        Preconditions.checkNotNull(distanceMatrix);\n        Preconditions.checkArgument(distanceMatrix.numRows() == centroids.getVectors().numCols() &&\n            distanceMatrix.numCols() == 1, \"Memory not preallocated!\");\n\n        fastDistance.calc(sample, centroids, distanceMatrix);\n        int clusterIndex = getClosestClusterIndex(sample, centroids, k, fastDistance, distanceMatrix).f0;\n        int startIndex = clusterIndex * (vectorSize + 1);\n        Vector vec = sample.getVector();\n        if (vec instanceof DenseVector) {\n            BLAS.axpy(vectorSize, sampleWeight, ((DenseVector)vec).getData(), 0, sumMatrix, startIndex);\n        } else {\n            SparseVector sparseVector = (SparseVector)vec;\n            sparseVector.forEach((index, value) -> sumMatrix[startIndex + index] += sampleWeight * value);\n        }\n        sumMatrix[startIndex + vectorSize] += sampleWeight;\n        return clusterIndex;\n    }", "signature": "int updateSumMatrix(FastDistanceVectorData sample,\n                                      long sampleWeight,\n                                      FastDistanceMatrixData centroids,\n                                      int vectorSize,\n                                      double[] sumMatrix,\n                                      int k,\n                                      FastDistance fastDistance,\n                                      DenseMatrix distanceMatrix)", "full_signature": "public static int updateSumMatrix(FastDistanceVectorData sample,\n                                      long sampleWeight,\n                                      FastDistanceMatrixData centroids,\n                                      int vectorSize,\n                                      double[] sumMatrix,\n                                      int k,\n                                      FastDistance fastDistance,\n                                      DenseMatrix distanceMatrix)", "class_method_signature": "KMeansUtil.updateSumMatrix(FastDistanceVectorData sample,\n                                      long sampleWeight,\n                                      FastDistanceMatrixData centroids,\n                                      int vectorSize,\n                                      double[] sumMatrix,\n                                      int k,\n                                      FastDistance fastDistance,\n                                      DenseMatrix distanceMatrix)", "testcase": false, "constructor": false, "invocations": ["checkNotNull", "checkNotNull", "checkArgument", "numRows", "numCols", "getVectors", "numCols", "calc", "getClosestClusterIndex", "getVector", "axpy", "getData", "forEach"]}, "repository": {"repo_id": 150938406, "url": "https://github.com/alibaba/Alink", "stars": 1923, "created": "9/30/2018 6:36:11 AM +00:00", "updates": "2020-01-27T10:24:34+00:00", "fork": "False", "license": "licensed"}}