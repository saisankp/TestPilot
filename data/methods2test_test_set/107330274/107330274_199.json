{"test_class": {"identifier": "DefaultAgentManagementServiceTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final int INSTANCE_GROUP_COUNT = 2;", "modifier": "private static final", "type": "int", "declarator": "INSTANCE_GROUP_COUNT = 2", "var_name": "INSTANCE_GROUP_COUNT"}, {"original_string": "private final TitusRuntime titusRuntime = TitusRuntimes.internal();", "modifier": "private final", "type": "TitusRuntime", "declarator": "titusRuntime = TitusRuntimes.internal()", "var_name": "titusRuntime"}, {"original_string": "private final AgentManagementConfiguration configuration = mock(AgentManagementConfiguration.class);", "modifier": "private final", "type": "AgentManagementConfiguration", "declarator": "configuration = mock(AgentManagementConfiguration.class)", "var_name": "configuration"}, {"original_string": "private final InstanceCloudConnector connector = mock(InstanceCloudConnector.class);", "modifier": "private final", "type": "InstanceCloudConnector", "declarator": "connector = mock(InstanceCloudConnector.class)", "var_name": "connector"}, {"original_string": "private final AgentCache agentCache = mock(AgentCache.class);", "modifier": "private final", "type": "AgentCache", "declarator": "agentCache = mock(AgentCache.class)", "var_name": "agentCache"}, {"original_string": "private final ServerInfoResolver serverInfoResolver = mock(ServerInfoResolver.class);", "modifier": "private final", "type": "ServerInfoResolver", "declarator": "serverInfoResolver = mock(ServerInfoResolver.class)", "var_name": "serverInfoResolver"}, {"original_string": "private final List<AgentInstanceGroup> instanceGroups = agentServerGroups(Tier.Flex, 5).toList(INSTANCE_GROUP_COUNT);", "modifier": "private final", "type": "List<AgentInstanceGroup>", "declarator": "instanceGroups = agentServerGroups(Tier.Flex, 5).toList(INSTANCE_GROUP_COUNT)", "var_name": "instanceGroups"}, {"original_string": "private final List<AgentInstance> instanceSet0 = new ArrayList<>();", "modifier": "private final", "type": "List<AgentInstance>", "declarator": "instanceSet0 = new ArrayList<>()", "var_name": "instanceSet0"}, {"original_string": "private final List<AgentInstance> instanceSet1 = new ArrayList<>();", "modifier": "private final", "type": "List<AgentInstance>", "declarator": "instanceSet1 = new ArrayList<>()", "var_name": "instanceSet1"}, {"original_string": "private final Predicate<AgentInstanceGroup> kubeSchedulerInstanceGroupPredicate = ig -> instanceGroups.get(INSTANCE_GROUP_COUNT - 1).getId().equals(ig.getId());", "modifier": "private final", "type": "Predicate<AgentInstanceGroup>", "declarator": "kubeSchedulerInstanceGroupPredicate = ig -> instanceGroups.get(INSTANCE_GROUP_COUNT - 1).getId().equals(ig.getId())", "var_name": "kubeSchedulerInstanceGroupPredicate"}, {"original_string": "private final DefaultAgentManagementService service = new DefaultAgentManagementService(configuration,\n            kubeSchedulerInstanceGroupPredicate,\n            connector,\n            agentCache,\n            serverInfoResolver,\n            titusRuntime\n    );", "modifier": "private final", "type": "DefaultAgentManagementService", "declarator": "service = new DefaultAgentManagementService(configuration,\n            kubeSchedulerInstanceGroupPredicate,\n            connector,\n            agentCache,\n            serverInfoResolver,\n            titusRuntime\n    )", "var_name": "service"}, {"original_string": "private final PublishSubject<CacheUpdateEvent> agentCacheEventSubject = PublishSubject.create();", "modifier": "private final", "type": "PublishSubject<CacheUpdateEvent>", "declarator": "agentCacheEventSubject = PublishSubject.create()", "var_name": "agentCacheEventSubject"}, {"original_string": "private final ExtTestSubscriber<AgentEvent> eventSubscriber = new ExtTestSubscriber<>();", "modifier": "private final", "type": "ExtTestSubscriber<AgentEvent>", "declarator": "eventSubscriber = new ExtTestSubscriber<>()", "var_name": "eventSubscriber"}], "file": "titus-server-master/src/test/java/com/netflix/titus/master/agent/service/DefaultAgentManagementServiceTest.java"}, "test_case": {"identifier": "testUpdateTier", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testUpdateTier() {\n        ExtTestSubscriber<Object> testSubscriber = new ExtTestSubscriber<>();\n        AgentInstanceGroup instanceGroup = instanceGroups.get(0);\n        String instanceGroupId = instanceGroup.getId();\n\n        when(agentCache.updateInstanceGroupStore(eq(instanceGroupId), any()))\n                .thenReturn(Single.just(instanceGroup.toBuilder().withTier(Tier.Critical).build()));\n        service.updateInstanceGroupTier(instanceGroupId, Tier.Critical).toObservable().subscribe(testSubscriber);\n\n        verify(agentCache, times(1)).updateInstanceGroupStore(eq(instanceGroupId), any());\n    }", "signature": "void testUpdateTier()", "full_signature": "@Test public void testUpdateTier()", "class_method_signature": "DefaultAgentManagementServiceTest.testUpdateTier()", "testcase": true, "constructor": false, "invocations": ["get", "getId", "thenReturn", "when", "updateInstanceGroupStore", "eq", "any", "just", "build", "withTier", "toBuilder", "subscribe", "toObservable", "updateInstanceGroupTier", "updateInstanceGroupStore", "verify", "times", "eq", "any"]}, "focal_class": {"identifier": "DefaultAgentManagementService", "superclass": "", "interfaces": "implements AgentManagementService", "fields": [{"original_string": "public static final String KUBE_SCHEDULER_INSTANCE_GROUP_PREDICATE = \"kubeSchedulerInstanceGroupPredicate\";", "modifier": "public static final", "type": "String", "declarator": "KUBE_SCHEDULER_INSTANCE_GROUP_PREDICATE = \"kubeSchedulerInstanceGroupPredicate\"", "var_name": "KUBE_SCHEDULER_INSTANCE_GROUP_PREDICATE"}, {"original_string": "private final AgentManagementConfiguration configuration;", "modifier": "private final", "type": "AgentManagementConfiguration", "declarator": "configuration", "var_name": "configuration"}, {"original_string": "private final Predicate<AgentInstanceGroup> kubeSchedulerInstanceGroupPredicate;", "modifier": "private final", "type": "Predicate<AgentInstanceGroup>", "declarator": "kubeSchedulerInstanceGroupPredicate", "var_name": "kubeSchedulerInstanceGroupPredicate"}, {"original_string": "private final InstanceCloudConnector instanceCloudConnector;", "modifier": "private final", "type": "InstanceCloudConnector", "declarator": "instanceCloudConnector", "var_name": "instanceCloudConnector"}, {"original_string": "private final AgentCache agentCache;", "modifier": "private final", "type": "AgentCache", "declarator": "agentCache", "var_name": "agentCache"}, {"original_string": "private final ServerInfoResolver serverInfoResolver;", "modifier": "private final", "type": "ServerInfoResolver", "declarator": "serverInfoResolver", "var_name": "serverInfoResolver"}, {"original_string": "private final TitusRuntime titusRuntime;", "modifier": "private final", "type": "TitusRuntime", "declarator": "titusRuntime", "var_name": "titusRuntime"}, {"original_string": "private InstanceGroupSchedulerAssignmentMonitor schedulerAssignmentMonitor;", "modifier": "private", "type": "InstanceGroupSchedulerAssignmentMonitor", "declarator": "schedulerAssignmentMonitor", "var_name": "schedulerAssignmentMonitor"}], "methods": [{"identifier": "DefaultAgentManagementService", "parameters": "(AgentManagementConfiguration configuration,\n                                         @Named(KUBE_SCHEDULER_INSTANCE_GROUP_PREDICATE) Predicate<AgentInstanceGroup> kubeSchedulerInstanceGroupPredicate,\n                                         InstanceCloudConnector instanceCloudConnector,\n                                         AgentCache AgentCache,\n                                         ServerInfoResolver serverInfoResolver,\n                                         TitusRuntime titusRuntime)", "modifiers": "@Inject public", "return": "", "signature": " DefaultAgentManagementService(AgentManagementConfiguration configuration,\n                                         @Named(KUBE_SCHEDULER_INSTANCE_GROUP_PREDICATE) Predicate<AgentInstanceGroup> kubeSchedulerInstanceGroupPredicate,\n                                         InstanceCloudConnector instanceCloudConnector,\n                                         AgentCache AgentCache,\n                                         ServerInfoResolver serverInfoResolver,\n                                         TitusRuntime titusRuntime)", "full_signature": "@Inject public  DefaultAgentManagementService(AgentManagementConfiguration configuration,\n                                         @Named(KUBE_SCHEDULER_INSTANCE_GROUP_PREDICATE) Predicate<AgentInstanceGroup> kubeSchedulerInstanceGroupPredicate,\n                                         InstanceCloudConnector instanceCloudConnector,\n                                         AgentCache AgentCache,\n                                         ServerInfoResolver serverInfoResolver,\n                                         TitusRuntime titusRuntime)", "class_method_signature": "DefaultAgentManagementService.DefaultAgentManagementService(AgentManagementConfiguration configuration,\n                                         @Named(KUBE_SCHEDULER_INSTANCE_GROUP_PREDICATE) Predicate<AgentInstanceGroup> kubeSchedulerInstanceGroupPredicate,\n                                         InstanceCloudConnector instanceCloudConnector,\n                                         AgentCache AgentCache,\n                                         ServerInfoResolver serverInfoResolver,\n                                         TitusRuntime titusRuntime)", "testcase": false, "constructor": true}, {"identifier": "enterActiveMode", "parameters": "()", "modifiers": "@Activator public", "return": "void", "signature": "void enterActiveMode()", "full_signature": "@Activator public void enterActiveMode()", "class_method_signature": "DefaultAgentManagementService.enterActiveMode()", "testcase": false, "constructor": false}, {"identifier": "shutdown", "parameters": "()", "modifiers": "@PreDestroy public", "return": "void", "signature": "void shutdown()", "full_signature": "@PreDestroy public void shutdown()", "class_method_signature": "DefaultAgentManagementService.shutdown()", "testcase": false, "constructor": false}, {"identifier": "isOwnedByFenzo", "parameters": "(AgentInstanceGroup instanceGroup)", "modifiers": "@Override public", "return": "boolean", "signature": "boolean isOwnedByFenzo(AgentInstanceGroup instanceGroup)", "full_signature": "@Override public boolean isOwnedByFenzo(AgentInstanceGroup instanceGroup)", "class_method_signature": "DefaultAgentManagementService.isOwnedByFenzo(AgentInstanceGroup instanceGroup)", "testcase": false, "constructor": false}, {"identifier": "isOwnedByFenzo", "parameters": "(AgentInstance instance)", "modifiers": "@Override public", "return": "boolean", "signature": "boolean isOwnedByFenzo(AgentInstance instance)", "full_signature": "@Override public boolean isOwnedByFenzo(AgentInstance instance)", "class_method_signature": "DefaultAgentManagementService.isOwnedByFenzo(AgentInstance instance)", "testcase": false, "constructor": false}, {"identifier": "getInstanceGroups", "parameters": "()", "modifiers": "@Override public", "return": "List<AgentInstanceGroup>", "signature": "List<AgentInstanceGroup> getInstanceGroups()", "full_signature": "@Override public List<AgentInstanceGroup> getInstanceGroups()", "class_method_signature": "DefaultAgentManagementService.getInstanceGroups()", "testcase": false, "constructor": false}, {"identifier": "getInstanceGroup", "parameters": "(String instanceGroupId)", "modifiers": "@Override public", "return": "AgentInstanceGroup", "signature": "AgentInstanceGroup getInstanceGroup(String instanceGroupId)", "full_signature": "@Override public AgentInstanceGroup getInstanceGroup(String instanceGroupId)", "class_method_signature": "DefaultAgentManagementService.getInstanceGroup(String instanceGroupId)", "testcase": false, "constructor": false}, {"identifier": "findInstanceGroup", "parameters": "(String instanceGroupId)", "modifiers": "@Override public", "return": "Optional<AgentInstanceGroup>", "signature": "Optional<AgentInstanceGroup> findInstanceGroup(String instanceGroupId)", "full_signature": "@Override public Optional<AgentInstanceGroup> findInstanceGroup(String instanceGroupId)", "class_method_signature": "DefaultAgentManagementService.findInstanceGroup(String instanceGroupId)", "testcase": false, "constructor": false}, {"identifier": "getAgentInstance", "parameters": "(String instanceId)", "modifiers": "@Override public", "return": "AgentInstance", "signature": "AgentInstance getAgentInstance(String instanceId)", "full_signature": "@Override public AgentInstance getAgentInstance(String instanceId)", "class_method_signature": "DefaultAgentManagementService.getAgentInstance(String instanceId)", "testcase": false, "constructor": false}, {"identifier": "findAgentInstance", "parameters": "(String instanceId)", "modifiers": "@Override public", "return": "Optional<AgentInstance>", "signature": "Optional<AgentInstance> findAgentInstance(String instanceId)", "full_signature": "@Override public Optional<AgentInstance> findAgentInstance(String instanceId)", "class_method_signature": "DefaultAgentManagementService.findAgentInstance(String instanceId)", "testcase": false, "constructor": false}, {"identifier": "getAgentInstances", "parameters": "(String instanceGroupId)", "modifiers": "@Override public", "return": "List<AgentInstance>", "signature": "List<AgentInstance> getAgentInstances(String instanceGroupId)", "full_signature": "@Override public List<AgentInstance> getAgentInstances(String instanceGroupId)", "class_method_signature": "DefaultAgentManagementService.getAgentInstances(String instanceGroupId)", "testcase": false, "constructor": false}, {"identifier": "findAgentInstances", "parameters": "(Predicate<Pair<AgentInstanceGroup, AgentInstance>> filter)", "modifiers": "@Override public", "return": "List<Pair<AgentInstanceGroup, List<AgentInstance>>>", "signature": "List<Pair<AgentInstanceGroup, List<AgentInstance>>> findAgentInstances(Predicate<Pair<AgentInstanceGroup, AgentInstance>> filter)", "full_signature": "@Override public List<Pair<AgentInstanceGroup, List<AgentInstance>>> findAgentInstances(Predicate<Pair<AgentInstanceGroup, AgentInstance>> filter)", "class_method_signature": "DefaultAgentManagementService.findAgentInstances(Predicate<Pair<AgentInstanceGroup, AgentInstance>> filter)", "testcase": false, "constructor": false}, {"identifier": "getResourceLimits", "parameters": "(String instanceType)", "modifiers": "@Override public", "return": "ResourceDimension", "signature": "ResourceDimension getResourceLimits(String instanceType)", "full_signature": "@Override public ResourceDimension getResourceLimits(String instanceType)", "class_method_signature": "DefaultAgentManagementService.getResourceLimits(String instanceType)", "testcase": false, "constructor": false}, {"identifier": "findResourceLimits", "parameters": "(String instanceType)", "modifiers": "@Override public", "return": "Optional<ResourceDimension>", "signature": "Optional<ResourceDimension> findResourceLimits(String instanceType)", "full_signature": "@Override public Optional<ResourceDimension> findResourceLimits(String instanceType)", "class_method_signature": "DefaultAgentManagementService.findResourceLimits(String instanceType)", "testcase": false, "constructor": false}, {"identifier": "updateInstanceGroupTier", "parameters": "(String instanceGroupId, Tier tier)", "modifiers": "@Override public", "return": "Completable", "signature": "Completable updateInstanceGroupTier(String instanceGroupId, Tier tier)", "full_signature": "@Override public Completable updateInstanceGroupTier(String instanceGroupId, Tier tier)", "class_method_signature": "DefaultAgentManagementService.updateInstanceGroupTier(String instanceGroupId, Tier tier)", "testcase": false, "constructor": false}, {"identifier": "updateInstanceGroupLifecycle", "parameters": "(String instanceGroupId, InstanceGroupLifecycleStatus instanceGroupLifecycleStatus)", "modifiers": "@Override public", "return": "Completable", "signature": "Completable updateInstanceGroupLifecycle(String instanceGroupId, InstanceGroupLifecycleStatus instanceGroupLifecycleStatus)", "full_signature": "@Override public Completable updateInstanceGroupLifecycle(String instanceGroupId, InstanceGroupLifecycleStatus instanceGroupLifecycleStatus)", "class_method_signature": "DefaultAgentManagementService.updateInstanceGroupLifecycle(String instanceGroupId, InstanceGroupLifecycleStatus instanceGroupLifecycleStatus)", "testcase": false, "constructor": false}, {"identifier": "updateInstanceGroupAttributes", "parameters": "(String instanceGroupId, Map<String, String> attributes)", "modifiers": "@Override public", "return": "Completable", "signature": "Completable updateInstanceGroupAttributes(String instanceGroupId, Map<String, String> attributes)", "full_signature": "@Override public Completable updateInstanceGroupAttributes(String instanceGroupId, Map<String, String> attributes)", "class_method_signature": "DefaultAgentManagementService.updateInstanceGroupAttributes(String instanceGroupId, Map<String, String> attributes)", "testcase": false, "constructor": false}, {"identifier": "deleteInstanceGroupAttributes", "parameters": "(String instanceGroupId, Set<String> keys)", "modifiers": "@Override public", "return": "Completable", "signature": "Completable deleteInstanceGroupAttributes(String instanceGroupId, Set<String> keys)", "full_signature": "@Override public Completable deleteInstanceGroupAttributes(String instanceGroupId, Set<String> keys)", "class_method_signature": "DefaultAgentManagementService.deleteInstanceGroupAttributes(String instanceGroupId, Set<String> keys)", "testcase": false, "constructor": false}, {"identifier": "updateAgentInstanceAttributes", "parameters": "(String instanceId, Map<String, String> attributes)", "modifiers": "@Override public", "return": "Completable", "signature": "Completable updateAgentInstanceAttributes(String instanceId, Map<String, String> attributes)", "full_signature": "@Override public Completable updateAgentInstanceAttributes(String instanceId, Map<String, String> attributes)", "class_method_signature": "DefaultAgentManagementService.updateAgentInstanceAttributes(String instanceId, Map<String, String> attributes)", "testcase": false, "constructor": false}, {"identifier": "deleteAgentInstanceAttributes", "parameters": "(String instanceId, Set<String> keys)", "modifiers": "@Override public", "return": "Completable", "signature": "Completable deleteAgentInstanceAttributes(String instanceId, Set<String> keys)", "full_signature": "@Override public Completable deleteAgentInstanceAttributes(String instanceId, Set<String> keys)", "class_method_signature": "DefaultAgentManagementService.deleteAgentInstanceAttributes(String instanceId, Set<String> keys)", "testcase": false, "constructor": false}, {"identifier": "updateCapacity", "parameters": "(String instanceGroupId, Optional<Integer> min, Optional<Integer> desired)", "modifiers": "@Override public", "return": "Completable", "signature": "Completable updateCapacity(String instanceGroupId, Optional<Integer> min, Optional<Integer> desired)", "full_signature": "@Override public Completable updateCapacity(String instanceGroupId, Optional<Integer> min, Optional<Integer> desired)", "class_method_signature": "DefaultAgentManagementService.updateCapacity(String instanceGroupId, Optional<Integer> min, Optional<Integer> desired)", "testcase": false, "constructor": false}, {"identifier": "scaleUp", "parameters": "(String instanceGroupId, int scaleUpCount)", "modifiers": "@Override public", "return": "Completable", "signature": "Completable scaleUp(String instanceGroupId, int scaleUpCount)", "full_signature": "@Override public Completable scaleUp(String instanceGroupId, int scaleUpCount)", "class_method_signature": "DefaultAgentManagementService.scaleUp(String instanceGroupId, int scaleUpCount)", "testcase": false, "constructor": false}, {"identifier": "terminateAgents", "parameters": "(String instanceGroupId, List<String> instanceIds, boolean shrink)", "modifiers": "@Override public", "return": "Observable<List<Either<Boolean, Throwable>>>", "signature": "Observable<List<Either<Boolean, Throwable>>> terminateAgents(String instanceGroupId, List<String> instanceIds, boolean shrink)", "full_signature": "@Override public Observable<List<Either<Boolean, Throwable>>> terminateAgents(String instanceGroupId, List<String> instanceIds, boolean shrink)", "class_method_signature": "DefaultAgentManagementService.terminateAgents(String instanceGroupId, List<String> instanceIds, boolean shrink)", "testcase": false, "constructor": false}, {"identifier": "events", "parameters": "(boolean includeSnapshot)", "modifiers": "@Override public", "return": "Observable<AgentEvent>", "signature": "Observable<AgentEvent> events(boolean includeSnapshot)", "full_signature": "@Override public Observable<AgentEvent> events(boolean includeSnapshot)", "class_method_signature": "DefaultAgentManagementService.events(boolean includeSnapshot)", "testcase": false, "constructor": false}, {"identifier": "resolveInstanceGroup", "parameters": "(List<String> instanceIds)", "modifiers": "private", "return": "String", "signature": "String resolveInstanceGroup(List<String> instanceIds)", "full_signature": "private String resolveInstanceGroup(List<String> instanceIds)", "class_method_signature": "DefaultAgentManagementService.resolveInstanceGroup(List<String> instanceIds)", "testcase": false, "constructor": false}, {"identifier": "internalUpdateCapacity", "parameters": "(AgentInstanceGroup instanceGroup, Optional<Integer> min, Optional<Integer> desired)", "modifiers": "private", "return": "Completable", "signature": "Completable internalUpdateCapacity(AgentInstanceGroup instanceGroup, Optional<Integer> min, Optional<Integer> desired)", "full_signature": "private Completable internalUpdateCapacity(AgentInstanceGroup instanceGroup, Optional<Integer> min, Optional<Integer> desired)", "class_method_signature": "DefaultAgentManagementService.internalUpdateCapacity(AgentInstanceGroup instanceGroup, Optional<Integer> min, Optional<Integer> desired)", "testcase": false, "constructor": false}], "file": "titus-server-master/src/main/java/com/netflix/titus/master/agent/service/DefaultAgentManagementService.java"}, "focal_method": {"identifier": "updateInstanceGroupTier", "parameters": "(String instanceGroupId, Tier tier)", "modifiers": "@Override public", "return": "Completable", "body": "@Override\n    public Completable updateInstanceGroupTier(String instanceGroupId, Tier tier) {\n        return agentCache.updateInstanceGroupStore(\n                instanceGroupId,\n                instanceGroup -> instanceGroup.toBuilder().withTier(tier).build()\n        ).toCompletable();\n    }", "signature": "Completable updateInstanceGroupTier(String instanceGroupId, Tier tier)", "full_signature": "@Override public Completable updateInstanceGroupTier(String instanceGroupId, Tier tier)", "class_method_signature": "DefaultAgentManagementService.updateInstanceGroupTier(String instanceGroupId, Tier tier)", "testcase": false, "constructor": false, "invocations": ["toCompletable", "updateInstanceGroupStore", "build", "withTier", "toBuilder"]}, "repository": {"repo_id": 107330274, "url": "https://github.com/Netflix/titus-control-plane", "stars": 241, "created": "10/17/2017 10:20:55 PM +00:00", "updates": "2020-01-25T13:01:05+00:00", "fork": "False", "license": "licensed"}}