{"test_class": {"identifier": "BulkWriteResultAckFlowTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final ActorSystem actorSystem = ActorSystem.create();", "modifier": "private final", "type": "ActorSystem", "declarator": "actorSystem = ActorSystem.create()", "var_name": "actorSystem"}, {"original_string": "private final TestProbe updaterShardProbe = TestProbe.apply(\"updater\", actorSystem);", "modifier": "private final", "type": "TestProbe", "declarator": "updaterShardProbe = TestProbe.apply(\"updater\", actorSystem)", "var_name": "updaterShardProbe"}, {"original_string": "private final BulkWriteResultAckFlow underTest = BulkWriteResultAckFlow.of(updaterShardProbe.ref());", "modifier": "private final", "type": "BulkWriteResultAckFlow", "declarator": "underTest = BulkWriteResultAckFlow.of(updaterShardProbe.ref())", "var_name": "underTest"}], "file": "services/thingsearch/persistence/src/test/java/org/eclipse/ditto/services/thingsearch/persistence/write/streaming/BulkWriteResultAckFlowTest.java"}, "test_case": {"identifier": "partialSuccess", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void partialSuccess() {\n        final List<AbstractWriteModel> writeModels = generate5WriteModels();\n        final BulkWriteResult result = BulkWriteResult.acknowledged(1, 2, 1, 2, List.of());\n        final List<BulkWriteError> updateFailure = List.of(\n                new BulkWriteError(11000, \"E11000 duplicate key error\", new BsonDocument(), 3),\n                new BulkWriteError(50, \"E50 operation timed out\", new BsonDocument(), 4)\n        );\n\n        // WHEN: BulkWriteResultAckFlow receives partial update success with errors, one of which is not duplicate key\n        final WriteResultAndErrors resultAndErrors = WriteResultAndErrors.failure(writeModels,\n                new MongoBulkWriteException(result, updateFailure, null, new ServerAddress()));\n        final String message = runBulkWriteResultAckFlowAndGetFirstLogEntry(resultAndErrors);\n\n        // THEN: the non-duplicate-key error triggers a failure acknowledgement\n        actorSystem.log().info(message);\n        for (int i = 3; i < 5; ++i) {\n            assertThat(expectUpdateThingResponse(writeModels.get(i).getMetadata().getThingId()))\n                    .describedAs(\"response is failure\")\n                    .returns(false, UpdateThingResponse::isSuccess);\n        }\n        assertThat(message).contains(\"Acknowledged: PartialSuccess\");\n    }", "signature": "void partialSuccess()", "full_signature": "@Test public void partialSuccess()", "class_method_signature": "BulkWriteResultAckFlowTest.partialSuccess()", "testcase": true, "constructor": false, "invocations": ["generate5WriteModels", "acknowledged", "of", "of", "failure", "runBulkWriteResultAckFlowAndGetFirstLogEntry", "info", "log", "returns", "describedAs", "assertThat", "expectUpdateThingResponse", "getThingId", "getMetadata", "get", "contains", "assertThat"]}, "focal_class": {"identifier": "BulkWriteResultAckFlow", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String ERRORS_COUNTER_NAME = \"search-index-update-errors\";", "modifier": "private static final", "type": "String", "declarator": "ERRORS_COUNTER_NAME = \"search-index-update-errors\"", "var_name": "ERRORS_COUNTER_NAME"}, {"original_string": "private final ActorRef updaterShard;", "modifier": "private final", "type": "ActorRef", "declarator": "updaterShard", "var_name": "updaterShard"}, {"original_string": "private final Counter errorsCounter;", "modifier": "private final", "type": "Counter", "declarator": "errorsCounter", "var_name": "errorsCounter"}], "methods": [{"identifier": "BulkWriteResultAckFlow", "parameters": "(final ActorRef updaterShard)", "modifiers": "private", "return": "", "signature": " BulkWriteResultAckFlow(final ActorRef updaterShard)", "full_signature": "private  BulkWriteResultAckFlow(final ActorRef updaterShard)", "class_method_signature": "BulkWriteResultAckFlow.BulkWriteResultAckFlow(final ActorRef updaterShard)", "testcase": false, "constructor": true}, {"identifier": "of", "parameters": "(final ActorRef updaterShard)", "modifiers": "static", "return": "BulkWriteResultAckFlow", "signature": "BulkWriteResultAckFlow of(final ActorRef updaterShard)", "full_signature": "static BulkWriteResultAckFlow of(final ActorRef updaterShard)", "class_method_signature": "BulkWriteResultAckFlow.of(final ActorRef updaterShard)", "testcase": false, "constructor": false}, {"identifier": "start", "parameters": "()", "modifiers": "", "return": "Flow<WriteResultAndErrors, String, NotUsed>", "signature": "Flow<WriteResultAndErrors, String, NotUsed> start()", "full_signature": " Flow<WriteResultAndErrors, String, NotUsed> start()", "class_method_signature": "BulkWriteResultAckFlow.start()", "testcase": false, "constructor": false}, {"identifier": "checkBulkWriteResult", "parameters": "(final WriteResultAndErrors writeResultAndErrors)", "modifiers": "private", "return": "Iterable<String>", "signature": "Iterable<String> checkBulkWriteResult(final WriteResultAndErrors writeResultAndErrors)", "full_signature": "private Iterable<String> checkBulkWriteResult(final WriteResultAndErrors writeResultAndErrors)", "class_method_signature": "BulkWriteResultAckFlow.checkBulkWriteResult(final WriteResultAndErrors writeResultAndErrors)", "testcase": false, "constructor": false}, {"identifier": "acknowledgeFailures", "parameters": "(final List<Metadata> things)", "modifiers": "private", "return": "void", "signature": "void acknowledgeFailures(final List<Metadata> things)", "full_signature": "private void acknowledgeFailures(final List<Metadata> things)", "class_method_signature": "BulkWriteResultAckFlow.acknowledgeFailures(final List<Metadata> things)", "testcase": false, "constructor": false}, {"identifier": "acknowledge", "parameters": "(final List<Metadata> things,\n            final Function<Metadata, UpdateThingResponse> responseCreator)", "modifiers": "private", "return": "void", "signature": "void acknowledge(final List<Metadata> things,\n            final Function<Metadata, UpdateThingResponse> responseCreator)", "full_signature": "private void acknowledge(final List<Metadata> things,\n            final Function<Metadata, UpdateThingResponse> responseCreator)", "class_method_signature": "BulkWriteResultAckFlow.acknowledge(final List<Metadata> things,\n            final Function<Metadata, UpdateThingResponse> responseCreator)", "testcase": false, "constructor": false}, {"identifier": "createFailureResponse", "parameters": "(final Metadata metadata)", "modifiers": "private static", "return": "UpdateThingResponse", "signature": "UpdateThingResponse createFailureResponse(final Metadata metadata)", "full_signature": "private static UpdateThingResponse createFailureResponse(final Metadata metadata)", "class_method_signature": "BulkWriteResultAckFlow.createFailureResponse(final Metadata metadata)", "testcase": false, "constructor": false}, {"identifier": "createResponse", "parameters": "(final Metadata metadata, final boolean isSuccess)", "modifiers": "private static", "return": "UpdateThingResponse", "signature": "UpdateThingResponse createResponse(final Metadata metadata, final boolean isSuccess)", "full_signature": "private static UpdateThingResponse createResponse(final Metadata metadata, final boolean isSuccess)", "class_method_signature": "BulkWriteResultAckFlow.createResponse(final Metadata metadata, final boolean isSuccess)", "testcase": false, "constructor": false}, {"identifier": "wasNotAcknowledged", "parameters": "(final WriteResultAndErrors writeResultAndErrors)", "modifiers": "private static", "return": "boolean", "signature": "boolean wasNotAcknowledged(final WriteResultAndErrors writeResultAndErrors)", "full_signature": "private static boolean wasNotAcknowledged(final WriteResultAndErrors writeResultAndErrors)", "class_method_signature": "BulkWriteResultAckFlow.wasNotAcknowledged(final WriteResultAndErrors writeResultAndErrors)", "testcase": false, "constructor": false}, {"identifier": "checkForConsistencyError", "parameters": "(final WriteResultAndErrors resultAndErrors)", "modifiers": "private static", "return": "Optional<String>", "signature": "Optional<String> checkForConsistencyError(final WriteResultAndErrors resultAndErrors)", "full_signature": "private static Optional<String> checkForConsistencyError(final WriteResultAndErrors resultAndErrors)", "class_method_signature": "BulkWriteResultAckFlow.checkForConsistencyError(final WriteResultAndErrors resultAndErrors)", "testcase": false, "constructor": false}, {"identifier": "areAllIndexesWithinBounds", "parameters": "(final List<BulkWriteError> bulkWriteErrors, final int requested)", "modifiers": "private static", "return": "boolean", "signature": "boolean areAllIndexesWithinBounds(final List<BulkWriteError> bulkWriteErrors, final int requested)", "full_signature": "private static boolean areAllIndexesWithinBounds(final List<BulkWriteError> bulkWriteErrors, final int requested)", "class_method_signature": "BulkWriteResultAckFlow.areAllIndexesWithinBounds(final List<BulkWriteError> bulkWriteErrors, final int requested)", "testcase": false, "constructor": false}, {"identifier": "getAllThings", "parameters": "(final WriteResultAndErrors writeResultAndErrors)", "modifiers": "private static", "return": "List<Metadata>", "signature": "List<Metadata> getAllThings(final WriteResultAndErrors writeResultAndErrors)", "full_signature": "private static List<Metadata> getAllThings(final WriteResultAndErrors writeResultAndErrors)", "class_method_signature": "BulkWriteResultAckFlow.getAllThings(final WriteResultAndErrors writeResultAndErrors)", "testcase": false, "constructor": false}, {"identifier": "logResult", "parameters": "(final String status, final WriteResultAndErrors writeResultAndErrors,\n            final boolean isCompleteSuccess)", "modifiers": "private static", "return": "String", "signature": "String logResult(final String status, final WriteResultAndErrors writeResultAndErrors,\n            final boolean isCompleteSuccess)", "full_signature": "private static String logResult(final String status, final WriteResultAndErrors writeResultAndErrors,\n            final boolean isCompleteSuccess)", "class_method_signature": "BulkWriteResultAckFlow.logResult(final String status, final WriteResultAndErrors writeResultAndErrors,\n            final boolean isCompleteSuccess)", "testcase": false, "constructor": false}], "file": "services/thingsearch/persistence/src/main/java/org/eclipse/ditto/services/thingsearch/persistence/write/streaming/BulkWriteResultAckFlow.java"}, "focal_method": {"identifier": "of", "parameters": "(final ActorRef updaterShard)", "modifiers": "static", "return": "BulkWriteResultAckFlow", "body": "static BulkWriteResultAckFlow of(final ActorRef updaterShard) {\n        return new BulkWriteResultAckFlow(updaterShard);\n    }", "signature": "BulkWriteResultAckFlow of(final ActorRef updaterShard)", "full_signature": "static BulkWriteResultAckFlow of(final ActorRef updaterShard)", "class_method_signature": "BulkWriteResultAckFlow.of(final ActorRef updaterShard)", "testcase": false, "constructor": false, "invocations": []}, "repository": {"repo_id": 87849739, "url": "https://github.com/eclipse/ditto", "stars": 139, "created": "4/10/2017 7:29:57 PM +00:00", "updates": "2020-01-27T14:02:39+00:00", "fork": "False", "license": "licensed"}}