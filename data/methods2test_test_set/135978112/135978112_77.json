{"test_class": {"identifier": "WorkerCoordinatorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String LEADER_URL = \"leaderUrl:8083\";", "modifier": "private static final", "type": "String", "declarator": "LEADER_URL = \"leaderUrl:8083\"", "var_name": "LEADER_URL"}, {"original_string": "private static final String MEMBER_URL = \"memberUrl:8083\";", "modifier": "private static final", "type": "String", "declarator": "MEMBER_URL = \"memberUrl:8083\"", "var_name": "MEMBER_URL"}, {"original_string": "private String connectorId = \"connector\";", "modifier": "private", "type": "String", "declarator": "connectorId = \"connector\"", "var_name": "connectorId"}, {"original_string": "private String connectorId2 = \"connector2\";", "modifier": "private", "type": "String", "declarator": "connectorId2 = \"connector2\"", "var_name": "connectorId2"}, {"original_string": "private ConnectorTaskId taskId0 = new ConnectorTaskId(connectorId, 0);", "modifier": "private", "type": "ConnectorTaskId", "declarator": "taskId0 = new ConnectorTaskId(connectorId, 0)", "var_name": "taskId0"}, {"original_string": "private ConnectorTaskId taskId1 = new ConnectorTaskId(connectorId, 1);", "modifier": "private", "type": "ConnectorTaskId", "declarator": "taskId1 = new ConnectorTaskId(connectorId, 1)", "var_name": "taskId1"}, {"original_string": "private ConnectorTaskId taskId2 = new ConnectorTaskId(connectorId2, 0);", "modifier": "private", "type": "ConnectorTaskId", "declarator": "taskId2 = new ConnectorTaskId(connectorId2, 0)", "var_name": "taskId2"}, {"original_string": "private String groupId = \"test-group\";", "modifier": "private", "type": "String", "declarator": "groupId = \"test-group\"", "var_name": "groupId"}, {"original_string": "private int sessionTimeoutMs = 10;", "modifier": "private", "type": "int", "declarator": "sessionTimeoutMs = 10", "var_name": "sessionTimeoutMs"}, {"original_string": "private int heartbeatIntervalMs = 2;", "modifier": "private", "type": "int", "declarator": "heartbeatIntervalMs = 2", "var_name": "heartbeatIntervalMs"}, {"original_string": "private long retryBackoffMs = 100;", "modifier": "private", "type": "long", "declarator": "retryBackoffMs = 100", "var_name": "retryBackoffMs"}, {"original_string": "private MockTime time;", "modifier": "private", "type": "MockTime", "declarator": "time", "var_name": "time"}, {"original_string": "private MockClient client;", "modifier": "private", "type": "MockClient", "declarator": "client", "var_name": "client"}, {"original_string": "private Cluster cluster = TestUtils.singletonCluster(\"topic\", 1);", "modifier": "private", "type": "Cluster", "declarator": "cluster = TestUtils.singletonCluster(\"topic\", 1)", "var_name": "cluster"}, {"original_string": "private Node node = cluster.nodes().get(0);", "modifier": "private", "type": "Node", "declarator": "node = cluster.nodes().get(0)", "var_name": "node"}, {"original_string": "private Metadata metadata;", "modifier": "private", "type": "Metadata", "declarator": "metadata", "var_name": "metadata"}, {"original_string": "private Metrics metrics;", "modifier": "private", "type": "Metrics", "declarator": "metrics", "var_name": "metrics"}, {"original_string": "private ConsumerNetworkClient consumerClient;", "modifier": "private", "type": "ConsumerNetworkClient", "declarator": "consumerClient", "var_name": "consumerClient"}, {"original_string": "private MockRebalanceListener rebalanceListener;", "modifier": "private", "type": "MockRebalanceListener", "declarator": "rebalanceListener", "var_name": "rebalanceListener"}, {"original_string": "@Mock private KafkaConfigBackingStore configStorage;", "modifier": "@Mock private", "type": "KafkaConfigBackingStore", "declarator": "configStorage", "var_name": "configStorage"}, {"original_string": "private WorkerCoordinator coordinator;", "modifier": "private", "type": "WorkerCoordinator", "declarator": "coordinator", "var_name": "coordinator"}, {"original_string": "private ClusterConfigState configState1;", "modifier": "private", "type": "ClusterConfigState", "declarator": "configState1", "var_name": "configState1"}, {"original_string": "private ClusterConfigState configState2;", "modifier": "private", "type": "ClusterConfigState", "declarator": "configState2", "var_name": "configState2"}], "file": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerCoordinatorTest.java"}, "test_case": {"identifier": "testMetadata", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testMetadata() {\n        EasyMock.expect(configStorage.snapshot()).andReturn(configState1);\n\n        PowerMock.replayAll();\n\n        List<ProtocolMetadata> serialized = coordinator.metadata();\n        assertEquals(1, serialized.size());\n\n        ProtocolMetadata defaultMetadata = serialized.get(0);\n        assertEquals(WorkerCoordinator.DEFAULT_SUBPROTOCOL, defaultMetadata.name());\n        ConnectProtocol.WorkerState state = ConnectProtocol.deserializeMetadata(defaultMetadata.metadata());\n        assertEquals(1, state.offset());\n\n        PowerMock.verifyAll();\n    }", "signature": "void testMetadata()", "full_signature": "@Test public void testMetadata()", "class_method_signature": "WorkerCoordinatorTest.testMetadata()", "testcase": true, "constructor": false, "invocations": ["andReturn", "expect", "snapshot", "replayAll", "metadata", "assertEquals", "size", "get", "assertEquals", "name", "deserializeMetadata", "metadata", "assertEquals", "offset", "verifyAll"]}, "focal_class": {"identifier": "WorkerCoordinator", "superclass": "extends AbstractCoordinator", "interfaces": "implements Closeable", "fields": [{"original_string": "private static final Logger log = LoggerFactory.getLogger(WorkerCoordinator.class);", "modifier": "private static final", "type": "Logger", "declarator": "log = LoggerFactory.getLogger(WorkerCoordinator.class)", "var_name": "log"}, {"original_string": "public static final String DEFAULT_SUBPROTOCOL = \"default\";", "modifier": "public static final", "type": "String", "declarator": "DEFAULT_SUBPROTOCOL = \"default\"", "var_name": "DEFAULT_SUBPROTOCOL"}, {"original_string": "private final String restUrl;", "modifier": "private final", "type": "String", "declarator": "restUrl", "var_name": "restUrl"}, {"original_string": "private final ConfigBackingStore configStorage;", "modifier": "private final", "type": "ConfigBackingStore", "declarator": "configStorage", "var_name": "configStorage"}, {"original_string": "private ConnectProtocol.Assignment assignmentSnapshot;", "modifier": "private", "type": "ConnectProtocol.Assignment", "declarator": "assignmentSnapshot", "var_name": "assignmentSnapshot"}, {"original_string": "private final WorkerCoordinatorMetrics sensors;", "modifier": "private final", "type": "WorkerCoordinatorMetrics", "declarator": "sensors", "var_name": "sensors"}, {"original_string": "private ClusterConfigState configSnapshot;", "modifier": "private", "type": "ClusterConfigState", "declarator": "configSnapshot", "var_name": "configSnapshot"}, {"original_string": "private final WorkerRebalanceListener listener;", "modifier": "private final", "type": "WorkerRebalanceListener", "declarator": "listener", "var_name": "listener"}, {"original_string": "private LeaderState leaderState;", "modifier": "private", "type": "LeaderState", "declarator": "leaderState", "var_name": "leaderState"}, {"original_string": "private boolean rejoinRequested;", "modifier": "private", "type": "boolean", "declarator": "rejoinRequested", "var_name": "rejoinRequested"}], "methods": [{"identifier": "WorkerCoordinator", "parameters": "(ConsumerNetworkClient client,\n                             String groupId,\n                             int sessionTimeoutMs,\n                             int heartbeatIntervalMs,\n                             Metrics metrics,\n                             String metricGrpPrefix,\n                             Time time,\n                             long retryBackoffMs,\n                             String restUrl,\n                             ConfigBackingStore configStorage,\n                             WorkerRebalanceListener listener)", "modifiers": "public", "return": "", "signature": " WorkerCoordinator(ConsumerNetworkClient client,\n                             String groupId,\n                             int sessionTimeoutMs,\n                             int heartbeatIntervalMs,\n                             Metrics metrics,\n                             String metricGrpPrefix,\n                             Time time,\n                             long retryBackoffMs,\n                             String restUrl,\n                             ConfigBackingStore configStorage,\n                             WorkerRebalanceListener listener)", "full_signature": "public  WorkerCoordinator(ConsumerNetworkClient client,\n                             String groupId,\n                             int sessionTimeoutMs,\n                             int heartbeatIntervalMs,\n                             Metrics metrics,\n                             String metricGrpPrefix,\n                             Time time,\n                             long retryBackoffMs,\n                             String restUrl,\n                             ConfigBackingStore configStorage,\n                             WorkerRebalanceListener listener)", "class_method_signature": "WorkerCoordinator.WorkerCoordinator(ConsumerNetworkClient client,\n                             String groupId,\n                             int sessionTimeoutMs,\n                             int heartbeatIntervalMs,\n                             Metrics metrics,\n                             String metricGrpPrefix,\n                             Time time,\n                             long retryBackoffMs,\n                             String restUrl,\n                             ConfigBackingStore configStorage,\n                             WorkerRebalanceListener listener)", "testcase": false, "constructor": true}, {"identifier": "requestRejoin", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void requestRejoin()", "full_signature": "public void requestRejoin()", "class_method_signature": "WorkerCoordinator.requestRejoin()", "testcase": false, "constructor": false}, {"identifier": "protocolType", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String protocolType()", "full_signature": "@Override public String protocolType()", "class_method_signature": "WorkerCoordinator.protocolType()", "testcase": false, "constructor": false}, {"identifier": "metadata", "parameters": "()", "modifiers": "@Override public", "return": "List<ProtocolMetadata>", "signature": "List<ProtocolMetadata> metadata()", "full_signature": "@Override public List<ProtocolMetadata> metadata()", "class_method_signature": "WorkerCoordinator.metadata()", "testcase": false, "constructor": false}, {"identifier": "onJoinComplete", "parameters": "(int generation, String memberId, String protocol, ByteBuffer memberAssignment)", "modifiers": "@Override protected", "return": "void", "signature": "void onJoinComplete(int generation, String memberId, String protocol, ByteBuffer memberAssignment)", "full_signature": "@Override protected void onJoinComplete(int generation, String memberId, String protocol, ByteBuffer memberAssignment)", "class_method_signature": "WorkerCoordinator.onJoinComplete(int generation, String memberId, String protocol, ByteBuffer memberAssignment)", "testcase": false, "constructor": false}, {"identifier": "performAssignment", "parameters": "(String leaderId, String protocol, Map<String, ByteBuffer> allMemberMetadata)", "modifiers": "@Override protected", "return": "Map<String, ByteBuffer>", "signature": "Map<String, ByteBuffer> performAssignment(String leaderId, String protocol, Map<String, ByteBuffer> allMemberMetadata)", "full_signature": "@Override protected Map<String, ByteBuffer> performAssignment(String leaderId, String protocol, Map<String, ByteBuffer> allMemberMetadata)", "class_method_signature": "WorkerCoordinator.performAssignment(String leaderId, String protocol, Map<String, ByteBuffer> allMemberMetadata)", "testcase": false, "constructor": false}, {"identifier": "findMaxMemberConfigOffset", "parameters": "(Map<String, ConnectProtocol.WorkerState> allConfigs)", "modifiers": "private", "return": "long", "signature": "long findMaxMemberConfigOffset(Map<String, ConnectProtocol.WorkerState> allConfigs)", "full_signature": "private long findMaxMemberConfigOffset(Map<String, ConnectProtocol.WorkerState> allConfigs)", "class_method_signature": "WorkerCoordinator.findMaxMemberConfigOffset(Map<String, ConnectProtocol.WorkerState> allConfigs)", "testcase": false, "constructor": false}, {"identifier": "ensureLeaderConfig", "parameters": "(long maxOffset)", "modifiers": "private", "return": "Long", "signature": "Long ensureLeaderConfig(long maxOffset)", "full_signature": "private Long ensureLeaderConfig(long maxOffset)", "class_method_signature": "WorkerCoordinator.ensureLeaderConfig(long maxOffset)", "testcase": false, "constructor": false}, {"identifier": "performTaskAssignment", "parameters": "(String leaderId, long maxOffset, Map<String, ConnectProtocol.WorkerState> allConfigs)", "modifiers": "private", "return": "Map<String, ByteBuffer>", "signature": "Map<String, ByteBuffer> performTaskAssignment(String leaderId, long maxOffset, Map<String, ConnectProtocol.WorkerState> allConfigs)", "full_signature": "private Map<String, ByteBuffer> performTaskAssignment(String leaderId, long maxOffset, Map<String, ConnectProtocol.WorkerState> allConfigs)", "class_method_signature": "WorkerCoordinator.performTaskAssignment(String leaderId, long maxOffset, Map<String, ConnectProtocol.WorkerState> allConfigs)", "testcase": false, "constructor": false}, {"identifier": "fillAssignmentsAndSerialize", "parameters": "(Collection<String> members,\n                                                                short error,\n                                                                String leaderId,\n                                                                String leaderUrl,\n                                                                long maxOffset,\n                                                                Map<String, List<String>> connectorAssignments,\n                                                                Map<String, List<ConnectorTaskId>> taskAssignments)", "modifiers": "private", "return": "Map<String, ByteBuffer>", "signature": "Map<String, ByteBuffer> fillAssignmentsAndSerialize(Collection<String> members,\n                                                                short error,\n                                                                String leaderId,\n                                                                String leaderUrl,\n                                                                long maxOffset,\n                                                                Map<String, List<String>> connectorAssignments,\n                                                                Map<String, List<ConnectorTaskId>> taskAssignments)", "full_signature": "private Map<String, ByteBuffer> fillAssignmentsAndSerialize(Collection<String> members,\n                                                                short error,\n                                                                String leaderId,\n                                                                String leaderUrl,\n                                                                long maxOffset,\n                                                                Map<String, List<String>> connectorAssignments,\n                                                                Map<String, List<ConnectorTaskId>> taskAssignments)", "class_method_signature": "WorkerCoordinator.fillAssignmentsAndSerialize(Collection<String> members,\n                                                                short error,\n                                                                String leaderId,\n                                                                String leaderUrl,\n                                                                long maxOffset,\n                                                                Map<String, List<String>> connectorAssignments,\n                                                                Map<String, List<ConnectorTaskId>> taskAssignments)", "testcase": false, "constructor": false}, {"identifier": "onJoinPrepare", "parameters": "(int generation, String memberId)", "modifiers": "@Override protected", "return": "void", "signature": "void onJoinPrepare(int generation, String memberId)", "full_signature": "@Override protected void onJoinPrepare(int generation, String memberId)", "class_method_signature": "WorkerCoordinator.onJoinPrepare(int generation, String memberId)", "testcase": false, "constructor": false}, {"identifier": "needRejoin", "parameters": "()", "modifiers": "@Override public", "return": "boolean", "signature": "boolean needRejoin()", "full_signature": "@Override public boolean needRejoin()", "class_method_signature": "WorkerCoordinator.needRejoin()", "testcase": false, "constructor": false}, {"identifier": "memberId", "parameters": "()", "modifiers": "public", "return": "String", "signature": "String memberId()", "full_signature": "public String memberId()", "class_method_signature": "WorkerCoordinator.memberId()", "testcase": false, "constructor": false}, {"identifier": "close", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void close()", "full_signature": "@Override public void close()", "class_method_signature": "WorkerCoordinator.close()", "testcase": false, "constructor": false}, {"identifier": "isLeader", "parameters": "()", "modifiers": "private", "return": "boolean", "signature": "boolean isLeader()", "full_signature": "private boolean isLeader()", "class_method_signature": "WorkerCoordinator.isLeader()", "testcase": false, "constructor": false}, {"identifier": "ownerUrl", "parameters": "(String connector)", "modifiers": "public", "return": "String", "signature": "String ownerUrl(String connector)", "full_signature": "public String ownerUrl(String connector)", "class_method_signature": "WorkerCoordinator.ownerUrl(String connector)", "testcase": false, "constructor": false}, {"identifier": "ownerUrl", "parameters": "(ConnectorTaskId task)", "modifiers": "public", "return": "String", "signature": "String ownerUrl(ConnectorTaskId task)", "full_signature": "public String ownerUrl(ConnectorTaskId task)", "class_method_signature": "WorkerCoordinator.ownerUrl(ConnectorTaskId task)", "testcase": false, "constructor": false}, {"identifier": "sorted", "parameters": "(Collection<T> members)", "modifiers": "private static", "return": "List<T>", "signature": "List<T> sorted(Collection<T> members)", "full_signature": "private static List<T> sorted(Collection<T> members)", "class_method_signature": "WorkerCoordinator.sorted(Collection<T> members)", "testcase": false, "constructor": false}, {"identifier": "invertAssignment", "parameters": "(Map<K, List<V>> assignment)", "modifiers": "private static", "return": "Map<V, K>", "signature": "Map<V, K> invertAssignment(Map<K, List<V>> assignment)", "full_signature": "private static Map<V, K> invertAssignment(Map<K, List<V>> assignment)", "class_method_signature": "WorkerCoordinator.invertAssignment(Map<K, List<V>> assignment)", "testcase": false, "constructor": false}], "file": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/distributed/WorkerCoordinator.java"}, "focal_method": {"identifier": "metadata", "parameters": "()", "modifiers": "@Override public", "return": "List<ProtocolMetadata>", "body": "@Override\n    public List<ProtocolMetadata> metadata() {\n        configSnapshot = configStorage.snapshot();\n        ConnectProtocol.WorkerState workerState = new ConnectProtocol.WorkerState(restUrl, configSnapshot.offset());\n        ByteBuffer metadata = ConnectProtocol.serializeMetadata(workerState);\n        return Collections.singletonList(new ProtocolMetadata(DEFAULT_SUBPROTOCOL, metadata));\n    }", "signature": "List<ProtocolMetadata> metadata()", "full_signature": "@Override public List<ProtocolMetadata> metadata()", "class_method_signature": "WorkerCoordinator.metadata()", "testcase": false, "constructor": false, "invocations": ["snapshot", "offset", "serializeMetadata", "singletonList"]}, "repository": {"repo_id": 135978112, "url": "https://github.com/anurnomeru/kafka-0.10.0.1-source-reading", "language": "Java", "is_fork": false, "fork_count": 1, "stargazer_count": 7, "size": 2953, "license": "licensed"}}