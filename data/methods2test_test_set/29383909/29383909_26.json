{"test_class": {"identifier": "DagBuilderTest", "superclass": "", "interfaces": "", "fields": [], "file": "karamel-core/src/test/java/se/kth/karamel/backend/running/model/tasks/DagBuilderTest.java"}, "test_case": {"identifier": "testFlinkDag", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testFlinkDag() throws IOException, KaramelException {\n    TaskSubmitter dummyTaskSubmitter = new TaskSubmitter() {\n\n      @Override\n      public void submitTask(Task task) throws KaramelException {\n        System.out.println(task.uniqueId());\n        task.succeed();\n      }\n\n      @Override\n      public void prepareToStart(Task task) throws KaramelException {\n      }\n\n      @Override\n      public void killMe(Task task) throws KaramelException {\n      }\n\n      @Override\n      public void retryMe(Task task) throws KaramelException {\n      }\n\n      @Override\n      public void skipMe(Task task) throws KaramelException {\n      }\n\n      @Override\n      public void terminate(Task task) throws KaramelException {\n      }\n    };\n\n    Settings.CB_CLASSPATH_MODE = true;\n    Confs confs = new Confs();\n    confs.put(Settings.PREPARE_STORAGES_KEY, \"false\");\n    Confs.setMemConfs(confs);\n\n    String ymlString = Resources.toString(Resources.getResource(\"se/kth/karamel/client/model/test-definitions/flink.yml\"), Charsets.UTF_8);\n    JsonCluster definition = ClusterDefinitionService.yamlToJsonObject(ymlString);\n    ClusterRuntime dummyRuntime = MockingUtil.dummyRuntime(definition);\n    Map<String, JsonObject> chefJsons = ChefJsonGenerator.generateClusterChefJsonsForInstallation(definition, dummyRuntime);\n    ClusterStats clusterStats = new ClusterStats();\n    Dag dag = DagBuilder.getInstallationDag(definition, dummyRuntime, clusterStats, dummyTaskSubmitter, chefJsons);\n    dag.validate();\n    System.out.println(dag.print());\n\n    Assert.assertTrue(dag.isRoot(\"find os-type on namenodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"find os-type on namenodes1\", \"apt-get essentials on namenodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"install chefdk on namenodes1\", \"make solo.rb on namenodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"make solo.rb on namenodes1\", \"clone and vendor https://github.com/testorg/testrepo/tree/master/cookbooks/flink-chef on namenodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"clone and vendor https://github.com/testorg/testrepo/tree/master/cookbooks/flink-chef on namenodes1\", \"flink::install on namenodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"flink::install on namenodes1\", \"flink::jobmanager on namenodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"flink::install on namenodes1\", \"flink::wordcount on namenodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"hadoop::install on namenodes1\", \"hadoop::nn on namenodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"hadoop::install on namenodes1\", \"flink::install on namenodes1\"));\n\n    Assert.assertTrue(dag.isRoot(\"find os-type on datanodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"find os-type on datanodes1\", \"apt-get essentials on datanodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"install chefdk on datanodes1\", \"make solo.rb on datanodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"make solo.rb on datanodes1\", \"clone and vendor https://github.com/testorg/testrepo/tree/master/cookbooks/flink-chef on datanodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"clone and vendor https://github.com/testorg/testrepo/tree/master/cookbooks/flink-chef on datanodes1\", \"flink::install on datanodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"flink::install on datanodes1\", \"flink::taskmanager on datanodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"hadoop::install on datanodes1\", \"hadoop::dn on datanodes1\"));\n    Assert.assertTrue(dag.hasDependency(\"hadoop::install on datanodes1\", \"flink::install on datanodes1\"));\n\n    Assert.assertTrue(dag.isRoot(\"find os-type on datanodes2\"));\n    Assert.assertTrue(dag.hasDependency(\"find os-type on datanodes2\", \"apt-get essentials on datanodes2\"));\n    Assert.assertTrue(dag.hasDependency(\"install chefdk on datanodes2\", \"make solo.rb on datanodes2\"));\n    Assert.assertTrue(dag.hasDependency(\"make solo.rb on datanodes2\", \"clone and vendor https://github.com/testorg/testrepo/tree/master/cookbooks/flink-chef on datanodes2\"));\n    Assert.assertTrue(dag.hasDependency(\"clone and vendor https://github.com/testorg/testrepo/tree/master/cookbooks/flink-chef on datanodes2\", \"flink::install on datanodes2\"));\n    Assert.assertTrue(dag.hasDependency(\"flink::install on datanodes2\", \"flink::taskmanager on datanodes2\"));\n    Assert.assertTrue(dag.hasDependency(\"hadoop::install on datanodes2\", \"hadoop::dn on datanodes2\"));\n    Assert.assertTrue(dag.hasDependency(\"hadoop::install on datanodes2\", \"flink::install on datanodes2\"));\n  }", "signature": "void testFlinkDag()", "full_signature": "@Test public void testFlinkDag()", "class_method_signature": "DagBuilderTest.testFlinkDag()", "testcase": true, "constructor": false, "invocations": ["println", "uniqueId", "succeed", "put", "setMemConfs", "toString", "getResource", "yamlToJsonObject", "dummyRuntime", "generateClusterChefJsonsForInstallation", "getInstallationDag", "validate", "println", "print", "assertTrue", "isRoot", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "isRoot", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "isRoot", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency", "assertTrue", "hasDependency"]}, "focal_class": {"identifier": "DagBuilder", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger logger = Logger.getLogger(DagBuilder.class);", "modifier": "private static final", "type": "Logger", "declarator": "logger = Logger.getLogger(DagBuilder.class)", "var_name": "logger"}], "methods": [{"identifier": "getPurgingDag", "parameters": "(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "modifiers": "public static", "return": "Dag", "signature": "Dag getPurgingDag(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "full_signature": "public static Dag getPurgingDag(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "class_method_signature": "DagBuilder.getPurgingDag(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "testcase": false, "constructor": false}, {"identifier": "getInstallationDag", "parameters": "(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "modifiers": "public static", "return": "Dag", "signature": "Dag getInstallationDag(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "full_signature": "public static Dag getInstallationDag(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "class_method_signature": "DagBuilder.getInstallationDag(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "testcase": false, "constructor": false}, {"identifier": "updateKaramelDependencies", "parameters": "(Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      Map<String, Map<String, Task>> rlts)", "modifiers": "private static", "return": "boolean", "signature": "boolean updateKaramelDependencies(Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      Map<String, Map<String, Task>> rlts)", "full_signature": "private static boolean updateKaramelDependencies(Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      Map<String, Map<String, Task>> rlts)", "class_method_signature": "DagBuilder.updateKaramelDependencies(Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      Map<String, Map<String, Task>> rlts)", "testcase": false, "constructor": false}, {"identifier": "recipeLevelTasks", "parameters": "(JsonCluster cluster, ClusterRuntime clusterEntity,\n      ClusterStats clusterStats, Map<String, JsonObject> chefJsons, TaskSubmitter submitter,\n      Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "modifiers": "public static", "return": "Map<String, Map<String, Task>>", "signature": "Map<String, Map<String, Task>> recipeLevelTasks(JsonCluster cluster, ClusterRuntime clusterEntity,\n      ClusterStats clusterStats, Map<String, JsonObject> chefJsons, TaskSubmitter submitter,\n      Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "full_signature": "public static Map<String, Map<String, Task>> recipeLevelTasks(JsonCluster cluster, ClusterRuntime clusterEntity,\n      ClusterStats clusterStats, Map<String, JsonObject> chefJsons, TaskSubmitter submitter,\n      Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "class_method_signature": "DagBuilder.recipeLevelTasks(JsonCluster cluster, ClusterRuntime clusterEntity,\n      ClusterStats clusterStats, Map<String, JsonObject> chefJsons, TaskSubmitter submitter,\n      Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "testcase": false, "constructor": false}, {"identifier": "addRecipeTaskForMachineIntoRecipesMap", "parameters": "(String recipeName, MachineRuntime machine,\n      ClusterStats clusterStats, Map<String, Map<String, Task>> map, JsonObject chefJson, TaskSubmitter submitter,\n      String cookbookId, String cookbookName, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "modifiers": "private static", "return": "RunRecipeTask", "signature": "RunRecipeTask addRecipeTaskForMachineIntoRecipesMap(String recipeName, MachineRuntime machine,\n      ClusterStats clusterStats, Map<String, Map<String, Task>> map, JsonObject chefJson, TaskSubmitter submitter,\n      String cookbookId, String cookbookName, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "full_signature": "private static RunRecipeTask addRecipeTaskForMachineIntoRecipesMap(String recipeName, MachineRuntime machine,\n      ClusterStats clusterStats, Map<String, Map<String, Task>> map, JsonObject chefJson, TaskSubmitter submitter,\n      String cookbookId, String cookbookName, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "class_method_signature": "DagBuilder.addRecipeTaskForMachineIntoRecipesMap(String recipeName, MachineRuntime machine,\n      ClusterStats clusterStats, Map<String, Map<String, Task>> map, JsonObject chefJson, TaskSubmitter submitter,\n      String cookbookId, String cookbookName, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "testcase": false, "constructor": false}, {"identifier": "makeRecipeTaskIfNotExist", "parameters": "(String recipeName, MachineRuntime machine,\n      ClusterStats clusterStats, JsonObject chefJson,\n      TaskSubmitter submitter, String cookbookId, String cookbookName, Map<String, RunRecipeTask> allRecipeTasks,\n      Dag dag, List<KaramelizedCookbook> rootCookbooks)", "modifiers": "private static", "return": "RunRecipeTask", "signature": "RunRecipeTask makeRecipeTaskIfNotExist(String recipeName, MachineRuntime machine,\n      ClusterStats clusterStats, JsonObject chefJson,\n      TaskSubmitter submitter, String cookbookId, String cookbookName, Map<String, RunRecipeTask> allRecipeTasks,\n      Dag dag, List<KaramelizedCookbook> rootCookbooks)", "full_signature": "private static RunRecipeTask makeRecipeTaskIfNotExist(String recipeName, MachineRuntime machine,\n      ClusterStats clusterStats, JsonObject chefJson,\n      TaskSubmitter submitter, String cookbookId, String cookbookName, Map<String, RunRecipeTask> allRecipeTasks,\n      Dag dag, List<KaramelizedCookbook> rootCookbooks)", "class_method_signature": "DagBuilder.makeRecipeTaskIfNotExist(String recipeName, MachineRuntime machine,\n      ClusterStats clusterStats, JsonObject chefJson,\n      TaskSubmitter submitter, String cookbookId, String cookbookName, Map<String, RunRecipeTask> allRecipeTasks,\n      Dag dag, List<KaramelizedCookbook> rootCookbooks)", "testcase": false, "constructor": false}, {"identifier": "cookbookLevelPurgingTasks", "parameters": "(JsonCluster cluster,\n      ClusterRuntime clusterEntity, ClusterStats clusterStats, Map<String, JsonObject> chefJsons,\n      TaskSubmitter submitter, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "modifiers": "public static", "return": "Map<String, Map<String, Task>>", "signature": "Map<String, Map<String, Task>> cookbookLevelPurgingTasks(JsonCluster cluster,\n      ClusterRuntime clusterEntity, ClusterStats clusterStats, Map<String, JsonObject> chefJsons,\n      TaskSubmitter submitter, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "full_signature": "public static Map<String, Map<String, Task>> cookbookLevelPurgingTasks(JsonCluster cluster,\n      ClusterRuntime clusterEntity, ClusterStats clusterStats, Map<String, JsonObject> chefJsons,\n      TaskSubmitter submitter, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "class_method_signature": "DagBuilder.cookbookLevelPurgingTasks(JsonCluster cluster,\n      ClusterRuntime clusterEntity, ClusterStats clusterStats, Map<String, JsonObject> chefJsons,\n      TaskSubmitter submitter, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "testcase": false, "constructor": false}, {"identifier": "cookbookLevelInstallationTasks", "parameters": "(JsonCluster cluster,\n      ClusterRuntime clusterEntity, ClusterStats clusterStats, Map<String, JsonObject> chefJsons,\n      TaskSubmitter submitter, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "modifiers": "public static", "return": "Map<String, Map<String, Task>>", "signature": "Map<String, Map<String, Task>> cookbookLevelInstallationTasks(JsonCluster cluster,\n      ClusterRuntime clusterEntity, ClusterStats clusterStats, Map<String, JsonObject> chefJsons,\n      TaskSubmitter submitter, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "full_signature": "public static Map<String, Map<String, Task>> cookbookLevelInstallationTasks(JsonCluster cluster,\n      ClusterRuntime clusterEntity, ClusterStats clusterStats, Map<String, JsonObject> chefJsons,\n      TaskSubmitter submitter, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "class_method_signature": "DagBuilder.cookbookLevelInstallationTasks(JsonCluster cluster,\n      ClusterRuntime clusterEntity, ClusterStats clusterStats, Map<String, JsonObject> chefJsons,\n      TaskSubmitter submitter, Map<String, RunRecipeTask> allRecipeTasks, Dag dag,\n      List<KaramelizedCookbook> rootCookbooks)", "testcase": false, "constructor": false}, {"identifier": "machineLevelTasks", "parameters": "(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Dag dag, List<KaramelizedCookbook> rootCookbooks)", "modifiers": "public static", "return": "void", "signature": "void machineLevelTasks(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Dag dag, List<KaramelizedCookbook> rootCookbooks)", "full_signature": "public static void machineLevelTasks(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Dag dag, List<KaramelizedCookbook> rootCookbooks)", "class_method_signature": "DagBuilder.machineLevelTasks(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Dag dag, List<KaramelizedCookbook> rootCookbooks)", "testcase": false, "constructor": false}], "file": "karamel-core/src/main/java/se/kth/karamel/backend/running/model/tasks/DagBuilder.java"}, "focal_method": {"identifier": "getInstallationDag", "parameters": "(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "modifiers": "public static", "return": "Dag", "body": "public static Dag getInstallationDag(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons) throws KaramelException {\n    Dag dag = new Dag();\n    Map<String, RunRecipeTask> allRecipeTasks = new HashMap<>();\n    CookbookCache cache = ClusterDefinitionService.CACHE;\n    List<KaramelizedCookbook> kcbs = cache.loadRootKaramelizedCookbooks(cluster);\n    machineLevelTasks(cluster, clusterEntity, clusterStats, submitter, dag, kcbs);\n    cookbookLevelInstallationTasks(cluster, clusterEntity, clusterStats, chefJsons, submitter, allRecipeTasks, dag,\n        kcbs);\n    Map<String, Map<String, Task>> rlts = recipeLevelTasks(cluster, clusterEntity, clusterStats, chefJsons, submitter,\n        allRecipeTasks, dag, kcbs);\n    updateKaramelDependencies(allRecipeTasks, dag, rlts);\n    return dag;\n  }", "signature": "Dag getInstallationDag(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "full_signature": "public static Dag getInstallationDag(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "class_method_signature": "DagBuilder.getInstallationDag(JsonCluster cluster, ClusterRuntime clusterEntity, ClusterStats clusterStats,\n      TaskSubmitter submitter, Map<String, JsonObject> chefJsons)", "testcase": false, "constructor": false, "invocations": ["loadRootKaramelizedCookbooks", "machineLevelTasks", "cookbookLevelInstallationTasks", "recipeLevelTasks", "updateKaramelDependencies"]}, "repository": {"repo_id": 29383909, "url": "https://github.com/karamelchef/karamel", "language": "Java", "is_fork": false, "fork_count": 17, "stargazer_count": 30, "size": 12029, "license": "licensed"}}