{"test_class": {"identifier": "MaterializedLambdaConsequenceTest", "superclass": "", "interfaces": "", "fields": [], "file": "drools-model/drools-model-compiler/src/test/java/org/drools/modelcompiler/util/lambdareplace/MaterializedLambdaConsequenceTest.java"}, "test_case": {"identifier": "createConsequenceWithMultipleFactUpdate", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void createConsequenceWithMultipleFactUpdate() {\n        ArrayList<String> personFields = new ArrayList<>();\n        personFields.add(\"\\\"name\\\"\");\n        MaterializedLambda.BitMaskVariable bitMaskPerson = new MaterializedLambda.BitMaskVariableWithFields(\"DomainClassesMetadataB45236F6195B110E0FA3A5447BC53274.org_drools_modelcompiler_domain_Person_Metadata_INSTANCE\", personFields, \"mask_$person\");\n        ArrayList<String> petFields = new ArrayList<>();\n        petFields.add(\"\\\"age\\\"\");\n        MaterializedLambda.BitMaskVariable bitMaskPet = new MaterializedLambda.BitMaskVariableWithFields(\"DomainClassesMetadataB45236F6195B110E0FA3A5447BC53274.org_drools_modelcompiler_domain_Pet_Metadata_INSTANCE\", petFields, \"mask_$pet\");\n\n        String consequenceBlock = \"(org.drools.model.Drools drools, org.drools.modelcompiler.domain.Pet $pet, org.drools.modelcompiler.domain.Person $person) -> {{ ($person).setName(\\\"George\\\");drools.update($person, mask_$person); ($pet).setAge($pet.getAge() + 1); drools.update($pet, mask_$pet); }}\";\n        CreatedClass aClass = new MaterializedLambdaConsequence(\"defaultpkg\",\n                                                                \"defaultpkg.RulesB45236F6195B110E0FA3A5447BC53274\",\n                                                                Arrays.asList(bitMaskPerson, bitMaskPet))\n                .create(consequenceBlock, new ArrayList<>(), new ArrayList<>());\n\n        //language=JAVA\n        String expectedResult = \"\" +\n                \"package defaultpkg.PB5;\\n\" +\n                \"import static defaultpkg.RulesB45236F6195B110E0FA3A5447BC53274.*; \" +\n                \"import org.drools.modelcompiler.dsl.pattern.D; \" +\n                \"\\n\"+\n                \"@org.drools.compiler.kie.builder.MaterializedLambda() \" +\n                \"public enum LambdaConsequenceB5F5DCD7BB99BCAFC00F33AF0841B8C3 implements org.drools.model.functions.Block3<org.drools.model.Drools, org.drools.modelcompiler.domain.Pet, org.drools.modelcompiler.domain.Person> {\\n\" +\n                \"\\n\" +\n                \"    INSTANCE;\\n\" +\n                \"    public static final String EXPRESSION_HASH = \\\"2ABFB3D359AC0D0C1F6C1BAF91E05544\\\";\\n\" +\n                \"    private final org.drools.model.BitMask mask_$person = org.drools.model.BitMask.getPatternMask(DomainClassesMetadataB45236F6195B110E0FA3A5447BC53274.org_drools_modelcompiler_domain_Person_Metadata_INSTANCE, \\\"name\\\");\\n\" +\n                \"\\n\" +\n                \"    private final org.drools.model.BitMask mask_$pet = org.drools.model.BitMask.getPatternMask(DomainClassesMetadataB45236F6195B110E0FA3A5447BC53274.org_drools_modelcompiler_domain_Pet_Metadata_INSTANCE, \\\"age\\\");\\n\" +\n                \"\\n\" +\n                \"    @Override()\\n\" +\n                \"    public void execute(org.drools.model.Drools drools, org.drools.modelcompiler.domain.Pet $pet, org.drools.modelcompiler.domain.Person $person) throws java.lang.Exception {\\n\" +\n                \"        {\\n\" +\n                \"            ($person).setName(\\\"George\\\");\\n\" +\n                \"            drools.update($person, mask_$person);\\n\" +\n                \"            ($pet).setAge($pet.getAge() + 1);\\n\" +\n                \"            drools.update($pet, mask_$pet);\\n\" +\n                \"        }\\n\" +\n                \"    }\\n\" +\n                \"}\";\n\n        assertThat(aClass.getCompilationUnitAsString(), equalToIgnoringWhiteSpace(expectedResult));\n    }", "signature": "void createConsequenceWithMultipleFactUpdate()", "full_signature": "@Test public void createConsequenceWithMultipleFactUpdate()", "class_method_signature": "MaterializedLambdaConsequenceTest.createConsequenceWithMultipleFactUpdate()", "testcase": true, "constructor": false, "invocations": ["add", "add", "create", "asList", "assertThat", "getCompilationUnitAsString", "equalToIgnoringWhiteSpace"]}, "focal_class": {"identifier": "MaterializedLambdaConsequence", "superclass": "extends MaterializedLambda", "interfaces": "", "fields": [{"original_string": "private final static String CLASS_NAME_PREFIX = \"LambdaConsequence\";", "modifier": "private final static", "type": "String", "declarator": "CLASS_NAME_PREFIX = \"LambdaConsequence\"", "var_name": "CLASS_NAME_PREFIX"}, {"original_string": "private final List<BitMaskVariable> bitMaskVariables;", "modifier": "private final", "type": "List<BitMaskVariable>", "declarator": "bitMaskVariables", "var_name": "bitMaskVariables"}], "methods": [{"identifier": "MaterializedLambdaConsequence", "parameters": "(String packageName, String ruleClassName, List<BitMaskVariable> bitMaskVariables)", "modifiers": "", "return": "", "signature": " MaterializedLambdaConsequence(String packageName, String ruleClassName, List<BitMaskVariable> bitMaskVariables)", "full_signature": "  MaterializedLambdaConsequence(String packageName, String ruleClassName, List<BitMaskVariable> bitMaskVariables)", "class_method_signature": "MaterializedLambdaConsequence.MaterializedLambdaConsequence(String packageName, String ruleClassName, List<BitMaskVariable> bitMaskVariables)", "testcase": false, "constructor": true}, {"identifier": "createMethodDeclaration", "parameters": "(EnumDeclaration classDeclaration)", "modifiers": "@Override", "return": "void", "signature": "void createMethodDeclaration(EnumDeclaration classDeclaration)", "full_signature": "@Override void createMethodDeclaration(EnumDeclaration classDeclaration)", "class_method_signature": "MaterializedLambdaConsequence.createMethodDeclaration(EnumDeclaration classDeclaration)", "testcase": false, "constructor": false}, {"identifier": "getPrefix", "parameters": "()", "modifiers": "@Override", "return": "String", "signature": "String getPrefix()", "full_signature": "@Override String getPrefix()", "class_method_signature": "MaterializedLambdaConsequence.getPrefix()", "testcase": false, "constructor": false}, {"identifier": "create", "parameters": "(CompilationUnit compilationUnit)", "modifiers": "@Override protected", "return": "EnumDeclaration", "signature": "EnumDeclaration create(CompilationUnit compilationUnit)", "full_signature": "@Override protected EnumDeclaration create(CompilationUnit compilationUnit)", "class_method_signature": "MaterializedLambdaConsequence.create(CompilationUnit compilationUnit)", "testcase": false, "constructor": false}, {"identifier": "isDroolsParameter", "parameters": "(LambdaParameter p)", "modifiers": "private", "return": "boolean", "signature": "boolean isDroolsParameter(LambdaParameter p)", "full_signature": "private boolean isDroolsParameter(LambdaParameter p)", "class_method_signature": "MaterializedLambdaConsequence.isDroolsParameter(LambdaParameter p)", "testcase": false, "constructor": false}, {"identifier": "functionType", "parameters": "()", "modifiers": "@Override protected", "return": "ClassOrInterfaceType", "signature": "ClassOrInterfaceType functionType()", "full_signature": "@Override protected ClassOrInterfaceType functionType()", "class_method_signature": "MaterializedLambdaConsequence.functionType()", "testcase": false, "constructor": false}], "file": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/util/lambdareplace/MaterializedLambdaConsequence.java"}, "focal_method": {"identifier": "create", "parameters": "(CompilationUnit compilationUnit)", "modifiers": "@Override protected", "return": "EnumDeclaration", "body": "@Override\n    protected EnumDeclaration create(CompilationUnit compilationUnit) {\n        EnumDeclaration lambdaClass = super.create(compilationUnit);\n\n        boolean hasDroolsParameter = lambdaParameters.stream().anyMatch(this::isDroolsParameter);\n        if (hasDroolsParameter) {\n            bitMaskVariables.forEach(vd -> vd.generateBitMaskField(lambdaClass));\n        }\n        return lambdaClass;\n    }", "signature": "EnumDeclaration create(CompilationUnit compilationUnit)", "full_signature": "@Override protected EnumDeclaration create(CompilationUnit compilationUnit)", "class_method_signature": "MaterializedLambdaConsequence.create(CompilationUnit compilationUnit)", "testcase": false, "constructor": false, "invocations": ["create", "anyMatch", "stream", "forEach", "generateBitMaskField"]}, "repository": {"repo_id": 1381673, "url": "https://github.com/kiegroup/drools", "stars": 2733, "created": "2/18/2011 8:37:05 AM +00:00", "updates": "2020-01-27T13:12:15+00:00", "fork": "False", "license": "licensed"}}