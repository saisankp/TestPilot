{"test_class": {"identifier": "DegradedRouterQueryBuilderTest", "superclass": "extends LuceneTestCase", "interfaces": "", "fields": [], "file": "extra/src/test/java/org/wikimedia/search/extra/router/DegradedRouterQueryBuilderTest.java"}, "test_case": {"identifier": "testParseExample", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testParseExample() throws IOException {\n        String json = \"{\\\"degraded_router\\\": {\\n\" +\n                \"   \\\"conditions\\\" : [\\n\" +\n                \"       {\\n\" +\n                \"           \\\"lt\\\": 70,\\n\" +\n                \"           \\\"type\\\": \\\"cpu\\\",\" +\n                \"           \\\"query\\\": {\\n\" +\n                \"               \\\"match_phrase\\\": {\\n\" +\n                \"                   \\\"text\\\": \\\"input query\\\"\\n\" +\n                \"               }\\n\" +\n                \"           }\\n\" +\n                \"       }\\n\" +\n                \"   ],\\n\" +\n                \"   \\\"fallback\\\": {\\n\" +\n                \"       \\\"match_none\\\": {}\\n\" +\n                \"   }\\n\" +\n                \"}}\";\n\n        QueryBuilder builder = QueryBuilderTestUtils.FULLY_FEATURED.parseQuery(json);\n        assertThat(builder, instanceOf(DegradedRouterQueryBuilder.class));\n        DegradedRouterQueryBuilder qb = (DegradedRouterQueryBuilder) builder;\n        assertNotNull(qb.systemLoad());\n        assertEquals(1, qb.conditionStream().count());\n        DegradedRouterQueryBuilder.DegradedCondition cond = qb.conditionStream().findFirst().get();\n        assertEquals(DegradedConditionType.cpu, cond.type());\n        assertThat(cond.query(), instanceOf(MatchPhraseQueryBuilder.class));\n        assertEquals(ConditionDefinition.lt, cond.definition());\n        assertEquals(70, cond.value());\n        assertThat(qb.fallback(), instanceOf(MatchNoneQueryBuilder.class));\n\n        DegradedRouterQueryBuilder expected = new DegradedRouterQueryBuilder();\n        expected.condition(ConditionDefinition.lt, DegradedConditionType.cpu, null, null, 70,\n                new MatchPhraseQueryBuilder(\"text\", \"input query\"));\n        expected.fallback(new MatchNoneQueryBuilder());\n        assertEquals(expected, qb);\n    }", "signature": "void testParseExample()", "full_signature": "@Test public void testParseExample()", "class_method_signature": "DegradedRouterQueryBuilderTest.testParseExample()", "testcase": true, "constructor": false, "invocations": ["parseQuery", "assertThat", "instanceOf", "assertNotNull", "systemLoad", "assertEquals", "count", "conditionStream", "get", "findFirst", "conditionStream", "assertEquals", "type", "assertThat", "query", "instanceOf", "assertEquals", "definition", "assertEquals", "value", "assertThat", "fallback", "instanceOf", "condition", "fallback", "assertEquals"]}, "focal_class": {"identifier": "DegradedRouterQueryBuilder", "superclass": "extends AbstractRouterQueryBuilder<DegradedCondition, DegradedRouterQueryBuilder>", "interfaces": "", "fields": [{"original_string": "public static final ParseField NAME = new ParseField(\"degraded_router\");", "modifier": "public static final", "type": "ParseField", "declarator": "NAME = new ParseField(\"degraded_router\")", "var_name": "NAME"}, {"original_string": "private static final ParseField TYPE = new ParseField(\"type\");", "modifier": "private static final", "type": "ParseField", "declarator": "TYPE = new ParseField(\"type\")", "var_name": "TYPE"}, {"original_string": "private static final ParseField BUCKET = new ParseField(\"bucket\");", "modifier": "private static final", "type": "ParseField", "declarator": "BUCKET = new ParseField(\"bucket\")", "var_name": "BUCKET"}, {"original_string": "private static final ParseField PERCENTILE = new ParseField(\"percentile\");", "modifier": "private static final", "type": "ParseField", "declarator": "PERCENTILE = new ParseField(\"percentile\")", "var_name": "PERCENTILE"}, {"original_string": "private static final ObjectParser<DegradedRouterQueryBuilder, Void> PARSER;", "modifier": "private static final", "type": "ObjectParser<DegradedRouterQueryBuilder, Void>", "declarator": "PARSER", "var_name": "PARSER"}, {"original_string": "private static final ObjectParser<DegradedConditionParserState, Void> COND_PARSER;", "modifier": "private static final", "type": "ObjectParser<DegradedConditionParserState, Void>", "declarator": "COND_PARSER", "var_name": "COND_PARSER"}, {"original_string": "@Nullable private SystemLoad systemLoad;", "modifier": "@Nullable private", "type": "SystemLoad", "declarator": "systemLoad", "var_name": "systemLoad"}], "methods": [{"identifier": "DegradedRouterQueryBuilder", "parameters": "()", "modifiers": "", "return": "", "signature": " DegradedRouterQueryBuilder()", "full_signature": "  DegradedRouterQueryBuilder()", "class_method_signature": "DegradedRouterQueryBuilder.DegradedRouterQueryBuilder()", "testcase": false, "constructor": true}, {"identifier": "DegradedRouterQueryBuilder", "parameters": "(StreamInput in, SystemLoad systemLoad)", "modifiers": "public", "return": "", "signature": " DegradedRouterQueryBuilder(StreamInput in, SystemLoad systemLoad)", "full_signature": "public  DegradedRouterQueryBuilder(StreamInput in, SystemLoad systemLoad)", "class_method_signature": "DegradedRouterQueryBuilder.DegradedRouterQueryBuilder(StreamInput in, SystemLoad systemLoad)", "testcase": false, "constructor": true}, {"identifier": "getWriteableName", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String getWriteableName()", "full_signature": "@Override public String getWriteableName()", "class_method_signature": "DegradedRouterQueryBuilder.getWriteableName()", "testcase": false, "constructor": false}, {"identifier": "fromXContent", "parameters": "(\n            XContentParser parser, SystemLoad systemLoad\n    )", "modifiers": "public static", "return": "DegradedRouterQueryBuilder", "signature": "DegradedRouterQueryBuilder fromXContent(\n            XContentParser parser, SystemLoad systemLoad\n    )", "full_signature": "public static DegradedRouterQueryBuilder fromXContent(\n            XContentParser parser, SystemLoad systemLoad\n    )", "class_method_signature": "DegradedRouterQueryBuilder.fromXContent(\n            XContentParser parser, SystemLoad systemLoad\n    )", "testcase": false, "constructor": false}, {"identifier": "doRewrite", "parameters": "(QueryRewriteContext context)", "modifiers": "@Override public", "return": "QueryBuilder", "signature": "QueryBuilder doRewrite(QueryRewriteContext context)", "full_signature": "@Override public QueryBuilder doRewrite(QueryRewriteContext context)", "class_method_signature": "DegradedRouterQueryBuilder.doRewrite(QueryRewriteContext context)", "testcase": false, "constructor": false}, {"identifier": "condition", "parameters": "(ConditionDefinition def, DegradedConditionType type, String bucket, Double percentile, int value, QueryBuilder query)", "modifiers": "@VisibleForTesting", "return": "void", "signature": "void condition(ConditionDefinition def, DegradedConditionType type, String bucket, Double percentile, int value, QueryBuilder query)", "full_signature": "@VisibleForTesting void condition(ConditionDefinition def, DegradedConditionType type, String bucket, Double percentile, int value, QueryBuilder query)", "class_method_signature": "DegradedRouterQueryBuilder.condition(ConditionDefinition def, DegradedConditionType type, String bucket, Double percentile, int value, QueryBuilder query)", "testcase": false, "constructor": false}], "file": "extra/src/main/java/org/wikimedia/search/extra/router/DegradedRouterQueryBuilder.java"}, "focal_method": {"identifier": "condition", "parameters": "(ConditionDefinition def, DegradedConditionType type, String bucket, Double percentile, int value, QueryBuilder query)", "modifiers": "@VisibleForTesting", "return": "void", "body": "@VisibleForTesting\n    void condition(ConditionDefinition def, DegradedConditionType type, String bucket, Double percentile, int value, QueryBuilder query) {\n        condition(new DegradedCondition(def, type, bucket, percentile, value, query));\n    }", "signature": "void condition(ConditionDefinition def, DegradedConditionType type, String bucket, Double percentile, int value, QueryBuilder query)", "full_signature": "@VisibleForTesting void condition(ConditionDefinition def, DegradedConditionType type, String bucket, Double percentile, int value, QueryBuilder query)", "class_method_signature": "DegradedRouterQueryBuilder.condition(ConditionDefinition def, DegradedConditionType type, String bucket, Double percentile, int value, QueryBuilder query)", "testcase": false, "constructor": false, "invocations": ["condition"]}, "repository": {"repo_id": 24474053, "url": "https://github.com/wikimedia/search-extra", "stars": 37, "created": "9/25/2014 8:26:03 PM +00:00", "updates": "2019-12-06T15:10:34+00:00", "fork": "False", "license": "licensed"}}