{"test_class": {"identifier": "GetPeriodicMeterReadsGasCommandExecutorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@InjectMocks\n    private GetPeriodicMeterReadsGasCommandExecutor executor;", "modifier": "@InjectMocks\n    private", "type": "GetPeriodicMeterReadsGasCommandExecutor", "declarator": "executor", "var_name": "executor"}, {"original_string": "@Mock\n    private DlmsMessageListener dlmsMessageListener;", "modifier": "@Mock\n    private", "type": "DlmsMessageListener", "declarator": "dlmsMessageListener", "var_name": "dlmsMessageListener"}, {"original_string": "@Mock\n    private DlmsHelper dlmsHelper;", "modifier": "@Mock\n    private", "type": "DlmsHelper", "declarator": "dlmsHelper", "var_name": "dlmsHelper"}, {"original_string": "@Mock\n    private DlmsObjectConfigService dlmsObjectConfigService;", "modifier": "@Mock\n    private", "type": "DlmsObjectConfigService", "declarator": "dlmsObjectConfigService", "var_name": "dlmsObjectConfigService"}, {"original_string": "@Mock\n    private DlmsConnectionManager connectionManager;", "modifier": "@Mock\n    private", "type": "DlmsConnectionManager", "declarator": "connectionManager", "var_name": "connectionManager"}, {"original_string": "private final DlmsDevice device = this.createDevice(Protocol.DSMR_4_2_2);", "modifier": "private final", "type": "DlmsDevice", "declarator": "device = this.createDevice(Protocol.DSMR_4_2_2)", "var_name": "device"}, {"original_string": "private final long from = 1111111L;", "modifier": "private final", "type": "long", "declarator": "from = 1111111L", "var_name": "from"}, {"original_string": "private final long to = 2222222L;", "modifier": "private final", "type": "long", "declarator": "to = 2222222L", "var_name": "to"}, {"original_string": "private final DateTime fromDateTime = new DateTime(this.from);", "modifier": "private final", "type": "DateTime", "declarator": "fromDateTime = new DateTime(this.from)", "var_name": "fromDateTime"}, {"original_string": "private final DateTime toDateTime = new DateTime(this.to);", "modifier": "private final", "type": "DateTime", "declarator": "toDateTime = new DateTime(this.to)", "var_name": "toDateTime"}], "file": "osgp/protocol-adapter-dlms/osgp-protocol-adapter-dlms/src/test/java/org/opensmartgridplatform/adapter/protocol/dlms/domain/commands/periodicmeterreads/GetPeriodicMeterReadsGasCommandExecutorTest.java"}, "test_case": {"identifier": "testExecuteNullRequest", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testExecuteNullRequest() throws ProtocolAdapterException {\n        try {\n            this.executor.execute(this.connectionManager, this.device, null);\n            fail(\"Calling execute with null query should fail\");\n        } catch (final IllegalArgumentException e) {\n            // expected exception\n        }\n    }", "signature": "void testExecuteNullRequest()", "full_signature": "@Test public void testExecuteNullRequest()", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutorTest.testExecuteNullRequest()", "testcase": true, "constructor": false, "invocations": ["execute", "fail"]}, "focal_class": {"identifier": "GetPeriodicMeterReadsGasCommandExecutor", "superclass": "extends\n        AbstractPeriodicMeterReadsCommandExecutor<PeriodicMeterReadsRequestDto, PeriodicMeterReadGasResponseDto>", "interfaces": "", "fields": [{"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(GetPeriodicMeterReadsGasCommandExecutor.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(GetPeriodicMeterReadsGasCommandExecutor.class)", "var_name": "LOGGER"}, {"original_string": "private static final String GAS_VALUE = \"gasValue\";", "modifier": "private static final", "type": "String", "declarator": "GAS_VALUE = \"gasValue\"", "var_name": "GAS_VALUE"}, {"original_string": "private static final String PERIODIC_G_METER_READS = \"Periodic G-Meter Reads\";", "modifier": "private static final", "type": "String", "declarator": "PERIODIC_G_METER_READS = \"Periodic G-Meter Reads\"", "var_name": "PERIODIC_G_METER_READS"}, {"original_string": "private static final String UNEXPECTED_VALUE = \"Unexpected null/unspecified value for Gas Capture Time\";", "modifier": "private static final", "type": "String", "declarator": "UNEXPECTED_VALUE = \"Unexpected null/unspecified value for Gas Capture Time\"", "var_name": "UNEXPECTED_VALUE"}, {"original_string": "private static final String FORMAT_DESCRIPTION =\n            \"GetPeriodicMeterReadsGas for channel %s, %s from %s until %s, \" + \"retrieve attribute: %s\";", "modifier": "private static final", "type": "String", "declarator": "FORMAT_DESCRIPTION =\n            \"GetPeriodicMeterReadsGas for channel %s, %s from %s until %s, \" + \"retrieve attribute: %s\"", "var_name": "FORMAT_DESCRIPTION"}, {"original_string": "private final DlmsHelper dlmsHelper;", "modifier": "private final", "type": "DlmsHelper", "declarator": "dlmsHelper", "var_name": "dlmsHelper"}, {"original_string": "private final DlmsObjectConfigService dlmsObjectConfigService;", "modifier": "private final", "type": "DlmsObjectConfigService", "declarator": "dlmsObjectConfigService", "var_name": "dlmsObjectConfigService"}], "methods": [{"identifier": "GetPeriodicMeterReadsGasCommandExecutor", "parameters": "(final DlmsHelper dlmsHelper,\n            final AmrProfileStatusCodeHelper amrProfileStatusCodeHelper,\n            final DlmsObjectConfigService dlmsObjectConfigService)", "modifiers": "@Autowired public", "return": "", "signature": " GetPeriodicMeterReadsGasCommandExecutor(final DlmsHelper dlmsHelper,\n            final AmrProfileStatusCodeHelper amrProfileStatusCodeHelper,\n            final DlmsObjectConfigService dlmsObjectConfigService)", "full_signature": "@Autowired public  GetPeriodicMeterReadsGasCommandExecutor(final DlmsHelper dlmsHelper,\n            final AmrProfileStatusCodeHelper amrProfileStatusCodeHelper,\n            final DlmsObjectConfigService dlmsObjectConfigService)", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.GetPeriodicMeterReadsGasCommandExecutor(final DlmsHelper dlmsHelper,\n            final AmrProfileStatusCodeHelper amrProfileStatusCodeHelper,\n            final DlmsObjectConfigService dlmsObjectConfigService)", "testcase": false, "constructor": true}, {"identifier": "fromBundleRequestInput", "parameters": "(final ActionRequestDto bundleInput)", "modifiers": "@Override public", "return": "PeriodicMeterReadsRequestDto", "signature": "PeriodicMeterReadsRequestDto fromBundleRequestInput(final ActionRequestDto bundleInput)", "full_signature": "@Override public PeriodicMeterReadsRequestDto fromBundleRequestInput(final ActionRequestDto bundleInput)", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.fromBundleRequestInput(final ActionRequestDto bundleInput)", "testcase": false, "constructor": false}, {"identifier": "execute", "parameters": "(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "modifiers": "@Override public", "return": "PeriodicMeterReadGasResponseDto", "signature": "PeriodicMeterReadGasResponseDto execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "full_signature": "@Override public PeriodicMeterReadGasResponseDto execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "testcase": false, "constructor": false}, {"identifier": "convertToResponseItem", "parameters": "(final ConversionContext ctx,\n            final List<PeriodicMeterReadsGasResponseItemDto> periodicMeterReads)", "modifiers": "private", "return": "PeriodicMeterReadsGasResponseItemDto", "signature": "PeriodicMeterReadsGasResponseItemDto convertToResponseItem(final ConversionContext ctx,\n            final List<PeriodicMeterReadsGasResponseItemDto> periodicMeterReads)", "full_signature": "private PeriodicMeterReadsGasResponseItemDto convertToResponseItem(final ConversionContext ctx,\n            final List<PeriodicMeterReadsGasResponseItemDto> periodicMeterReads)", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.convertToResponseItem(final ConversionContext ctx,\n            final List<PeriodicMeterReadsGasResponseItemDto> periodicMeterReads)", "testcase": false, "constructor": false}, {"identifier": "getPreviousLogTime", "parameters": "(final List<PeriodicMeterReadsGasResponseItemDto> periodicMeterReads)", "modifiers": "private", "return": "Optional<Date>", "signature": "Optional<Date> getPreviousLogTime(final List<PeriodicMeterReadsGasResponseItemDto> periodicMeterReads)", "full_signature": "private Optional<Date> getPreviousLogTime(final List<PeriodicMeterReadsGasResponseItemDto> periodicMeterReads)", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.getPreviousLogTime(final List<PeriodicMeterReadsGasResponseItemDto> periodicMeterReads)", "testcase": false, "constructor": false}, {"identifier": "readValue", "parameters": "(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile)", "modifiers": "private", "return": "DataObject", "signature": "DataObject readValue(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile)", "full_signature": "private DataObject readValue(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile)", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.readValue(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile)", "testcase": false, "constructor": false}, {"identifier": "readScalerUnit", "parameters": "(final List<GetResult> getResultList,\n            final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final Integer channel)", "modifiers": "private", "return": "DataObject", "signature": "DataObject readScalerUnit(final List<GetResult> getResultList,\n            final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final Integer channel)", "full_signature": "private DataObject readScalerUnit(final List<GetResult> getResultList,\n            final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final Integer channel)", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.readScalerUnit(final List<GetResult> getResultList,\n            final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final Integer channel)", "testcase": false, "constructor": false}, {"identifier": "readCaptureTime", "parameters": "(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile)", "modifiers": "private", "return": "Date", "signature": "Date readCaptureTime(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile)", "full_signature": "private Date readCaptureTime(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile)", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.readCaptureTime(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile)", "testcase": false, "constructor": false}, {"identifier": "getProfileBufferAddress", "parameters": "(final PeriodTypeDto periodType, final ChannelDto channel,\n            final DateTime beginDateTime, final DateTime endDateTime, final DlmsDevice device)", "modifiers": "private", "return": "AttributeAddressForProfile", "signature": "AttributeAddressForProfile getProfileBufferAddress(final PeriodTypeDto periodType, final ChannelDto channel,\n            final DateTime beginDateTime, final DateTime endDateTime, final DlmsDevice device)", "full_signature": "private AttributeAddressForProfile getProfileBufferAddress(final PeriodTypeDto periodType, final ChannelDto channel,\n            final DateTime beginDateTime, final DateTime endDateTime, final DlmsDevice device)", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.getProfileBufferAddress(final PeriodTypeDto periodType, final ChannelDto channel,\n            final DateTime beginDateTime, final DateTime endDateTime, final DlmsDevice device)", "testcase": false, "constructor": false}, {"identifier": "getScalerUnitAddresses", "parameters": "(final ChannelDto channel,\n            final AttributeAddressForProfile attributeAddressForProfile)", "modifiers": "private", "return": "List<AttributeAddress>", "signature": "List<AttributeAddress> getScalerUnitAddresses(final ChannelDto channel,\n            final AttributeAddressForProfile attributeAddressForProfile)", "full_signature": "private List<AttributeAddress> getScalerUnitAddresses(final ChannelDto channel,\n            final AttributeAddressForProfile attributeAddressForProfile)", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.getScalerUnitAddresses(final ChannelDto channel,\n            final AttributeAddressForProfile attributeAddressForProfile)", "testcase": false, "constructor": false}, {"identifier": "getLogger", "parameters": "()", "modifiers": "@Override public", "return": "Logger", "signature": "Logger getLogger()", "full_signature": "@Override public Logger getLogger()", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.getLogger()", "testcase": false, "constructor": false}], "file": "osgp/protocol-adapter-dlms/osgp-protocol-adapter-dlms/src/main/java/org/opensmartgridplatform/adapter/protocol/dlms/domain/commands/periodicmeterreads/GetPeriodicMeterReadsGasCommandExecutor.java"}, "focal_method": {"identifier": "execute", "parameters": "(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "modifiers": "@Override public", "return": "PeriodicMeterReadGasResponseDto", "body": "@Override\n    public PeriodicMeterReadGasResponseDto execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery) throws ProtocolAdapterException {\n\n        if (periodicMeterReadsQuery == null) {\n            throw new IllegalArgumentException(\n                    \"PeriodicMeterReadsQuery should contain PeriodType, BeginDate and EndDate.\");\n        }\n\n        final PeriodTypeDto queryPeriodType = periodicMeterReadsQuery.getPeriodType();\n        final DateTime from = new DateTime(periodicMeterReadsQuery.getBeginDate());\n        final DateTime to = new DateTime(periodicMeterReadsQuery.getEndDate());\n\n        final AttributeAddressForProfile profileBufferAddress = this.getProfileBufferAddress(queryPeriodType,\n                periodicMeterReadsQuery.getChannel(), from, to, device);\n\n        final List<AttributeAddress> scalerUnitAddresses = this.getScalerUnitAddresses(\n                periodicMeterReadsQuery.getChannel(), profileBufferAddress);\n\n        final Optional<ProfileCaptureTime> intervalTime = this.getProfileCaptureTime(device,\n                this.dlmsObjectConfigService, Medium.GAS);\n\n        LOGGER.info(\"Retrieving current billing period and profiles for gas for period type: {}, from: \" + \"{}, to: {}\",\n                queryPeriodType, from, to);\n\n        /*\n         * workaround for a problem when using with_list and retrieving a profile\n         * buffer, this will be returned erroneously.\n         */\n        final List<GetResult> getResultList = new ArrayList<>();\n\n        final List<AttributeAddress> allAttributeAddresses = new ArrayList<>();\n        allAttributeAddresses.add(profileBufferAddress.getAttributeAddress());\n        allAttributeAddresses.addAll(scalerUnitAddresses);\n\n        for (final AttributeAddress address : allAttributeAddresses) {\n\n            conn.getDlmsMessageListener().setDescription(\n                    String.format(FORMAT_DESCRIPTION, periodicMeterReadsQuery.getChannel(), queryPeriodType, from, to,\n                            JdlmsObjectToStringUtil.describeAttributes(address)));\n\n            getResultList.addAll(this.dlmsHelper.getAndCheck(conn, device,\n                    \"retrieve periodic meter reads for \" + queryPeriodType + \", channel \"\n                            + periodicMeterReadsQuery.getChannel(), address));\n        }\n\n        LOGGER.info(\"Received getResult: {} \", getResultList);\n\n        final DataObject resultData = this.dlmsHelper.readDataObject(getResultList.get(0), PERIODIC_G_METER_READS);\n        final List<DataObject> bufferedObjectsList = resultData.getValue();\n\n        final List<PeriodicMeterReadsGasResponseItemDto> periodicMeterReads = new ArrayList<>();\n        for (final DataObject bufferedObject : bufferedObjectsList) {\n            final List<DataObject> bufferedObjectValue = bufferedObject.getValue();\n\n            try {\n                periodicMeterReads.add(this.convertToResponseItem(\n                        new ConversionContext(periodicMeterReadsQuery, bufferedObjectValue, getResultList,\n                                profileBufferAddress, scalerUnitAddresses, intervalTime), periodicMeterReads));\n            } catch (final BufferedDateTimeValidationException e) {\n                LOGGER.warn(e.getMessage(), e);\n            }\n        }\n\n        LOGGER.info(\"Resulting periodicMeterReads: {} \", periodicMeterReads);\n\n        return new PeriodicMeterReadGasResponseDto(queryPeriodType, periodicMeterReads);\n    }", "signature": "PeriodicMeterReadGasResponseDto execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "full_signature": "@Override public PeriodicMeterReadGasResponseDto execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "class_method_signature": "GetPeriodicMeterReadsGasCommandExecutor.execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "testcase": false, "constructor": false, "invocations": ["getPeriodType", "getBeginDate", "getEndDate", "getProfileBufferAddress", "getChannel", "getScalerUnitAddresses", "getChannel", "getProfileCaptureTime", "info", "add", "getAttributeAddress", "addAll", "setDescription", "getDlmsMessageListener", "format", "getChannel", "describeAttributes", "addAll", "getAndCheck", "getChannel", "info", "readDataObject", "get", "getValue", "getValue", "add", "convertToResponseItem", "warn", "getMessage", "info"]}, "repository": {"repo_id": 154302277, "url": "https://github.com/OSGP/open-smart-grid-platform", "stars": 30, "created": "10/23/2018 9:41:12 AM +00:00", "updates": "2020-01-26T20:15:09+00:00", "fork": "False", "license": "licensed"}}