{"test_class": {"identifier": "TestThemisRowCounter", "superclass": "extends TestThemisMapReduceBase", "interfaces": "", "fields": [], "file": "themis-client/src/test/java/org/apache/hadoop/hbase/themis/mapreduce/TestThemisRowCounter.java"}, "test_case": {"identifier": "testThemisRowCounterWithoutQualifier", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testThemisRowCounterWithoutQualifier() throws Exception {\n    if (TEST_UTIL != null) {\n      try {\n        Job job = ThemisRowCounter.createSubmittableJob(conf,\n          new String[] { Bytes.toString(TABLENAME), Bytes.toString(FAMILY) });\n        job.waitForCompletion(true);\n        Assert.fail();\n      } catch (IOException e) {\n        Assert.assertTrue(e.getMessage().contains(\"must specify qualifier to read themis table\"));\n      }\n    }\n  }", "signature": "void testThemisRowCounterWithoutQualifier()", "full_signature": "@Test public void testThemisRowCounterWithoutQualifier()", "class_method_signature": "TestThemisRowCounter.testThemisRowCounterWithoutQualifier()", "testcase": true, "constructor": false, "invocations": ["createSubmittableJob", "toString", "toString", "waitForCompletion", "fail", "assertTrue", "contains", "getMessage"]}, "focal_class": {"identifier": "ThemisRowCounter", "superclass": "", "interfaces": "", "fields": [{"original_string": "static final String NAME = \"ThemisRowCounter\";", "modifier": "static final", "type": "String", "declarator": "NAME = \"ThemisRowCounter\"", "var_name": "NAME"}], "methods": [{"identifier": "createSubmittableJob", "parameters": "(Configuration conf, String[] args)", "modifiers": "public static", "return": "Job", "signature": "Job createSubmittableJob(Configuration conf, String[] args)", "full_signature": "public static Job createSubmittableJob(Configuration conf, String[] args)", "class_method_signature": "ThemisRowCounter.createSubmittableJob(Configuration conf, String[] args)", "testcase": false, "constructor": false}, {"identifier": "printUsage", "parameters": "(String errorMessage)", "modifiers": "private static", "return": "void", "signature": "void printUsage(String errorMessage)", "full_signature": "private static void printUsage(String errorMessage)", "class_method_signature": "ThemisRowCounter.printUsage(String errorMessage)", "testcase": false, "constructor": false}, {"identifier": "printUsage", "parameters": "()", "modifiers": "private static", "return": "void", "signature": "void printUsage()", "full_signature": "private static void printUsage()", "class_method_signature": "ThemisRowCounter.printUsage()", "testcase": false, "constructor": false}, {"identifier": "main", "parameters": "(String[] args)", "modifiers": "public static", "return": "void", "signature": "void main(String[] args)", "full_signature": "public static void main(String[] args)", "class_method_signature": "ThemisRowCounter.main(String[] args)", "testcase": false, "constructor": false}], "file": "themis-client/src/main/java/org/apache/hadoop/hbase/themis/mapreduce/ThemisRowCounter.java"}, "focal_method": {"identifier": "createSubmittableJob", "parameters": "(Configuration conf, String[] args)", "modifiers": "public static", "return": "Job", "body": "public static Job createSubmittableJob(Configuration conf, String[] args)\n  throws IOException {\n    String tableName = args[0];\n    String startKey = null;\n    String endKey = null;\n    StringBuilder sb = new StringBuilder();\n\n    final String rangeSwitch = \"--range=\";\n\n    // First argument is table name, starting from second\n    for (int i = 1; i < args.length; i++) {\n      if (args[i].startsWith(rangeSwitch)) {\n        String[] startEnd = args[i].substring(rangeSwitch.length()).split(\",\", 2);\n        if (startEnd.length != 2 || startEnd[1].contains(\",\")) {\n          printUsage(\"Please specify range in such format as \\\"--range=a,b\\\" \" +\n              \"or, with only one boundary, \\\"--range=,b\\\" or \\\"--range=a,\\\"\");\n          return null;\n        }\n        startKey = startEnd[0];\n        endKey = startEnd[1];\n      }\n      else {\n        // if no switch, assume column names\n        sb.append(args[i]);\n        sb.append(\" \");\n      }\n    }\n\n    Job job = new Job(conf, NAME + \"_\" + tableName);\n    job.setJarByClass(RowCounter.class);\n    Scan scan = new Scan();\n    scan.setCacheBlocks(false);\n    if (startKey != null && !startKey.equals(\"\")) {\n      scan.setStartRow(Bytes.toBytes(startKey));\n    }\n    if (endKey != null && !endKey.equals(\"\")) {\n      scan.setStopRow(Bytes.toBytes(endKey));\n    }\n    scan.setFilter(new FirstKeyOnlyFilter());\n    if (sb.length() > 0) {\n      for (String columnName : sb.toString().trim().split(\" \")) {\n        String family = StringUtils.substringBefore(columnName, \":\");\n        String qualifier = StringUtils.substringAfter(columnName, \":\");\n        if (StringUtils.isBlank(qualifier)) {\n          throw new IOException(\"must specify qualifier to read themis table\");\n        } else {\n          scan.addColumn(Bytes.toBytes(family), Bytes.toBytes(qualifier));\n        }\n      }\n    }\n    job.setOutputFormatClass(NullOutputFormat.class);\n    ThemisTableMapReduceUtil.initTableMapperJob(tableName, scan,\n      RowCounterMapper.class, ImmutableBytesWritable.class, Result.class, job);\n    job.setNumReduceTasks(0);\n    return job;\n  }", "signature": "Job createSubmittableJob(Configuration conf, String[] args)", "full_signature": "public static Job createSubmittableJob(Configuration conf, String[] args)", "class_method_signature": "ThemisRowCounter.createSubmittableJob(Configuration conf, String[] args)", "testcase": false, "constructor": false, "invocations": ["startsWith", "split", "substring", "length", "contains", "printUsage", "append", "append", "setJarByClass", "setCacheBlocks", "equals", "setStartRow", "toBytes", "equals", "setStopRow", "toBytes", "setFilter", "length", "split", "trim", "toString", "substringBefore", "substringAfter", "isBlank", "addColumn", "toBytes", "toBytes", "setOutputFormatClass", "initTableMapperJob", "setNumReduceTasks"]}, "repository": {"repo_id": 19147361, "url": "https://github.com/XiaoMi/themis", "language": "Java", "is_fork": false, "fork_count": 57, "stargazer_count": 212, "size": 1400, "license": "Apache License 2.0"}}