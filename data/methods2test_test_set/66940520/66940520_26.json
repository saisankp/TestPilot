{"test_class": {"identifier": "ProgramRuleEngineTest", "superclass": "extends DhisSpringTest", "interfaces": "", "fields": [{"original_string": "private static final SimpleDateFormat simpleDateFormat = new SimpleDateFormat( \"yyyy-MM-dd\" );", "modifier": "private static final", "type": "SimpleDateFormat", "declarator": "simpleDateFormat = new SimpleDateFormat( \"yyyy-MM-dd\" )", "var_name": "simpleDateFormat"}, {"original_string": "private Program programA;", "modifier": "private", "type": "Program", "declarator": "programA", "var_name": "programA"}, {"original_string": "private Program programS;", "modifier": "private", "type": "Program", "declarator": "programS", "var_name": "programS"}, {"original_string": "private ProgramRule programRuleA;", "modifier": "private", "type": "ProgramRule", "declarator": "programRuleA", "var_name": "programRuleA"}, {"original_string": "private ProgramRule programRuleA2;", "modifier": "private", "type": "ProgramRule", "declarator": "programRuleA2", "var_name": "programRuleA2"}, {"original_string": "private ProgramRule programRuleC;", "modifier": "private", "type": "ProgramRule", "declarator": "programRuleC", "var_name": "programRuleC"}, {"original_string": "private ProgramRule programRuleS;", "modifier": "private", "type": "ProgramRule", "declarator": "programRuleS", "var_name": "programRuleS"}, {"original_string": "private DataElement dataElementA;", "modifier": "private", "type": "DataElement", "declarator": "dataElementA", "var_name": "dataElementA"}, {"original_string": "private DataElement dataElementB;", "modifier": "private", "type": "DataElement", "declarator": "dataElementB", "var_name": "dataElementB"}, {"original_string": "private DataElement dataElementC;", "modifier": "private", "type": "DataElement", "declarator": "dataElementC", "var_name": "dataElementC"}, {"original_string": "private DataElement dataElementD;", "modifier": "private", "type": "DataElement", "declarator": "dataElementD", "var_name": "dataElementD"}, {"original_string": "private DataElement dataElementDate;", "modifier": "private", "type": "DataElement", "declarator": "dataElementDate", "var_name": "dataElementDate"}, {"original_string": "private DataElement dataElementAge;", "modifier": "private", "type": "DataElement", "declarator": "dataElementAge", "var_name": "dataElementAge"}, {"original_string": "private DataElement assignedDataElement;", "modifier": "private", "type": "DataElement", "declarator": "assignedDataElement", "var_name": "assignedDataElement"}, {"original_string": "private EventDataValue eventDataValueDate;", "modifier": "private", "type": "EventDataValue", "declarator": "eventDataValueDate", "var_name": "eventDataValueDate"}, {"original_string": "private EventDataValue eventDataValueAge;", "modifier": "private", "type": "EventDataValue", "declarator": "eventDataValueAge", "var_name": "eventDataValueAge"}, {"original_string": "private TrackedEntityAttribute attributeA;", "modifier": "private", "type": "TrackedEntityAttribute", "declarator": "attributeA", "var_name": "attributeA"}, {"original_string": "private TrackedEntityAttribute attributeB;", "modifier": "private", "type": "TrackedEntityAttribute", "declarator": "attributeB", "var_name": "attributeB"}, {"original_string": "private OrganisationUnit organisationUnitA;", "modifier": "private", "type": "OrganisationUnit", "declarator": "organisationUnitA", "var_name": "organisationUnitA"}, {"original_string": "private OrganisationUnit organisationUnitB;", "modifier": "private", "type": "OrganisationUnit", "declarator": "organisationUnitB", "var_name": "organisationUnitB"}, {"original_string": "private String scheduledDate;", "modifier": "private", "type": "String", "declarator": "scheduledDate", "var_name": "scheduledDate"}, {"original_string": "private String dob = \"1984-01-01\";", "modifier": "private", "type": "String", "declarator": "dob = \"1984-01-01\"", "var_name": "dob"}, {"original_string": "private String expressionA = \"#{ProgramRuleVariableA}=='malaria'\";", "modifier": "private", "type": "String", "declarator": "expressionA = \"#{ProgramRuleVariableA}=='malaria'\"", "var_name": "expressionA"}, {"original_string": "private String expressionC = \"A{C1234567890}=='test'\";", "modifier": "private", "type": "String", "declarator": "expressionC = \"A{C1234567890}=='test'\"", "var_name": "expressionC"}, {"original_string": "private String expressionS = \"A{S1234567890}=='xmen'\";", "modifier": "private", "type": "String", "declarator": "expressionS = \"A{S1234567890}=='xmen'\"", "var_name": "expressionS"}, {"original_string": "private String dataExpression = \"d2:addDays('2018-04-15', '2')\";", "modifier": "private", "type": "String", "declarator": "dataExpression = \"d2:addDays('2018-04-15', '2')\"", "var_name": "dataExpression"}, {"original_string": "private String calculatedDateExpression = \"true\";", "modifier": "private", "type": "String", "declarator": "calculatedDateExpression = \"true\"", "var_name": "calculatedDateExpression"}, {"original_string": "private Date psEventDate;", "modifier": "private", "type": "Date", "declarator": "psEventDate", "var_name": "psEventDate"}, {"original_string": "@Qualifier( \"notificationRuleEngine\" )\n    @Autowired\n    ProgramRuleEngine programRuleEngine;", "modifier": "@Qualifier( \"notificationRuleEngine\" )\n    @Autowired", "type": "ProgramRuleEngine", "declarator": "programRuleEngine", "var_name": "programRuleEngine"}, {"original_string": "@Autowired\n    private ProgramRuleEngineService programRuleEngineService;", "modifier": "@Autowired\n    private", "type": "ProgramRuleEngineService", "declarator": "programRuleEngineService", "var_name": "programRuleEngineService"}, {"original_string": "@Autowired\n    private ProgramRuleService programRuleService;", "modifier": "@Autowired\n    private", "type": "ProgramRuleService", "declarator": "programRuleService", "var_name": "programRuleService"}, {"original_string": "@Autowired\n    private ProgramRuleActionService programRuleActionService;", "modifier": "@Autowired\n    private", "type": "ProgramRuleActionService", "declarator": "programRuleActionService", "var_name": "programRuleActionService"}, {"original_string": "@Autowired\n    private ProgramRuleVariableService programRuleVariableService;", "modifier": "@Autowired\n    private", "type": "ProgramRuleVariableService", "declarator": "programRuleVariableService", "var_name": "programRuleVariableService"}, {"original_string": "@Autowired\n    private ProgramInstanceService programInstanceService;", "modifier": "@Autowired\n    private", "type": "ProgramInstanceService", "declarator": "programInstanceService", "var_name": "programInstanceService"}, {"original_string": "@Autowired\n    private TrackedEntityInstanceService entityInstanceService;", "modifier": "@Autowired\n    private", "type": "TrackedEntityInstanceService", "declarator": "entityInstanceService", "var_name": "entityInstanceService"}, {"original_string": "@Autowired\n    private OrganisationUnitService organisationUnitService;", "modifier": "@Autowired\n    private", "type": "OrganisationUnitService", "declarator": "organisationUnitService", "var_name": "organisationUnitService"}, {"original_string": "@Autowired\n    private ProgramService programService;", "modifier": "@Autowired\n    private", "type": "ProgramService", "declarator": "programService", "var_name": "programService"}, {"original_string": "@Autowired\n    private ProgramStageService programStageService;", "modifier": "@Autowired\n    private", "type": "ProgramStageService", "declarator": "programStageService", "var_name": "programStageService"}, {"original_string": "@Autowired\n    private ProgramStageInstanceService programStageInstanceService;", "modifier": "@Autowired\n    private", "type": "ProgramStageInstanceService", "declarator": "programStageInstanceService", "var_name": "programStageInstanceService"}, {"original_string": "@Autowired\n    private ProgramStageDataElementService programStageDataElementService;", "modifier": "@Autowired\n    private", "type": "ProgramStageDataElementService", "declarator": "programStageDataElementService", "var_name": "programStageDataElementService"}, {"original_string": "@Autowired\n    private DataElementService dataElementService;", "modifier": "@Autowired\n    private", "type": "DataElementService", "declarator": "dataElementService", "var_name": "dataElementService"}, {"original_string": "@Autowired\n    private TrackedEntityAttributeService attributeService;", "modifier": "@Autowired\n    private", "type": "TrackedEntityAttributeService", "declarator": "attributeService", "var_name": "attributeService"}, {"original_string": "@Autowired\n    private TrackedEntityAttributeValueService trackedEntityAttributeValueService;", "modifier": "@Autowired\n    private", "type": "TrackedEntityAttributeValueService", "declarator": "trackedEntityAttributeValueService", "var_name": "trackedEntityAttributeValueService"}, {"original_string": "@Autowired\n    private ProgramTrackedEntityAttributeStore programTrackedEntityAttributeStore;", "modifier": "@Autowired\n    private", "type": "ProgramTrackedEntityAttributeStore", "declarator": "programTrackedEntityAttributeStore", "var_name": "programTrackedEntityAttributeStore"}, {"original_string": "@Autowired\n    private ProgramNotificationTemplateStore programNotificationTemplateStore;", "modifier": "@Autowired\n    private", "type": "ProgramNotificationTemplateStore", "declarator": "programNotificationTemplateStore", "var_name": "programNotificationTemplateStore"}], "file": "dhis-2/dhis-services/dhis-service-program-rule/src/test/java/org/hisp/dhis/programrule/engine/ProgramRuleEngineTest.java"}, "test_case": {"identifier": "testSendMessageForEnrollment", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testSendMessageForEnrollment()\n    {\n        setUpSendMessageForEnrollment();\n\n        ProgramInstance programInstance = programInstanceService.getProgramInstance( \"UID-P1\" );\n\n        List<RuleEffect> ruleEffects = programRuleEngine.evaluate( programInstance, Sets.newHashSet() );\n\n        assertEquals( 1, ruleEffects.size() );\n\n        RuleAction ruleAction = ruleEffects.get( 0 ).ruleAction();\n\n        assertTrue( ruleAction instanceof RuleActionSendMessage );\n\n        RuleActionSendMessage ruleActionSendMessage = (RuleActionSendMessage) ruleAction;\n\n        assertEquals( \"PNT-1\", ruleActionSendMessage.notification() );\n    }", "signature": "void testSendMessageForEnrollment()", "full_signature": "@Test public void testSendMessageForEnrollment()", "class_method_signature": "ProgramRuleEngineTest.testSendMessageForEnrollment()", "testcase": true, "constructor": false, "invocations": ["setUpSendMessageForEnrollment", "getProgramInstance", "evaluate", "newHashSet", "assertEquals", "size", "ruleAction", "get", "assertTrue", "assertEquals", "notification"]}, "focal_class": {"identifier": "ProgramRuleEngine", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String USER = \"USER\";", "modifier": "private static final", "type": "String", "declarator": "USER = \"USER\"", "var_name": "USER"}, {"original_string": "private final ProgramRuleEntityMapperService programRuleEntityMapperService;", "modifier": "private final", "type": "ProgramRuleEntityMapperService", "declarator": "programRuleEntityMapperService", "var_name": "programRuleEntityMapperService"}, {"original_string": "private final ProgramRuleVariableService programRuleVariableService;", "modifier": "private final", "type": "ProgramRuleVariableService", "declarator": "programRuleVariableService", "var_name": "programRuleVariableService"}, {"original_string": "private final OrganisationUnitGroupService organisationUnitGroupService;", "modifier": "private final", "type": "OrganisationUnitGroupService", "declarator": "organisationUnitGroupService", "var_name": "organisationUnitGroupService"}, {"original_string": "private final CurrentUserService currentUserService;", "modifier": "private final", "type": "CurrentUserService", "declarator": "currentUserService", "var_name": "currentUserService"}, {"original_string": "private final ConstantService constantService;", "modifier": "private final", "type": "ConstantService", "declarator": "constantService", "var_name": "constantService"}, {"original_string": "private final ImplementableRuleService implementableRuleService;", "modifier": "private final", "type": "ImplementableRuleService", "declarator": "implementableRuleService", "var_name": "implementableRuleService"}], "methods": [{"identifier": "ProgramRuleEngine", "parameters": "( ProgramRuleEntityMapperService programRuleEntityMapperService,\n        ProgramRuleVariableService programRuleVariableService,\n        OrganisationUnitGroupService organisationUnitGroupService,\n        CurrentUserService currentUserService,\n        ConstantService constantService,\n        ImplementableRuleService implementableRuleService )", "modifiers": "public", "return": "", "signature": " ProgramRuleEngine( ProgramRuleEntityMapperService programRuleEntityMapperService,\n        ProgramRuleVariableService programRuleVariableService,\n        OrganisationUnitGroupService organisationUnitGroupService,\n        CurrentUserService currentUserService,\n        ConstantService constantService,\n        ImplementableRuleService implementableRuleService )", "full_signature": "public  ProgramRuleEngine( ProgramRuleEntityMapperService programRuleEntityMapperService,\n        ProgramRuleVariableService programRuleVariableService,\n        OrganisationUnitGroupService organisationUnitGroupService,\n        CurrentUserService currentUserService,\n        ConstantService constantService,\n        ImplementableRuleService implementableRuleService )", "class_method_signature": "ProgramRuleEngine.ProgramRuleEngine( ProgramRuleEntityMapperService programRuleEntityMapperService,\n        ProgramRuleVariableService programRuleVariableService,\n        OrganisationUnitGroupService organisationUnitGroupService,\n        CurrentUserService currentUserService,\n        ConstantService constantService,\n        ImplementableRuleService implementableRuleService )", "testcase": false, "constructor": true}, {"identifier": "evaluate", "parameters": "( ProgramInstance enrollment, Set<ProgramStageInstance> events )", "modifiers": "public", "return": "List<RuleEffect>", "signature": "List<RuleEffect> evaluate( ProgramInstance enrollment, Set<ProgramStageInstance> events )", "full_signature": "public List<RuleEffect> evaluate( ProgramInstance enrollment, Set<ProgramStageInstance> events )", "class_method_signature": "ProgramRuleEngine.evaluate( ProgramInstance enrollment, Set<ProgramStageInstance> events )", "testcase": false, "constructor": false}, {"identifier": "evaluate", "parameters": "( ProgramInstance enrollment, ProgramStageInstance programStageInstance,\n        Set<ProgramStageInstance> events )", "modifiers": "public", "return": "List<RuleEffect>", "signature": "List<RuleEffect> evaluate( ProgramInstance enrollment, ProgramStageInstance programStageInstance,\n        Set<ProgramStageInstance> events )", "full_signature": "public List<RuleEffect> evaluate( ProgramInstance enrollment, ProgramStageInstance programStageInstance,\n        Set<ProgramStageInstance> events )", "class_method_signature": "ProgramRuleEngine.evaluate( ProgramInstance enrollment, ProgramStageInstance programStageInstance,\n        Set<ProgramStageInstance> events )", "testcase": false, "constructor": false}, {"identifier": "evaluateProgramRules", "parameters": "( ProgramInstance enrollment,\n        ProgramStageInstance programStageInstance, Set<ProgramStageInstance> events )", "modifiers": "private", "return": "List<RuleEffect>", "signature": "List<RuleEffect> evaluateProgramRules( ProgramInstance enrollment,\n        ProgramStageInstance programStageInstance, Set<ProgramStageInstance> events )", "full_signature": "private List<RuleEffect> evaluateProgramRules( ProgramInstance enrollment,\n        ProgramStageInstance programStageInstance, Set<ProgramStageInstance> events )", "class_method_signature": "ProgramRuleEngine.evaluateProgramRules( ProgramInstance enrollment,\n        ProgramStageInstance programStageInstance, Set<ProgramStageInstance> events )", "testcase": false, "constructor": false}, {"identifier": "getDescription", "parameters": "( String condition, Program program )", "modifiers": "public", "return": "RuleValidationResult", "signature": "RuleValidationResult getDescription( String condition, Program program )", "full_signature": "public RuleValidationResult getDescription( String condition, Program program )", "class_method_signature": "ProgramRuleEngine.getDescription( String condition, Program program )", "testcase": false, "constructor": false}, {"identifier": "getRuleEngineContext", "parameters": "( Program program )", "modifiers": "private", "return": "RuleEngineContext", "signature": "RuleEngineContext getRuleEngineContext( Program program )", "full_signature": "private RuleEngineContext getRuleEngineContext( Program program )", "class_method_signature": "ProgramRuleEngine.getRuleEngineContext( Program program )", "testcase": false, "constructor": false}, {"identifier": "ruleEngineBuilder", "parameters": "( List<ProgramRule> programRules,\n        List<ProgramRuleVariable> programRuleVariables, RuleEngineIntent intent )", "modifiers": "private", "return": "RuleEngine.Builder", "signature": "RuleEngine.Builder ruleEngineBuilder( List<ProgramRule> programRules,\n        List<ProgramRuleVariable> programRuleVariables, RuleEngineIntent intent )", "full_signature": "private RuleEngine.Builder ruleEngineBuilder( List<ProgramRule> programRules,\n        List<ProgramRuleVariable> programRuleVariables, RuleEngineIntent intent )", "class_method_signature": "ProgramRuleEngine.ruleEngineBuilder( List<ProgramRule> programRules,\n        List<ProgramRuleVariable> programRuleVariables, RuleEngineIntent intent )", "testcase": false, "constructor": false}, {"identifier": "getRuleEvent", "parameters": "( ProgramStageInstance programStageInstance )", "modifiers": "private", "return": "RuleEvent", "signature": "RuleEvent getRuleEvent( ProgramStageInstance programStageInstance )", "full_signature": "private RuleEvent getRuleEvent( ProgramStageInstance programStageInstance )", "class_method_signature": "ProgramRuleEngine.getRuleEvent( ProgramStageInstance programStageInstance )", "testcase": false, "constructor": false}, {"identifier": "getRuleEvents", "parameters": "( Set<ProgramStageInstance> events,\n        ProgramStageInstance programStageInstance )", "modifiers": "private", "return": "List<RuleEvent>", "signature": "List<RuleEvent> getRuleEvents( Set<ProgramStageInstance> events,\n        ProgramStageInstance programStageInstance )", "full_signature": "private List<RuleEvent> getRuleEvents( Set<ProgramStageInstance> events,\n        ProgramStageInstance programStageInstance )", "class_method_signature": "ProgramRuleEngine.getRuleEvents( Set<ProgramStageInstance> events,\n        ProgramStageInstance programStageInstance )", "testcase": false, "constructor": false}, {"identifier": "getRuleEnrollment", "parameters": "( ProgramInstance enrollment )", "modifiers": "private", "return": "RuleEnrollment", "signature": "RuleEnrollment getRuleEnrollment( ProgramInstance enrollment )", "full_signature": "private RuleEnrollment getRuleEnrollment( ProgramInstance enrollment )", "class_method_signature": "ProgramRuleEngine.getRuleEnrollment( ProgramInstance enrollment )", "testcase": false, "constructor": false}, {"identifier": "getRuleEngineEvaluation", "parameters": "( RuleEngine ruleEngine, RuleEnrollment enrollment,\n        ProgramStageInstance event )", "modifiers": "private", "return": "List<RuleEffect>", "signature": "List<RuleEffect> getRuleEngineEvaluation( RuleEngine ruleEngine, RuleEnrollment enrollment,\n        ProgramStageInstance event )", "full_signature": "private List<RuleEffect> getRuleEngineEvaluation( RuleEngine ruleEngine, RuleEnrollment enrollment,\n        ProgramStageInstance event )", "class_method_signature": "ProgramRuleEngine.getRuleEngineEvaluation( RuleEngine ruleEngine, RuleEnrollment enrollment,\n        ProgramStageInstance event )", "testcase": false, "constructor": false}], "file": "dhis-2/dhis-services/dhis-service-program-rule/src/main/java/org/hisp/dhis/programrule/engine/ProgramRuleEngine.java"}, "focal_method": {"identifier": "evaluate", "parameters": "( ProgramInstance enrollment, Set<ProgramStageInstance> events )", "modifiers": "public", "return": "List<RuleEffect>", "body": "public List<RuleEffect> evaluate( ProgramInstance enrollment, Set<ProgramStageInstance> events )\n    {\n        return evaluateProgramRules( enrollment, null, events );\n    }", "signature": "List<RuleEffect> evaluate( ProgramInstance enrollment, Set<ProgramStageInstance> events )", "full_signature": "public List<RuleEffect> evaluate( ProgramInstance enrollment, Set<ProgramStageInstance> events )", "class_method_signature": "ProgramRuleEngine.evaluate( ProgramInstance enrollment, Set<ProgramStageInstance> events )", "testcase": false, "constructor": false, "invocations": ["evaluateProgramRules"]}, "repository": {"repo_id": 66940520, "url": "https://github.com/dhis2/dhis2-core", "stars": 151, "created": "8/30/2016 12:57:05 PM +00:00", "updates": "2020-01-24T18:06:36+00:00", "fork": "False", "license": "licensed"}}