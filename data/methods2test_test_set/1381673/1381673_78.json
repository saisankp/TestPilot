{"test_class": {"identifier": "MVELExpressionEvaluatorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "MVELExpressionEvaluator evaluator = new MVELExpressionEvaluator(MVELExpressionEvaluatorTest.class.getClassLoader());", "modifier": "", "type": "MVELExpressionEvaluator", "declarator": "evaluator = new MVELExpressionEvaluator(MVELExpressionEvaluatorTest.class.getClassLoader())", "var_name": "evaluator"}], "file": "drools-scenario-simulation/drools-scenario-simulation-backend/src/test/java/org/drools/scenariosimulation/backend/expression/MVELExpressionEvaluatorTest.java"}, "test_case": {"identifier": "evaluateLiteralExpression", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void evaluateLiteralExpression() {\n        assertEquals(1, evaluator.evaluateLiteralExpression(mvelExpression(\"1\"), Integer.class.getCanonicalName(),\n                                                            Collections.emptyList()\n        ));\n\n        assertEquals(\"Value\", evaluator.evaluateLiteralExpression(mvelExpression(\"\\\"Value\\\"\"), String.class.getCanonicalName(),\n                                                                  Collections.emptyList()\n        ));\n\n        assertEquals(6, evaluator.evaluateLiteralExpression(mvelExpression(\"2 * 3\"), Integer.class.getCanonicalName(),\n                                                            Collections.emptyList()\n        ));\n\n        assertEquals(14, evaluator.evaluateLiteralExpression(mvelExpression(\"-1 + (3 * 5)\"), Integer.class.getCanonicalName(),\n                                                             Collections.emptyList()\n        ));\n\n        assertEquals(Arrays.asList(\"Jim\"), evaluator.evaluateLiteralExpression(mvelExpression(\"[\\\"Jim\\\"]\"), ArrayList.class.getCanonicalName(),\n                                                                               Collections.emptyList()\n        ));\n\n        assertEquals(Collections.emptyList(), evaluator.evaluateLiteralExpression(mvelExpression(\"[]\"), ArrayList.class.getCanonicalName(),\n                                                                                  Collections.emptyList()\n        ));\n\n        assertThat(evaluator.evaluateLiteralExpression(mvelExpression(\"\\\"abc..\\\"[2]\"), Character.class.getCanonicalName(),\n                                                       Collections.emptyList()\n        ))\n                .isEqualTo('c');\n\n        assertThat(evaluator.evaluateLiteralExpression(mvelExpression(\"1.234B\"), BigDecimal.class.getCanonicalName(),\n                                                       Collections.emptyList()\n        ))\n                .isEqualTo(new BigDecimal(\"1.234\"));\n\n        assertThat(evaluator.evaluateLiteralExpression(mvelExpression(\"1.234d\"), Double.class.getCanonicalName(),\n                                                       Collections.emptyList()\n        ))\n                .isEqualTo(Double.valueOf(\"1.234\"));\n\n        assertEquals(\"Value\", evaluator.evaluateLiteralExpression(\"# \\\"Value\\\"\", String.class.getCanonicalName(), Collections.emptyList()));\n\n        assertEquals(3, evaluator.evaluateLiteralExpression(\"# a = 1; b = 2; a+b;\", Integer.class.getCanonicalName(), Collections.emptyList()));\n\n        assertEquals(\"Test\", evaluator.evaluateLiteralExpression(\"# a = \\\"Te\\\"; b = \\\"st\\\"; a+b;\", String.class.getCanonicalName(), Collections.emptyList()));\n\n        assertThatThrownBy(() -> evaluator.evaluateLiteralExpression(\"# a = 1 b = 2 a+b;\", Integer.class.getCanonicalName(), Collections.emptyList()))\n                .isInstanceOf(CompileException.class);\n\n        assertThatThrownBy(() -> evaluator.evaluateLiteralExpression(\"# a = 1; a+b;\", Integer.class.getCanonicalName(), Collections.emptyList()))\n                .isInstanceOf(CompileException.class);\n\n        assertEquals(Arrays.asList(\"Bob\", \"Michael\"), evaluator.evaluateLiteralExpression(mvelExpression(\"a = \\\"Bob\\\";\\n\" +\n                                                                                                                 \"test = new java.util.ArrayList();\\n\" +\n                                                                                                                 \"test.add(a);\\n\" +\n                                                                                                                 \"test.add(\\\"Michael\\\");\\n\" +\n                                                                                                                 \"test;\"),\n                                                                                          ArrayList.class.getCanonicalName(),\n                                                                                          Collections.emptyList()\n        ));\n\n        HashMap<String, String> expectedMap = new HashMap<String, String>() {{\n            put(\"Jim\", \"Person\");\n        }};\n\n        assertEquals(expectedMap, evaluator.evaluateLiteralExpression(mvelExpression(\"[\\\"Jim\\\" : \\\"Person\\\"]\"),\n                                                                      HashMap.class.getCanonicalName(),\n                                                                      Collections.emptyList()\n        ));\n        assertEquals(expectedMap, evaluator.evaluateLiteralExpression(mvelExpression(\"a = \\\"Person\\\";\\n\" +\n                                                                                             \"test = new java.util.HashMap();\\n\" +\n                                                                                             \"test.put(\\\"Jim\\\", a);\\n\" +\n                                                                                             \"test;\"),\n                                                                      HashMap.class.getCanonicalName(),\n                                                                      Collections.emptyList()\n        ));\n        assertEquals(expectedMap,\n                     evaluator.evaluateLiteralExpression(\n                             mvelExpression(\"a = \\\"Person\\\";test = new java.util.HashMap();test.put(\\\"Jim\\\", a);test;\"),\n                             HashMap.class.getCanonicalName(),\n                             Collections.emptyList()\n                     ));\n        assertEquals(Collections.emptyMap(),\n                     evaluator.evaluateLiteralExpression(\n                             mvelExpression(\"a = \\\"Person\\\";\\n\" +\n                                                    \"test = new java.util.HashMap();\\n\" +\n                                                    \"test.put(\\\"Jim\\\", a);\\n\" +\n                                                    \"test;\\n\" +\n                                                    \"test.clear();\\n\" +\n                                                    \"test;\"),\n                             HashMap.class.getCanonicalName(),\n                             Collections.emptyList()\n                     ));\n\n        assertThatThrownBy(() -> evaluator.evaluateLiteralExpression(\"1+\", String.class.getCanonicalName(), Collections.emptyList()))\n                .isInstanceOf(RuntimeException.class);\n\n        assertThatThrownBy(() -> evaluator.evaluateLiteralExpression(mvelExpression(\"1\"), String.class.getCanonicalName(),\n                                                                     Collections.emptyList()\n        ))\n                .isInstanceOf(IllegalArgumentException.class)\n                .hasMessageStartingWith(\"Cannot assign a 'java.lang.Integer\");\n    }", "signature": "void evaluateLiteralExpression()", "full_signature": "@Test public void evaluateLiteralExpression()", "class_method_signature": "MVELExpressionEvaluatorTest.evaluateLiteralExpression()", "testcase": true, "constructor": false, "invocations": ["assertEquals", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "assertEquals", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "assertEquals", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "assertEquals", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "assertEquals", "asList", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "assertEquals", "emptyList", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "isEqualTo", "assertThat", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "isEqualTo", "assertThat", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "isEqualTo", "assertThat", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "valueOf", "assertEquals", "evaluateLiteralExpression", "getCanonicalName", "emptyList", "assertEquals", "evaluateLiteralExpression", "getCanonicalName", "emptyList", "assertEquals", "evaluateLiteralExpression", "getCanonicalName", "emptyList", "isInstanceOf", "assertThatThrownBy", "evaluateLiteralExpression", "getCanonicalName", "emptyList", "isInstanceOf", "assertThatThrownBy", "evaluateLiteralExpression", "getCanonicalName", "emptyList", "assertEquals", "asList", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "put", "assertEquals", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "assertEquals", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "assertEquals", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "assertEquals", "emptyMap", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList", "isInstanceOf", "assertThatThrownBy", "evaluateLiteralExpression", "getCanonicalName", "emptyList", "hasMessageStartingWith", "isInstanceOf", "assertThatThrownBy", "evaluateLiteralExpression", "mvelExpression", "getCanonicalName", "emptyList"]}, "focal_class": {"identifier": "MVELExpressionEvaluator", "superclass": "", "interfaces": "implements ExpressionEvaluator", "fields": [{"original_string": "private final ParserConfiguration config;", "modifier": "private final", "type": "ParserConfiguration", "declarator": "config", "var_name": "config"}, {"original_string": "private final MVELEvaluator evaluator = MVELSafeHelper.getEvaluator();", "modifier": "private final", "type": "MVELEvaluator", "declarator": "evaluator = MVELSafeHelper.getEvaluator()", "var_name": "evaluator"}, {"original_string": "private final ClassLoader classLoader;", "modifier": "private final", "type": "ClassLoader", "declarator": "classLoader", "var_name": "classLoader"}], "methods": [{"identifier": "MVELExpressionEvaluator", "parameters": "(ClassLoader classLoader)", "modifiers": "public", "return": "", "signature": " MVELExpressionEvaluator(ClassLoader classLoader)", "full_signature": "public  MVELExpressionEvaluator(ClassLoader classLoader)", "class_method_signature": "MVELExpressionEvaluator.MVELExpressionEvaluator(ClassLoader classLoader)", "testcase": false, "constructor": true}, {"identifier": "evaluateUnaryExpression", "parameters": "(String rawExpression, Object resultValue, Class<?> resultClass)", "modifiers": "@Override public", "return": "boolean", "signature": "boolean evaluateUnaryExpression(String rawExpression, Object resultValue, Class<?> resultClass)", "full_signature": "@Override public boolean evaluateUnaryExpression(String rawExpression, Object resultValue, Class<?> resultClass)", "class_method_signature": "MVELExpressionEvaluator.evaluateUnaryExpression(String rawExpression, Object resultValue, Class<?> resultClass)", "testcase": false, "constructor": false}, {"identifier": "evaluateLiteralExpression", "parameters": "(String rawExpression, String className, List<String> genericClasses)", "modifiers": "@Override public", "return": "Object", "signature": "Object evaluateLiteralExpression(String rawExpression, String className, List<String> genericClasses)", "full_signature": "@Override public Object evaluateLiteralExpression(String rawExpression, String className, List<String> genericClasses)", "class_method_signature": "MVELExpressionEvaluator.evaluateLiteralExpression(String rawExpression, String className, List<String> genericClasses)", "testcase": false, "constructor": false}, {"identifier": "fromObjectToExpression", "parameters": "(Object value)", "modifiers": "@Override public", "return": "String", "signature": "String fromObjectToExpression(Object value)", "full_signature": "@Override public String fromObjectToExpression(Object value)", "class_method_signature": "MVELExpressionEvaluator.fromObjectToExpression(Object value)", "testcase": false, "constructor": false}, {"identifier": "compileAndExecute", "parameters": "(String rawExpression, Map<String, Object> params)", "modifiers": "protected", "return": "Object", "signature": "Object compileAndExecute(String rawExpression, Map<String, Object> params)", "full_signature": "protected Object compileAndExecute(String rawExpression, Map<String, Object> params)", "class_method_signature": "MVELExpressionEvaluator.compileAndExecute(String rawExpression, Map<String, Object> params)", "testcase": false, "constructor": false}, {"identifier": "cleanExpression", "parameters": "(String rawExpression)", "modifiers": "protected", "return": "String", "signature": "String cleanExpression(String rawExpression)", "full_signature": "protected String cleanExpression(String rawExpression)", "class_method_signature": "MVELExpressionEvaluator.cleanExpression(String rawExpression)", "testcase": false, "constructor": false}], "file": "drools-scenario-simulation/drools-scenario-simulation-backend/src/main/java/org/drools/scenariosimulation/backend/expression/MVELExpressionEvaluator.java"}, "focal_method": {"identifier": "evaluateLiteralExpression", "parameters": "(String rawExpression, String className, List<String> genericClasses)", "modifiers": "@Override public", "return": "Object", "body": "@Override\n    public Object evaluateLiteralExpression(String rawExpression, String className, List<String> genericClasses) {\n        Object expressionResult = compileAndExecute(rawExpression, new HashMap<>());\n        Class<Object> requiredClass = loadClass(className, classLoader);\n        if (expressionResult != null && !requiredClass.isAssignableFrom(expressionResult.getClass())) {\n            throw new IllegalArgumentException(\"Cannot assign a '\" + expressionResult.getClass().getCanonicalName() +\n                                                       \"' to '\" + requiredClass.getCanonicalName() + \"'\");\n        }\n        return expressionResult;\n    }", "signature": "Object evaluateLiteralExpression(String rawExpression, String className, List<String> genericClasses)", "full_signature": "@Override public Object evaluateLiteralExpression(String rawExpression, String className, List<String> genericClasses)", "class_method_signature": "MVELExpressionEvaluator.evaluateLiteralExpression(String rawExpression, String className, List<String> genericClasses)", "testcase": false, "constructor": false, "invocations": ["compileAndExecute", "loadClass", "isAssignableFrom", "getClass", "getCanonicalName", "getClass", "getCanonicalName"]}, "repository": {"repo_id": 1381673, "url": "https://github.com/kiegroup/drools", "stars": 2733, "created": "2/18/2011 8:37:05 AM +00:00", "updates": "2020-01-27T13:12:15+00:00", "fork": "False", "license": "licensed"}}