{"test_class": {"identifier": "ForkableRepoValidatorTest", "superclass": "", "interfaces": "", "fields": [], "file": "dockerfile-image-update/src/test/java/com/salesforce/dockerfileimageupdate/process/ForkableRepoValidatorTest.java"}, "test_case": {"identifier": "testContentHasChangesInDefaultBranch", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testContentHasChangesInDefaultBranch() throws InterruptedException, IOException {\n        DockerfileGitHubUtil dockerfileGitHubUtil = mock(DockerfileGitHubUtil.class);\n        GHRepository repo = mock(GHRepository.class);\n        ForkableRepoValidator validator = new ForkableRepoValidator(dockerfileGitHubUtil);\n        GHContent content = mock(GHContent.class);\n        when(content.getPath()).thenReturn(\"/Dockerfile\");\n        GitForkBranch gitForkBranch = new GitForkBranch(\"someImage\", \"someTag\", null);\n        when(dockerfileGitHubUtil.tryRetrievingContent(eq(repo), any(), any())).thenReturn(content);\n        InputStream inputStream = new ByteArrayInputStream(\"FROM someImage\".getBytes());\n        when(content.read()).thenReturn(inputStream);\n\n        assertEquals(validator.contentHasChangesInDefaultBranch(repo, content, gitForkBranch), shouldForkResult());\n    }", "signature": "void testContentHasChangesInDefaultBranch()", "full_signature": "@Test public void testContentHasChangesInDefaultBranch()", "class_method_signature": "ForkableRepoValidatorTest.testContentHasChangesInDefaultBranch()", "testcase": true, "constructor": false, "invocations": ["mock", "mock", "mock", "thenReturn", "when", "getPath", "thenReturn", "when", "tryRetrievingContent", "eq", "any", "any", "getBytes", "thenReturn", "when", "read", "assertEquals", "contentHasChangesInDefaultBranch", "shouldForkResult"]}, "focal_class": {"identifier": "ForkableRepoValidator", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger log = LoggerFactory.getLogger(ForkableRepoValidator.class);", "modifier": "private static final", "type": "Logger", "declarator": "log = LoggerFactory.getLogger(ForkableRepoValidator.class)", "var_name": "log"}, {"original_string": "public static final String REPO_IS_FORK =\n            \"it's a fork already. Sending a PR to a fork is unsupported at the moment.\";", "modifier": "public static final", "type": "String", "declarator": "REPO_IS_FORK =\n            \"it's a fork already. Sending a PR to a fork is unsupported at the moment.\"", "var_name": "REPO_IS_FORK"}, {"original_string": "public static final String REPO_IS_ARCHIVED = \"it's archived.\";", "modifier": "public static final", "type": "String", "declarator": "REPO_IS_ARCHIVED = \"it's archived.\"", "var_name": "REPO_IS_ARCHIVED"}, {"original_string": "public static final String REPO_IS_OWNED_BY_THIS_USER = \"it is owned by this user.\";", "modifier": "public static final", "type": "String", "declarator": "REPO_IS_OWNED_BY_THIS_USER = \"it is owned by this user.\"", "var_name": "REPO_IS_OWNED_BY_THIS_USER"}, {"original_string": "public static final String COULD_NOT_CHECK_THIS_USER =\n            \"we could not determine fork status because we don't know the identity of the authenticated user.\";", "modifier": "public static final", "type": "String", "declarator": "COULD_NOT_CHECK_THIS_USER =\n            \"we could not determine fork status because we don't know the identity of the authenticated user.\"", "var_name": "COULD_NOT_CHECK_THIS_USER"}, {"original_string": "public static final String CONTENT_PATH_NOT_IN_DEFAULT_BRANCH_TEMPLATE =\n            \"didn't find content path %s in default branch\";", "modifier": "public static final", "type": "String", "declarator": "CONTENT_PATH_NOT_IN_DEFAULT_BRANCH_TEMPLATE =\n            \"didn't find content path %s in default branch\"", "var_name": "CONTENT_PATH_NOT_IN_DEFAULT_BRANCH_TEMPLATE"}, {"original_string": "public static final String COULD_NOT_FIND_IMAGE_TO_UPDATE_TEMPLATE =\n            \"didn't find the image '%s' which required an update in path %s\";", "modifier": "public static final", "type": "String", "declarator": "COULD_NOT_FIND_IMAGE_TO_UPDATE_TEMPLATE =\n            \"didn't find the image '%s' which required an update in path %s\"", "var_name": "COULD_NOT_FIND_IMAGE_TO_UPDATE_TEMPLATE"}, {"original_string": "private final DockerfileGitHubUtil dockerfileGitHubUtil;", "modifier": "private final", "type": "DockerfileGitHubUtil", "declarator": "dockerfileGitHubUtil", "var_name": "dockerfileGitHubUtil"}], "methods": [{"identifier": "ForkableRepoValidator", "parameters": "(DockerfileGitHubUtil dockerfileGitHubUtil)", "modifiers": "public", "return": "", "signature": " ForkableRepoValidator(DockerfileGitHubUtil dockerfileGitHubUtil)", "full_signature": "public  ForkableRepoValidator(DockerfileGitHubUtil dockerfileGitHubUtil)", "class_method_signature": "ForkableRepoValidator.ForkableRepoValidator(DockerfileGitHubUtil dockerfileGitHubUtil)", "testcase": false, "constructor": true}, {"identifier": "shouldFork", "parameters": "(GHRepository parentRepo,\n                                       GHContent searchResultContent,\n                                       GitForkBranch gitForkBranch)", "modifiers": "public", "return": "ShouldForkResult", "signature": "ShouldForkResult shouldFork(GHRepository parentRepo,\n                                       GHContent searchResultContent,\n                                       GitForkBranch gitForkBranch)", "full_signature": "public ShouldForkResult shouldFork(GHRepository parentRepo,\n                                       GHContent searchResultContent,\n                                       GitForkBranch gitForkBranch)", "class_method_signature": "ForkableRepoValidator.shouldFork(GHRepository parentRepo,\n                                       GHContent searchResultContent,\n                                       GitForkBranch gitForkBranch)", "testcase": false, "constructor": false}, {"identifier": "contentHasChangesInDefaultBranch", "parameters": "(GHRepository parentRepo,\n                                                                GHContent searchResultContent,\n                                                                GitForkBranch gitForkBranch)", "modifiers": "protected", "return": "ShouldForkResult", "signature": "ShouldForkResult contentHasChangesInDefaultBranch(GHRepository parentRepo,\n                                                                GHContent searchResultContent,\n                                                                GitForkBranch gitForkBranch)", "full_signature": "protected ShouldForkResult contentHasChangesInDefaultBranch(GHRepository parentRepo,\n                                                                GHContent searchResultContent,\n                                                                GitForkBranch gitForkBranch)", "class_method_signature": "ForkableRepoValidator.contentHasChangesInDefaultBranch(GHRepository parentRepo,\n                                                                GHContent searchResultContent,\n                                                                GitForkBranch gitForkBranch)", "testcase": false, "constructor": false}, {"identifier": "hasNoChanges", "parameters": "(GHContent content, GitForkBranch gitForkBranch)", "modifiers": "protected", "return": "boolean", "signature": "boolean hasNoChanges(GHContent content, GitForkBranch gitForkBranch)", "full_signature": "protected boolean hasNoChanges(GHContent content, GitForkBranch gitForkBranch)", "class_method_signature": "ForkableRepoValidator.hasNoChanges(GHContent content, GitForkBranch gitForkBranch)", "testcase": false, "constructor": false}, {"identifier": "thisUserIsNotOwner", "parameters": "(GHRepository parentRepo)", "modifiers": "protected", "return": "ShouldForkResult", "signature": "ShouldForkResult thisUserIsNotOwner(GHRepository parentRepo)", "full_signature": "protected ShouldForkResult thisUserIsNotOwner(GHRepository parentRepo)", "class_method_signature": "ForkableRepoValidator.thisUserIsNotOwner(GHRepository parentRepo)", "testcase": false, "constructor": false}, {"identifier": "parentIsFork", "parameters": "(GHRepository parentRepo)", "modifiers": "protected", "return": "ShouldForkResult", "signature": "ShouldForkResult parentIsFork(GHRepository parentRepo)", "full_signature": "protected ShouldForkResult parentIsFork(GHRepository parentRepo)", "class_method_signature": "ForkableRepoValidator.parentIsFork(GHRepository parentRepo)", "testcase": false, "constructor": false}, {"identifier": "parentIsArchived", "parameters": "(GHRepository parentRepo)", "modifiers": "protected", "return": "ShouldForkResult", "signature": "ShouldForkResult parentIsArchived(GHRepository parentRepo)", "full_signature": "protected ShouldForkResult parentIsArchived(GHRepository parentRepo)", "class_method_signature": "ForkableRepoValidator.parentIsArchived(GHRepository parentRepo)", "testcase": false, "constructor": false}], "file": "dockerfile-image-update/src/main/java/com/salesforce/dockerfileimageupdate/process/ForkableRepoValidator.java"}, "focal_method": {"identifier": "contentHasChangesInDefaultBranch", "parameters": "(GHRepository parentRepo,\n                                                                GHContent searchResultContent,\n                                                                GitForkBranch gitForkBranch)", "modifiers": "protected", "return": "ShouldForkResult", "body": "protected ShouldForkResult contentHasChangesInDefaultBranch(GHRepository parentRepo,\n                                                                GHContent searchResultContent,\n                                                                GitForkBranch gitForkBranch) {\n        try {\n            String searchContentPath = searchResultContent.getPath();\n            GHContent content =\n                    dockerfileGitHubUtil.tryRetrievingContent(parentRepo,\n                            searchContentPath, parentRepo.getDefaultBranch());\n            if (content == null) {\n                return shouldNotForkResult(\n                        String.format(CONTENT_PATH_NOT_IN_DEFAULT_BRANCH_TEMPLATE, searchContentPath));\n            } else {\n                if (hasNoChanges(content, gitForkBranch)) {\n                    return shouldNotForkResult(\n                            String.format(COULD_NOT_FIND_IMAGE_TO_UPDATE_TEMPLATE,\n                                    gitForkBranch.getImageName(), searchContentPath));\n                }\n            }\n        } catch (InterruptedException e) {\n            log.warn(\"Couldn't get parent content to check for some reason for {}. Trying to proceed... exception: {}\",\n                    parentRepo.getFullName(), e.getMessage());\n        }\n        return shouldForkResult();\n    }", "signature": "ShouldForkResult contentHasChangesInDefaultBranch(GHRepository parentRepo,\n                                                                GHContent searchResultContent,\n                                                                GitForkBranch gitForkBranch)", "full_signature": "protected ShouldForkResult contentHasChangesInDefaultBranch(GHRepository parentRepo,\n                                                                GHContent searchResultContent,\n                                                                GitForkBranch gitForkBranch)", "class_method_signature": "ForkableRepoValidator.contentHasChangesInDefaultBranch(GHRepository parentRepo,\n                                                                GHContent searchResultContent,\n                                                                GitForkBranch gitForkBranch)", "testcase": false, "constructor": false, "invocations": ["getPath", "tryRetrievingContent", "getDefaultBranch", "shouldNotForkResult", "format", "hasNoChanges", "shouldNotForkResult", "format", "getImageName", "warn", "getFullName", "getMessage", "shouldForkResult"]}, "repository": {"repo_id": 104787715, "url": "https://github.com/salesforce/dockerfile-image-update", "stars": 62, "created": "9/25/2017 6:38:13 PM +00:00", "updates": "2020-01-23T07:15:59+00:00", "fork": "False", "license": "licensed"}}