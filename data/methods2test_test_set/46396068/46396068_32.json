{"test_class": {"identifier": "ExportKeysTest", "superclass": "extends TestBase", "interfaces": "", "fields": [], "file": "hbase0.98/hbase-manager-0.98/src/test/java/com/kakao/hbase/manager/command/ExportKeysTest.java"}, "test_case": {"identifier": "testRun", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testRun() throws Exception {\n        String outputFile = \"exportkeys_test.keys\";\n        try {\n            byte[] splitPoint = \"splitpoint\".getBytes();\n\n            splitTable(splitPoint);\n\n            String[] argsParam = {\"zookeeper\", tableName, outputFile};\n            Args args = new ManagerArgs(argsParam);\n            assertEquals(\"zookeeper\", args.getZookeeperQuorum());\n            ExportKeys command = new ExportKeys(admin, args);\n            waitForSplitting(2);\n            command.run();\n\n            int i = 0;\n            List<Triple<String, String, String>> results = new ArrayList<>();\n            for (String keys : Files.readAllLines(Paths.get(outputFile), Constant.CHARSET)) {\n                i++;\n\n                String[] split = keys.split(ExportKeys.DELIMITER);\n                results.add(new ImmutableTriple<>(split[0], split[1], split[2]));\n            }\n            assertEquals(2, i);\n\n            assertEquals(tableName, results.get(0).getLeft().trim());\n            assertArrayEquals(\"\".getBytes(), Bytes.toBytesBinary(results.get(0).getMiddle().trim()));\n            assertArrayEquals(splitPoint, Bytes.toBytesBinary(results.get(0).getRight().trim()));\n            assertEquals(tableName, results.get(1).getLeft().trim());\n            assertArrayEquals(splitPoint, Bytes.toBytesBinary(results.get(1).getMiddle().trim()));\n            assertArrayEquals(\"\".getBytes(), Bytes.toBytesBinary(results.get(1).getRight().trim()));\n\n            // split once more\n            byte[] splitPoint2 = Bytes.toBytes(100L);\n\n            splitTable(splitPoint2);\n\n            command.run();\n\n            i = 0;\n            results.clear();\n            for (String keys : Files.readAllLines(Paths.get(outputFile), Constant.CHARSET)) {\n                i++;\n\n                String[] split = keys.split(ExportKeys.DELIMITER);\n                results.add(new ImmutableTriple<>(split[0], split[1], split[2]));\n            }\n            assertEquals(3, i);\n\n            assertEquals(tableName, results.get(0).getLeft().trim());\n            assertArrayEquals(\"\".getBytes(), Bytes.toBytesBinary(results.get(0).getMiddle().trim()));\n            assertArrayEquals(splitPoint2, Bytes.toBytesBinary(results.get(0).getRight().trim()));\n            assertEquals(tableName, results.get(1).getLeft().trim());\n            assertArrayEquals(splitPoint2, Bytes.toBytesBinary(results.get(1).getMiddle().trim()));\n            assertArrayEquals(splitPoint, Bytes.toBytesBinary(results.get(1).getRight().trim()));\n            assertEquals(tableName, results.get(2).getLeft().trim());\n            assertArrayEquals(splitPoint, Bytes.toBytesBinary(results.get(2).getMiddle().trim()));\n            assertArrayEquals(\"\".getBytes(), Bytes.toBytesBinary(results.get(2).getRight().trim()));\n        } finally {\n            Files.delete(Paths.get(outputFile));\n        }\n    }", "signature": "void testRun()", "full_signature": "@Test public void testRun()", "class_method_signature": "ExportKeysTest.testRun()", "testcase": true, "constructor": false, "invocations": ["getBytes", "splitTable", "assertEquals", "getZookeeperQuorum", "waitForSplitting", "run", "readAllLines", "get", "split", "add", "assertEquals", "assertEquals", "trim", "getLeft", "get", "assertArrayEquals", "getBytes", "toBytesBinary", "trim", "getMiddle", "get", "assertArrayEquals", "toBytesBinary", "trim", "getRight", "get", "assertEquals", "trim", "getLeft", "get", "assertArrayEquals", "toBytesBinary", "trim", "getMiddle", "get", "assertArrayEquals", "getBytes", "toBytesBinary", "trim", "getRight", "get", "toBytes", "splitTable", "run", "clear", "readAllLines", "get", "split", "add", "assertEquals", "assertEquals", "trim", "getLeft", "get", "assertArrayEquals", "getBytes", "toBytesBinary", "trim", "getMiddle", "get", "assertArrayEquals", "toBytesBinary", "trim", "getRight", "get", "assertEquals", "trim", "getLeft", "get", "assertArrayEquals", "toBytesBinary", "trim", "getMiddle", "get", "assertArrayEquals", "toBytesBinary", "trim", "getRight", "get", "assertEquals", "trim", "getLeft", "get", "assertArrayEquals", "toBytesBinary", "trim", "getMiddle", "get", "assertArrayEquals", "getBytes", "toBytesBinary", "trim", "getRight", "get", "delete", "get"]}, "focal_class": {"identifier": "ExportKeys", "superclass": "", "interfaces": "implements Command", "fields": [{"original_string": "static final String DELIMITER = \"-\";", "modifier": "static final", "type": "String", "declarator": "DELIMITER = \"-\"", "var_name": "DELIMITER"}, {"original_string": "private final HBaseAdmin admin;", "modifier": "private final", "type": "HBaseAdmin", "declarator": "admin", "var_name": "admin"}, {"original_string": "private final Args args;", "modifier": "private final", "type": "Args", "declarator": "args", "var_name": "args"}, {"original_string": "private final String outputFileName;", "modifier": "private final", "type": "String", "declarator": "outputFileName", "var_name": "outputFileName"}, {"original_string": "private final int exportThreshold;", "modifier": "private final", "type": "int", "declarator": "exportThreshold", "var_name": "exportThreshold"}], "methods": [{"identifier": "ExportKeys", "parameters": "(HBaseAdmin admin, Args args)", "modifiers": "public", "return": "", "signature": " ExportKeys(HBaseAdmin admin, Args args)", "full_signature": "public  ExportKeys(HBaseAdmin admin, Args args)", "class_method_signature": "ExportKeys.ExportKeys(HBaseAdmin admin, Args args)", "testcase": false, "constructor": true}, {"identifier": "usage", "parameters": "()", "modifiers": "public static", "return": "String", "signature": "String usage()", "full_signature": "public static String usage()", "class_method_signature": "ExportKeys.usage()", "testcase": false, "constructor": false}, {"identifier": "run", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void run()", "full_signature": "@Override public void run()", "class_method_signature": "ExportKeys.run()", "testcase": false, "constructor": false}, {"identifier": "parseExportThreshold", "parameters": "()", "modifiers": "private", "return": "int", "signature": "int parseExportThreshold()", "full_signature": "private int parseExportThreshold()", "class_method_signature": "ExportKeys.parseExportThreshold()", "testcase": false, "constructor": false}, {"identifier": "export", "parameters": "(PrintWriter writer, HRegionInfo regionInfo)", "modifiers": "private", "return": "boolean", "signature": "boolean export(PrintWriter writer, HRegionInfo regionInfo)", "full_signature": "private boolean export(PrintWriter writer, HRegionInfo regionInfo)", "class_method_signature": "ExportKeys.export(PrintWriter writer, HRegionInfo regionInfo)", "testcase": false, "constructor": false}], "file": "hbase0.98/hbase-manager-0.98/src/main/java/com/kakao/hbase/manager/command/ExportKeys.java"}, "focal_method": {"identifier": "run", "parameters": "()", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void run() throws Exception {\n        try (PrintWriter writer = new PrintWriter(outputFileName, Constant.CHARSET.name())) {\n            writer.print(\"\");\n\n            TableInfo tableInfo = new TableInfo(admin, args.getTableName(), args);\n            tableInfo.refresh();\n            Set<HRegionInfo> regions = tableInfo.getRegionInfoSet();\n\n            int exported = 0, storeFileSizeMBSum = 0;\n            for (HRegionInfo regionInfo : regions) {\n                System.out.println(regionInfo.toString());\n\n                if (args.getOptionSet().has(Args.OPTION_OPTIMIZE)) {\n                    storeFileSizeMBSum += tableInfo.getRegionLoad(regionInfo).getStorefileSizeMB();\n                    if (storeFileSizeMBSum < exportThreshold) {\n                        continue;\n                    }\n                }\n                if (export(writer, regionInfo)) exported++;\n                storeFileSizeMBSum = 0;\n            }\n\n            System.out.println(\"\\n\" + regions.size() + \" regions are scanned.\");\n            System.out.println(exported + \" startkeys are exported.\");\n            System.out.println(\"\\n\" + outputFileName + \" file is successfully created.\");\n        }\n    }", "signature": "void run()", "full_signature": "@Override public void run()", "class_method_signature": "ExportKeys.run()", "testcase": false, "constructor": false, "invocations": ["name", "print", "getTableName", "refresh", "getRegionInfoSet", "println", "toString", "has", "getOptionSet", "getStorefileSizeMB", "getRegionLoad", "export", "println", "size", "println", "println"]}, "repository": {"repo_id": 46396068, "url": "https://github.com/kakao/hbase-tools", "language": "Java", "is_fork": false, "fork_count": 21, "stargazer_count": 49, "size": 1758, "license": "licensed"}}