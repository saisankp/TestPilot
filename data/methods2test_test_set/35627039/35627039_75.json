{"test_class": {"identifier": "ComponentMetricSummaryTest", "superclass": "", "interfaces": "", "fields": [], "file": "streams/service/src/test/java/com/hortonworks/streamline/streams/service/ComponentMetricSummaryTest.java"}, "test_case": {"identifier": "testCalculateWeightedAverageLacksWeightInformation", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testCalculateWeightedAverageLacksWeightInformation() {\n        Map<Long, Double> keyMetrics = new HashMap<>();\n        keyMetrics.put(1L, 10.0);\n        keyMetrics.put(2L, 20.0);\n\n        // no weight for both 1L and 2L\n        double actual = ComponentMetricSummary.calculateWeightedAverage(keyMetrics, Collections.emptyMap());\n        Assert.assertEquals(0.0, actual, DoubleUtils.EPSILON);\n\n        Map<Long, Double> weightMetrics = new HashMap<>();\n        // no weight for 1L\n        weightMetrics.put(2L, 5.0);\n\n        actual = ComponentMetricSummary.calculateWeightedAverage(keyMetrics, weightMetrics);\n\n        // only weight and value for 2L is considered\n        Assert.assertEquals(20.0, actual, DoubleUtils.EPSILON);\n    }", "signature": "void testCalculateWeightedAverageLacksWeightInformation()", "full_signature": "@Test public void testCalculateWeightedAverageLacksWeightInformation()", "class_method_signature": "ComponentMetricSummaryTest.testCalculateWeightedAverageLacksWeightInformation()", "testcase": true, "constructor": false, "invocations": ["put", "put", "calculateWeightedAverage", "emptyMap", "assertEquals", "put", "calculateWeightedAverage", "assertEquals"]}, "focal_class": {"identifier": "ComponentMetricSummary", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String METRIC_NAME_ACK_COUNT = \"ackedRecords\";", "modifier": "private static final", "type": "String", "declarator": "METRIC_NAME_ACK_COUNT = \"ackedRecords\"", "var_name": "METRIC_NAME_ACK_COUNT"}, {"original_string": "private final Long emitted;", "modifier": "private final", "type": "Long", "declarator": "emitted", "var_name": "emitted"}, {"original_string": "private final Long acked;", "modifier": "private final", "type": "Long", "declarator": "acked", "var_name": "acked"}, {"original_string": "private final Long failed;", "modifier": "private final", "type": "Long", "declarator": "failed", "var_name": "failed"}, {"original_string": "private final Double latency;", "modifier": "private final", "type": "Double", "declarator": "latency", "var_name": "latency"}, {"original_string": "private final Double completeLatency;", "modifier": "private final", "type": "Double", "declarator": "completeLatency", "var_name": "completeLatency"}, {"original_string": "private final Double processTime;", "modifier": "private final", "type": "Double", "declarator": "processTime", "var_name": "processTime"}, {"original_string": "private final Double executeTime;", "modifier": "private final", "type": "Double", "declarator": "executeTime", "var_name": "executeTime"}, {"original_string": "private final Long prevEmitted;", "modifier": "private final", "type": "Long", "declarator": "prevEmitted", "var_name": "prevEmitted"}, {"original_string": "private final Long prevAcked;", "modifier": "private final", "type": "Long", "declarator": "prevAcked", "var_name": "prevAcked"}, {"original_string": "private final Long prevFailed;", "modifier": "private final", "type": "Long", "declarator": "prevFailed", "var_name": "prevFailed"}, {"original_string": "private final Double prevLatency;", "modifier": "private final", "type": "Double", "declarator": "prevLatency", "var_name": "prevLatency"}, {"original_string": "private final Double prevCompleteLatency;", "modifier": "private final", "type": "Double", "declarator": "prevCompleteLatency", "var_name": "prevCompleteLatency"}, {"original_string": "private final Double prevProcessTime;", "modifier": "private final", "type": "Double", "declarator": "prevProcessTime", "var_name": "prevProcessTime"}, {"original_string": "private final Double prevExecuteTime;", "modifier": "private final", "type": "Double", "declarator": "prevExecuteTime", "var_name": "prevExecuteTime"}], "methods": [{"identifier": "ComponentMetricSummary", "parameters": "(Long emitted, Long acked, Long failed, Double latency, Double completeLatency,\n                                  Double processTime, Double executeTime,\n                                  Long prevEmitted, Long prevAcked, Long prevFailed, Double prevLatency,\n                                  Double prevCompleteLatency, Double prevProcessTime, Double prevExecuteTime)", "modifiers": "public", "return": "", "signature": " ComponentMetricSummary(Long emitted, Long acked, Long failed, Double latency, Double completeLatency,\n                                  Double processTime, Double executeTime,\n                                  Long prevEmitted, Long prevAcked, Long prevFailed, Double prevLatency,\n                                  Double prevCompleteLatency, Double prevProcessTime, Double prevExecuteTime)", "full_signature": "public  ComponentMetricSummary(Long emitted, Long acked, Long failed, Double latency, Double completeLatency,\n                                  Double processTime, Double executeTime,\n                                  Long prevEmitted, Long prevAcked, Long prevFailed, Double prevLatency,\n                                  Double prevCompleteLatency, Double prevProcessTime, Double prevExecuteTime)", "class_method_signature": "ComponentMetricSummary.ComponentMetricSummary(Long emitted, Long acked, Long failed, Double latency, Double completeLatency,\n                                  Double processTime, Double executeTime,\n                                  Long prevEmitted, Long prevAcked, Long prevFailed, Double prevLatency,\n                                  Double prevCompleteLatency, Double prevProcessTime, Double prevExecuteTime)", "testcase": false, "constructor": true}, {"identifier": "getEmitted", "parameters": "()", "modifiers": "public", "return": "Long", "signature": "Long getEmitted()", "full_signature": "public Long getEmitted()", "class_method_signature": "ComponentMetricSummary.getEmitted()", "testcase": false, "constructor": false}, {"identifier": "getAcked", "parameters": "()", "modifiers": "public", "return": "Long", "signature": "Long getAcked()", "full_signature": "public Long getAcked()", "class_method_signature": "ComponentMetricSummary.getAcked()", "testcase": false, "constructor": false}, {"identifier": "getFailed", "parameters": "()", "modifiers": "public", "return": "Long", "signature": "Long getFailed()", "full_signature": "public Long getFailed()", "class_method_signature": "ComponentMetricSummary.getFailed()", "testcase": false, "constructor": false}, {"identifier": "getLatency", "parameters": "()", "modifiers": "@JsonInclude(JsonInclude.Include.NON_NULL) public", "return": "Double", "signature": "Double getLatency()", "full_signature": "@JsonInclude(JsonInclude.Include.NON_NULL) public Double getLatency()", "class_method_signature": "ComponentMetricSummary.getLatency()", "testcase": false, "constructor": false}, {"identifier": "getCompleteLatency", "parameters": "()", "modifiers": "@JsonInclude(JsonInclude.Include.NON_NULL) public", "return": "Double", "signature": "Double getCompleteLatency()", "full_signature": "@JsonInclude(JsonInclude.Include.NON_NULL) public Double getCompleteLatency()", "class_method_signature": "ComponentMetricSummary.getCompleteLatency()", "testcase": false, "constructor": false}, {"identifier": "getProcessTime", "parameters": "()", "modifiers": "@JsonInclude(JsonInclude.Include.NON_NULL) public", "return": "Double", "signature": "Double getProcessTime()", "full_signature": "@JsonInclude(JsonInclude.Include.NON_NULL) public Double getProcessTime()", "class_method_signature": "ComponentMetricSummary.getProcessTime()", "testcase": false, "constructor": false}, {"identifier": "getExecuteTime", "parameters": "()", "modifiers": "@JsonInclude(JsonInclude.Include.NON_NULL) public", "return": "Double", "signature": "Double getExecuteTime()", "full_signature": "@JsonInclude(JsonInclude.Include.NON_NULL) public Double getExecuteTime()", "class_method_signature": "ComponentMetricSummary.getExecuteTime()", "testcase": false, "constructor": false}, {"identifier": "getPrevEmitted", "parameters": "()", "modifiers": "public", "return": "Long", "signature": "Long getPrevEmitted()", "full_signature": "public Long getPrevEmitted()", "class_method_signature": "ComponentMetricSummary.getPrevEmitted()", "testcase": false, "constructor": false}, {"identifier": "getPrevAcked", "parameters": "()", "modifiers": "public", "return": "Long", "signature": "Long getPrevAcked()", "full_signature": "public Long getPrevAcked()", "class_method_signature": "ComponentMetricSummary.getPrevAcked()", "testcase": false, "constructor": false}, {"identifier": "getPrevFailed", "parameters": "()", "modifiers": "public", "return": "Long", "signature": "Long getPrevFailed()", "full_signature": "public Long getPrevFailed()", "class_method_signature": "ComponentMetricSummary.getPrevFailed()", "testcase": false, "constructor": false}, {"identifier": "getPrevLatency", "parameters": "()", "modifiers": "@JsonInclude(JsonInclude.Include.NON_NULL) public", "return": "Double", "signature": "Double getPrevLatency()", "full_signature": "@JsonInclude(JsonInclude.Include.NON_NULL) public Double getPrevLatency()", "class_method_signature": "ComponentMetricSummary.getPrevLatency()", "testcase": false, "constructor": false}, {"identifier": "getPrevCompleteLatency", "parameters": "()", "modifiers": "@JsonInclude(JsonInclude.Include.NON_NULL) public", "return": "Double", "signature": "Double getPrevCompleteLatency()", "full_signature": "@JsonInclude(JsonInclude.Include.NON_NULL) public Double getPrevCompleteLatency()", "class_method_signature": "ComponentMetricSummary.getPrevCompleteLatency()", "testcase": false, "constructor": false}, {"identifier": "getPrevProcessTime", "parameters": "()", "modifiers": "@JsonInclude(JsonInclude.Include.NON_NULL) public", "return": "Double", "signature": "Double getPrevProcessTime()", "full_signature": "@JsonInclude(JsonInclude.Include.NON_NULL) public Double getPrevProcessTime()", "class_method_signature": "ComponentMetricSummary.getPrevProcessTime()", "testcase": false, "constructor": false}, {"identifier": "getPrevExecuteTime", "parameters": "()", "modifiers": "@JsonInclude(JsonInclude.Include.NON_NULL) public", "return": "Double", "signature": "Double getPrevExecuteTime()", "full_signature": "@JsonInclude(JsonInclude.Include.NON_NULL) public Double getPrevExecuteTime()", "class_method_signature": "ComponentMetricSummary.getPrevExecuteTime()", "testcase": false, "constructor": false}, {"identifier": "convertTopologyMetric", "parameters": "(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                               TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "modifiers": "public static", "return": "ComponentMetricSummary", "signature": "ComponentMetricSummary convertTopologyMetric(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                               TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "full_signature": "public static ComponentMetricSummary convertTopologyMetric(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                               TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "class_method_signature": "ComponentMetricSummary.convertTopologyMetric(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                               TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "testcase": false, "constructor": false}, {"identifier": "convertSourceMetric", "parameters": "(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                             TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "modifiers": "public static", "return": "ComponentMetricSummary", "signature": "ComponentMetricSummary convertSourceMetric(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                             TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "full_signature": "public static ComponentMetricSummary convertSourceMetric(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                             TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "class_method_signature": "ComponentMetricSummary.convertSourceMetric(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                             TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "testcase": false, "constructor": false}, {"identifier": "convertNonSourceMetric", "parameters": "(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                                TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "modifiers": "public static", "return": "ComponentMetricSummary", "signature": "ComponentMetricSummary convertNonSourceMetric(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                                TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "full_signature": "public static ComponentMetricSummary convertNonSourceMetric(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                                TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "class_method_signature": "ComponentMetricSummary.convertNonSourceMetric(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics,\n                                                                TopologyTimeSeriesMetrics.TimeSeriesComponentMetric prevMetrics)", "testcase": false, "constructor": false}, {"identifier": "aggregateFailed", "parameters": "(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "modifiers": "@VisibleForTesting static", "return": "long", "signature": "long aggregateFailed(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "full_signature": "@VisibleForTesting static long aggregateFailed(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "class_method_signature": "ComponentMetricSummary.aggregateFailed(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "testcase": false, "constructor": false}, {"identifier": "aggregateProcessLatency", "parameters": "(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "modifiers": "@VisibleForTesting static", "return": "double", "signature": "double aggregateProcessLatency(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "full_signature": "@VisibleForTesting static double aggregateProcessLatency(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "class_method_signature": "ComponentMetricSummary.aggregateProcessLatency(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "testcase": false, "constructor": false}, {"identifier": "aggregateExecuteLatency", "parameters": "(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "modifiers": "@VisibleForTesting static", "return": "double", "signature": "double aggregateExecuteLatency(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "full_signature": "@VisibleForTesting static double aggregateExecuteLatency(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "class_method_signature": "ComponentMetricSummary.aggregateExecuteLatency(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "testcase": false, "constructor": false}, {"identifier": "aggregateCompleteLatency", "parameters": "(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "modifiers": "@VisibleForTesting static", "return": "double", "signature": "double aggregateCompleteLatency(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "full_signature": "@VisibleForTesting static double aggregateCompleteLatency(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "class_method_signature": "ComponentMetricSummary.aggregateCompleteLatency(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "testcase": false, "constructor": false}, {"identifier": "aggregateEmitted", "parameters": "(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "modifiers": "@VisibleForTesting static", "return": "long", "signature": "long aggregateEmitted(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "full_signature": "@VisibleForTesting static long aggregateEmitted(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "class_method_signature": "ComponentMetricSummary.aggregateEmitted(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "testcase": false, "constructor": false}, {"identifier": "aggregateAcked", "parameters": "(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "modifiers": "@VisibleForTesting static", "return": "long", "signature": "long aggregateAcked(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "full_signature": "@VisibleForTesting static long aggregateAcked(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "class_method_signature": "ComponentMetricSummary.aggregateAcked(TopologyTimeSeriesMetrics.TimeSeriesComponentMetric metrics)", "testcase": false, "constructor": false}, {"identifier": "calculateWeightedAverage", "parameters": "(Map<Long, Double> keyMetrics, Map<Long, Double> weightMetrics)", "modifiers": "@VisibleForTesting static", "return": "double", "signature": "double calculateWeightedAverage(Map<Long, Double> keyMetrics, Map<Long, Double> weightMetrics)", "full_signature": "@VisibleForTesting static double calculateWeightedAverage(Map<Long, Double> keyMetrics, Map<Long, Double> weightMetrics)", "class_method_signature": "ComponentMetricSummary.calculateWeightedAverage(Map<Long, Double> keyMetrics, Map<Long, Double> weightMetrics)", "testcase": false, "constructor": false}], "file": "streams/service/src/main/java/com/hortonworks/streamline/streams/service/ComponentMetricSummary.java"}, "focal_method": {"identifier": "calculateWeightedAverage", "parameters": "(Map<Long, Double> keyMetrics, Map<Long, Double> weightMetrics)", "modifiers": "@VisibleForTesting static", "return": "double", "body": "@VisibleForTesting\n    static double calculateWeightedAverage(Map<Long, Double> keyMetrics, Map<Long, Double> weightMetrics) {\n        Map<Long, Double> filteredKeyMetrics = keyMetrics.entrySet().stream()\n                .filter(entry -> entry.getValue() != null && DoubleUtils.notEqualsToZero(entry.getValue()))\n                .collect(toMap(e -> e.getKey(), e -> e.getValue()));\n\n        Map<Long, Double> filteredWeightMetrics = weightMetrics.entrySet().stream()\n                .filter(entry -> filteredKeyMetrics.containsKey(entry.getKey()))\n                .collect(toMap(e -> e.getKey(), e -> e.getValue()));\n\n        Double sumInputRecords = filteredWeightMetrics.values().stream().mapToDouble(d -> d).sum();\n\n        if (DoubleUtils.equalsToZero(sumInputRecords)) {\n            // total weight is zero\n            return 0.0d;\n        }\n\n        return filteredKeyMetrics.entrySet().stream()\n                .map(entry -> {\n                    Long timestamp = entry.getKey();\n                    double weight = filteredWeightMetrics.getOrDefault(timestamp, 0.0) / sumInputRecords;\n                    return entry.getValue() * weight;\n                }).mapToDouble(d -> d).sum();\n    }", "signature": "double calculateWeightedAverage(Map<Long, Double> keyMetrics, Map<Long, Double> weightMetrics)", "full_signature": "@VisibleForTesting static double calculateWeightedAverage(Map<Long, Double> keyMetrics, Map<Long, Double> weightMetrics)", "class_method_signature": "ComponentMetricSummary.calculateWeightedAverage(Map<Long, Double> keyMetrics, Map<Long, Double> weightMetrics)", "testcase": false, "constructor": false, "invocations": ["collect", "filter", "stream", "entrySet", "getValue", "notEqualsToZero", "getValue", "toMap", "getKey", "getValue", "collect", "filter", "stream", "entrySet", "containsKey", "getKey", "toMap", "getKey", "getValue", "sum", "mapToDouble", "stream", "values", "equalsToZero", "sum", "mapToDouble", "map", "stream", "entrySet", "getKey", "getOrDefault", "getValue"]}, "repository": {"repo_id": 35627039, "url": "https://github.com/hortonworks/streamline", "language": "Java", "is_fork": false, "fork_count": 94, "stargazer_count": 147, "size": 69226, "license": "licensed"}}