{"test_class": {"identifier": "JcrNamespaceRegistryTest", "superclass": "extends MultiUseAbstractTest", "interfaces": "", "fields": [{"original_string": "private NamespaceRegistry registry;", "modifier": "private", "type": "NamespaceRegistry", "declarator": "registry", "var_name": "registry"}], "file": "modeshape-jcr/src/test/java/org/modeshape/jcr/JcrNamespaceRegistryTest.java"}, "test_case": {"identifier": "shouldNotAllowRegisteringPrefixThatIsNotValidXmlNCName", "parameters": "()", "modifiers": "@Test( expected = NamespaceException.class ) public", "return": "void", "body": "@Test( expected = NamespaceException.class )\n    public void shouldNotAllowRegisteringPrefixThatIsNotValidXmlNCName() throws Exception {\n        registry.registerNamespace(\"1foot&in<door\", \"http://example.com\");\n    }", "signature": "void shouldNotAllowRegisteringPrefixThatIsNotValidXmlNCName()", "full_signature": "@Test( expected = NamespaceException.class ) public void shouldNotAllowRegisteringPrefixThatIsNotValidXmlNCName()", "class_method_signature": "JcrNamespaceRegistryTest.shouldNotAllowRegisteringPrefixThatIsNotValidXmlNCName()", "testcase": true, "constructor": false, "invocations": ["registerNamespace"]}, "focal_class": {"identifier": "JcrNamespaceRegistry", "superclass": "", "interfaces": "implements org.modeshape.jcr.api.NamespaceRegistry", "fields": [{"original_string": "static final String DEFAULT_NAMESPACE_PREFIX = \"\";", "modifier": "static final", "type": "String", "declarator": "DEFAULT_NAMESPACE_PREFIX = \"\"", "var_name": "DEFAULT_NAMESPACE_PREFIX"}, {"original_string": "static final String DEFAULT_NAMESPACE_URI = \"\";", "modifier": "static final", "type": "String", "declarator": "DEFAULT_NAMESPACE_URI = \"\"", "var_name": "DEFAULT_NAMESPACE_URI"}, {"original_string": "static final String XML_NAMESPACE_PREFIX = XMLConstants.XML_NS_PREFIX;", "modifier": "static final", "type": "String", "declarator": "XML_NAMESPACE_PREFIX = XMLConstants.XML_NS_PREFIX", "var_name": "XML_NAMESPACE_PREFIX"}, {"original_string": "static final String XML_NAMESPACE_URI = XMLConstants.XML_NS_URI;", "modifier": "static final", "type": "String", "declarator": "XML_NAMESPACE_URI = XMLConstants.XML_NS_URI", "var_name": "XML_NAMESPACE_URI"}, {"original_string": "static final String XMLNS_NAMESPACE_PREFIX = XMLConstants.XMLNS_ATTRIBUTE;", "modifier": "static final", "type": "String", "declarator": "XMLNS_NAMESPACE_PREFIX = XMLConstants.XMLNS_ATTRIBUTE", "var_name": "XMLNS_NAMESPACE_PREFIX"}, {"original_string": "static final String XMLNS_NAMESPACE_URI = XMLConstants.XMLNS_ATTRIBUTE_NS_URI;", "modifier": "static final", "type": "String", "declarator": "XMLNS_NAMESPACE_URI = XMLConstants.XMLNS_ATTRIBUTE_NS_URI", "var_name": "XMLNS_NAMESPACE_URI"}, {"original_string": "static final String XML_SCHEMA_NAMESPACE_PREFIX = \"xs\";", "modifier": "static final", "type": "String", "declarator": "XML_SCHEMA_NAMESPACE_PREFIX = \"xs\"", "var_name": "XML_SCHEMA_NAMESPACE_PREFIX"}, {"original_string": "static final String XML_SCHEMA_NAMESPACE_URI = \"http://www.w3.org/2001/XMLSchema\";", "modifier": "static final", "type": "String", "declarator": "XML_SCHEMA_NAMESPACE_URI = \"http://www.w3.org/2001/XMLSchema\"", "var_name": "XML_SCHEMA_NAMESPACE_URI"}, {"original_string": "static final String XML_SCHEMA_INSTANCE_NAMESPACE_PREFIX = \"xsi\";", "modifier": "static final", "type": "String", "declarator": "XML_SCHEMA_INSTANCE_NAMESPACE_PREFIX = \"xsi\"", "var_name": "XML_SCHEMA_INSTANCE_NAMESPACE_PREFIX"}, {"original_string": "static final String XML_SCHEMA_INSTANCE_NAMESPACE_URI = \"http://www.w3.org/2001/XMLSchema-instance\";", "modifier": "static final", "type": "String", "declarator": "XML_SCHEMA_INSTANCE_NAMESPACE_URI = \"http://www.w3.org/2001/XMLSchema-instance\"", "var_name": "XML_SCHEMA_INSTANCE_NAMESPACE_URI"}, {"original_string": "static final Set<String> STANDARD_BUILT_IN_PREFIXES;", "modifier": "static final", "type": "Set<String>", "declarator": "STANDARD_BUILT_IN_PREFIXES", "var_name": "STANDARD_BUILT_IN_PREFIXES"}, {"original_string": "static final Set<String> STANDARD_BUILT_IN_URIS;", "modifier": "static final", "type": "Set<String>", "declarator": "STANDARD_BUILT_IN_URIS", "var_name": "STANDARD_BUILT_IN_URIS"}, {"original_string": "static final Map<String, String> STANDARD_BUILT_IN_NAMESPACES_BY_PREFIX;", "modifier": "static final", "type": "Map<String, String>", "declarator": "STANDARD_BUILT_IN_NAMESPACES_BY_PREFIX", "var_name": "STANDARD_BUILT_IN_NAMESPACES_BY_PREFIX"}, {"original_string": "static final Map<String, String> STANDARD_BUILT_IN_PREFIXES_BY_NAMESPACE;", "modifier": "static final", "type": "Map<String, String>", "declarator": "STANDARD_BUILT_IN_PREFIXES_BY_NAMESPACE", "var_name": "STANDARD_BUILT_IN_PREFIXES_BY_NAMESPACE"}, {"original_string": "private final Behavior behavior;", "modifier": "private final", "type": "Behavior", "declarator": "behavior", "var_name": "behavior"}, {"original_string": "private final NamespaceRegistry registry;", "modifier": "private final", "type": "NamespaceRegistry", "declarator": "registry", "var_name": "registry"}, {"original_string": "private final NamespaceRegistry workspaceRegistry;", "modifier": "private final", "type": "NamespaceRegistry", "declarator": "workspaceRegistry", "var_name": "workspaceRegistry"}, {"original_string": "private final JcrSession session;", "modifier": "private final", "type": "JcrSession", "declarator": "session", "var_name": "session"}], "methods": [{"identifier": "JcrNamespaceRegistry", "parameters": "( NamespaceRegistry workspaceRegistry,\n                                    JcrSession session )", "modifiers": "protected", "return": "", "signature": " JcrNamespaceRegistry( NamespaceRegistry workspaceRegistry,\n                                    JcrSession session )", "full_signature": "protected  JcrNamespaceRegistry( NamespaceRegistry workspaceRegistry,\n                                    JcrSession session )", "class_method_signature": "JcrNamespaceRegistry.JcrNamespaceRegistry( NamespaceRegistry workspaceRegistry,\n                                    JcrSession session )", "testcase": false, "constructor": true}, {"identifier": "JcrNamespaceRegistry", "parameters": "( Behavior behavior,\n                          NamespaceRegistry localRegistry,\n                          NamespaceRegistry workspaceRegistry,\n                          JcrSession session )", "modifiers": "", "return": "", "signature": " JcrNamespaceRegistry( Behavior behavior,\n                          NamespaceRegistry localRegistry,\n                          NamespaceRegistry workspaceRegistry,\n                          JcrSession session )", "full_signature": "  JcrNamespaceRegistry( Behavior behavior,\n                          NamespaceRegistry localRegistry,\n                          NamespaceRegistry workspaceRegistry,\n                          JcrSession session )", "class_method_signature": "JcrNamespaceRegistry.JcrNamespaceRegistry( Behavior behavior,\n                          NamespaceRegistry localRegistry,\n                          NamespaceRegistry workspaceRegistry,\n                          JcrSession session )", "testcase": false, "constructor": true}, {"identifier": "checkSession", "parameters": "()", "modifiers": "protected final", "return": "void", "signature": "void checkSession()", "full_signature": "protected final void checkSession()", "class_method_signature": "JcrNamespaceRegistry.checkSession()", "testcase": false, "constructor": false}, {"identifier": "getPrefix", "parameters": "( String uri )", "modifiers": "@Override public", "return": "String", "signature": "String getPrefix( String uri )", "full_signature": "@Override public String getPrefix( String uri )", "class_method_signature": "JcrNamespaceRegistry.getPrefix( String uri )", "testcase": false, "constructor": false}, {"identifier": "getPrefixes", "parameters": "()", "modifiers": "@Override public", "return": "String[]", "signature": "String[] getPrefixes()", "full_signature": "@Override public String[] getPrefixes()", "class_method_signature": "JcrNamespaceRegistry.getPrefixes()", "testcase": false, "constructor": false}, {"identifier": "getURI", "parameters": "( String prefix )", "modifiers": "@Override public", "return": "String", "signature": "String getURI( String prefix )", "full_signature": "@Override public String getURI( String prefix )", "class_method_signature": "JcrNamespaceRegistry.getURI( String prefix )", "testcase": false, "constructor": false}, {"identifier": "getURIs", "parameters": "()", "modifiers": "@Override public", "return": "String[]", "signature": "String[] getURIs()", "full_signature": "@Override public String[] getURIs()", "class_method_signature": "JcrNamespaceRegistry.getURIs()", "testcase": false, "constructor": false}, {"identifier": "isRegisteredPrefix", "parameters": "( String prefix )", "modifiers": "@Override public", "return": "boolean", "signature": "boolean isRegisteredPrefix( String prefix )", "full_signature": "@Override public boolean isRegisteredPrefix( String prefix )", "class_method_signature": "JcrNamespaceRegistry.isRegisteredPrefix( String prefix )", "testcase": false, "constructor": false}, {"identifier": "isRegisteredUri", "parameters": "( String uri )", "modifiers": "@Override public", "return": "boolean", "signature": "boolean isRegisteredUri( String uri )", "full_signature": "@Override public boolean isRegisteredUri( String uri )", "class_method_signature": "JcrNamespaceRegistry.isRegisteredUri( String uri )", "testcase": false, "constructor": false}, {"identifier": "registerNamespace", "parameters": "( String prefix,\n                                                String uri )", "modifiers": "@Override public synchronized", "return": "void", "signature": "void registerNamespace( String prefix,\n                                                String uri )", "full_signature": "@Override public synchronized void registerNamespace( String prefix,\n                                                String uri )", "class_method_signature": "JcrNamespaceRegistry.registerNamespace( String prefix,\n                                                String uri )", "testcase": false, "constructor": false}, {"identifier": "unregisterNamespace", "parameters": "( String prefix )", "modifiers": "@Override public synchronized", "return": "void", "signature": "void unregisterNamespace( String prefix )", "full_signature": "@Override public synchronized void unregisterNamespace( String prefix )", "class_method_signature": "JcrNamespaceRegistry.unregisterNamespace( String prefix )", "testcase": false, "constructor": false}, {"identifier": "checkURINotInUse", "parameters": "( String uri )", "modifiers": "private", "return": "void", "signature": "void checkURINotInUse( String uri )", "full_signature": "private void checkURINotInUse( String uri )", "class_method_signature": "JcrNamespaceRegistry.checkURINotInUse( String uri )", "testcase": false, "constructor": false}, {"identifier": "registerNamespace", "parameters": "( String uri )", "modifiers": "@Override public", "return": "String", "signature": "String registerNamespace( String uri )", "full_signature": "@Override public String registerNamespace( String uri )", "class_method_signature": "JcrNamespaceRegistry.registerNamespace( String uri )", "testcase": false, "constructor": false}, {"identifier": "toString", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String toString()", "full_signature": "@Override public String toString()", "class_method_signature": "JcrNamespaceRegistry.toString()", "testcase": false, "constructor": false}], "file": "modeshape-jcr/src/main/java/org/modeshape/jcr/JcrNamespaceRegistry.java"}, "focal_method": {"identifier": "registerNamespace", "parameters": "( String prefix,\n                                                String uri )", "modifiers": "@Override public synchronized", "return": "void", "body": "@Override\n    public synchronized void registerNamespace( String prefix,\n                                                String uri ) throws NamespaceException, RepositoryException {\n        CheckArg.isNotNull(prefix, \"prefix\");\n        CheckArg.isNotNull(uri, \"uri\");\n        checkSession();\n\n        // Check the zero-length prefix and zero-length URI ...\n        if (DEFAULT_NAMESPACE_PREFIX.equals(prefix) || DEFAULT_NAMESPACE_URI.equals(uri)) {\n            throw new NamespaceException(JcrI18n.unableToChangeTheDefaultNamespace.text());\n        }\n\n        // Check whether the prefix begins with 'xml' (in any case) ...\n        if (prefix.toLowerCase().startsWith(XML_NAMESPACE_PREFIX)) {\n            throw new NamespaceException(JcrI18n.unableToRegisterNamespaceUsingXmlPrefix.text(prefix, uri));\n        }\n\n        // The prefix must be a valid XML Namespace prefix (i.e., a valid NCName) ...\n        if (!XmlCharacters.isValidNcName(prefix)) {\n            throw new NamespaceException(JcrI18n.unableToRegisterNamespaceWithInvalidPrefix.text(prefix, uri));\n        }\n\n        // The prefix must also be a valid JCR name ...\n        try {\n            session.nameFactory().create(prefix);\n        } catch (ValueFormatException e) {\n            throw new NamespaceException(JcrI18n.unableToRegisterNamespaceWithInvalidPrefix.text(prefix, uri));\n        }\n\n        String existingPrefixForURI = registry.getPrefixForNamespaceUri(uri, false);\n        if (prefix.equals(existingPrefixForURI)) {\n            //this is a no-op because we're trying to register the URI under the same prefix\n            return;\n        }\n\n        boolean global = false;\n        switch (behavior) {\n            case SESSION:\n                // --------------------------------------\n                // JSR-283 Session remapping behavior ...\n                // --------------------------------------\n                // Section 5.11:\n                // \"All local mappings already present in the Session that include either the specified prefix\n                // or the specified uri are removed and the new mapping is added.\"\n                String existingUriForPrefix = registry.getNamespaceForPrefix(prefix);\n                if (existingUriForPrefix != null) {\n                    registry.unregister(existingUriForPrefix);\n                }\n                registry.unregister(uri);\n\n                break;\n            case WORKSPACE:\n                // --------------------------------------------------\n                // JSR-170 & JSR-283 Workspace namespace registry ...\n                // --------------------------------------------------\n                global = true;\n                // Check whether the prefix or URI are reserved (case-sensitive) ...\n                if (STANDARD_BUILT_IN_PREFIXES.contains(prefix)) {\n                    throw new NamespaceException(JcrI18n.unableToRegisterReservedNamespacePrefix.text(prefix, uri));\n                }\n                if (STANDARD_BUILT_IN_URIS.contains(uri)) {\n                    throw new NamespaceException(JcrI18n.unableToRegisterReservedNamespaceUri.text(prefix, uri));\n                }\n\n                try {\n                    session.checkWorkspacePermission(session.workspaceName(), ModeShapePermissions.REGISTER_NAMESPACE);\n                } catch (AccessControlException ace) {\n                    throw new AccessDeniedException(ace);\n                }\n\n                if (existingPrefixForURI != null) {\n                    //the uri is already mapped under a different prefix so check that it's not in use\n                    checkURINotInUse(uri);\n                }\n                registry.unregister(uri);\n                break;\n            default:\n                assert false; // should never happen\n        }\n\n        // Now we're sure the prefix and URI are valid and okay for a custom mapping ...\n        try {\n            registry.register(prefix, uri);\n            // Signal the local node type manager ...\n            session.signalNamespaceChanges(global);\n        } catch (RuntimeException e) {\n            throw new RepositoryException(e.getMessage(), e.getCause());\n        }\n    }", "signature": "void registerNamespace( String prefix,\n                                                String uri )", "full_signature": "@Override public synchronized void registerNamespace( String prefix,\n                                                String uri )", "class_method_signature": "JcrNamespaceRegistry.registerNamespace( String prefix,\n                                                String uri )", "testcase": false, "constructor": false, "invocations": ["isNotNull", "isNotNull", "checkSession", "equals", "equals", "text", "startsWith", "toLowerCase", "text", "isValidNcName", "text", "create", "nameFactory", "text", "getPrefixForNamespaceUri", "equals", "getNamespaceForPrefix", "unregister", "unregister", "contains", "text", "contains", "text", "checkWorkspacePermission", "workspaceName", "checkURINotInUse", "unregister", "register", "signalNamespaceChanges", "getMessage", "getCause"]}, "repository": {"repo_id": 1244027, "url": "https://github.com/ModeShape/modeshape", "language": "Java", "is_fork": false, "fork_count": 213, "stargazer_count": 208, "size": 134266, "license": "licensed"}}