{"test_class": {"identifier": "urn_perun_user_attribute_def_virt_institutionsCountriesTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final static Logger log = LoggerFactory.getLogger(urn_perun_user_attribute_def_virt_institutionsCountriesTest.class);", "modifier": "private final static", "type": "Logger", "declarator": "log = LoggerFactory.getLogger(urn_perun_user_attribute_def_virt_institutionsCountriesTest.class)", "var_name": "log"}, {"original_string": "public static final String SCHAC_HOME_ATTR_NAME = \"urn:perun:ues:attribute-def:def:schacHomeOrganization\";", "modifier": "public static final", "type": "String", "declarator": "SCHAC_HOME_ATTR_NAME = \"urn:perun:ues:attribute-def:def:schacHomeOrganization\"", "var_name": "SCHAC_HOME_ATTR_NAME"}, {"original_string": "private final urn_perun_user_attribute_def_virt_institutionsCountries classInstance = new urn_perun_user_attribute_def_virt_institutionsCountries();", "modifier": "private final", "type": "urn_perun_user_attribute_def_virt_institutionsCountries", "declarator": "classInstance = new urn_perun_user_attribute_def_virt_institutionsCountries()", "var_name": "classInstance"}, {"original_string": "private final AttributeDefinition institutionCountriesAttrDef = classInstance.getAttributeDefinition();", "modifier": "private final", "type": "AttributeDefinition", "declarator": "institutionCountriesAttrDef = classInstance.getAttributeDefinition()", "var_name": "institutionCountriesAttrDef"}, {"original_string": "private final User user = new User(10, \"Joe\", \"Doe\", \"W.\", \"\", \"\");", "modifier": "private final", "type": "User", "declarator": "user = new User(10, \"Joe\", \"Doe\", \"W.\", \"\", \"\")", "var_name": "user"}, {"original_string": "private final UserExtSource userExtSource = new UserExtSource(1, new ExtSource(100, \"es_name\", \"es_type\"), \"joe\", user.getId());", "modifier": "private final", "type": "UserExtSource", "declarator": "userExtSource = new UserExtSource(1, new ExtSource(100, \"es_name\", \"es_type\"), \"joe\", user.getId())", "var_name": "userExtSource"}, {"original_string": "private final List<UserExtSource> userExtSources = Collections.singletonList(userExtSource);", "modifier": "private final", "type": "List<UserExtSource>", "declarator": "userExtSources = Collections.singletonList(userExtSource)", "var_name": "userExtSources"}, {"original_string": "private final Map<String, String> dnsMap = new HashMap<>();", "modifier": "private final", "type": "Map<String, String>", "declarator": "dnsMap = new HashMap<>()", "var_name": "dnsMap"}, {"original_string": "private PerunSessionImpl sess;", "modifier": "private", "type": "PerunSessionImpl", "declarator": "sess", "var_name": "sess"}, {"original_string": "private Attribute schacHomeOrg;", "modifier": "private", "type": "Attribute", "declarator": "schacHomeOrg", "var_name": "schacHomeOrg"}], "file": "perun-core/src/test/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_user_attribute_def_virt_institutionsCountriesTest.java"}, "test_case": {"identifier": "resolveVirtualAttributeValueChange2", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n\tpublic void resolveVirtualAttributeValueChange2() throws Exception {\n\t\tsetSchacHomeOrgs(\"muni.cz;cesnet.cz\");\n\t\tString czech_republic = \"Czech Republic\";\n\t\tdnsMap.put(\".cz\", czech_republic);\n\t\tAttributeDefinition countries = classInstance.getAttributeDefinition();\n\t\twhen(sess.getPerunBl().getAttributesManagerBl().getAttributeDefinition(sess, \"urn:perun:user:attribute-def:virt:institutionsCountries\"))\n\t\t\t.thenReturn(countries);\n\t\tAttribute newval = new Attribute(new urn_perun_entityless_attribute_def_def_dnsStateMapping().getAttributeDefinition());\n\t\tnewval.setValue(czech_republic);\n\n\t\twhen(sess.getPerunBl().getUsersManagerBl().findUsersWithExtSourceAttributeValueEnding(eq(sess), eq(SCHAC_HOME_ATTR_NAME), eq(\".cz\"), any()))\n\t\t\t.thenReturn(Collections.singletonList(user));\n\t\tAuditEvent event = new AttributeSetForKey(newval, \".cz\");\n\t\tList<AuditEvent> msgs = classInstance.resolveVirtualAttributeValueChange(sess, event);\n\t\tassertTrue(\"audit should contain change of institutionsCountries\",msgs.get(0).getMessage().contains(\"friendlyName=<institutionsCountries>\"));\n\t}", "signature": "void resolveVirtualAttributeValueChange2()", "full_signature": "@Test public void resolveVirtualAttributeValueChange2()", "class_method_signature": "urn_perun_user_attribute_def_virt_institutionsCountriesTest.resolveVirtualAttributeValueChange2()", "testcase": true, "constructor": false, "invocations": ["setSchacHomeOrgs", "put", "getAttributeDefinition", "thenReturn", "when", "getAttributeDefinition", "getAttributesManagerBl", "getPerunBl", "getAttributeDefinition", "setValue", "thenReturn", "when", "findUsersWithExtSourceAttributeValueEnding", "getUsersManagerBl", "getPerunBl", "eq", "eq", "eq", "any", "singletonList", "resolveVirtualAttributeValueChange", "assertTrue", "contains", "getMessage", "get"]}, "focal_class": {"identifier": "urn_perun_user_attribute_def_virt_institutionsCountries", "superclass": "extends UserVirtualAttributeCollectedFromUserExtSource<DnsMapCtx>", "interfaces": "", "fields": [{"original_string": "private final static Logger log = LoggerFactory.getLogger(urn_perun_user_attribute_def_virt_institutionsCountries.class);", "modifier": "private final static", "type": "Logger", "declarator": "log = LoggerFactory.getLogger(urn_perun_user_attribute_def_virt_institutionsCountries.class)", "var_name": "log"}, {"original_string": "private final static AttributeDefinition DNS_STATE_MAPPING_ATTR = new urn_perun_entityless_attribute_def_def_dnsStateMapping().getAttributeDefinition();", "modifier": "private final static", "type": "AttributeDefinition", "declarator": "DNS_STATE_MAPPING_ATTR = new urn_perun_entityless_attribute_def_def_dnsStateMapping().getAttributeDefinition()", "var_name": "DNS_STATE_MAPPING_ATTR"}], "methods": [{"identifier": "getSourceAttributeFriendlyName", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String getSourceAttributeFriendlyName()", "full_signature": "@Override public String getSourceAttributeFriendlyName()", "class_method_signature": "urn_perun_user_attribute_def_virt_institutionsCountries.getSourceAttributeFriendlyName()", "testcase": false, "constructor": false}, {"identifier": "getDestinationAttributeFriendlyName", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String getDestinationAttributeFriendlyName()", "full_signature": "@Override public String getDestinationAttributeFriendlyName()", "class_method_signature": "urn_perun_user_attribute_def_virt_institutionsCountries.getDestinationAttributeFriendlyName()", "testcase": false, "constructor": false}, {"identifier": "getDestinationAttributeDescription", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String getDestinationAttributeDescription()", "full_signature": "@Override public String getDestinationAttributeDescription()", "class_method_signature": "urn_perun_user_attribute_def_virt_institutionsCountries.getDestinationAttributeDescription()", "testcase": false, "constructor": false}, {"identifier": "initModifyValueContext", "parameters": "(PerunSessionImpl sess, User user, AttributeDefinition attr)", "modifiers": "@Override protected", "return": "DnsMapCtx", "signature": "DnsMapCtx initModifyValueContext(PerunSessionImpl sess, User user, AttributeDefinition attr)", "full_signature": "@Override protected DnsMapCtx initModifyValueContext(PerunSessionImpl sess, User user, AttributeDefinition attr)", "class_method_signature": "urn_perun_user_attribute_def_virt_institutionsCountries.initModifyValueContext(PerunSessionImpl sess, User user, AttributeDefinition attr)", "testcase": false, "constructor": false}, {"identifier": "modifyValue", "parameters": "(PerunSession session, DnsMapCtx ctx, UserExtSource ues, String value)", "modifiers": "@Override public", "return": "String", "signature": "String modifyValue(PerunSession session, DnsMapCtx ctx, UserExtSource ues, String value)", "full_signature": "@Override public String modifyValue(PerunSession session, DnsMapCtx ctx, UserExtSource ues, String value)", "class_method_signature": "urn_perun_user_attribute_def_virt_institutionsCountries.modifyValue(PerunSession session, DnsMapCtx ctx, UserExtSource ues, String value)", "testcase": false, "constructor": false}, {"identifier": "resolveVirtualAttributeValueChange", "parameters": "(PerunSessionImpl sess, AuditEvent message)", "modifiers": "@Override public", "return": "List<AuditEvent>", "signature": "List<AuditEvent> resolveVirtualAttributeValueChange(PerunSessionImpl sess, AuditEvent message)", "full_signature": "@Override public List<AuditEvent> resolveVirtualAttributeValueChange(PerunSessionImpl sess, AuditEvent message)", "class_method_signature": "urn_perun_user_attribute_def_virt_institutionsCountries.resolveVirtualAttributeValueChange(PerunSessionImpl sess, AuditEvent message)", "testcase": false, "constructor": false}, {"identifier": "resolveEvent", "parameters": "(PerunSessionImpl sess, String key)", "modifiers": "private", "return": "List<AuditEvent>", "signature": "List<AuditEvent> resolveEvent(PerunSessionImpl sess, String key)", "full_signature": "private List<AuditEvent> resolveEvent(PerunSessionImpl sess, String key)", "class_method_signature": "urn_perun_user_attribute_def_virt_institutionsCountries.resolveEvent(PerunSessionImpl sess, String key)", "testcase": false, "constructor": false}], "file": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_user_attribute_def_virt_institutionsCountries.java"}, "focal_method": {"identifier": "resolveVirtualAttributeValueChange", "parameters": "(PerunSessionImpl sess, AuditEvent message)", "modifiers": "@Override public", "return": "List<AuditEvent>", "body": "@Override\n\tpublic List<AuditEvent> resolveVirtualAttributeValueChange(PerunSessionImpl sess, AuditEvent message) throws WrongReferenceAttributeValueException, AttributeNotExistsException, WrongAttributeAssignmentException {\n\t\tList<AuditEvent> messages = super.resolveVirtualAttributeValueChange(sess, message);\n\t\t// react to auditlog message about changing dnsStateMapping\n\n\t\tif (message instanceof AttributeSetForKey\n\t\t\t&& ((AttributeSetForKey) message).getAttribute().getFriendlyName().equals(DNS_STATE_MAPPING_ATTR.getFriendlyName())) {\n\n\t\t\tmessages.addAll(resolveEvent(sess, ((AttributeSetForKey) message).getKey()));\n\t\t} else if (message instanceof AttributeRemovedForKey\n\t\t\t&& ((AttributeRemovedForKey) message).getAttribute().getFriendlyName().equals(DNS_STATE_MAPPING_ATTR.getFriendlyName())) {\n\n\t\t\tmessages.addAll(resolveEvent(sess, ((AttributeRemovedForKey) message).getKey()));\n\t\t}\n\t\treturn messages;\n\t}", "signature": "List<AuditEvent> resolveVirtualAttributeValueChange(PerunSessionImpl sess, AuditEvent message)", "full_signature": "@Override public List<AuditEvent> resolveVirtualAttributeValueChange(PerunSessionImpl sess, AuditEvent message)", "class_method_signature": "urn_perun_user_attribute_def_virt_institutionsCountries.resolveVirtualAttributeValueChange(PerunSessionImpl sess, AuditEvent message)", "testcase": false, "constructor": false, "invocations": ["resolveVirtualAttributeValueChange", "equals", "getFriendlyName", "getAttribute", "getFriendlyName", "addAll", "resolveEvent", "getKey", "equals", "getFriendlyName", "getAttribute", "getFriendlyName", "addAll", "resolveEvent", "getKey"]}, "repository": {"repo_id": 4085998, "url": "https://github.com/CESNET/perun", "stars": 38, "created": "4/20/2012 11:55:38 AM +00:00", "updates": "2020-01-27T09:51:13+00:00", "fork": "False", "license": "licensed"}}