{"test_class": {"identifier": "FormatterTest", "superclass": "", "interfaces": "", "fields": [], "file": "hbase0.98/hbase-table-stat-0.98/src/test/java/com/kakao/hbase/stat/print/FormatterTest.java"}, "test_case": {"identifier": "testSort", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testSort() throws Exception {\n        Formatter formatter;\n        String resultString;\n        LoadRecord rec1, rec2;\n        String expected;\n        Map<Level, LoadRecord> loadMap;\n        LoadRecord summary;\n        Load load = new Load(new LevelClass(ServerName.class));\n\n        // iteration 1\n        loadMap = new TreeMap<>();\n        rec1 = new LoadRecord();\n        rec1.put(LoadEntry.Reads, 2);\n        loadMap.put(new Level(\"rec1\"), rec1);\n        rec2 = new LoadRecord();\n        rec2.put(LoadEntry.Reads, 1);\n        loadMap.put(new Level(\"rec2\"), rec2);\n\n        summary = new LoadRecord();\n        summary.put(LoadEntry.Reads, 3);\n\n        load.setLoadMap(loadMap);\n        load.setSummary(summary);\n        load.updateChangeMap();\n        Assert.assertEquals(SortKey.DEFAULT, load.getSortKey());\n\n        formatter = new Formatter(\"testTable\", load);\n        resultString = formatter.buildString(false, Formatter.Type.ANSI);\n        System.out.println(resultString);\n        expected = \"\\u001B[32mRegionServer\\u001B[0m  \\u001B[36mReads\\u001B[0m    \\u001B[36mWrites\\u001B[0m     \\u001B[36mRegions\\u001B[0m    \\u001B[36mFiles\\u001B[0m      \\u001B[36mFileSize\\u001B[0m   \\u001B[36mFileSizeUncomp\\u001B[0m  \\u001B[36mMemstoreSize\\u001B[0m  \\u001B[36mCompactedKVs\\u001B[0m  \\n\" +\n                \"\\u001B[1m rec1\\u001B[0m         2 | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m rec2\\u001B[0m         1 | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m Total: 2\\u001B[0m     3 | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\";\n        Assert.assertEquals(expected, resultString);\n\n        // iteration 2\n        loadMap = new TreeMap<>();\n        rec1 = new LoadRecord();\n        rec1.put(LoadEntry.Reads, 2);\n        loadMap.put(new Level(\"rec1\"), rec1);\n        rec2 = new LoadRecord();\n        rec2.put(LoadEntry.Reads, 1);\n        loadMap.put(new Level(\"rec2\"), rec2);\n\n        summary = new LoadRecord();\n        summary.put(LoadEntry.Reads, 3);\n\n        load.prepare();\n        load.setLoadMap(loadMap);\n        load.setSummary(summary);\n        load.updateChangeMap();\n        load.setSortKey(new SortKey(\"1\"));\n\n        formatter = new Formatter(\"testTable\", load);\n        resultString = formatter.buildString(false, Formatter.Type.ANSI);\n        System.out.println(resultString);\n        expected = \"\\u001B[36mRegionServer\\u001B[0m  \\u001B[32mReads\\u001B[0m  \\u001B[36mWrites\\u001B[0m     \\u001B[36mRegions\\u001B[0m    \\u001B[36mFiles\\u001B[0m      \\u001B[36mFileSize\\u001B[0m   \\u001B[36mFileSizeUncomp\\u001B[0m  \\u001B[36mMemstoreSize\\u001B[0m  \\u001B[36mCompactedKVs\\u001B[0m  \\n\" +\n                \"\\u001B[1m rec2\\u001B[0m         1 | 0  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m rec1\\u001B[0m         2 | 0  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m Total: 2\\u001B[0m     3 | 0  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\";\n        Assert.assertEquals(expected, resultString);\n\n        // iteration 3\n        loadMap = new TreeMap<>();\n        rec1 = new LoadRecord();\n        rec1.put(LoadEntry.Reads, 2);\n        loadMap.put(new Level(\"rec1\"), rec1);\n        rec2 = new LoadRecord();\n        rec2.put(LoadEntry.Reads, 1);\n        loadMap.put(new Level(\"rec2\"), rec2);\n\n        summary = new LoadRecord();\n        summary.put(LoadEntry.Reads, 3);\n\n        load.prepare();\n        load.setLoadMap(loadMap);\n        load.setSummary(summary);\n        load.updateChangeMap();\n        load.setSortKey(new SortKey(\"!\"));\n\n        formatter = new Formatter(\"testTable\", load);\n        resultString = formatter.buildString(false, Formatter.Type.ANSI);\n        System.out.println(resultString);\n        expected = \"\\u001B[36mRegionServer\\u001B[0m  \\u001B[42mReads\\u001B[0m  \\u001B[36mWrites\\u001B[0m     \\u001B[36mRegions\\u001B[0m    \\u001B[36mFiles\\u001B[0m      \\u001B[36mFileSize\\u001B[0m   \\u001B[36mFileSizeUncomp\\u001B[0m  \\u001B[36mMemstoreSize\\u001B[0m  \\u001B[36mCompactedKVs\\u001B[0m  \\n\" +\n                \"\\u001B[1m rec1\\u001B[0m         2 | 0  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m rec2\\u001B[0m         1 | 0  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m Total: 2\\u001B[0m     3 | 0  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\";\n        Assert.assertEquals(expected, resultString);\n\n        // iteration 4. reset to 0\n        loadMap = new TreeMap<>();\n        rec1 = new LoadRecord();\n        rec1.put(LoadEntry.Reads, 2);\n        loadMap.put(new Level(\"rec1\"), rec1);\n        rec2 = new LoadRecord();\n        rec2.put(LoadEntry.Reads, 1);\n        loadMap.put(new Level(\"rec2\"), rec2);\n\n        summary = new LoadRecord();\n        summary.put(LoadEntry.Reads, 3);\n\n        load.prepare();\n        load.setLoadMap(loadMap);\n        load.setSummary(summary);\n        load.updateChangeMap();\n        load.setSortKey(SortKey.DEFAULT);\n        Assert.assertEquals(SortKey.DEFAULT, load.getSortKey());\n\n        formatter = new Formatter(\"testTable\", load);\n        resultString = formatter.buildString(false, Formatter.Type.ANSI);\n        System.out.println(resultString);\n        expected = \"\\u001B[32mRegionServer\\u001B[0m  \\u001B[36mReads\\u001B[0m  \\u001B[36mWrites\\u001B[0m     \\u001B[36mRegions\\u001B[0m    \\u001B[36mFiles\\u001B[0m      \\u001B[36mFileSize\\u001B[0m   \\u001B[36mFileSizeUncomp\\u001B[0m  \\u001B[36mMemstoreSize\\u001B[0m  \\u001B[36mCompactedKVs\\u001B[0m  \\n\" +\n                \"\\u001B[1m rec1\\u001B[0m         2 | 0  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m rec2\\u001B[0m         1 | 0  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m Total: 2\\u001B[0m     3 | 0  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\";\n        Assert.assertEquals(expected, resultString);\n\n        // iteration 5. if value is same then sorted by level string\n        loadMap = new TreeMap<>();\n        rec1 = new LoadRecord();\n        rec1.put(LoadEntry.Reads, 2);\n        loadMap.put(new Level(\"rec1\"), rec1);\n        rec2 = new LoadRecord();\n        rec2.put(LoadEntry.Reads, 1);\n        loadMap.put(new Level(\"rec2\"), rec2);\n\n        summary = new LoadRecord();\n        summary.put(LoadEntry.Reads, 3);\n\n        load.prepare();\n        load.setLoadMap(loadMap);\n        load.setSummary(summary);\n        load.updateChangeMap();\n        load.setSortKey(new SortKey(\"!\"));\n        load.toggleShowRate();\n        Assert.assertTrue(load.isShowRate());\n\n        formatter = new Formatter(\"testTable\", load);\n        resultString = formatter.buildString(false, Formatter.Type.ANSI);\n        System.out.println(resultString);\n        expected = \"\\u001B[36mRegionServer\\u001B[0m  \\u001B[42mReads\\u001B[0m    \\u001B[36mWrites\\u001B[0m     \\u001B[36mRegions\\u001B[0m    \\u001B[36mFiles\\u001B[0m      \\u001B[36mFileSize\\u001B[0m   \\u001B[36mFileSizeUncomp\\u001B[0m  \\u001B[36mMemstoreSize\\u001B[0m  \\u001B[36mCompactedKVs\\u001B[0m  \\n\" +\n                \"\\u001B[1m rec1\\u001B[0m         2 | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m rec2\\u001B[0m         1 | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m Total: 2\\u001B[0m     3 | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\";\n        Assert.assertEquals(expected, resultString);\n\n        // iteration 6\n        loadMap = new TreeMap<>();\n        rec1 = new LoadRecord();\n        rec1.put(LoadEntry.Reads, 3);\n        loadMap.put(new Level(\"rec1\"), rec1);\n        rec2 = new LoadRecord();\n        rec2.put(LoadEntry.Reads, 1);\n        loadMap.put(new Level(\"rec2\"), rec2);\n\n        summary = new LoadRecord();\n        summary.put(LoadEntry.Reads, 4);\n\n        load.prepare();\n        load.setLoadMap(loadMap);\n        load.setSummary(summary);\n        load.updateChangeMap();\n        load.setDuration(500);\n        Assert.assertTrue(load.isShowRate());\n\n        formatter = new Formatter(\"testTable\", load);\n        resultString = formatter.buildString(false, Formatter.Type.ANSI);\n        System.out.println(resultString);\n        expected = \"\\u001B[36mRegionServer\\u001B[0m  \\u001B[42mReads\\u001B[0m      \\u001B[36mWrites\\u001B[0m     \\u001B[36mRegions\\u001B[0m    \\u001B[36mFiles\\u001B[0m      \\u001B[36mFileSize\\u001B[0m   \\u001B[36mFileSizeUncomp\\u001B[0m  \\u001B[36mMemstoreSize\\u001B[0m  \\u001B[36mCompactedKVs\\u001B[0m  \\n\" +\n                \"\\u001B[1m rec2\\u001B[0m         1 |   0/s  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m rec1\\u001B[0m         \\u001B[33m3\\u001B[0m | \\u001B[33m2.0/s\\u001B[0m  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\" +\n                \"\\u001B[1m Total: 2\\u001B[0m     \\u001B[33m4\\u001B[0m | \\u001B[33m2.0/s\\u001B[0m  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A  N/A | N/A       N/A | N/A     N/A | N/A     \\n\";\n        Assert.assertEquals(expected, resultString);\n    }", "signature": "void testSort()", "full_signature": "@Test public void testSort()", "class_method_signature": "FormatterTest.testSort()", "testcase": true, "constructor": false, "invocations": ["put", "put", "put", "put", "put", "setLoadMap", "setSummary", "updateChangeMap", "assertEquals", "getSortKey", "buildString", "println", "assertEquals", "put", "put", "put", "put", "put", "prepare", "setLoadMap", "setSummary", "updateChangeMap", "setSortKey", "buildString", "println", "assertEquals", "put", "put", "put", "put", "put", "prepare", "setLoadMap", "setSummary", "updateChangeMap", "setSortKey", "buildString", "println", "assertEquals", "put", "put", "put", "put", "put", "prepare", "setLoadMap", "setSummary", "updateChangeMap", "setSortKey", "assertEquals", "getSortKey", "buildString", "println", "assertEquals", "put", "put", "put", "put", "put", "prepare", "setLoadMap", "setSummary", "updateChangeMap", "setSortKey", "toggleShowRate", "assertTrue", "isShowRate", "buildString", "println", "assertEquals", "put", "put", "put", "put", "put", "prepare", "setLoadMap", "setSummary", "updateChangeMap", "setDuration", "assertTrue", "isShowRate", "buildString", "println", "assertEquals"]}, "focal_class": {"identifier": "Formatter", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final LengthMapBuilder LENGTH_MAP_BUILDER = new LengthMapBuilder();", "modifier": "private static final", "type": "LengthMapBuilder", "declarator": "LENGTH_MAP_BUILDER = new LengthMapBuilder()", "var_name": "LENGTH_MAP_BUILDER"}, {"original_string": "private static final PrintStringBuilder PRINT_STRING_BUILDER = new PrintStringBuilder();", "modifier": "private static final", "type": "PrintStringBuilder", "declarator": "PRINT_STRING_BUILDER = new PrintStringBuilder()", "var_name": "PRINT_STRING_BUILDER"}, {"original_string": "private final String tableName;", "modifier": "private final", "type": "String", "declarator": "tableName", "var_name": "tableName"}, {"original_string": "private final Load load;", "modifier": "private final", "type": "Load", "declarator": "load", "var_name": "load"}, {"original_string": "private Map<Type, String> cache = new HashMap<>();", "modifier": "private", "type": "Map<Type, String>", "declarator": "cache = new HashMap<>()", "var_name": "cache"}], "methods": [{"identifier": "Formatter", "parameters": "(String tableName, Load load)", "modifiers": "public", "return": "", "signature": " Formatter(String tableName, Load load)", "full_signature": "public  Formatter(String tableName, Load load)", "class_method_signature": "Formatter.Formatter(String tableName, Load load)", "testcase": false, "constructor": true}, {"identifier": "generateLengthMap", "parameters": "(Type formatType)", "modifiers": "private", "return": "Map<String, Length>", "signature": "Map<String, Length> generateLengthMap(Type formatType)", "full_signature": "private Map<String, Length> generateLengthMap(Type formatType)", "class_method_signature": "Formatter.generateLengthMap(Type formatType)", "testcase": false, "constructor": false}, {"identifier": "toggleShowChangedOnly", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean toggleShowChangedOnly()", "full_signature": "public boolean toggleShowChangedOnly()", "class_method_signature": "Formatter.toggleShowChangedOnly()", "testcase": false, "constructor": false}, {"identifier": "toggleDiffFromStart", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean toggleDiffFromStart()", "full_signature": "public boolean toggleDiffFromStart()", "class_method_signature": "Formatter.toggleDiffFromStart()", "testcase": false, "constructor": false}, {"identifier": "createRunInformation", "parameters": "()", "modifiers": "private", "return": "java.lang.StringBuilder", "signature": "java.lang.StringBuilder createRunInformation()", "full_signature": "private java.lang.StringBuilder createRunInformation()", "class_method_signature": "Formatter.createRunInformation()", "testcase": false, "constructor": false}, {"identifier": "appendStat", "parameters": "(StringBuilder sb, Type formatType)", "modifiers": "private", "return": "void", "signature": "void appendStat(StringBuilder sb, Type formatType)", "full_signature": "private void appendStat(StringBuilder sb, Type formatType)", "class_method_signature": "Formatter.appendStat(StringBuilder sb, Type formatType)", "testcase": false, "constructor": false}, {"identifier": "toString", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String toString()", "full_signature": "@Override public String toString()", "class_method_signature": "Formatter.toString()", "testcase": false, "constructor": false}, {"identifier": "toHtmlString", "parameters": "()", "modifiers": "public", "return": "String", "signature": "String toHtmlString()", "full_signature": "public String toHtmlString()", "class_method_signature": "Formatter.toHtmlString()", "testcase": false, "constructor": false}, {"identifier": "buildString", "parameters": "(boolean withRunInformation, Type formatType)", "modifiers": "@VisibleForTesting public", "return": "String", "signature": "String buildString(boolean withRunInformation, Type formatType)", "full_signature": "@VisibleForTesting public String buildString(boolean withRunInformation, Type formatType)", "class_method_signature": "Formatter.buildString(boolean withRunInformation, Type formatType)", "testcase": false, "constructor": false}, {"identifier": "buildStringInternal", "parameters": "(boolean withRunInformation, Type formatType)", "modifiers": "private", "return": "String", "signature": "String buildStringInternal(boolean withRunInformation, Type formatType)", "full_signature": "private String buildStringInternal(boolean withRunInformation, Type formatType)", "class_method_signature": "Formatter.buildStringInternal(boolean withRunInformation, Type formatType)", "testcase": false, "constructor": false}], "file": "hbase0.98/hbase-table-stat-0.98/src/main/java/com/kakao/hbase/stat/print/Formatter.java"}, "focal_method": {"identifier": "buildString", "parameters": "(boolean withRunInformation, Type formatType)", "modifiers": "@VisibleForTesting public", "return": "String", "body": "@VisibleForTesting\n    public String buildString(boolean withRunInformation, Type formatType) {\n        if (load.isUpdating()) {\n            return cache.get(formatType);\n        } else {\n            cache.put(Type.ANSI, buildStringInternal(withRunInformation, Type.ANSI));\n            cache.put(Type.HTML, buildStringInternal(withRunInformation, Type.HTML));\n            return cache.get(formatType);\n        }\n    }", "signature": "String buildString(boolean withRunInformation, Type formatType)", "full_signature": "@VisibleForTesting public String buildString(boolean withRunInformation, Type formatType)", "class_method_signature": "Formatter.buildString(boolean withRunInformation, Type formatType)", "testcase": false, "constructor": false, "invocations": ["isUpdating", "get", "put", "buildStringInternal", "put", "buildStringInternal", "get"]}, "repository": {"repo_id": 46396068, "url": "https://github.com/kakao/hbase-tools", "language": "Java", "is_fork": false, "fork_count": 21, "stargazer_count": 49, "size": 1758, "license": "licensed"}}