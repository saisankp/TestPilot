{"test_class": {"identifier": "HystrixUtilizationStreamTest", "superclass": "extends CommandStreamTest", "interfaces": "", "fields": [{"original_string": "@Rule\n    public HystrixRequestContextRule ctx = new HystrixRequestContextRule();", "modifier": "@Rule\n    public", "type": "HystrixRequestContextRule", "declarator": "ctx = new HystrixRequestContextRule()", "var_name": "ctx"}, {"original_string": "HystrixUtilizationStream stream;", "modifier": "", "type": "HystrixUtilizationStream", "declarator": "stream", "var_name": "stream"}, {"original_string": "private final static HystrixCommandGroupKey groupKey = HystrixCommandGroupKey.Factory.asKey(\"Util\");", "modifier": "private final static", "type": "HystrixCommandGroupKey", "declarator": "groupKey = HystrixCommandGroupKey.Factory.asKey(\"Util\")", "var_name": "groupKey"}, {"original_string": "private final static HystrixCommandKey commandKey = HystrixCommandKey.Factory.asKey(\"Command\");", "modifier": "private final static", "type": "HystrixCommandKey", "declarator": "commandKey = HystrixCommandKey.Factory.asKey(\"Command\")", "var_name": "commandKey"}], "file": "hystrix-core/src/test/java/com/netflix/hystrix/metric/sample/HystrixUtilizationStreamTest.java"}, "test_case": {"identifier": "testTwoSubscribersOneUnsubscribes", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testTwoSubscribersOneUnsubscribes() throws Exception {\n        final CountDownLatch latch1 = new CountDownLatch(1);\n        final CountDownLatch latch2 = new CountDownLatch(1);\n        final AtomicInteger payloads1 = new AtomicInteger(0);\n        final AtomicInteger payloads2 = new AtomicInteger(0);\n\n        Subscription s1 = stream\n                .observe()\n                .take(100)\n                .doOnUnsubscribe(new Action0() {\n                    @Override\n                    public void call() {\n                        latch1.countDown();\n                    }\n                })\n                .subscribe(new Subscriber<HystrixUtilization>() {\n                    @Override\n                    public void onCompleted() {\n                        System.out.println(System.currentTimeMillis() + \" : \" + Thread.currentThread().getName() + \" : Dashboard 1 OnCompleted\");\n                        latch1.countDown();\n                    }\n\n                    @Override\n                    public void onError(Throwable e) {\n                        System.out.println(System.currentTimeMillis() + \" : \" + Thread.currentThread().getName() + \" : Dashboard 1 OnError : \" + e);\n                        latch1.countDown();\n                    }\n\n                    @Override\n                    public void onNext(HystrixUtilization utilization) {\n                        System.out.println(System.currentTimeMillis() + \" : \" + Thread.currentThread().getName() + \" : Dashboard 1 OnNext : \" + utilization);\n                        payloads1.incrementAndGet();\n                    }\n                });\n\n        Subscription s2 = stream\n                .observe()\n                .take(100)\n                .doOnUnsubscribe(new Action0() {\n                    @Override\n                    public void call() {\n                        latch2.countDown();\n                    }\n                })\n                .subscribe(new Subscriber<HystrixUtilization>() {\n                    @Override\n                    public void onCompleted() {\n                        System.out.println(System.currentTimeMillis() + \" : \" + Thread.currentThread().getName() + \" : Dashboard 2 OnCompleted\");\n                        latch2.countDown();\n                    }\n\n                    @Override\n                    public void onError(Throwable e) {\n                        System.out.println(System.currentTimeMillis() + \" : \" + Thread.currentThread().getName() + \" : Dashboard 2 OnError : \" + e);\n                        latch2.countDown();\n                    }\n\n                    @Override\n                    public void onNext(HystrixUtilization utilization) {\n                        System.out.println(System.currentTimeMillis() + \" : \" + Thread.currentThread().getName() + \" : Dashboard 2 OnNext : \" + utilization);\n                        payloads2.incrementAndGet();\n                    }\n                });\n        //execute 1 command, then unsubscribe from first stream. then execute the rest\n        for (int i = 0; i < 50; i++) {\n            HystrixCommand<Integer> cmd = Command.from(groupKey, commandKey, HystrixEventType.SUCCESS, 50);\n            cmd.execute();\n            if (i == 1) {\n                s1.unsubscribe();\n            }\n        }\n\n        assertTrue(latch1.await(10000, TimeUnit.MILLISECONDS));\n        assertTrue(latch2.await(10000, TimeUnit.MILLISECONDS));\n        System.out.println(\"s1 got : \" + payloads1.get() + \", s2 got : \" + payloads2.get());\n        assertTrue(\"s1 got data\", payloads1.get() > 0);\n        assertTrue(\"s2 got data\", payloads2.get() > 0);\n        assertTrue(\"s1 got less data than s2\", payloads2.get() > payloads1.get());\n    }", "signature": "void testTwoSubscribersOneUnsubscribes()", "full_signature": "@Test public void testTwoSubscribersOneUnsubscribes()", "class_method_signature": "HystrixUtilizationStreamTest.testTwoSubscribersOneUnsubscribes()", "testcase": true, "constructor": false, "invocations": ["subscribe", "doOnUnsubscribe", "take", "observe", "countDown", "println", "currentTimeMillis", "getName", "currentThread", "countDown", "println", "currentTimeMillis", "getName", "currentThread", "countDown", "println", "currentTimeMillis", "getName", "currentThread", "incrementAndGet", "subscribe", "doOnUnsubscribe", "take", "observe", "countDown", "println", "currentTimeMillis", "getName", "currentThread", "countDown", "println", "currentTimeMillis", "getName", "currentThread", "countDown", "println", "currentTimeMillis", "getName", "currentThread", "incrementAndGet", "from", "execute", "unsubscribe", "assertTrue", "await", "assertTrue", "await", "println", "get", "get", "assertTrue", "get", "assertTrue", "get", "assertTrue", "get", "get"]}, "focal_class": {"identifier": "HystrixUtilizationStream", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final int intervalInMilliseconds;", "modifier": "private final", "type": "int", "declarator": "intervalInMilliseconds", "var_name": "intervalInMilliseconds"}, {"original_string": "private final Observable<HystrixUtilization> allUtilizationStream;", "modifier": "private final", "type": "Observable<HystrixUtilization>", "declarator": "allUtilizationStream", "var_name": "allUtilizationStream"}, {"original_string": "private final AtomicBoolean isSourceCurrentlySubscribed = new AtomicBoolean(false);", "modifier": "private final", "type": "AtomicBoolean", "declarator": "isSourceCurrentlySubscribed = new AtomicBoolean(false)", "var_name": "isSourceCurrentlySubscribed"}, {"original_string": "private static final DynamicIntProperty dataEmissionIntervalInMs =\n            DynamicPropertyFactory.getInstance().getIntProperty(\"hystrix.stream.utilization.intervalInMilliseconds\", 500);", "modifier": "private static final", "type": "DynamicIntProperty", "declarator": "dataEmissionIntervalInMs =\n            DynamicPropertyFactory.getInstance().getIntProperty(\"hystrix.stream.utilization.intervalInMilliseconds\", 500)", "var_name": "dataEmissionIntervalInMs"}, {"original_string": "private static final Func1<Long, HystrixUtilization> getAllUtilization =\n            new Func1<Long, HystrixUtilization>() {\n                @Override\n                public HystrixUtilization call(Long timestamp) {\n                    return HystrixUtilization.from(\n                            getAllCommandUtilization.call(timestamp),\n                            getAllThreadPoolUtilization.call(timestamp)\n                    );\n                }\n            };", "modifier": "private static final", "type": "Func1<Long, HystrixUtilization>", "declarator": "getAllUtilization =\n            new Func1<Long, HystrixUtilization>() {\n                @Override\n                public HystrixUtilization call(Long timestamp) {\n                    return HystrixUtilization.from(\n                            getAllCommandUtilization.call(timestamp),\n                            getAllThreadPoolUtilization.call(timestamp)\n                    );\n                }\n            }", "var_name": "getAllUtilization"}, {"original_string": "private static final HystrixUtilizationStream INSTANCE =\n            new HystrixUtilizationStream(dataEmissionIntervalInMs.get());", "modifier": "private static final", "type": "HystrixUtilizationStream", "declarator": "INSTANCE =\n            new HystrixUtilizationStream(dataEmissionIntervalInMs.get())", "var_name": "INSTANCE"}, {"original_string": "private static final Func1<Long, Map<HystrixCommandKey, HystrixCommandUtilization>> getAllCommandUtilization =\n            new Func1<Long, Map<HystrixCommandKey, HystrixCommandUtilization>>() {\n                @Override\n                public Map<HystrixCommandKey, HystrixCommandUtilization> call(Long timestamp) {\n                    Map<HystrixCommandKey, HystrixCommandUtilization> commandUtilizationPerKey = new HashMap<HystrixCommandKey, HystrixCommandUtilization>();\n                    for (HystrixCommandMetrics commandMetrics: HystrixCommandMetrics.getInstances()) {\n                        HystrixCommandKey commandKey = commandMetrics.getCommandKey();\n                        commandUtilizationPerKey.put(commandKey, sampleCommandUtilization(commandMetrics));\n                    }\n                    return commandUtilizationPerKey;\n                }\n            };", "modifier": "private static final", "type": "Func1<Long, Map<HystrixCommandKey, HystrixCommandUtilization>>", "declarator": "getAllCommandUtilization =\n            new Func1<Long, Map<HystrixCommandKey, HystrixCommandUtilization>>() {\n                @Override\n                public Map<HystrixCommandKey, HystrixCommandUtilization> call(Long timestamp) {\n                    Map<HystrixCommandKey, HystrixCommandUtilization> commandUtilizationPerKey = new HashMap<HystrixCommandKey, HystrixCommandUtilization>();\n                    for (HystrixCommandMetrics commandMetrics: HystrixCommandMetrics.getInstances()) {\n                        HystrixCommandKey commandKey = commandMetrics.getCommandKey();\n                        commandUtilizationPerKey.put(commandKey, sampleCommandUtilization(commandMetrics));\n                    }\n                    return commandUtilizationPerKey;\n                }\n            }", "var_name": "getAllCommandUtilization"}, {"original_string": "private static final Func1<Long, Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization>> getAllThreadPoolUtilization =\n            new Func1<Long, Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization>>() {\n                @Override\n                public Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization> call(Long timestamp) {\n                    Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization> threadPoolUtilizationPerKey = new HashMap<HystrixThreadPoolKey, HystrixThreadPoolUtilization>();\n                    for (HystrixThreadPoolMetrics threadPoolMetrics: HystrixThreadPoolMetrics.getInstances()) {\n                        HystrixThreadPoolKey threadPoolKey = threadPoolMetrics.getThreadPoolKey();\n                        threadPoolUtilizationPerKey.put(threadPoolKey, sampleThreadPoolUtilization(threadPoolMetrics));\n                    }\n                    return threadPoolUtilizationPerKey;\n                }\n            };", "modifier": "private static final", "type": "Func1<Long, Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization>>", "declarator": "getAllThreadPoolUtilization =\n            new Func1<Long, Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization>>() {\n                @Override\n                public Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization> call(Long timestamp) {\n                    Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization> threadPoolUtilizationPerKey = new HashMap<HystrixThreadPoolKey, HystrixThreadPoolUtilization>();\n                    for (HystrixThreadPoolMetrics threadPoolMetrics: HystrixThreadPoolMetrics.getInstances()) {\n                        HystrixThreadPoolKey threadPoolKey = threadPoolMetrics.getThreadPoolKey();\n                        threadPoolUtilizationPerKey.put(threadPoolKey, sampleThreadPoolUtilization(threadPoolMetrics));\n                    }\n                    return threadPoolUtilizationPerKey;\n                }\n            }", "var_name": "getAllThreadPoolUtilization"}, {"original_string": "private static final Func1<HystrixUtilization, Map<HystrixCommandKey, HystrixCommandUtilization>> getOnlyCommandUtilization =\n            new Func1<HystrixUtilization, Map<HystrixCommandKey, HystrixCommandUtilization>>() {\n                @Override\n                public Map<HystrixCommandKey, HystrixCommandUtilization> call(HystrixUtilization hystrixUtilization) {\n                    return hystrixUtilization.getCommandUtilizationMap();\n                }\n            };", "modifier": "private static final", "type": "Func1<HystrixUtilization, Map<HystrixCommandKey, HystrixCommandUtilization>>", "declarator": "getOnlyCommandUtilization =\n            new Func1<HystrixUtilization, Map<HystrixCommandKey, HystrixCommandUtilization>>() {\n                @Override\n                public Map<HystrixCommandKey, HystrixCommandUtilization> call(HystrixUtilization hystrixUtilization) {\n                    return hystrixUtilization.getCommandUtilizationMap();\n                }\n            }", "var_name": "getOnlyCommandUtilization"}, {"original_string": "private static final Func1<HystrixUtilization, Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization>> getOnlyThreadPoolUtilization =\n            new Func1<HystrixUtilization, Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization>>() {\n                @Override\n                public Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization> call(HystrixUtilization hystrixUtilization) {\n                    return hystrixUtilization.getThreadPoolUtilizationMap();\n                }\n            };", "modifier": "private static final", "type": "Func1<HystrixUtilization, Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization>>", "declarator": "getOnlyThreadPoolUtilization =\n            new Func1<HystrixUtilization, Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization>>() {\n                @Override\n                public Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization> call(HystrixUtilization hystrixUtilization) {\n                    return hystrixUtilization.getThreadPoolUtilizationMap();\n                }\n            }", "var_name": "getOnlyThreadPoolUtilization"}], "methods": [{"identifier": "HystrixUtilizationStream", "parameters": "(final int intervalInMilliseconds)", "modifiers": "@Deprecated //deprecated in 1.5.4. public", "return": "", "signature": " HystrixUtilizationStream(final int intervalInMilliseconds)", "full_signature": "@Deprecated //deprecated in 1.5.4. public  HystrixUtilizationStream(final int intervalInMilliseconds)", "class_method_signature": "HystrixUtilizationStream.HystrixUtilizationStream(final int intervalInMilliseconds)", "testcase": false, "constructor": true}, {"identifier": "getInstance", "parameters": "()", "modifiers": "public static", "return": "HystrixUtilizationStream", "signature": "HystrixUtilizationStream getInstance()", "full_signature": "public static HystrixUtilizationStream getInstance()", "class_method_signature": "HystrixUtilizationStream.getInstance()", "testcase": false, "constructor": false}, {"identifier": "getNonSingletonInstanceOnlyUsedInUnitTests", "parameters": "(int delayInMs)", "modifiers": "static", "return": "HystrixUtilizationStream", "signature": "HystrixUtilizationStream getNonSingletonInstanceOnlyUsedInUnitTests(int delayInMs)", "full_signature": "static HystrixUtilizationStream getNonSingletonInstanceOnlyUsedInUnitTests(int delayInMs)", "class_method_signature": "HystrixUtilizationStream.getNonSingletonInstanceOnlyUsedInUnitTests(int delayInMs)", "testcase": false, "constructor": false}, {"identifier": "observe", "parameters": "()", "modifiers": "public", "return": "Observable<HystrixUtilization>", "signature": "Observable<HystrixUtilization> observe()", "full_signature": "public Observable<HystrixUtilization> observe()", "class_method_signature": "HystrixUtilizationStream.observe()", "testcase": false, "constructor": false}, {"identifier": "observeCommandUtilization", "parameters": "()", "modifiers": "public", "return": "Observable<Map<HystrixCommandKey, HystrixCommandUtilization>>", "signature": "Observable<Map<HystrixCommandKey, HystrixCommandUtilization>> observeCommandUtilization()", "full_signature": "public Observable<Map<HystrixCommandKey, HystrixCommandUtilization>> observeCommandUtilization()", "class_method_signature": "HystrixUtilizationStream.observeCommandUtilization()", "testcase": false, "constructor": false}, {"identifier": "observeThreadPoolUtilization", "parameters": "()", "modifiers": "public", "return": "Observable<Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization>>", "signature": "Observable<Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization>> observeThreadPoolUtilization()", "full_signature": "public Observable<Map<HystrixThreadPoolKey, HystrixThreadPoolUtilization>> observeThreadPoolUtilization()", "class_method_signature": "HystrixUtilizationStream.observeThreadPoolUtilization()", "testcase": false, "constructor": false}, {"identifier": "getIntervalInMilliseconds", "parameters": "()", "modifiers": "public", "return": "int", "signature": "int getIntervalInMilliseconds()", "full_signature": "public int getIntervalInMilliseconds()", "class_method_signature": "HystrixUtilizationStream.getIntervalInMilliseconds()", "testcase": false, "constructor": false}, {"identifier": "isSourceCurrentlySubscribed", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean isSourceCurrentlySubscribed()", "full_signature": "public boolean isSourceCurrentlySubscribed()", "class_method_signature": "HystrixUtilizationStream.isSourceCurrentlySubscribed()", "testcase": false, "constructor": false}, {"identifier": "sampleCommandUtilization", "parameters": "(HystrixCommandMetrics commandMetrics)", "modifiers": "private static", "return": "HystrixCommandUtilization", "signature": "HystrixCommandUtilization sampleCommandUtilization(HystrixCommandMetrics commandMetrics)", "full_signature": "private static HystrixCommandUtilization sampleCommandUtilization(HystrixCommandMetrics commandMetrics)", "class_method_signature": "HystrixUtilizationStream.sampleCommandUtilization(HystrixCommandMetrics commandMetrics)", "testcase": false, "constructor": false}, {"identifier": "sampleThreadPoolUtilization", "parameters": "(HystrixThreadPoolMetrics threadPoolMetrics)", "modifiers": "private static", "return": "HystrixThreadPoolUtilization", "signature": "HystrixThreadPoolUtilization sampleThreadPoolUtilization(HystrixThreadPoolMetrics threadPoolMetrics)", "full_signature": "private static HystrixThreadPoolUtilization sampleThreadPoolUtilization(HystrixThreadPoolMetrics threadPoolMetrics)", "class_method_signature": "HystrixUtilizationStream.sampleThreadPoolUtilization(HystrixThreadPoolMetrics threadPoolMetrics)", "testcase": false, "constructor": false}], "file": "hystrix-core/src/main/java/com/netflix/hystrix/metric/sample/HystrixUtilizationStream.java"}, "focal_method": {"identifier": "observe", "parameters": "()", "modifiers": "public", "return": "Observable<HystrixUtilization>", "body": "public Observable<HystrixUtilization> observe() {\n        return allUtilizationStream;\n    }", "signature": "Observable<HystrixUtilization> observe()", "full_signature": "public Observable<HystrixUtilization> observe()", "class_method_signature": "HystrixUtilizationStream.observe()", "testcase": false, "constructor": false, "invocations": []}, "repository": {"repo_id": 6766558, "url": "https://github.com/Netflix/Hystrix", "stars": 19028, "created": "11/19/2012 8:14:46 PM +00:00", "updates": "2020-01-27T17:55:28+00:00", "fork": "False", "license": "licensed"}}