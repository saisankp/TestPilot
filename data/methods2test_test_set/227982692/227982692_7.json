{"test_class": {"identifier": "BaseAuthorityServiceImplTest", "superclass": "extends BaseTest", "interfaces": "", "fields": [{"original_string": "@Autowired\n    private BaseAuthorityService baseAuthorityService;", "modifier": "@Autowired\n    private", "type": "BaseAuthorityService", "declarator": "baseAuthorityService", "var_name": "baseAuthorityService"}], "file": "platform/base-server/src/test/java/com/opencloud/base/server/service/impl/BaseAuthorityServiceImplTest.java"}, "test_case": {"identifier": "clearInvalidApi", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void clearInvalidApi() {\n        String[] serviceIds = {\n                \"serviceId\",\n                \"serviceId2\"\n        };\n        for (String serviceId : serviceIds) {\n            // \u6e05\u7a7a\u65e0\u6548\u670d\u52a1 \u6743\u9650 \u548c api\u63a5\u53e3\u6570\u636e\n            baseAuthorityService.clearInvalidApi(serviceId, Collections.emptyList());\n        }\n    }", "signature": "void clearInvalidApi()", "full_signature": "@Test public void clearInvalidApi()", "class_method_signature": "BaseAuthorityServiceImplTest.clearInvalidApi()", "testcase": true, "constructor": false, "invocations": ["clearInvalidApi", "emptyList"]}, "focal_class": {"identifier": "BaseAuthorityServiceImpl", "superclass": "extends BaseServiceImpl<BaseAuthorityMapper, BaseAuthority>", "interfaces": "implements BaseAuthorityService", "fields": [{"original_string": "@Autowired\n    private BaseAuthorityMapper baseAuthorityMapper;", "modifier": "@Autowired\n    private", "type": "BaseAuthorityMapper", "declarator": "baseAuthorityMapper", "var_name": "baseAuthorityMapper"}, {"original_string": "@Autowired\n    private BaseAuthorityRoleMapper baseAuthorityRoleMapper;", "modifier": "@Autowired\n    private", "type": "BaseAuthorityRoleMapper", "declarator": "baseAuthorityRoleMapper", "var_name": "baseAuthorityRoleMapper"}, {"original_string": "@Autowired\n    private BaseAuthorityUserMapper baseAuthorityUserMapper;", "modifier": "@Autowired\n    private", "type": "BaseAuthorityUserMapper", "declarator": "baseAuthorityUserMapper", "var_name": "baseAuthorityUserMapper"}, {"original_string": "@Autowired\n    private BaseAuthorityAppMapper baseAuthorityAppMapper;", "modifier": "@Autowired\n    private", "type": "BaseAuthorityAppMapper", "declarator": "baseAuthorityAppMapper", "var_name": "baseAuthorityAppMapper"}, {"original_string": "@Autowired\n    private BaseAuthorityActionMapper baseAuthorityActionMapper;", "modifier": "@Autowired\n    private", "type": "BaseAuthorityActionMapper", "declarator": "baseAuthorityActionMapper", "var_name": "baseAuthorityActionMapper"}, {"original_string": "@Autowired\n    private BaseMenuService baseMenuService;", "modifier": "@Autowired\n    private", "type": "BaseMenuService", "declarator": "baseMenuService", "var_name": "baseMenuService"}, {"original_string": "@Autowired\n    private BaseActionService baseActionService;", "modifier": "@Autowired\n    private", "type": "BaseActionService", "declarator": "baseActionService", "var_name": "baseActionService"}, {"original_string": "@Autowired\n    private BaseApiService baseApiService;", "modifier": "@Autowired\n    private", "type": "BaseApiService", "declarator": "baseApiService", "var_name": "baseApiService"}, {"original_string": "@Autowired\n    private BaseRoleService baseRoleService;", "modifier": "@Autowired\n    private", "type": "BaseRoleService", "declarator": "baseRoleService", "var_name": "baseRoleService"}, {"original_string": "@Autowired\n    private BaseUserService baseUserService;", "modifier": "@Autowired\n    private", "type": "BaseUserService", "declarator": "baseUserService", "var_name": "baseUserService"}, {"original_string": "@Autowired\n    private BaseAppService baseAppService;", "modifier": "@Autowired\n    private", "type": "BaseAppService", "declarator": "baseAppService", "var_name": "baseAppService"}, {"original_string": "@Autowired\n    private RedisTokenStore redisTokenStore;", "modifier": "@Autowired\n    private", "type": "RedisTokenStore", "declarator": "redisTokenStore", "var_name": "redisTokenStore"}, {"original_string": "@Value(\"${spring.application.name}\")\n    private String DEFAULT_SERVICE_ID;", "modifier": "@Value(\"${spring.application.name}\")\n    private", "type": "String", "declarator": "DEFAULT_SERVICE_ID", "var_name": "DEFAULT_SERVICE_ID"}], "methods": [{"identifier": "findAuthorityResource", "parameters": "()", "modifiers": "@Override public", "return": "List<AuthorityResource>", "signature": "List<AuthorityResource> findAuthorityResource()", "full_signature": "@Override public List<AuthorityResource> findAuthorityResource()", "class_method_signature": "BaseAuthorityServiceImpl.findAuthorityResource()", "testcase": false, "constructor": false}, {"identifier": "findAuthorityMenu", "parameters": "(Integer status, String serviceId)", "modifiers": "@Override public", "return": "List<AuthorityMenu>", "signature": "List<AuthorityMenu> findAuthorityMenu(Integer status, String serviceId)", "full_signature": "@Override public List<AuthorityMenu> findAuthorityMenu(Integer status, String serviceId)", "class_method_signature": "BaseAuthorityServiceImpl.findAuthorityMenu(Integer status, String serviceId)", "testcase": false, "constructor": false}, {"identifier": "findAuthorityApi", "parameters": "(String serviceId)", "modifiers": "@Override public", "return": "List<AuthorityApi>", "signature": "List<AuthorityApi> findAuthorityApi(String serviceId)", "full_signature": "@Override public List<AuthorityApi> findAuthorityApi(String serviceId)", "class_method_signature": "BaseAuthorityServiceImpl.findAuthorityApi(String serviceId)", "testcase": false, "constructor": false}, {"identifier": "findAuthorityAction", "parameters": "(Long actionId)", "modifiers": "@Override public", "return": "List<BaseAuthorityAction>", "signature": "List<BaseAuthorityAction> findAuthorityAction(Long actionId)", "full_signature": "@Override public List<BaseAuthorityAction> findAuthorityAction(Long actionId)", "class_method_signature": "BaseAuthorityServiceImpl.findAuthorityAction(Long actionId)", "testcase": false, "constructor": false}, {"identifier": "saveOrUpdateAuthority", "parameters": "(Long resourceId, ResourceType resourceType)", "modifiers": "@Override public", "return": "BaseAuthority", "signature": "BaseAuthority saveOrUpdateAuthority(Long resourceId, ResourceType resourceType)", "full_signature": "@Override public BaseAuthority saveOrUpdateAuthority(Long resourceId, ResourceType resourceType)", "class_method_signature": "BaseAuthorityServiceImpl.saveOrUpdateAuthority(Long resourceId, ResourceType resourceType)", "testcase": false, "constructor": false}, {"identifier": "removeAuthority", "parameters": "(Long resourceId, ResourceType resourceType)", "modifiers": "@Override public", "return": "void", "signature": "void removeAuthority(Long resourceId, ResourceType resourceType)", "full_signature": "@Override public void removeAuthority(Long resourceId, ResourceType resourceType)", "class_method_signature": "BaseAuthorityServiceImpl.removeAuthority(Long resourceId, ResourceType resourceType)", "testcase": false, "constructor": false}, {"identifier": "getAuthority", "parameters": "(Long resourceId, ResourceType resourceType)", "modifiers": "@Override public", "return": "BaseAuthority", "signature": "BaseAuthority getAuthority(Long resourceId, ResourceType resourceType)", "full_signature": "@Override public BaseAuthority getAuthority(Long resourceId, ResourceType resourceType)", "class_method_signature": "BaseAuthorityServiceImpl.getAuthority(Long resourceId, ResourceType resourceType)", "testcase": false, "constructor": false}, {"identifier": "isGranted", "parameters": "(Long resourceId, ResourceType resourceType)", "modifiers": "@Override public", "return": "Boolean", "signature": "Boolean isGranted(Long resourceId, ResourceType resourceType)", "full_signature": "@Override public Boolean isGranted(Long resourceId, ResourceType resourceType)", "class_method_signature": "BaseAuthorityServiceImpl.isGranted(Long resourceId, ResourceType resourceType)", "testcase": false, "constructor": false}, {"identifier": "buildQueryWrapper", "parameters": "(Long resourceId, ResourceType resourceType)", "modifiers": "private", "return": "QueryWrapper<BaseAuthority>", "signature": "QueryWrapper<BaseAuthority> buildQueryWrapper(Long resourceId, ResourceType resourceType)", "full_signature": "private QueryWrapper<BaseAuthority> buildQueryWrapper(Long resourceId, ResourceType resourceType)", "class_method_signature": "BaseAuthorityServiceImpl.buildQueryWrapper(Long resourceId, ResourceType resourceType)", "testcase": false, "constructor": false}, {"identifier": "removeAuthorityApp", "parameters": "(String appId)", "modifiers": "@Override public", "return": "void", "signature": "void removeAuthorityApp(String appId)", "full_signature": "@Override public void removeAuthorityApp(String appId)", "class_method_signature": "BaseAuthorityServiceImpl.removeAuthorityApp(String appId)", "testcase": false, "constructor": false}, {"identifier": "removeAuthorityAction", "parameters": "(Long actionId)", "modifiers": "@Override public", "return": "void", "signature": "void removeAuthorityAction(Long actionId)", "full_signature": "@Override public void removeAuthorityAction(Long actionId)", "class_method_signature": "BaseAuthorityServiceImpl.removeAuthorityAction(Long actionId)", "testcase": false, "constructor": false}, {"identifier": "addAuthorityRole", "parameters": "(Long roleId, Date expireTime, String... authorityIds)", "modifiers": "@Override public", "return": "void", "signature": "void addAuthorityRole(Long roleId, Date expireTime, String... authorityIds)", "full_signature": "@Override public void addAuthorityRole(Long roleId, Date expireTime, String... authorityIds)", "class_method_signature": "BaseAuthorityServiceImpl.addAuthorityRole(Long roleId, Date expireTime, String... authorityIds)", "testcase": false, "constructor": false}, {"identifier": "addAuthorityUser", "parameters": "(Long userId, Date expireTime, String... authorityIds)", "modifiers": "@Override public", "return": "void", "signature": "void addAuthorityUser(Long userId, Date expireTime, String... authorityIds)", "full_signature": "@Override public void addAuthorityUser(Long userId, Date expireTime, String... authorityIds)", "class_method_signature": "BaseAuthorityServiceImpl.addAuthorityUser(Long userId, Date expireTime, String... authorityIds)", "testcase": false, "constructor": false}, {"identifier": "addAuthorityApp", "parameters": "(String appId, Date expireTime, String... authorityIds)", "modifiers": "@CacheEvict(value = {\"apps\"}, key = \"'client:'+#appId\") @Override public", "return": "void", "signature": "void addAuthorityApp(String appId, Date expireTime, String... authorityIds)", "full_signature": "@CacheEvict(value = {\"apps\"}, key = \"'client:'+#appId\") @Override public void addAuthorityApp(String appId, Date expireTime, String... authorityIds)", "class_method_signature": "BaseAuthorityServiceImpl.addAuthorityApp(String appId, Date expireTime, String... authorityIds)", "testcase": false, "constructor": false}, {"identifier": "addAuthorityApp", "parameters": "(String appId, Date expireTime, String authorityId)", "modifiers": "@CacheEvict(value = {\"apps\"}, key = \"'client:'+#appId\") @Override public", "return": "void", "signature": "void addAuthorityApp(String appId, Date expireTime, String authorityId)", "full_signature": "@CacheEvict(value = {\"apps\"}, key = \"'client:'+#appId\") @Override public void addAuthorityApp(String appId, Date expireTime, String authorityId)", "class_method_signature": "BaseAuthorityServiceImpl.addAuthorityApp(String appId, Date expireTime, String authorityId)", "testcase": false, "constructor": false}, {"identifier": "addAuthorityAction", "parameters": "(Long actionId, String... authorityIds)", "modifiers": "@Override public", "return": "void", "signature": "void addAuthorityAction(Long actionId, String... authorityIds)", "full_signature": "@Override public void addAuthorityAction(Long actionId, String... authorityIds)", "class_method_signature": "BaseAuthorityServiceImpl.addAuthorityAction(Long actionId, String... authorityIds)", "testcase": false, "constructor": false}, {"identifier": "findAuthorityByApp", "parameters": "(String appId)", "modifiers": "@Override public", "return": "List<OpenAuthority>", "signature": "List<OpenAuthority> findAuthorityByApp(String appId)", "full_signature": "@Override public List<OpenAuthority> findAuthorityByApp(String appId)", "class_method_signature": "BaseAuthorityServiceImpl.findAuthorityByApp(String appId)", "testcase": false, "constructor": false}, {"identifier": "findAuthorityByRole", "parameters": "(Long roleId)", "modifiers": "@Override public", "return": "List<OpenAuthority>", "signature": "List<OpenAuthority> findAuthorityByRole(Long roleId)", "full_signature": "@Override public List<OpenAuthority> findAuthorityByRole(Long roleId)", "class_method_signature": "BaseAuthorityServiceImpl.findAuthorityByRole(Long roleId)", "testcase": false, "constructor": false}, {"identifier": "findAuthorityByType", "parameters": "(String type)", "modifiers": "@Override public", "return": "List<OpenAuthority>", "signature": "List<OpenAuthority> findAuthorityByType(String type)", "full_signature": "@Override public List<OpenAuthority> findAuthorityByType(String type)", "class_method_signature": "BaseAuthorityServiceImpl.findAuthorityByType(String type)", "testcase": false, "constructor": false}, {"identifier": "findAuthorityByUser", "parameters": "(Long userId, Boolean root)", "modifiers": "@Override public", "return": "List<OpenAuthority>", "signature": "List<OpenAuthority> findAuthorityByUser(Long userId, Boolean root)", "full_signature": "@Override public List<OpenAuthority> findAuthorityByUser(Long userId, Boolean root)", "class_method_signature": "BaseAuthorityServiceImpl.findAuthorityByUser(Long userId, Boolean root)", "testcase": false, "constructor": false}, {"identifier": "findAuthorityMenuByUser", "parameters": "(Long userId, Boolean root)", "modifiers": "@Override public", "return": "List<AuthorityMenu>", "signature": "List<AuthorityMenu> findAuthorityMenuByUser(Long userId, Boolean root)", "full_signature": "@Override public List<AuthorityMenu> findAuthorityMenuByUser(Long userId, Boolean root)", "class_method_signature": "BaseAuthorityServiceImpl.findAuthorityMenuByUser(Long userId, Boolean root)", "testcase": false, "constructor": false}, {"identifier": "findAuthorityMenuByUser", "parameters": "(Long userId, Boolean root, String serviceId)", "modifiers": "@Override public", "return": "List<AuthorityMenu>", "signature": "List<AuthorityMenu> findAuthorityMenuByUser(Long userId, Boolean root, String serviceId)", "full_signature": "@Override public List<AuthorityMenu> findAuthorityMenuByUser(Long userId, Boolean root, String serviceId)", "class_method_signature": "BaseAuthorityServiceImpl.findAuthorityMenuByUser(Long userId, Boolean root, String serviceId)", "testcase": false, "constructor": false}, {"identifier": "isGrantedByRoleIds", "parameters": "(String authorityId, Long... roleIds)", "modifiers": "@Override public", "return": "Boolean", "signature": "Boolean isGrantedByRoleIds(String authorityId, Long... roleIds)", "full_signature": "@Override public Boolean isGrantedByRoleIds(String authorityId, Long... roleIds)", "class_method_signature": "BaseAuthorityServiceImpl.isGrantedByRoleIds(String authorityId, Long... roleIds)", "testcase": false, "constructor": false}, {"identifier": "clearInvalidApi", "parameters": "(String serviceId, Collection<String> codes)", "modifiers": "@Override public", "return": "void", "signature": "void clearInvalidApi(String serviceId, Collection<String> codes)", "full_signature": "@Override public void clearInvalidApi(String serviceId, Collection<String> codes)", "class_method_signature": "BaseAuthorityServiceImpl.clearInvalidApi(String serviceId, Collection<String> codes)", "testcase": false, "constructor": false}], "file": "platform/base-server/src/main/java/com/opencloud/base/server/service/impl/BaseAuthorityServiceImpl.java"}, "focal_method": {"identifier": "clearInvalidApi", "parameters": "(String serviceId, Collection<String> codes)", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void clearInvalidApi(String serviceId, Collection<String> codes) {\n        if (StringUtils.isBlank(serviceId)) {\n            return;\n        }\n        List<String> invalidApiIds = baseApiService.listObjs(new QueryWrapper<BaseApi>().select(\"api_id\").eq(\"service_id\", serviceId).notIn(codes != null && !codes.isEmpty(), \"api_code\", codes), e -> e.toString());\n        if (invalidApiIds != null) {\n            // \u9632\u6b62\u5220\u9664\u9ed8\u8ba4api\n            invalidApiIds.remove(\"1\");\n            invalidApiIds.remove(\"2\");\n            // \u83b7\u53d6\u65e0\u6548\u7684\u6743\u9650\n            if (invalidApiIds.isEmpty()) {\n                return;\n            }\n            List<String> invalidAuthorityIds = listObjs(new QueryWrapper<BaseAuthority>().select(\"authority_id\").in(\"api_id\", invalidApiIds), e -> e.toString());\n            if (invalidAuthorityIds != null && !invalidAuthorityIds.isEmpty()) {\n                // \u79fb\u9664\u5173\u8054\u6570\u636e\n                baseAuthorityAppMapper.delete(new QueryWrapper<BaseAuthorityApp>().in(\"authority_id\", invalidAuthorityIds));\n                baseAuthorityActionMapper.delete(new QueryWrapper<BaseAuthorityAction>().in(\"authority_id\", invalidAuthorityIds));\n                baseAuthorityRoleMapper.delete(new QueryWrapper<BaseAuthorityRole>().in(\"authority_id\", invalidAuthorityIds));\n                baseAuthorityUserMapper.delete(new QueryWrapper<BaseAuthorityUser>().in(\"authority_id\", invalidAuthorityIds));\n                // \u79fb\u9664\u6743\u9650\u6570\u636e\n                this.removeByIds(invalidAuthorityIds);\n                // \u79fb\u9664\u63a5\u53e3\u8d44\u6e90\n                baseApiService.removeByIds(invalidApiIds);\n            }\n        }\n    }", "signature": "void clearInvalidApi(String serviceId, Collection<String> codes)", "full_signature": "@Override public void clearInvalidApi(String serviceId, Collection<String> codes)", "class_method_signature": "BaseAuthorityServiceImpl.clearInvalidApi(String serviceId, Collection<String> codes)", "testcase": false, "constructor": false, "invocations": ["isBlank", "listObjs", "notIn", "eq", "select", "isEmpty", "toString", "remove", "remove", "isEmpty", "listObjs", "in", "select", "toString", "isEmpty", "delete", "in", "delete", "in", "delete", "in", "delete", "in", "removeByIds", "removeByIds"]}, "repository": {"repo_id": 227982692, "url": "https://github.com/uhonliu/open-platform", "language": "Java", "is_fork": false, "fork_count": 8, "stargazer_count": 12, "size": 15471, "license": "licensed"}}