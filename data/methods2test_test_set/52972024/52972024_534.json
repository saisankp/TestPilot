{"test_class": {"identifier": "CachedCollectionTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private ICachedCollection collection;", "modifier": "private", "type": "ICachedCollection", "declarator": "collection", "var_name": "collection"}, {"original_string": "private IStorageConnection connection;", "modifier": "private", "type": "IStorageConnection", "declarator": "connection", "var_name": "connection"}, {"original_string": "private String collectionName;", "modifier": "private", "type": "String", "declarator": "collectionName", "var_name": "collectionName"}, {"original_string": "private IField collectionNameField;", "modifier": "private", "type": "IField", "declarator": "collectionNameField", "var_name": "collectionNameField"}, {"original_string": "private IField keyNameField;", "modifier": "private", "type": "IField", "declarator": "keyNameField", "var_name": "keyNameField"}, {"original_string": "private IField keyValueField;", "modifier": "private", "type": "IField", "declarator": "keyValueField", "var_name": "keyValueField"}, {"original_string": "private IField specificKeyNameField;", "modifier": "private", "type": "IField", "declarator": "specificKeyNameField", "var_name": "specificKeyNameField"}, {"original_string": "private IField documentField;", "modifier": "private", "type": "IField", "declarator": "documentField", "var_name": "documentField"}, {"original_string": "private IField idField;", "modifier": "private", "type": "IField", "declarator": "idField", "var_name": "idField"}, {"original_string": "private IField isActiveField;", "modifier": "private", "type": "IField", "declarator": "isActiveField", "var_name": "isActiveField"}, {"original_string": "private IField searchResultField;", "modifier": "private", "type": "IField", "declarator": "searchResultField", "var_name": "searchResultField"}], "file": "CoreFeatures/Database/CachedCollection/src/test/java/info/smart_tools/smartactors/database/cached_collection/CachedCollectionTest.java"}, "test_case": {"identifier": "ShouldDeleteObject", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void ShouldDeleteObject() throws Exception {\n\n        IObject query = mock(IObject.class);\n        IObject deleteQuery = mock(IObject.class);\n        IKey keyIObject = mock(IKey.class);\n        when(Keys.getOrAdd(\"info.smart_tools.smartactors.iobject.iobject.IObject\")).thenReturn(keyIObject);\n        when(IOC.resolve(keyIObject)).thenReturn(deleteQuery);\n\n        IDatabaseTask deleteTask = mock(IDatabaseTask.class);\n        IKey keyTask = mock(IKey.class);\n        when(Keys.getOrAdd(\"db.cached_collection.delete\")).thenReturn(keyTask);\n        when(IOC.resolve(eq(keyTask), any(), eq(collectionName), eq(query))).thenReturn(deleteTask);\n\n        when(specificKeyNameField.in(query)).thenReturn(\"key\");\n\n        collection.delete(query);\n\n        verify(deleteTask).execute();\n    }", "signature": "void ShouldDeleteObject()", "full_signature": "@Test public void ShouldDeleteObject()", "class_method_signature": "CachedCollectionTest.ShouldDeleteObject()", "testcase": true, "constructor": false, "invocations": ["mock", "mock", "mock", "thenReturn", "when", "getOrAdd", "thenReturn", "when", "resolve", "mock", "mock", "thenReturn", "when", "getOrAdd", "thenReturn", "when", "resolve", "eq", "any", "eq", "eq", "thenReturn", "when", "in", "delete", "execute", "verify"]}, "focal_class": {"identifier": "CachedCollection", "superclass": "", "interfaces": "implements ICachedCollection", "fields": [{"original_string": "private IField collectionNameField;", "modifier": "private", "type": "IField", "declarator": "collectionNameField", "var_name": "collectionNameField"}, {"original_string": "private IField keyNameField;", "modifier": "private", "type": "IField", "declarator": "keyNameField", "var_name": "keyNameField"}, {"original_string": "private IField specificKeyNameField;", "modifier": "private", "type": "IField", "declarator": "specificKeyNameField", "var_name": "specificKeyNameField"}, {"original_string": "private IField idField;", "modifier": "private", "type": "IField", "declarator": "idField", "var_name": "idField"}, {"original_string": "private IField isActiveField;", "modifier": "private", "type": "IField", "declarator": "isActiveField", "var_name": "isActiveField"}, {"original_string": "private IPool connectionPool;", "modifier": "private", "type": "IPool", "declarator": "connectionPool", "var_name": "connectionPool"}, {"original_string": "private String collectionName;", "modifier": "private", "type": "String", "declarator": "collectionName", "var_name": "collectionName"}, {"original_string": "private String keyName;", "modifier": "private", "type": "String", "declarator": "keyName", "var_name": "keyName"}, {"original_string": "private ConcurrentMap<String, List<IObject>> map;", "modifier": "private", "type": "ConcurrentMap<String, List<IObject>>", "declarator": "map", "var_name": "map"}], "methods": [{"identifier": "CachedCollection", "parameters": "(final IObject config)", "modifiers": "public", "return": "", "signature": " CachedCollection(final IObject config)", "full_signature": "public  CachedCollection(final IObject config)", "class_method_signature": "CachedCollection.CachedCollection(final IObject config)", "testcase": false, "constructor": true}, {"identifier": "getItems", "parameters": "(final String key)", "modifiers": "@Override public", "return": "List<IObject>", "signature": "List<IObject> getItems(final String key)", "full_signature": "@Override public List<IObject> getItems(final String key)", "class_method_signature": "CachedCollection.getItems(final String key)", "testcase": false, "constructor": false}, {"identifier": "delete", "parameters": "(final IObject message)", "modifiers": "@Override public", "return": "void", "signature": "void delete(final IObject message)", "full_signature": "@Override public void delete(final IObject message)", "class_method_signature": "CachedCollection.delete(final IObject message)", "testcase": false, "constructor": false}, {"identifier": "upsert", "parameters": "(final IObject message)", "modifiers": "@Override public", "return": "void", "signature": "void upsert(final IObject message)", "full_signature": "@Override public void upsert(final IObject message)", "class_method_signature": "CachedCollection.upsert(final IObject message)", "testcase": false, "constructor": false}, {"identifier": "clearCache", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void clearCache()", "full_signature": "@Override public void clearCache()", "class_method_signature": "CachedCollection.clearCache()", "testcase": false, "constructor": false}], "file": "CoreFeatures/Database/CachedCollection/src/main/java/info/smart_tools/smartactors/database/cached_collection/CachedCollection.java"}, "focal_method": {"identifier": "delete", "parameters": "(final IObject message)", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void delete(final IObject message) throws DeleteCacheItemException {\n        try {\n            try (IPoolGuard poolGuard = new PoolGuard(connectionPool)) {\n                IDatabaseTask deleteTask = IOC.resolve(\n                    Keys.getOrAdd(\"db.cached_collection.delete\"),\n                    poolGuard.getObject(),\n                    collectionName,\n                    message\n                );\n                deleteTask.execute();\n            } catch (PoolGuardException e) {\n                throw new DeleteCacheItemException(\"Can't get connection from pool.\", e);\n            } catch (TaskExecutionException e) {\n                throw new DeleteCacheItemException(\"Error during execution delete task.\", e);\n            }\n\n            String key = specificKeyNameField.in(message);\n            List<IObject> items = map.get(key);\n            if (items != null) {\n                for (IObject obj : items) {\n                    if (idField.in(obj).equals(idField.in(message))) {\n                        items.remove(obj);\n                        break;\n                    }\n                }\n            }\n        }  catch (ResolutionException e) {\n            throw new DeleteCacheItemException(\"Can't resolve cached object.\", e);\n        } catch (InvalidArgumentException | ReadValueException e) {\n            throw new DeleteCacheItemException(\"Can't delete cached object.\", e);\n        }\n    }", "signature": "void delete(final IObject message)", "full_signature": "@Override public void delete(final IObject message)", "class_method_signature": "CachedCollection.delete(final IObject message)", "testcase": false, "constructor": false, "invocations": ["resolve", "getOrAdd", "getObject", "execute", "in", "get", "equals", "in", "in", "remove"]}, "repository": {"repo_id": 52972024, "url": "https://github.com/SmartTools/smartactors-core", "language": "Java", "is_fork": false, "fork_count": 7, "stargazer_count": 17, "size": 58816, "license": "licensed"}}