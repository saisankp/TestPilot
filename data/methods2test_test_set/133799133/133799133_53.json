{"test_class": {"identifier": "DatabaseConnectorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Autowired\n  JdbcTemplate jdbcTemplate;", "modifier": "@Autowired", "type": "JdbcTemplate", "declarator": "jdbcTemplate", "var_name": "jdbcTemplate"}, {"original_string": "@Autowired\n  DatabaseConnector connector;", "modifier": "@Autowired", "type": "DatabaseConnector", "declarator": "connector", "var_name": "connector"}], "file": "databasemigration/src/test/java/de/governikus/eumw/databasemigration/DatabaseConnectorTest.java"}, "test_case": {"identifier": "testRemoveOutdatedBlacklistVersions", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testRemoveOutdatedBlacklistVersions()\n  {\n    assertThat(\"The initial database must contain 5 entries\", getNumberOfRows(), is(5));\n\n    // cleanup should not delete any entries as they are all the same version\n    connector.removeOutdatedVersionsFromBlacklistentry();\n    assertThat(\"No current versions should be deleted\", getNumberOfRows(), is(5));\n\n    // Add entries with older blacklist version\n    for ( int i = 0 ; i < 10 ; i++ )\n    {\n      addEntryToBlacklistentry(Base64.getEncoder().encodeToString(\"XXX\".getBytes(StandardCharsets.UTF_8)),\n                               UUID.randomUUID().toString(),\n                               \"1000\");\n    }\n    assertThat(\"There must be 15 entries\", getNumberOfRows(), is(15));\n\n    // Perform the clean up\n    connector.removeOutdatedVersionsFromBlacklistentry();\n    assertThat(\"The 10 outdated entries should be deleted\", getNumberOfRows(), is(5));\n    List<Long> expected = Arrays.asList(1337L);\n    assertThat(\"Only the recent blacklist version should be present\",\n               getUniqueBlacklistVersions(),\n               Matchers.containsInAnyOrder(expected.toArray()));\n  }", "signature": "void testRemoveOutdatedBlacklistVersions()", "full_signature": "@Test public void testRemoveOutdatedBlacklistVersions()", "class_method_signature": "DatabaseConnectorTest.testRemoveOutdatedBlacklistVersions()", "testcase": true, "constructor": false, "invocations": ["assertThat", "getNumberOfRows", "is", "removeOutdatedVersionsFromBlacklistentry", "assertThat", "getNumberOfRows", "is", "addEntryToBlacklistentry", "encodeToString", "getEncoder", "getBytes", "toString", "randomUUID", "assertThat", "getNumberOfRows", "is", "removeOutdatedVersionsFromBlacklistentry", "assertThat", "getNumberOfRows", "is", "asList", "assertThat", "getUniqueBlacklistVersions", "containsInAnyOrder", "toArray"]}, "focal_class": {"identifier": "DatabaseConnector", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final JdbcTemplate jdbcTemplate;", "modifier": "private final", "type": "JdbcTemplate", "declarator": "jdbcTemplate", "var_name": "jdbcTemplate"}], "methods": [{"identifier": "DatabaseConnector", "parameters": "(JdbcTemplate jdbcTemplate)", "modifiers": "public", "return": "", "signature": " DatabaseConnector(JdbcTemplate jdbcTemplate)", "full_signature": "public  DatabaseConnector(JdbcTemplate jdbcTemplate)", "class_method_signature": "DatabaseConnector.DatabaseConnector(JdbcTemplate jdbcTemplate)", "testcase": false, "constructor": true}, {"identifier": "getTerminalsFromTerminalpermission", "parameters": "()", "modifiers": "public", "return": "List<byte[]>", "signature": "List<byte[]> getTerminalsFromTerminalpermission()", "full_signature": "public List<byte[]> getTerminalsFromTerminalpermission()", "class_method_signature": "DatabaseConnector.getTerminalsFromTerminalpermission()", "testcase": false, "constructor": false}, {"identifier": "removeOutdatedSectorIDsFromBlacklistentry", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void removeOutdatedSectorIDsFromBlacklistentry()", "full_signature": "public void removeOutdatedSectorIDsFromBlacklistentry()", "class_method_signature": "DatabaseConnector.removeOutdatedSectorIDsFromBlacklistentry()", "testcase": false, "constructor": false}, {"identifier": "removeOutdatedVersionsFromBlacklistentry", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void removeOutdatedVersionsFromBlacklistentry()", "full_signature": "public void removeOutdatedVersionsFromBlacklistentry()", "class_method_signature": "DatabaseConnector.removeOutdatedVersionsFromBlacklistentry()", "testcase": false, "constructor": false}, {"identifier": "checkPrimaryKey", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean checkPrimaryKey()", "full_signature": "public boolean checkPrimaryKey()", "class_method_signature": "DatabaseConnector.checkPrimaryKey()", "testcase": false, "constructor": false}, {"identifier": "performMigrationWithoutData", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean performMigrationWithoutData()", "full_signature": "public boolean performMigrationWithoutData()", "class_method_signature": "DatabaseConnector.performMigrationWithoutData()", "testcase": false, "constructor": false}, {"identifier": "performMigrationWithData", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean performMigrationWithData()", "full_signature": "public boolean performMigrationWithData()", "class_method_signature": "DatabaseConnector.performMigrationWithData()", "testcase": false, "constructor": false}, {"identifier": "getColumnCountForBlacklistentry", "parameters": "()", "modifiers": "private", "return": "int", "signature": "int getColumnCountForBlacklistentry()", "full_signature": "private int getColumnCountForBlacklistentry()", "class_method_signature": "DatabaseConnector.getColumnCountForBlacklistentry()", "testcase": false, "constructor": false}], "file": "databasemigration/src/main/java/de/governikus/eumw/databasemigration/DatabaseConnector.java"}, "focal_method": {"identifier": "removeOutdatedVersionsFromBlacklistentry", "parameters": "()", "modifiers": "public", "return": "void", "body": "public void removeOutdatedVersionsFromBlacklistentry()\n  {\n    List<Long> blacklistversions = jdbcTemplate.queryForList(\"SELECT DISTINCT BLACKLISTVERSION FROM BLACKLISTENTRY\",\n                                                             Long.TYPE);\n    if (blacklistversions.size() > 1)\n    {\n      Long currentBlacklistversion = Collections.max(blacklistversions);\n      int rowsAffected = jdbcTemplate.update(\"DELETE FROM BLACKLISTENTRY WHERE BLACKLISTVERSION <> ?\",\n                                             currentBlacklistversion);\n      log.info(\"Deleted {} entries with outdated Blacklist versions from Blacklistentry\", rowsAffected);\n    }\n    else\n    {\n      log.info(\"No entries with outdated Blacklist versions found.\");\n    }\n  }", "signature": "void removeOutdatedVersionsFromBlacklistentry()", "full_signature": "public void removeOutdatedVersionsFromBlacklistentry()", "class_method_signature": "DatabaseConnector.removeOutdatedVersionsFromBlacklistentry()", "testcase": false, "constructor": false, "invocations": ["queryForList", "size", "max", "update", "info", "info"]}, "repository": {"repo_id": 133799133, "url": "https://github.com/Governikus/eidas-middleware", "language": "Java", "is_fork": false, "fork_count": 11, "stargazer_count": 15, "size": 2286, "license": "licensed"}}