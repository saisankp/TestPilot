{"test_class": {"identifier": "EventBusSinkTest", "superclass": "extends EventbusTestBase", "interfaces": "", "fields": [{"original_string": "private WeldContainer container;", "modifier": "private", "type": "WeldContainer", "declarator": "container", "var_name": "container"}], "file": "smallrye-reactive-messaging-vertx-eventbus/src/test/java/io/smallrye/reactive/messaging/eventbus/EventBusSinkTest.java"}, "test_case": {"identifier": "testSinkUsingString", "parameters": "()", "modifiers": "@SuppressWarnings(\"unchecked\") @Test public", "return": "void", "body": "@SuppressWarnings(\"unchecked\")\n    @Test\n    public void testSinkUsingString() {\n        String topic = UUID.randomUUID().toString();\n        AtomicInteger expected = new AtomicInteger(0);\n        usage.consumeStrings(topic, 10, 10, TimeUnit.SECONDS,\n                v -> expected.getAndIncrement());\n\n        Map<String, Object> config = new HashMap<>();\n        config.put(\"address\", topic);\n        EventBusSink sink = new EventBusSink(vertx,\n                new VertxEventBusConnectorOutgoingConfiguration(new MapBasedConfig(config)));\n\n        SubscriberBuilder<? extends Message<?>, Void> subscriber = sink.sink();\n        Multi.createFrom().range(0, 10)\n                .map(i -> Integer.toString(i))\n                .map(Message::of)\n                .subscribe((Subscriber<Message<?>>) subscriber.build());\n        await().untilAtomic(expected, is(10));\n        assertThat(expected).hasValue(10);\n    }", "signature": "void testSinkUsingString()", "full_signature": "@SuppressWarnings(\"unchecked\") @Test public void testSinkUsingString()", "class_method_signature": "EventBusSinkTest.testSinkUsingString()", "testcase": true, "constructor": false, "invocations": ["toString", "randomUUID", "consumeStrings", "getAndIncrement", "put", "sink", "subscribe", "map", "map", "range", "createFrom", "toString", "build", "untilAtomic", "await", "is", "hasValue", "assertThat"]}, "focal_class": {"identifier": "EventBusSink", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final String address;", "modifier": "private final", "type": "String", "declarator": "address", "var_name": "address"}, {"original_string": "private final Vertx vertx;", "modifier": "private final", "type": "Vertx", "declarator": "vertx", "var_name": "vertx"}, {"original_string": "private final boolean publish;", "modifier": "private final", "type": "boolean", "declarator": "publish", "var_name": "publish"}, {"original_string": "private final boolean expectReply;", "modifier": "private final", "type": "boolean", "declarator": "expectReply", "var_name": "expectReply"}, {"original_string": "private final String codec;", "modifier": "private final", "type": "String", "declarator": "codec", "var_name": "codec"}, {"original_string": "private final long timeout;", "modifier": "private final", "type": "long", "declarator": "timeout", "var_name": "timeout"}], "methods": [{"identifier": "EventBusSink", "parameters": "(Vertx vertx, VertxEventBusConnectorOutgoingConfiguration config)", "modifiers": "", "return": "", "signature": " EventBusSink(Vertx vertx, VertxEventBusConnectorOutgoingConfiguration config)", "full_signature": "  EventBusSink(Vertx vertx, VertxEventBusConnectorOutgoingConfiguration config)", "class_method_signature": "EventBusSink.EventBusSink(Vertx vertx, VertxEventBusConnectorOutgoingConfiguration config)", "testcase": false, "constructor": true}, {"identifier": "sink", "parameters": "()", "modifiers": "", "return": "SubscriberBuilder<? extends Message<?>, Void>", "signature": "SubscriberBuilder<? extends Message<?>, Void> sink()", "full_signature": " SubscriberBuilder<? extends Message<?>, Void> sink()", "class_method_signature": "EventBusSink.sink()", "testcase": false, "constructor": false}], "file": "smallrye-reactive-messaging-vertx-eventbus/src/main/java/io/smallrye/reactive/messaging/eventbus/EventBusSink.java"}, "focal_method": {"identifier": "sink", "parameters": "()", "modifiers": "", "return": "SubscriberBuilder<? extends Message<?>, Void>", "body": "SubscriberBuilder<? extends Message<?>, Void> sink() {\n        DeliveryOptions options = new DeliveryOptions();\n        if (this.codec != null) {\n            options.setCodecName(this.codec);\n        }\n        if (this.timeout != -1) {\n            options.setSendTimeout(this.timeout);\n        }\n\n        return ReactiveStreams.<Message<?>> builder()\n                .flatMapCompletionStage(msg -> {\n                    // TODO support getting an EventBusMessage as message.\n                    if (!this.publish) {\n                        if (expectReply) {\n                            return vertx.eventBus().request(address, msg.getPayload(), options).subscribeAsCompletionStage()\n                                    .thenApply(m -> msg);\n                        } else {\n                            vertx.eventBus().sendAndForget(address, msg.getPayload(), options);\n                            return CompletableFuture.completedFuture(msg);\n                        }\n                    } else {\n                        vertx.eventBus().publish(address, msg.getPayload(), options);\n                        return CompletableFuture.completedFuture(msg);\n                    }\n                })\n                .ignore();\n    }", "signature": "SubscriberBuilder<? extends Message<?>, Void> sink()", "full_signature": " SubscriberBuilder<? extends Message<?>, Void> sink()", "class_method_signature": "EventBusSink.sink()", "testcase": false, "constructor": false, "invocations": ["setCodecName", "setSendTimeout", "ignore", "flatMapCompletionStage", "builder", "thenApply", "subscribeAsCompletionStage", "request", "eventBus", "getPayload", "sendAndForget", "eventBus", "getPayload", "completedFuture", "publish", "eventBus", "getPayload", "completedFuture"]}, "repository": {"repo_id": 153155267, "url": "https://github.com/smallrye/smallrye-reactive-messaging", "stars": 45, "created": "10/15/2018 5:36:05 PM +00:00", "updates": "2020-01-26T16:55:44+00:00", "fork": "False", "license": "licensed"}}