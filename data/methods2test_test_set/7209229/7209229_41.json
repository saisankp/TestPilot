{"test_class": {"identifier": "TestRateControl", "superclass": "", "interfaces": "", "fields": [], "file": "databus-core/databus-core-impl/src/test/java/com/linkedin/databus/core/util/TestRateControl.java"}, "test_case": {"identifier": "testSleepToMaintainRate", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testSleepToMaintainRate() throws Exception\n  {\n    RateControl rc = new RateControl(2,1);\n\n    long duration = 10000;\n    long msecToSleep = rc.sleepToMaintainRate(duration);\n    Assert.assertEquals(msecToSleep, 1L);\n\n    duration = 100000;\n    msecToSleep = rc.sleepToMaintainRate(duration);\n    Assert.assertEquals(msecToSleep, 1L);\n\n    duration = 1000000;\n    msecToSleep = rc.sleepToMaintainRate(duration);\n    Assert.assertEquals(msecToSleep, 1L);\n\n    duration = 100000000;\n    msecToSleep = rc.sleepToMaintainRate(duration);\n    Assert.assertEquals(msecToSleep, 100L);\n\n    duration = 1000000000;\n    msecToSleep = rc.sleepToMaintainRate(duration);\n    Assert.assertEquals(msecToSleep, 1000L);\n\n  }", "signature": "void testSleepToMaintainRate()", "full_signature": "@Test public void testSleepToMaintainRate()", "class_method_signature": "TestRateControl.testSleepToMaintainRate()", "testcase": true, "constructor": false, "invocations": ["sleepToMaintainRate", "assertEquals", "sleepToMaintainRate", "assertEquals", "sleepToMaintainRate", "assertEquals", "sleepToMaintainRate", "assertEquals", "sleepToMaintainRate", "assertEquals"]}, "focal_class": {"identifier": "RateControl", "superclass": "", "interfaces": "", "fields": [{"original_string": "private RateMonitor _ra = null;", "modifier": "private", "type": "RateMonitor", "declarator": "_ra = null", "var_name": "_ra"}, {"original_string": "private long _maxEventsPerSec = Long.MIN_VALUE, _maxthrottleDurationInSecs = Long.MIN_VALUE;", "modifier": "private", "type": "long", "declarator": "_maxEventsPerSec = Long.MIN_VALUE", "var_name": "_maxEventsPerSec"}, {"original_string": "final private boolean _enabled;", "modifier": "final private", "type": "boolean", "declarator": "_enabled", "var_name": "_enabled"}, {"original_string": "private boolean _expired = false;", "modifier": "private", "type": "boolean", "declarator": "_expired = false", "var_name": "_expired"}, {"original_string": "private long _numSleeps = 0;", "modifier": "private", "type": "long", "declarator": "_numSleeps = 0", "var_name": "_numSleeps"}, {"original_string": "public static final String MODULE = RateControl.class.getName();", "modifier": "public static final", "type": "String", "declarator": "MODULE = RateControl.class.getName()", "var_name": "MODULE"}, {"original_string": "public static final Logger LOG = Logger.getLogger(MODULE);", "modifier": "public static final", "type": "Logger", "declarator": "LOG = Logger.getLogger(MODULE)", "var_name": "LOG"}], "methods": [{"identifier": "RateControl", "parameters": "(long numEventsPerSec, long throttleDurationInSecs)", "modifiers": "public", "return": "", "signature": " RateControl(long numEventsPerSec, long throttleDurationInSecs)", "full_signature": "public  RateControl(long numEventsPerSec, long throttleDurationInSecs)", "class_method_signature": "RateControl.RateControl(long numEventsPerSec, long throttleDurationInSecs)", "testcase": false, "constructor": true}, {"identifier": "incrementEventCount", "parameters": "()", "modifiers": "public", "return": "long", "signature": "long incrementEventCount()", "full_signature": "public long incrementEventCount()", "class_method_signature": "RateControl.incrementEventCount()", "testcase": false, "constructor": false}, {"identifier": "isEnabled", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean isEnabled()", "full_signature": "public boolean isEnabled()", "class_method_signature": "RateControl.isEnabled()", "testcase": false, "constructor": false}, {"identifier": "sleepToMaintainRate", "parameters": "(long duration)", "modifiers": "protected", "return": "long", "signature": "long sleepToMaintainRate(long duration)", "full_signature": "protected long sleepToMaintainRate(long duration)", "class_method_signature": "RateControl.sleepToMaintainRate(long duration)", "testcase": false, "constructor": false}, {"identifier": "checkExpired", "parameters": "()", "modifiers": "protected", "return": "boolean", "signature": "boolean checkExpired()", "full_signature": "protected boolean checkExpired()", "class_method_signature": "RateControl.checkExpired()", "testcase": false, "constructor": false}, {"identifier": "checkRateExceeded", "parameters": "()", "modifiers": "protected", "return": "boolean", "signature": "boolean checkRateExceeded()", "full_signature": "protected boolean checkRateExceeded()", "class_method_signature": "RateControl.checkRateExceeded()", "testcase": false, "constructor": false}, {"identifier": "computeSleepDuration", "parameters": "()", "modifiers": "protected", "return": "long", "signature": "long computeSleepDuration()", "full_signature": "protected long computeSleepDuration()", "class_method_signature": "RateControl.computeSleepDuration()", "testcase": false, "constructor": false}, {"identifier": "getNumSleeps", "parameters": "()", "modifiers": "public", "return": "long", "signature": "long getNumSleeps()", "full_signature": "public long getNumSleeps()", "class_method_signature": "RateControl.getNumSleeps()", "testcase": false, "constructor": false}, {"identifier": "resetNumSleeps", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void resetNumSleeps()", "full_signature": "public void resetNumSleeps()", "class_method_signature": "RateControl.resetNumSleeps()", "testcase": false, "constructor": false}], "file": "databus-core/databus-core-impl/src/main/java/com/linkedin/databus/core/util/RateControl.java"}, "focal_method": {"identifier": "sleepToMaintainRate", "parameters": "(long duration)", "modifiers": "protected", "return": "long", "body": "protected long sleepToMaintainRate(long duration) throws InterruptedException, DatabusException\n  {\n    if (duration <= 0 )\n    {\n      throw new DatabusException(\"Negative duration specified\");\n    }\n\n    long remainingTimeNSec = duration;\n    long remainingTimeMSec = remainingTimeNSec / DbusConstants.NUM_NSECS_IN_MSEC;\n    remainingTimeNSec -= (remainingTimeMSec * DbusConstants.NUM_NSECS_IN_MSEC);\n\n    // Make sleep at msec resolution. Err on the side of sleeping for a msec resolution instead of nsecs\n    // to keep rate strictly less than specified rate\n    if (remainingTimeNSec > 0)\n      remainingTimeMSec++;\n\n    boolean needToSleep = (remainingTimeMSec > 0);\n    if (needToSleep)\n    {\n      if (LOG.isDebugEnabled())\n      {\n        LOG.debug(\"Sleeping for remainingTimeMSec = \" + remainingTimeMSec);        \t\n      }\n      _ra.sleep(remainingTimeMSec);\n      _numSleeps++;\n    }\n    else\n    {\n      if (LOG.isDebugEnabled())\n      {\n        LOG.debug(\"No need to sleep. remainingTimeMSec = \" + remainingTimeMSec);\n      }\n    }\n\n    return remainingTimeMSec;\n  }", "signature": "long sleepToMaintainRate(long duration)", "full_signature": "protected long sleepToMaintainRate(long duration)", "class_method_signature": "RateControl.sleepToMaintainRate(long duration)", "testcase": false, "constructor": false, "invocations": ["isDebugEnabled", "debug", "sleep", "isDebugEnabled", "debug"]}, "repository": {"repo_id": 7209229, "url": "https://github.com/linkedin/databus", "language": "Java", "is_fork": false, "fork_count": 653, "stargazer_count": 2899, "size": 51191, "license": "licensed"}}