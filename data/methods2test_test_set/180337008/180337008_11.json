{"test_class": {"identifier": "PaullGenericControllerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Autowired\n    MockMvc mockMvc;", "modifier": "@Autowired", "type": "MockMvc", "declarator": "mockMvc", "var_name": "mockMvc"}, {"original_string": "@Autowired\n    PaullGenericController paullGenericController;", "modifier": "@Autowired", "type": "PaullGenericController", "declarator": "paullGenericController", "var_name": "paullGenericController"}, {"original_string": "@MockBean\n    SesileService sesileService;", "modifier": "@MockBean", "type": "SesileService", "declarator": "sesileService", "var_name": "sesileService"}, {"original_string": "@MockBean\n    LocalAuthorityService localAuthorityService;", "modifier": "@MockBean", "type": "LocalAuthorityService", "declarator": "localAuthorityService", "var_name": "localAuthorityService"}, {"original_string": "@MockBean\n    PaullService paullService;", "modifier": "@MockBean", "type": "PaullService", "declarator": "paullService", "var_name": "paullService"}, {"original_string": "@MockBean\n    CertUtilService certUtilService;", "modifier": "@MockBean", "type": "CertUtilService", "declarator": "certUtilService", "var_name": "certUtilService"}, {"original_string": "@MockBean\n    ExternalRestService externalRestService;", "modifier": "@MockBean", "type": "ExternalRestService", "declarator": "externalRestService", "var_name": "externalRestService"}, {"original_string": "private String urlTemplate = \"/rest/externalws/SIREN/fr/classic/webservgeneriques/services/api/rest.php/\";", "modifier": "private", "type": "String", "declarator": "urlTemplate = \"/rest/externalws/SIREN/fr/classic/webservgeneriques/services/api/rest.php/\"", "var_name": "urlTemplate"}, {"original_string": "private HttpHeaders httpHeaders;", "modifier": "private", "type": "HttpHeaders", "declarator": "httpHeaders", "var_name": "httpHeaders"}, {"original_string": "private LocalAuthority localAuthority;", "modifier": "private", "type": "LocalAuthority", "declarator": "localAuthority", "var_name": "localAuthority"}], "file": "pes-service/src/test/java/fr/sictiam/stela/pesservice/controller/PaullGenericControllerTest.java"}, "test_case": {"identifier": "infosDocument", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void infosDocument() throws Exception {\n        ResultActions resultActions =\n                mockMvc.perform(\n                        get(urlTemplate.replaceFirst(\"SIREN\", \"sys250601879\") + \"/infosdoc/3000\")\n                                .headers(httpHeaders));\n\n        resultActions\n                .andExpect(matchAll(\n                        status().isOk(),\n                        jsonPath(\"$.status\").value(200),\n                        jsonPath(\"$.status_message\").value(\"OK\"),\n                        jsonPath(\"$.data\").hasJsonPath(),\n                        jsonPath(\"$.data.EtatClasseur\").value(ClasseurStatus.IN_PROGRESS.toString())))\n                .andDo(print());\n    }", "signature": "void infosDocument()", "full_signature": "@Test public void infosDocument()", "class_method_signature": "PaullGenericControllerTest.infosDocument()", "testcase": true, "constructor": false, "invocations": ["perform", "headers", "get", "replaceFirst", "andDo", "andExpect", "matchAll", "isOk", "status", "value", "jsonPath", "value", "jsonPath", "hasJsonPath", "jsonPath", "value", "jsonPath", "toString", "print"]}, "focal_class": {"identifier": "PaullGenericController", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(PaullGenericController.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(PaullGenericController.class)", "var_name": "LOGGER"}, {"original_string": "private final SesileService sesileService;", "modifier": "private final", "type": "SesileService", "declarator": "sesileService", "var_name": "sesileService"}, {"original_string": "private final LocalAuthorityService localAuthorityService;", "modifier": "private final", "type": "LocalAuthorityService", "declarator": "localAuthorityService", "var_name": "localAuthorityService"}, {"original_string": "private final PaullService paullService;", "modifier": "private final", "type": "PaullService", "declarator": "paullService", "var_name": "paullService"}, {"original_string": "private final ExternalRestService externalRestService;", "modifier": "private final", "type": "ExternalRestService", "declarator": "externalRestService", "var_name": "externalRestService"}], "methods": [{"identifier": "PaullGenericController", "parameters": "(SesileService sesileService, LocalAuthorityService localAuthorityService,\n                                  PaullService paullService, ExternalRestService externalRestService)", "modifiers": "public", "return": "", "signature": " PaullGenericController(SesileService sesileService, LocalAuthorityService localAuthorityService,\n                                  PaullService paullService, ExternalRestService externalRestService)", "full_signature": "public  PaullGenericController(SesileService sesileService, LocalAuthorityService localAuthorityService,\n                                  PaullService paullService, ExternalRestService externalRestService)", "class_method_signature": "PaullGenericController.PaullGenericController(SesileService sesileService, LocalAuthorityService localAuthorityService,\n                                  PaullService paullService, ExternalRestService externalRestService)", "testcase": false, "constructor": true}, {"identifier": "generatePaullResponse", "parameters": "(HttpStatus httpStatus, Object datas)", "modifiers": "private", "return": "PaullResponse", "signature": "PaullResponse generatePaullResponse(HttpStatus httpStatus, Object datas)", "full_signature": "private PaullResponse generatePaullResponse(HttpStatus httpStatus, Object datas)", "class_method_signature": "PaullGenericController.generatePaullResponse(HttpStatus httpStatus, Object datas)", "testcase": false, "constructor": false}, {"identifier": "generatePaullResponse", "parameters": "(HttpStatus httpStatus, Object datas, String customMessage)", "modifiers": "private", "return": "PaullResponse", "signature": "PaullResponse generatePaullResponse(HttpStatus httpStatus, Object datas, String customMessage)", "full_signature": "private PaullResponse generatePaullResponse(HttpStatus httpStatus, Object datas, String customMessage)", "class_method_signature": "PaullGenericController.generatePaullResponse(HttpStatus httpStatus, Object datas, String customMessage)", "testcase": false, "constructor": false}, {"identifier": "depotDocument", "parameters": "(@PathVariable String siren, MultipartHttpServletRequest request,\n            @RequestParam(name = \"title\", required = false) String title,\n            @RequestParam(name = \"comment\", required = false) String comment,\n            @RequestParam(name = \"name\", required = false) String name,\n            @RequestParam(name = \"desc\", required = false) String desc,\n            @RequestParam(name = \"validation\", required = false) String validation,\n            @RequestParam(name = \"email\", required = false) String email,\n            @RequestParam(name = \"type\", required = false) Integer type,\n            @RequestParam(name = \"service\", required = false) String service,\n            @RequestHeader(\"userid\") String userid,\n            @RequestHeader(\"password\") String password)", "modifiers": "@PostMapping(\"/depot\") public", "return": "ResponseEntity<?>", "signature": "ResponseEntity<?> depotDocument(@PathVariable String siren, MultipartHttpServletRequest request,\n            @RequestParam(name = \"title\", required = false) String title,\n            @RequestParam(name = \"comment\", required = false) String comment,\n            @RequestParam(name = \"name\", required = false) String name,\n            @RequestParam(name = \"desc\", required = false) String desc,\n            @RequestParam(name = \"validation\", required = false) String validation,\n            @RequestParam(name = \"email\", required = false) String email,\n            @RequestParam(name = \"type\", required = false) Integer type,\n            @RequestParam(name = \"service\", required = false) String service,\n            @RequestHeader(\"userid\") String userid,\n            @RequestHeader(\"password\") String password)", "full_signature": "@PostMapping(\"/depot\") public ResponseEntity<?> depotDocument(@PathVariable String siren, MultipartHttpServletRequest request,\n            @RequestParam(name = \"title\", required = false) String title,\n            @RequestParam(name = \"comment\", required = false) String comment,\n            @RequestParam(name = \"name\", required = false) String name,\n            @RequestParam(name = \"desc\", required = false) String desc,\n            @RequestParam(name = \"validation\", required = false) String validation,\n            @RequestParam(name = \"email\", required = false) String email,\n            @RequestParam(name = \"type\", required = false) Integer type,\n            @RequestParam(name = \"service\", required = false) String service,\n            @RequestHeader(\"userid\") String userid,\n            @RequestHeader(\"password\") String password)", "class_method_signature": "PaullGenericController.depotDocument(@PathVariable String siren, MultipartHttpServletRequest request,\n            @RequestParam(name = \"title\", required = false) String title,\n            @RequestParam(name = \"comment\", required = false) String comment,\n            @RequestParam(name = \"name\", required = false) String name,\n            @RequestParam(name = \"desc\", required = false) String desc,\n            @RequestParam(name = \"validation\", required = false) String validation,\n            @RequestParam(name = \"email\", required = false) String email,\n            @RequestParam(name = \"type\", required = false) Integer type,\n            @RequestParam(name = \"service\", required = false) String service,\n            @RequestHeader(\"userid\") String userid,\n            @RequestHeader(\"password\") String password)", "testcase": false, "constructor": false}, {"identifier": "infosDocument", "parameters": "(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "modifiers": "@GetMapping(\"/infosdoc/{idFlux}\") public", "return": "ResponseEntity<?>", "signature": "ResponseEntity<?> infosDocument(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "full_signature": "@GetMapping(\"/infosdoc/{idFlux}\") public ResponseEntity<?> infosDocument(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "class_method_signature": "PaullGenericController.infosDocument(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "testcase": false, "constructor": false}, {"identifier": "getDocument", "parameters": "(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "modifiers": "@GetMapping(\"/doc/{idFlux}\") public", "return": "ResponseEntity<?>", "signature": "ResponseEntity<?> getDocument(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "full_signature": "@GetMapping(\"/doc/{idFlux}\") public ResponseEntity<?> getDocument(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "class_method_signature": "PaullGenericController.getDocument(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "testcase": false, "constructor": false}, {"identifier": "getServices", "parameters": "(@PathVariable String siren, @PathVariable String email,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "modifiers": "@GetMapping(\"/servicesorganisationnels/{email}\") public", "return": "ResponseEntity<?>", "signature": "ResponseEntity<?> getServices(@PathVariable String siren, @PathVariable String email,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "full_signature": "@GetMapping(\"/servicesorganisationnels/{email}\") public ResponseEntity<?> getServices(@PathVariable String siren, @PathVariable String email,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "class_method_signature": "PaullGenericController.getServices(@PathVariable String siren, @PathVariable String email,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "testcase": false, "constructor": false}, {"identifier": "notFoundLocalAuthority", "parameters": "(Map data)", "modifiers": "private", "return": "ResponseEntity<Object>", "signature": "ResponseEntity<Object> notFoundLocalAuthority(Map data)", "full_signature": "private ResponseEntity<Object> notFoundLocalAuthority(Map data)", "class_method_signature": "PaullGenericController.notFoundLocalAuthority(Map data)", "testcase": false, "constructor": false}, {"identifier": "notFoundClasseur", "parameters": "(Map data)", "modifiers": "private", "return": "ResponseEntity<Object>", "signature": "ResponseEntity<Object> notFoundClasseur(Map data)", "full_signature": "private ResponseEntity<Object> notFoundClasseur(Map data)", "class_method_signature": "PaullGenericController.notFoundClasseur(Map data)", "testcase": false, "constructor": false}, {"identifier": "errorWhileSearchingClasseur", "parameters": "(Map data)", "modifiers": "private", "return": "ResponseEntity<Object>", "signature": "ResponseEntity<Object> errorWhileSearchingClasseur(Map data)", "full_signature": "private ResponseEntity<Object> errorWhileSearchingClasseur(Map data)", "class_method_signature": "PaullGenericController.errorWhileSearchingClasseur(Map data)", "testcase": false, "constructor": false}, {"identifier": "noDocumentInClasseur", "parameters": "(Map data)", "modifiers": "private", "return": "ResponseEntity<Object>", "signature": "ResponseEntity<Object> noDocumentInClasseur(Map data)", "full_signature": "private ResponseEntity<Object> noDocumentInClasseur(Map data)", "class_method_signature": "PaullGenericController.noDocumentInClasseur(Map data)", "testcase": false, "constructor": false}, {"identifier": "authGenericAccountForbidden", "parameters": "(Map data)", "modifiers": "private", "return": "ResponseEntity<Object>", "signature": "ResponseEntity<Object> authGenericAccountForbidden(Map data)", "full_signature": "private ResponseEntity<Object> authGenericAccountForbidden(Map data)", "class_method_signature": "PaullGenericController.authGenericAccountForbidden(Map data)", "testcase": false, "constructor": false}], "file": "pes-service/src/main/java/fr/sictiam/stela/pesservice/controller/PaullGenericController.java"}, "focal_method": {"identifier": "infosDocument", "parameters": "(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "modifiers": "@GetMapping(\"/infosdoc/{idFlux}\") public", "return": "ResponseEntity<?>", "body": "@GetMapping(\"/infosdoc/{idFlux}\")\n    public ResponseEntity<?> infosDocument(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password) throws IOException {\n\n        Map<String, Object> data = new HashMap<>();\n\n        if (paullService.emailAuth(userid, password) == null) return this.authGenericAccountForbidden(data);\n\n        Optional<LocalAuthority> localAuthority = localAuthorityService.getBySiren(StringUtils.removeStart(siren, \"sys\"));\n\n        if (!localAuthority.isPresent()) return this.notFoundLocalAuthority(data);\n\n        ResponseEntity<Classeur> classeurResponse = sesileService.checkClasseurStatus(localAuthority.get(), idFlux);\n        Optional<GenericDocument> genericDocument = sesileService.getGenericDocument(idFlux);\n\n        if ((classeurResponse.getStatusCode().isError() && !classeurResponse.hasBody()) || !genericDocument.isPresent())\n            return this.notFoundClasseur(data);\n\n        Classeur classeur = classeurResponse.getBody();\n\n        if (classeur == null)\n            return this.errorWhileSearchingClasseur(data);\n\n        if (classeur.getDocuments().isEmpty())\n            return this.noDocumentInClasseur(data);\n\n        Document document = classeur.getDocuments().get(0);\n        data.put(\"Title\", classeur.getNom());\n        data.put(\"Name\", classeur.getNom());\n        data.put(\"Username\", genericDocument.get().getDepositEmail());\n        data.put(\"NomDocument\", document.getName());\n        data.put(\"dateDepot\", classeur.getCreation());\n        data.put(\"datevalide\", classeur.getValidation());\n        data.put(\"service\", classeur.getCircuit());\n        data.put(\"EtatClasseur\", classeur.getStatus().ordinal());\n\n        return new ResponseEntity<Object>(generatePaullResponse(HttpStatus.OK, data, \"OK\"), HttpStatus.OK);\n    }", "signature": "ResponseEntity<?> infosDocument(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "full_signature": "@GetMapping(\"/infosdoc/{idFlux}\") public ResponseEntity<?> infosDocument(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "class_method_signature": "PaullGenericController.infosDocument(@PathVariable String siren, @PathVariable Integer idFlux,\n            @RequestHeader(\"userid\") String userid, @RequestHeader(\"password\") String password)", "testcase": false, "constructor": false, "invocations": ["emailAuth", "authGenericAccountForbidden", "getBySiren", "removeStart", "isPresent", "notFoundLocalAuthority", "checkClasseurStatus", "get", "getGenericDocument", "isError", "getStatusCode", "hasBody", "isPresent", "notFoundClasseur", "getBody", "errorWhileSearchingClasseur", "isEmpty", "getDocuments", "noDocumentInClasseur", "get", "getDocuments", "put", "getNom", "put", "getNom", "put", "getDepositEmail", "get", "put", "getName", "put", "getCreation", "put", "getValidation", "put", "getCircuit", "put", "ordinal", "getStatus", "generatePaullResponse"]}, "repository": {"repo_id": 180337008, "url": "https://github.com/SICTIAM/stela", "language": "Java", "is_fork": false, "fork_count": 0, "stargazer_count": 5, "size": 7714, "license": "licensed"}}