{"test_class": {"identifier": "UnshardedExportToCloudStorageTest", "superclass": "", "interfaces": "", "fields": [], "file": "bigquery/src/test/java/com/google/cloud/hadoop/io/bigquery/UnshardedExportToCloudStorageTest.java"}, "test_case": {"identifier": "testGetSplits", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testGetSplits() throws Exception {\n    Configuration conf = new Configuration();\n\n    UnshardedExportToCloudStorage export =\n        new UnshardedExportToCloudStorage(\n            conf,\n            \"path\",\n            ExportFileFormat.AVRO,\n            new BigQueryHelper(null),\n            \"project-id\",\n            null, /* table */\n            new InputFormat<LongWritable, Text>() {\n              @Override\n              public List<InputSplit> getSplits(JobContext jobContext) {\n                return ImmutableList.<InputSplit>builder()\n                    .add(new FileSplit(new Path(\"Foo\"), 0L, 1L, new String[0]))\n                    .add(new FileSplit(new Path(\"Bar\"), 0L, 1L, new String[0]))\n                    .build();\n              }\n\n              @Override\n              public RecordReader<LongWritable, Text> createRecordReader(\n                  InputSplit inputSplit, TaskAttemptContext taskAttemptContext) {\n                throw new UnsupportedOperationException(\"Not implemented.\");\n              }\n            });\n\n    List<InputSplit> splits = export.getSplits(null);\n    UnshardedInputSplit fooSplit = (UnshardedInputSplit) splits.get(0);\n    assertThat(fooSplit.getPath().getName()).isEqualTo(\"Foo\");\n\n    UnshardedInputSplit barSplit = (UnshardedInputSplit) splits.get(1);\n    assertThat(barSplit.getPath().getName()).isEqualTo(\"Bar\");\n  }", "signature": "void testGetSplits()", "full_signature": "@Test public void testGetSplits()", "class_method_signature": "UnshardedExportToCloudStorageTest.testGetSplits()", "testcase": true, "constructor": false, "invocations": ["build", "add", "add", "builder", "getSplits", "get", "isEqualTo", "assertThat", "getName", "getPath", "get", "isEqualTo", "assertThat", "getName", "getPath"]}, "focal_class": {"identifier": "UnshardedExportToCloudStorage", "superclass": "extends AbstractExportToCloudStorage", "interfaces": "", "fields": [{"original_string": "private static final GoogleLogger logger = GoogleLogger.forEnclosingClass();", "modifier": "private static final", "type": "GoogleLogger", "declarator": "logger = GoogleLogger.forEnclosingClass()", "var_name": "logger"}, {"original_string": "private InputFormat<LongWritable, Text> delegateInputFormat;", "modifier": "private", "type": "InputFormat<LongWritable, Text>", "declarator": "delegateInputFormat", "var_name": "delegateInputFormat"}], "methods": [{"identifier": "UnshardedExportToCloudStorage", "parameters": "(\n      Configuration configuration,\n      String gcsPath,\n      ExportFileFormat fileFormat,\n      BigQueryHelper bigQueryHelper,\n      String projectId,\n      Table tableToExport,\n      @Nullable InputFormat<LongWritable, Text> delegateInputFormat)", "modifiers": "public", "return": "", "signature": " UnshardedExportToCloudStorage(\n      Configuration configuration,\n      String gcsPath,\n      ExportFileFormat fileFormat,\n      BigQueryHelper bigQueryHelper,\n      String projectId,\n      Table tableToExport,\n      @Nullable InputFormat<LongWritable, Text> delegateInputFormat)", "full_signature": "public  UnshardedExportToCloudStorage(\n      Configuration configuration,\n      String gcsPath,\n      ExportFileFormat fileFormat,\n      BigQueryHelper bigQueryHelper,\n      String projectId,\n      Table tableToExport,\n      @Nullable InputFormat<LongWritable, Text> delegateInputFormat)", "class_method_signature": "UnshardedExportToCloudStorage.UnshardedExportToCloudStorage(\n      Configuration configuration,\n      String gcsPath,\n      ExportFileFormat fileFormat,\n      BigQueryHelper bigQueryHelper,\n      String projectId,\n      Table tableToExport,\n      @Nullable InputFormat<LongWritable, Text> delegateInputFormat)", "testcase": false, "constructor": true}, {"identifier": "getSplits", "parameters": "(JobContext context)", "modifiers": "@Override public", "return": "List<InputSplit>", "signature": "List<InputSplit> getSplits(JobContext context)", "full_signature": "@Override public List<InputSplit> getSplits(JobContext context)", "class_method_signature": "UnshardedExportToCloudStorage.getSplits(JobContext context)", "testcase": false, "constructor": false}, {"identifier": "getExportPaths", "parameters": "()", "modifiers": "@Override public", "return": "List<String>", "signature": "List<String> getExportPaths()", "full_signature": "@Override public List<String> getExportPaths()", "class_method_signature": "UnshardedExportToCloudStorage.getExportPaths()", "testcase": false, "constructor": false}, {"identifier": "waitForUsableMapReduceInput", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void waitForUsableMapReduceInput()", "full_signature": "@Override public void waitForUsableMapReduceInput()", "class_method_signature": "UnshardedExportToCloudStorage.waitForUsableMapReduceInput()", "testcase": false, "constructor": false}], "file": "bigquery/src/main/java/com/google/cloud/hadoop/io/bigquery/UnshardedExportToCloudStorage.java"}, "focal_method": {"identifier": "getSplits", "parameters": "(JobContext context)", "modifiers": "@Override public", "return": "List<InputSplit>", "body": "@Override\n  public List<InputSplit> getSplits(JobContext context) throws IOException, InterruptedException {\n    logger.atInfo().log(\"Setting FileInputFormat's inputPath to '%s'\", gcsPath);\n    configuration.set(FileInputFormat.INPUT_DIR, gcsPath);\n\n    // Now that the FileInputFormat's path is pointed to the export directory, construct splits\n    // using a TextInputFormat instance.\n    List<InputSplit> splits = new ArrayList<>();\n    for (InputSplit split : delegateInputFormat.getSplits(context)) {\n      FileSplit fileSplit = (FileSplit) split;\n      splits.add(\n          new UnshardedInputSplit(\n              fileSplit.getPath(),\n              fileSplit.getStart(),\n              fileSplit.getLength(),\n              fileSplit.getLocations()));\n    }\n    return splits;\n  }", "signature": "List<InputSplit> getSplits(JobContext context)", "full_signature": "@Override public List<InputSplit> getSplits(JobContext context)", "class_method_signature": "UnshardedExportToCloudStorage.getSplits(JobContext context)", "testcase": false, "constructor": false, "invocations": ["log", "atInfo", "set", "getSplits", "add", "getPath", "getStart", "getLength", "getLocations"]}, "repository": {"repo_id": 19684359, "url": "https://github.com/GoogleCloudDataproc/bigdata-interop", "stars": 178, "created": "5/12/2014 3:11:55 AM +00:00", "updates": "2020-01-23T23:10:40+00:00", "fork": "False", "license": "licensed"}}