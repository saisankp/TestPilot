{"test_class": {"identifier": "TestLongLivedProcess", "superclass": "extends WorkflowServiceTestBase", "interfaces": "implements\n    LongLivedProcessLifecycleEvent", "fields": [{"original_string": "private static final Logger log = LoggerFactory.getLogger(TestLongLivedProcess.class);", "modifier": "private static final", "type": "Logger", "declarator": "log = LoggerFactory.getLogger(TestLongLivedProcess.class)", "var_name": "log"}, {"original_string": "private static final Logger processLog =\n      LoggerFactory.getLogger(\"org.apache.hadoop.services.workflow.Process\");", "modifier": "private static final", "type": "Logger", "declarator": "processLog =\n      LoggerFactory.getLogger(\"org.apache.hadoop.services.workflow.Process\")", "var_name": "processLog"}, {"original_string": "private LongLivedProcess process;", "modifier": "private", "type": "LongLivedProcess", "declarator": "process", "var_name": "process"}, {"original_string": "private File testDir = new File(\"target\");", "modifier": "private", "type": "File", "declarator": "testDir = new File(\"target\")", "var_name": "testDir"}, {"original_string": "private ProcessCommandFactory commandFactory;", "modifier": "private", "type": "ProcessCommandFactory", "declarator": "commandFactory", "var_name": "commandFactory"}, {"original_string": "private volatile boolean started, stopped;", "modifier": "private volatile", "type": "boolean", "declarator": "started", "var_name": "started"}], "file": "slider-core/src/test/java/org/apache/slider/server/services/workflow/TestLongLivedProcess.java"}, "test_case": {"identifier": "testSetenv", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testSetenv() throws Throwable {\n\n    String var = \"TEST_RUN\";\n    String val = \"TEST-RUN-ENV-VALUE\";\n    initProcess(commandFactory.env());\n    process.setEnv(var, val);\n    process.start();\n    //in-thread wait\n    process.run();\n\n    //here stopped\n    assertTrue(\"process stop callback not received\", stopped);\n    assertEquals(0, process.getExitCode().intValue());\n    assertStringInOutput(val, getFinalOutput());\n  }", "signature": "void testSetenv()", "full_signature": "@Test public void testSetenv()", "class_method_signature": "TestLongLivedProcess.testSetenv()", "testcase": true, "constructor": false, "invocations": ["initProcess", "env", "setEnv", "start", "run", "assertTrue", "assertEquals", "intValue", "getExitCode", "assertStringInOutput", "getFinalOutput"]}, "focal_class": {"identifier": "LongLivedProcess", "superclass": "", "interfaces": "implements Runnable", "fields": [{"original_string": "public static final int RECENT_LINE_LOG_LIMIT = 64;", "modifier": "public static final", "type": "int", "declarator": "RECENT_LINE_LOG_LIMIT = 64", "var_name": "RECENT_LINE_LOG_LIMIT"}, {"original_string": "private static final int STREAM_READER_SLEEP_TIME = 200;", "modifier": "private static final", "type": "int", "declarator": "STREAM_READER_SLEEP_TIME = 200", "var_name": "STREAM_READER_SLEEP_TIME"}, {"original_string": "private static final int LINE_LENGTH = 256;", "modifier": "private static final", "type": "int", "declarator": "LINE_LENGTH = 256", "var_name": "LINE_LENGTH"}, {"original_string": "private final ProcessBuilder processBuilder;", "modifier": "private final", "type": "ProcessBuilder", "declarator": "processBuilder", "var_name": "processBuilder"}, {"original_string": "private Process process;", "modifier": "private", "type": "Process", "declarator": "process", "var_name": "process"}, {"original_string": "private Integer exitCode = null;", "modifier": "private", "type": "Integer", "declarator": "exitCode = null", "var_name": "exitCode"}, {"original_string": "private final String name;", "modifier": "private final", "type": "String", "declarator": "name", "var_name": "name"}, {"original_string": "private final ExecutorService processExecutor;", "modifier": "private final", "type": "ExecutorService", "declarator": "processExecutor", "var_name": "processExecutor"}, {"original_string": "private final ExecutorService logExecutor;", "modifier": "private final", "type": "ExecutorService", "declarator": "logExecutor", "var_name": "logExecutor"}, {"original_string": "private ProcessStreamReader processStreamReader;", "modifier": "private", "type": "ProcessStreamReader", "declarator": "processStreamReader", "var_name": "processStreamReader"}, {"original_string": "private final List<String> recentLines = new LinkedList<>();", "modifier": "private final", "type": "List<String>", "declarator": "recentLines = new LinkedList<>()", "var_name": "recentLines"}, {"original_string": "private int recentLineLimit = RECENT_LINE_LOG_LIMIT;", "modifier": "private", "type": "int", "declarator": "recentLineLimit = RECENT_LINE_LOG_LIMIT", "var_name": "recentLineLimit"}, {"original_string": "private LongLivedProcessLifecycleEvent lifecycleCallback;", "modifier": "private", "type": "LongLivedProcessLifecycleEvent", "declarator": "lifecycleCallback", "var_name": "lifecycleCallback"}, {"original_string": "private final AtomicBoolean finalOutputProcessed = new AtomicBoolean(false);", "modifier": "private final", "type": "AtomicBoolean", "declarator": "finalOutputProcessed = new AtomicBoolean(false)", "var_name": "finalOutputProcessed"}, {"original_string": "private Logger processLog;", "modifier": "private", "type": "Logger", "declarator": "processLog", "var_name": "processLog"}, {"original_string": "private static final Logger LOG = LoggerFactory.getLogger(LongLivedProcess.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOG = LoggerFactory.getLogger(LongLivedProcess.class)", "var_name": "LOG"}, {"original_string": "private final AtomicBoolean finished = new AtomicBoolean(false);", "modifier": "private final", "type": "AtomicBoolean", "declarator": "finished = new AtomicBoolean(false)", "var_name": "finished"}], "methods": [{"identifier": "LongLivedProcess", "parameters": "(String name,\n      Logger processLog,\n      List<String> commands)", "modifiers": "public", "return": "", "signature": " LongLivedProcess(String name,\n      Logger processLog,\n      List<String> commands)", "full_signature": "public  LongLivedProcess(String name,\n      Logger processLog,\n      List<String> commands)", "class_method_signature": "LongLivedProcess.LongLivedProcess(String name,\n      Logger processLog,\n      List<String> commands)", "testcase": false, "constructor": true}, {"identifier": "setRecentLineLimit", "parameters": "(int recentLineLimit)", "modifiers": "public", "return": "void", "signature": "void setRecentLineLimit(int recentLineLimit)", "full_signature": "public void setRecentLineLimit(int recentLineLimit)", "class_method_signature": "LongLivedProcess.setRecentLineLimit(int recentLineLimit)", "testcase": false, "constructor": false}, {"identifier": "setLifecycleCallback", "parameters": "(LongLivedProcessLifecycleEvent lifecycleCallback)", "modifiers": "public", "return": "void", "signature": "void setLifecycleCallback(LongLivedProcessLifecycleEvent lifecycleCallback)", "full_signature": "public void setLifecycleCallback(LongLivedProcessLifecycleEvent lifecycleCallback)", "class_method_signature": "LongLivedProcess.setLifecycleCallback(LongLivedProcessLifecycleEvent lifecycleCallback)", "testcase": false, "constructor": false}, {"identifier": "setEnv", "parameters": "(String envVar, String val)", "modifiers": "public", "return": "void", "signature": "void setEnv(String envVar, String val)", "full_signature": "public void setEnv(String envVar, String val)", "class_method_signature": "LongLivedProcess.setEnv(String envVar, String val)", "testcase": false, "constructor": false}, {"identifier": "putEnvMap", "parameters": "(Map<String, String> map)", "modifiers": "public", "return": "void", "signature": "void putEnvMap(Map<String, String> map)", "full_signature": "public void putEnvMap(Map<String, String> map)", "class_method_signature": "LongLivedProcess.putEnvMap(Map<String, String> map)", "testcase": false, "constructor": false}, {"identifier": "getEnv", "parameters": "(String variable)", "modifiers": "public", "return": "String", "signature": "String getEnv(String variable)", "full_signature": "public String getEnv(String variable)", "class_method_signature": "LongLivedProcess.getEnv(String variable)", "testcase": false, "constructor": false}, {"identifier": "setProcessLog", "parameters": "(Logger processLog)", "modifiers": "public", "return": "void", "signature": "void setProcessLog(Logger processLog)", "full_signature": "public void setProcessLog(Logger processLog)", "class_method_signature": "LongLivedProcess.setProcessLog(Logger processLog)", "testcase": false, "constructor": false}, {"identifier": "getProcess", "parameters": "()", "modifiers": "public", "return": "Process", "signature": "Process getProcess()", "full_signature": "public Process getProcess()", "class_method_signature": "LongLivedProcess.getProcess()", "testcase": false, "constructor": false}, {"identifier": "getProcessBuilder", "parameters": "()", "modifiers": "public", "return": "ProcessBuilder", "signature": "ProcessBuilder getProcessBuilder()", "full_signature": "public ProcessBuilder getProcessBuilder()", "class_method_signature": "LongLivedProcess.getProcessBuilder()", "testcase": false, "constructor": false}, {"identifier": "getCommands", "parameters": "()", "modifiers": "public", "return": "List<String>", "signature": "List<String> getCommands()", "full_signature": "public List<String> getCommands()", "class_method_signature": "LongLivedProcess.getCommands()", "testcase": false, "constructor": false}, {"identifier": "getCommand", "parameters": "()", "modifiers": "public", "return": "String", "signature": "String getCommand()", "full_signature": "public String getCommand()", "class_method_signature": "LongLivedProcess.getCommand()", "testcase": false, "constructor": false}, {"identifier": "isRunning", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean isRunning()", "full_signature": "public boolean isRunning()", "class_method_signature": "LongLivedProcess.isRunning()", "testcase": false, "constructor": false}, {"identifier": "getExitCode", "parameters": "()", "modifiers": "public", "return": "Integer", "signature": "Integer getExitCode()", "full_signature": "public Integer getExitCode()", "class_method_signature": "LongLivedProcess.getExitCode()", "testcase": false, "constructor": false}, {"identifier": "getExitCodeSignCorrected", "parameters": "()", "modifiers": "public", "return": "Integer", "signature": "Integer getExitCodeSignCorrected()", "full_signature": "public Integer getExitCodeSignCorrected()", "class_method_signature": "LongLivedProcess.getExitCodeSignCorrected()", "testcase": false, "constructor": false}, {"identifier": "stop", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void stop()", "full_signature": "public void stop()", "class_method_signature": "LongLivedProcess.stop()", "testcase": false, "constructor": false}, {"identifier": "describeBuilder", "parameters": "()", "modifiers": "protected", "return": "String", "signature": "String describeBuilder()", "full_signature": "protected String describeBuilder()", "class_method_signature": "LongLivedProcess.describeBuilder()", "testcase": false, "constructor": false}, {"identifier": "dumpEnv", "parameters": "(StringBuilder buffer)", "modifiers": "public", "return": "void", "signature": "void dumpEnv(StringBuilder buffer)", "full_signature": "public void dumpEnv(StringBuilder buffer)", "class_method_signature": "LongLivedProcess.dumpEnv(StringBuilder buffer)", "testcase": false, "constructor": false}, {"identifier": "spawnChildProcess", "parameters": "()", "modifiers": "private", "return": "Process", "signature": "Process spawnChildProcess()", "full_signature": "private Process spawnChildProcess()", "class_method_signature": "LongLivedProcess.spawnChildProcess()", "testcase": false, "constructor": false}, {"identifier": "run", "parameters": "()", "modifiers": "@Override // Runnable public", "return": "void", "signature": "void run()", "full_signature": "@Override // Runnable public void run()", "class_method_signature": "LongLivedProcess.run()", "testcase": false, "constructor": false}, {"identifier": "start", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void start()", "full_signature": "public void start()", "class_method_signature": "LongLivedProcess.start()", "testcase": false, "constructor": false}, {"identifier": "getRecentOutput", "parameters": "()", "modifiers": "public synchronized", "return": "List<String>", "signature": "List<String> getRecentOutput()", "full_signature": "public synchronized List<String> getRecentOutput()", "class_method_signature": "LongLivedProcess.getRecentOutput()", "testcase": false, "constructor": false}, {"identifier": "isRecentOutputEmpty", "parameters": "()", "modifiers": "public synchronized", "return": "boolean", "signature": "boolean isRecentOutputEmpty()", "full_signature": "public synchronized boolean isRecentOutputEmpty()", "class_method_signature": "LongLivedProcess.isRecentOutputEmpty()", "testcase": false, "constructor": false}, {"identifier": "isFinalOutputProcessed", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean isFinalOutputProcessed()", "full_signature": "public boolean isFinalOutputProcessed()", "class_method_signature": "LongLivedProcess.isFinalOutputProcessed()", "testcase": false, "constructor": false}, {"identifier": "getRecentOutput", "parameters": "(boolean finalOutput, int duration)", "modifiers": "public", "return": "List<String>", "signature": "List<String> getRecentOutput(boolean finalOutput, int duration)", "full_signature": "public List<String> getRecentOutput(boolean finalOutput, int duration)", "class_method_signature": "LongLivedProcess.getRecentOutput(boolean finalOutput, int duration)", "testcase": false, "constructor": false}, {"identifier": "recordRecentLine", "parameters": "(String line,\n      boolean isErrorStream,\n      Logger logger)", "modifiers": "private synchronized", "return": "void", "signature": "void recordRecentLine(String line,\n      boolean isErrorStream,\n      Logger logger)", "full_signature": "private synchronized void recordRecentLine(String line,\n      boolean isErrorStream,\n      Logger logger)", "class_method_signature": "LongLivedProcess.recordRecentLine(String line,\n      boolean isErrorStream,\n      Logger logger)", "testcase": false, "constructor": false}], "file": "slider-core/src/main/java/org/apache/slider/server/services/workflow/LongLivedProcess.java"}, "focal_method": {"identifier": "setEnv", "parameters": "(String envVar, String val)", "modifiers": "public", "return": "void", "body": "public void setEnv(String envVar, String val) {\n    Preconditions.checkArgument(envVar != null, \"envVar\");\n    Preconditions.checkArgument(val != null, \"val\");\n    processBuilder.environment().put(envVar, val);\n  }", "signature": "void setEnv(String envVar, String val)", "full_signature": "public void setEnv(String envVar, String val)", "class_method_signature": "LongLivedProcess.setEnv(String envVar, String val)", "testcase": false, "constructor": false, "invocations": ["checkArgument", "checkArgument", "put", "environment"]}, "repository": {"repo_id": 20051204, "url": "https://github.com/apache/incubator-retired-slider", "language": "Java", "is_fork": false, "fork_count": 73, "stargazer_count": 74, "size": 16472, "license": "licensed"}}