{"test_class": {"identifier": "OpearFileTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(OpearFileTest.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(OpearFileTest.class)", "var_name": "LOGGER"}, {"original_string": "final File baseDir = new File(\"src/test/resources/OpearFileTest\");", "modifier": "final", "type": "File", "declarator": "baseDir = new File(\"src/test/resources/OpearFileTest\")", "var_name": "baseDir"}, {"original_string": "final File testTarget = new File(\"target/test-output/OpearFileTest\");", "modifier": "final", "type": "File", "declarator": "testTarget = new File(\"target/test-output/OpearFileTest\")", "var_name": "testTarget"}, {"original_string": "final File deepTestSrc = new File(baseDir, \"deep_test_src\");", "modifier": "final", "type": "File", "declarator": "deepTestSrc = new File(baseDir, \"deep_test_src\")", "var_name": "deepTestSrc"}, {"original_string": "final File deepTestTarget = new File(testTarget, \"deep_test.jar\");", "modifier": "final", "type": "File", "declarator": "deepTestTarget = new File(testTarget, \"deep_test.jar\")", "var_name": "deepTestTarget"}, {"original_string": "final File embedModuleSrc = new File(baseDir, \"embedded_module_src\");", "modifier": "final", "type": "File", "declarator": "embedModuleSrc = new File(baseDir, \"embedded_module_src\")", "var_name": "embedModuleSrc"}, {"original_string": "final File embedModuleTarget = new File(testTarget, \"embedded_module.jar\");", "modifier": "final", "type": "File", "declarator": "embedModuleTarget = new File(testTarget, \"embedded_module.jar\")", "var_name": "embedModuleTarget"}], "file": "core/src/test/java/net/adamcin/oakpal/core/opear/OpearFileTest.java"}, "test_case": {"identifier": "testEmptyPlanJar", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testEmptyPlanJar() throws Exception {\n        final File targetDir = new File(\"target/test-temp\");\n        targetDir.mkdirs();\n        final File mfJar = new File(targetDir, \"emptyplan.jar\");\n        final File mfCache = new File(targetDir, \"emptyplan.cache\");\n        if (mfJar.exists()) {\n            mfJar.delete();\n        }\n        final File mfDir = new File(\"src/test/resources/plans/xEmpty\");\n        final File mfFile = new File(mfDir, JarFile.MANIFEST_NAME);\n        try (InputStream mfStream = new FileInputStream(mfFile)) {\n            Manifest manifest = new Manifest(mfStream);\n\n            try (JarOutputStream mfJarOut = new JarOutputStream(new FileOutputStream(mfJar), manifest)) {\n                // nothing to add\n                mfJarOut.putNextEntry(new JarEntry(\"other-plan.json\"));\n                mfJarOut.write(\"{}\".getBytes(StandardCharsets.UTF_8));\n            }\n        }\n\n        Result<OpearFile> opearResult = result1((File file) -> new JarFile(file, true))\n                .apply(mfJar)\n                .flatMap(jar -> OpearFile.fromJar(jar, mfCache));\n        opearResult.throwCause(Exception.class);\n        assertTrue(\"opear result should be success \", opearResult.isSuccess());\n        Result<OakpalPlan> plan = opearResult.map(OpearFile::getDefaultPlan).flatMap(OakpalPlan::fromJson);\n        plan.throwCause(Exception.class);\n\n        assertTrue(\"opear plan should be empty\",\n                plan.map(OakpalPlan::getChecklists).getOrDefault(Arrays.asList(\"not a checklist\")).isEmpty());\n    }", "signature": "void testEmptyPlanJar()", "full_signature": "@Test public void testEmptyPlanJar()", "class_method_signature": "OpearFileTest.testEmptyPlanJar()", "testcase": true, "constructor": false, "invocations": ["mkdirs", "exists", "delete", "putNextEntry", "write", "getBytes", "flatMap", "apply", "result1", "fromJar", "throwCause", "assertTrue", "isSuccess", "flatMap", "map", "throwCause", "assertTrue", "isEmpty", "getOrDefault", "map", "asList"]}, "focal_class": {"identifier": "OpearFile", "superclass": "", "interfaces": "implements Opear", "fields": [{"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(OpearFile.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(OpearFile.class)", "var_name": "LOGGER"}, {"original_string": "public static final Attributes.Name NAME_BUNDLE_SYMBOLICNAME = new Attributes.Name(MF_BUNDLE_SYMBOLICNAME);", "modifier": "public static final", "type": "Attributes.Name", "declarator": "NAME_BUNDLE_SYMBOLICNAME = new Attributes.Name(MF_BUNDLE_SYMBOLICNAME)", "var_name": "NAME_BUNDLE_SYMBOLICNAME"}, {"original_string": "public static final Attributes.Name NAME_BUNDLE_VERSION = new Attributes.Name(MF_BUNDLE_VERSION);", "modifier": "public static final", "type": "Attributes.Name", "declarator": "NAME_BUNDLE_VERSION = new Attributes.Name(MF_BUNDLE_VERSION)", "var_name": "NAME_BUNDLE_VERSION"}, {"original_string": "public static final Attributes.Name NAME_CLASS_PATH = new Attributes.Name(MF_CLASS_PATH);", "modifier": "public static final", "type": "Attributes.Name", "declarator": "NAME_CLASS_PATH = new Attributes.Name(MF_CLASS_PATH)", "var_name": "NAME_CLASS_PATH"}, {"original_string": "public static final Attributes.Name NAME_OAKPAL_VERSION = new Attributes.Name(MF_OAKPAL_VERSION);", "modifier": "public static final", "type": "Attributes.Name", "declarator": "NAME_OAKPAL_VERSION = new Attributes.Name(MF_OAKPAL_VERSION)", "var_name": "NAME_OAKPAL_VERSION"}, {"original_string": "public static final Attributes.Name NAME_OAKPAL_PLAN = new Attributes.Name(MF_OAKPAL_PLAN);", "modifier": "public static final", "type": "Attributes.Name", "declarator": "NAME_OAKPAL_PLAN = new Attributes.Name(MF_OAKPAL_PLAN)", "var_name": "NAME_OAKPAL_PLAN"}, {"original_string": "final File cacheDir;", "modifier": "final", "type": "File", "declarator": "cacheDir", "var_name": "cacheDir"}, {"original_string": "final OpearMetadata metadata;", "modifier": "final", "type": "OpearMetadata", "declarator": "metadata", "var_name": "metadata"}], "methods": [{"identifier": "OpearFile", "parameters": "(final File cacheDir, final OpearMetadata metadata)", "modifiers": "", "return": "", "signature": " OpearFile(final File cacheDir, final OpearMetadata metadata)", "full_signature": "  OpearFile(final File cacheDir, final OpearMetadata metadata)", "class_method_signature": "OpearFile.OpearFile(final File cacheDir, final OpearMetadata metadata)", "testcase": false, "constructor": true}, {"identifier": "getDefaultPlan", "parameters": "()", "modifiers": "@Override public", "return": "URL", "signature": "URL getDefaultPlan()", "full_signature": "@Override public URL getDefaultPlan()", "class_method_signature": "OpearFile.getDefaultPlan()", "testcase": false, "constructor": false}, {"identifier": "getSpecificPlan", "parameters": "(final @NotNull String planName)", "modifiers": "@Override public", "return": "Result<URL>", "signature": "Result<URL> getSpecificPlan(final @NotNull String planName)", "full_signature": "@Override public Result<URL> getSpecificPlan(final @NotNull String planName)", "class_method_signature": "OpearFile.getSpecificPlan(final @NotNull String planName)", "testcase": false, "constructor": false}, {"identifier": "getPlanClassLoader", "parameters": "(final @NotNull ClassLoader parent)", "modifiers": "@Override public", "return": "ClassLoader", "signature": "ClassLoader getPlanClassLoader(final @NotNull ClassLoader parent)", "full_signature": "@Override public ClassLoader getPlanClassLoader(final @NotNull ClassLoader parent)", "class_method_signature": "OpearFile.getPlanClassLoader(final @NotNull ClassLoader parent)", "testcase": false, "constructor": false}, {"identifier": "readExpectedManifest", "parameters": "(final @NotNull File mfFile)", "modifiers": "static", "return": "Result<Manifest>", "signature": "Result<Manifest> readExpectedManifest(final @NotNull File mfFile)", "full_signature": "static Result<Manifest> readExpectedManifest(final @NotNull File mfFile)", "class_method_signature": "OpearFile.readExpectedManifest(final @NotNull File mfFile)", "testcase": false, "constructor": false}, {"identifier": "metaForSimpleDir", "parameters": "(final @NotNull File directory)", "modifiers": "static", "return": "OpearMetadata", "signature": "OpearMetadata metaForSimpleDir(final @NotNull File directory)", "full_signature": "static OpearMetadata metaForSimpleDir(final @NotNull File directory)", "class_method_signature": "OpearFile.metaForSimpleDir(final @NotNull File directory)", "testcase": false, "constructor": false}, {"identifier": "validateUriHeaderValuesWithDefaultForMissing", "parameters": "(final @NotNull Manifest manifest,\n                                                                         final @NotNull Attributes.Name headerName,\n                                                                         final @NotNull String... defaultValue)", "modifiers": "static", "return": "Result<String[]>", "signature": "Result<String[]> validateUriHeaderValuesWithDefaultForMissing(final @NotNull Manifest manifest,\n                                                                         final @NotNull Attributes.Name headerName,\n                                                                         final @NotNull String... defaultValue)", "full_signature": "static Result<String[]> validateUriHeaderValuesWithDefaultForMissing(final @NotNull Manifest manifest,\n                                                                         final @NotNull Attributes.Name headerName,\n                                                                         final @NotNull String... defaultValue)", "class_method_signature": "OpearFile.validateUriHeaderValuesWithDefaultForMissing(final @NotNull Manifest manifest,\n                                                                         final @NotNull Attributes.Name headerName,\n                                                                         final @NotNull String... defaultValue)", "testcase": false, "constructor": false}, {"identifier": "validateUriHeaderValues", "parameters": "(final @NotNull Manifest manifest,\n                                                    final @NotNull Attributes.Name headerName)", "modifiers": "static", "return": "Result<String[]>", "signature": "Result<String[]> validateUriHeaderValues(final @NotNull Manifest manifest,\n                                                    final @NotNull Attributes.Name headerName)", "full_signature": "static Result<String[]> validateUriHeaderValues(final @NotNull Manifest manifest,\n                                                    final @NotNull Attributes.Name headerName)", "class_method_signature": "OpearFile.validateUriHeaderValues(final @NotNull Manifest manifest,\n                                                    final @NotNull Attributes.Name headerName)", "testcase": false, "constructor": false}, {"identifier": "validateOpearManifest", "parameters": "(final @Nullable Manifest manifest)", "modifiers": "static", "return": "Result<OpearMetadata>", "signature": "Result<OpearMetadata> validateOpearManifest(final @Nullable Manifest manifest)", "full_signature": "static Result<OpearMetadata> validateOpearManifest(final @Nullable Manifest manifest)", "class_method_signature": "OpearFile.validateOpearManifest(final @Nullable Manifest manifest)", "testcase": false, "constructor": false}, {"identifier": "fromDirectory", "parameters": "(final @NotNull File directory)", "modifiers": "public static", "return": "Result<OpearFile>", "signature": "Result<OpearFile> fromDirectory(final @NotNull File directory)", "full_signature": "public static Result<OpearFile> fromDirectory(final @NotNull File directory)", "class_method_signature": "OpearFile.fromDirectory(final @NotNull File directory)", "testcase": false, "constructor": false}, {"identifier": "getHashCacheKey", "parameters": "(final @NotNull String path)", "modifiers": "static", "return": "Result<String>", "signature": "Result<String> getHashCacheKey(final @NotNull String path)", "full_signature": "static Result<String> getHashCacheKey(final @NotNull String path)", "class_method_signature": "OpearFile.getHashCacheKey(final @NotNull String path)", "testcase": false, "constructor": false}, {"identifier": "fromJar", "parameters": "(final @NotNull JarFile jarFile, final @NotNull File cacheBaseDir)", "modifiers": "public static", "return": "Result<OpearFile>", "signature": "Result<OpearFile> fromJar(final @NotNull JarFile jarFile, final @NotNull File cacheBaseDir)", "full_signature": "public static Result<OpearFile> fromJar(final @NotNull JarFile jarFile, final @NotNull File cacheBaseDir)", "class_method_signature": "OpearFile.fromJar(final @NotNull JarFile jarFile, final @NotNull File cacheBaseDir)", "testcase": false, "constructor": false}, {"identifier": "cacheJar", "parameters": "(final @NotNull JarFile jarFile, final @NotNull File cacheDir)", "modifiers": "static", "return": "Result<File>", "signature": "Result<File> cacheJar(final @NotNull JarFile jarFile, final @NotNull File cacheDir)", "full_signature": "static Result<File> cacheJar(final @NotNull JarFile jarFile, final @NotNull File cacheDir)", "class_method_signature": "OpearFile.cacheJar(final @NotNull JarFile jarFile, final @NotNull File cacheDir)", "testcase": false, "constructor": false}], "file": "core/src/main/java/net/adamcin/oakpal/core/opear/OpearFile.java"}, "focal_method": {"identifier": "fromJar", "parameters": "(final @NotNull JarFile jarFile, final @NotNull File cacheBaseDir)", "modifiers": "public static", "return": "Result<OpearFile>", "body": "public static Result<OpearFile> fromJar(final @NotNull JarFile jarFile, final @NotNull File cacheBaseDir) {\n        return getHashCacheKey(jarFile.getName()).flatMap(cacheKey -> {\n            return result1(JarFile::getManifest).apply(jarFile)\n                    .flatMap(OpearFile::validateOpearManifest)\n                    .flatMap(metadata -> {\n                        final File cacheDir = new File(cacheBaseDir, cacheKey);\n                        if (cacheDir.isDirectory()) {\n                            return fromDirectory(cacheDir);\n                        } else {\n                            if (!cacheDir.mkdirs()) {\n                                return Result.failure(format(\"failed to create cache dir %s for specified opear file %s\",\n                                        cacheDir.getPath(), jarFile.getName()));\n                            } else {\n                                return cacheJar(jarFile, cacheDir).flatMap(OpearFile::fromDirectory);\n                            }\n                        }\n                    });\n        });\n    }", "signature": "Result<OpearFile> fromJar(final @NotNull JarFile jarFile, final @NotNull File cacheBaseDir)", "full_signature": "public static Result<OpearFile> fromJar(final @NotNull JarFile jarFile, final @NotNull File cacheBaseDir)", "class_method_signature": "OpearFile.fromJar(final @NotNull JarFile jarFile, final @NotNull File cacheBaseDir)", "testcase": false, "constructor": false, "invocations": ["flatMap", "getHashCacheKey", "getName", "flatMap", "flatMap", "apply", "result1", "isDirectory", "fromDirectory", "mkdirs", "failure", "format", "getPath", "getName", "flatMap", "cacheJar"]}, "repository": {"repo_id": 155883728, "url": "https://github.com/adamcin/oakpal", "language": "Java", "is_fork": false, "fork_count": 6, "stargazer_count": 6, "size": 13349, "license": "licensed"}}