{"test_class": {"identifier": "SourcesExporterTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final byte[] TEST_FILE_CONTENT = \"This is a test file\".getBytes(StandardCharsets.UTF_8);", "modifier": "private static final", "type": "byte[]", "declarator": "TEST_FILE_CONTENT = \"This is a test file\".getBytes(StandardCharsets.UTF_8)", "var_name": "TEST_FILE_CONTENT"}, {"original_string": "private static final String TEST_FILE_SHA1 = \"91b7b0b1e27bfbf7bc646946f35fa972c47c2d32\";", "modifier": "private static final", "type": "String", "declarator": "TEST_FILE_SHA1 = \"91b7b0b1e27bfbf7bc646946f35fa972c47c2d32\"", "var_name": "TEST_FILE_SHA1"}, {"original_string": "@Rule\n    public TemporaryFolder folder = new TemporaryFolder();", "modifier": "@Rule\n    public", "type": "TemporaryFolder", "declarator": "folder = new TemporaryFolder()", "var_name": "folder"}, {"original_string": "private Path sourcePath;", "modifier": "private", "type": "Path", "declarator": "sourcePath", "var_name": "sourcePath"}, {"original_string": "private SW360ReleaseClientAdapterAsync releaseAdapter;", "modifier": "private", "type": "SW360ReleaseClientAdapterAsync", "declarator": "releaseAdapter", "var_name": "releaseAdapter"}, {"original_string": "private SourcesExporter sourcesExporter;", "modifier": "private", "type": "SourcesExporter", "declarator": "sourcesExporter", "var_name": "sourcesExporter"}], "file": "assembly/compliance-tool/src/test/java/org/eclipse/sw360/antenna/frontend/compliancetool/sw360/exporter/SourcesExporterTest.java"}, "test_case": {"identifier": "testUnreferencedFilesCanBeRemoved", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testUnreferencedFilesCanBeRemoved() {\n        Set<SW360SparseAttachment> attachments1 = createAttachments(1, 2);\n        Set<SW360SparseAttachment> attachments2 = createAttachments(2, 3);\n        Set<SW360SparseAttachment> attachments3 = createAttachments(1, 3);\n        ReleaseWithSources release1 =\n                createReleaseWithSources(createReleaseWithAttachments(1, attachments1), attachments1);\n        ReleaseWithSources release2 =\n                createReleaseWithSources(createReleaseWithAttachments(2, attachments2), attachments2);\n        SW360SparseAttachment unreferencedAttachment = createAttachment(17, 47);\n        SW360Release unreferencedRelease1 =\n                createReleaseWithAttachments(17, Collections.singleton(unreferencedAttachment));\n        SW360Release unreferencedRelease2 = createReleaseWithAttachments(1, attachments3);\n        unreferencedRelease2.setVersion(\"2.0\");\n        ReleaseWithSources unreferencedRelease2WithSources =\n                createReleaseWithSources(unreferencedRelease2, attachments3);\n        Path unreferencedPath = attachmentPath(unreferencedRelease1, unreferencedAttachment);\n        createTestFile(unreferencedPath);\n        createAttachmentFiles(release1);\n        createAttachmentFiles(release2);\n        createAttachmentFiles(unreferencedRelease2WithSources);\n        Path furtherSubPath1 = createTestFile(releasePath(release1.getRelease())\n                .resolve(\"sub\").resolve(\"subFile.txt\")).getParent();\n        Path furtherSubPath2 = createTestFile(releasePath(release1.getRelease())\n                .resolve(\"aSubDir\").resolve(\"otherSubFile.txt\")).getParent();\n        Path topPath1 = createTestFile(sourcePath.resolve(\"a.txt\"));\n        Path topPath2 = createTestFile(sourcePath.resolve(\"z.txt\"));\n\n        sourcesExporter.removeUnreferencedFiles(Arrays.asList(release1, release2));\n        checkAllAttachmentsExist(release1);\n        checkAllAttachmentsExist(release2);\n        assertThat(checkFileExists(unreferencedPath)).isFalse();\n        assertThat(checkFileExists(releasePath(unreferencedRelease1))).isFalse();\n        assertThat(checkFileExists(releasePath(unreferencedRelease2))).isFalse();\n        assertThat(checkFileExists(furtherSubPath1)).isFalse();\n        assertThat(checkFileExists(furtherSubPath2)).isFalse();\n        assertThat(checkFileExists(topPath1)).isFalse();\n        assertThat(checkFileExists(topPath2)).isFalse();\n    }", "signature": "void testUnreferencedFilesCanBeRemoved()", "full_signature": "@Test public void testUnreferencedFilesCanBeRemoved()", "class_method_signature": "SourcesExporterTest.testUnreferencedFilesCanBeRemoved()", "testcase": true, "constructor": false, "invocations": ["createAttachments", "createAttachments", "createAttachments", "createReleaseWithSources", "createReleaseWithAttachments", "createReleaseWithSources", "createReleaseWithAttachments", "createAttachment", "createReleaseWithAttachments", "singleton", "createReleaseWithAttachments", "setVersion", "createReleaseWithSources", "attachmentPath", "createTestFile", "createAttachmentFiles", "createAttachmentFiles", "createAttachmentFiles", "getParent", "createTestFile", "resolve", "resolve", "releasePath", "getRelease", "getParent", "createTestFile", "resolve", "resolve", "releasePath", "getRelease", "createTestFile", "resolve", "createTestFile", "resolve", "removeUnreferencedFiles", "asList", "checkAllAttachmentsExist", "checkAllAttachmentsExist", "isFalse", "assertThat", "checkFileExists", "isFalse", "assertThat", "checkFileExists", "releasePath", "isFalse", "assertThat", "checkFileExists", "releasePath", "isFalse", "assertThat", "checkFileExists", "isFalse", "assertThat", "checkFileExists", "isFalse", "assertThat", "checkFileExists", "isFalse", "assertThat", "checkFileExists"]}, "focal_class": {"identifier": "SourcesExporter", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String FMT_DOWNLOAD_ERROR = \"Failed to download attachment %s for release %s:%s\";", "modifier": "private static final", "type": "String", "declarator": "FMT_DOWNLOAD_ERROR = \"Failed to download attachment %s for release %s:%s\"", "var_name": "FMT_DOWNLOAD_ERROR"}, {"original_string": "private static final String ALLOWED_CHARACTERS = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\" +\n            \"0123456789.:-\";", "modifier": "private static final", "type": "String", "declarator": "ALLOWED_CHARACTERS = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\" +\n            \"0123456789.:-\"", "var_name": "ALLOWED_CHARACTERS"}, {"original_string": "private static final char REPLACE_CHARACTER = '_';", "modifier": "private static final", "type": "char", "declarator": "REPLACE_CHARACTER = '_'", "var_name": "REPLACE_CHARACTER"}, {"original_string": "private static final Logger LOG = LoggerFactory.getLogger(SourcesExporter.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOG = LoggerFactory.getLogger(SourcesExporter.class)", "var_name": "LOG"}, {"original_string": "private final Path sourcePath;", "modifier": "private final", "type": "Path", "declarator": "sourcePath", "var_name": "sourcePath"}], "methods": [{"identifier": "SourcesExporter", "parameters": "(Path sourcePath)", "modifiers": "public", "return": "", "signature": " SourcesExporter(Path sourcePath)", "full_signature": "public  SourcesExporter(Path sourcePath)", "class_method_signature": "SourcesExporter.SourcesExporter(Path sourcePath)", "testcase": false, "constructor": true}, {"identifier": "downloadSources", "parameters": "(SW360ReleaseClientAdapterAsync releaseAdapter,\n                                                          Collection<SW360Release> releases)", "modifiers": "public", "return": "Collection<ReleaseWithSources>", "signature": "Collection<ReleaseWithSources> downloadSources(SW360ReleaseClientAdapterAsync releaseAdapter,\n                                                          Collection<SW360Release> releases)", "full_signature": "public Collection<ReleaseWithSources> downloadSources(SW360ReleaseClientAdapterAsync releaseAdapter,\n                                                          Collection<SW360Release> releases)", "class_method_signature": "SourcesExporter.downloadSources(SW360ReleaseClientAdapterAsync releaseAdapter,\n                                                          Collection<SW360Release> releases)", "testcase": false, "constructor": false}, {"identifier": "removeUnreferencedFiles", "parameters": "(Collection<ReleaseWithSources> releases)", "modifiers": "public", "return": "void", "signature": "void removeUnreferencedFiles(Collection<ReleaseWithSources> releases)", "full_signature": "public void removeUnreferencedFiles(Collection<ReleaseWithSources> releases)", "class_method_signature": "SourcesExporter.removeUnreferencedFiles(Collection<ReleaseWithSources> releases)", "testcase": false, "constructor": false}, {"identifier": "calculateLocalAttachmentHash", "parameters": "(Path localPath)", "modifiers": "", "return": "String", "signature": "String calculateLocalAttachmentHash(Path localPath)", "full_signature": " String calculateLocalAttachmentHash(Path localPath)", "class_method_signature": "SourcesExporter.calculateLocalAttachmentHash(Path localPath)", "testcase": false, "constructor": false}, {"identifier": "downloadSourcesForRelease", "parameters": "(SW360ReleaseClientAdapterAsync releaseAdapter, SW360Release release)", "modifiers": "private", "return": "CompletableFuture<ReleaseWithSources>", "signature": "CompletableFuture<ReleaseWithSources> downloadSourcesForRelease(SW360ReleaseClientAdapterAsync releaseAdapter, SW360Release release)", "full_signature": "private CompletableFuture<ReleaseWithSources> downloadSourcesForRelease(SW360ReleaseClientAdapterAsync releaseAdapter, SW360Release release)", "class_method_signature": "SourcesExporter.downloadSourcesForRelease(SW360ReleaseClientAdapterAsync releaseAdapter, SW360Release release)", "testcase": false, "constructor": false}, {"identifier": "downloadAttachment", "parameters": "(SW360ReleaseClientAdapterAsync releaseAdapter,\n                                                       SW360Release release, SW360SparseAttachment attachment,\n                                                       Path releasePath)", "modifiers": "private", "return": "CompletableFuture<Path>", "signature": "CompletableFuture<Path> downloadAttachment(SW360ReleaseClientAdapterAsync releaseAdapter,\n                                                       SW360Release release, SW360SparseAttachment attachment,\n                                                       Path releasePath)", "full_signature": "private CompletableFuture<Path> downloadAttachment(SW360ReleaseClientAdapterAsync releaseAdapter,\n                                                       SW360Release release, SW360SparseAttachment attachment,\n                                                       Path releasePath)", "class_method_signature": "SourcesExporter.downloadAttachment(SW360ReleaseClientAdapterAsync releaseAdapter,\n                                                       SW360Release release, SW360SparseAttachment attachment,\n                                                       Path releasePath)", "testcase": false, "constructor": false}, {"identifier": "getLocalAttachmentPath", "parameters": "(SW360SparseAttachment attachment, Path releasePath)", "modifiers": "private", "return": "Optional<Path>", "signature": "Optional<Path> getLocalAttachmentPath(SW360SparseAttachment attachment, Path releasePath)", "full_signature": "private Optional<Path> getLocalAttachmentPath(SW360SparseAttachment attachment, Path releasePath)", "class_method_signature": "SourcesExporter.getLocalAttachmentPath(SW360SparseAttachment attachment, Path releasePath)", "testcase": false, "constructor": false}, {"identifier": "pathForRelease", "parameters": "(SW360Release release)", "modifiers": "private", "return": "Path", "signature": "Path pathForRelease(SW360Release release)", "full_signature": "private Path pathForRelease(SW360Release release)", "class_method_signature": "SourcesExporter.pathForRelease(SW360Release release)", "testcase": false, "constructor": false}, {"identifier": "createDownloadProcessor", "parameters": "(Path releasePath, SW360SparseAttachment attachment)", "modifiers": "private static", "return": "SW360AttachmentUtils.AttachmentDownloadProcessorCreateDownloadFolderWithParents", "signature": "SW360AttachmentUtils.AttachmentDownloadProcessorCreateDownloadFolderWithParents createDownloadProcessor(Path releasePath, SW360SparseAttachment attachment)", "full_signature": "private static SW360AttachmentUtils.AttachmentDownloadProcessorCreateDownloadFolderWithParents createDownloadProcessor(Path releasePath, SW360SparseAttachment attachment)", "class_method_signature": "SourcesExporter.createDownloadProcessor(Path releasePath, SW360SparseAttachment attachment)", "testcase": false, "constructor": false}, {"identifier": "logDownloadFailure", "parameters": "(Throwable ex)", "modifiers": "private static", "return": "boolean", "signature": "boolean logDownloadFailure(Throwable ex)", "full_signature": "private static boolean logDownloadFailure(Throwable ex)", "class_method_signature": "SourcesExporter.logDownloadFailure(Throwable ex)", "testcase": false, "constructor": false}, {"identifier": "sanitizePath", "parameters": "(String name)", "modifiers": "private static", "return": "String", "signature": "String sanitizePath(String name)", "full_signature": "private static String sanitizePath(String name)", "class_method_signature": "SourcesExporter.sanitizePath(String name)", "testcase": false, "constructor": false}], "file": "assembly/compliance-tool/src/main/java/org/eclipse/sw360/antenna/frontend/compliancetool/sw360/exporter/SourcesExporter.java"}, "focal_method": {"identifier": "removeUnreferencedFiles", "parameters": "(Collection<ReleaseWithSources> releases)", "modifiers": "public", "return": "void", "body": "public void removeUnreferencedFiles(Collection<ReleaseWithSources> releases) {\n        RemoveUnreferencedFilesVisitor visitor = new RemoveUnreferencedFilesVisitor(releases);\n        try {\n            Files.walkFileTree(sourcePath, visitor);\n        } catch (IOException e) {\n            LOG.error(\"Could not traverse sources directory {}\", sourcePath, e);\n        }\n    }", "signature": "void removeUnreferencedFiles(Collection<ReleaseWithSources> releases)", "full_signature": "public void removeUnreferencedFiles(Collection<ReleaseWithSources> releases)", "class_method_signature": "SourcesExporter.removeUnreferencedFiles(Collection<ReleaseWithSources> releases)", "testcase": false, "constructor": false, "invocations": ["walkFileTree", "error"]}, "repository": {"repo_id": 140017338, "url": "https://github.com/eclipse/antenna", "stars": 14, "created": "7/6/2018 6:17:28 PM +00:00", "updates": "2020-01-21T13:15:34+00:00", "fork": "False", "license": "licensed"}}