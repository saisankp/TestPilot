{"test_class": {"identifier": "CDSShardAccessImplTest", "superclass": "extends AbstractActorTest", "interfaces": "", "fields": [{"original_string": "private static final DOMDataTreeIdentifier TEST_ID =\n            new DOMDataTreeIdentifier(LogicalDatastoreType.CONFIGURATION, TestModel.TEST_PATH);", "modifier": "private static final", "type": "DOMDataTreeIdentifier", "declarator": "TEST_ID =\n            new DOMDataTreeIdentifier(LogicalDatastoreType.CONFIGURATION, TestModel.TEST_PATH)", "var_name": "TEST_ID"}, {"original_string": "private CDSShardAccessImpl shardAccess;", "modifier": "private", "type": "CDSShardAccessImpl", "declarator": "shardAccess", "var_name": "shardAccess"}, {"original_string": "private ActorUtils context;", "modifier": "private", "type": "ActorUtils", "declarator": "context", "var_name": "context"}], "file": "opendaylight/md-sal/sal-distributed-datastore/src/test/java/org/opendaylight/controller/cluster/sharding/CDSShardAccessImplTest.java"}, "test_case": {"identifier": "testOnLeaderLocationChanged", "parameters": "()", "modifiers": "@Test @SuppressWarnings(\"checkstyle:IllegalCatch\") public", "return": "void", "body": "@Test\n    @SuppressWarnings(\"checkstyle:IllegalCatch\")\n    public void testOnLeaderLocationChanged() {\n        final LeaderLocationListener listener1 = mock(LeaderLocationListener.class);\n        doThrow(new RuntimeException(\"Failed\")).when(listener1).onLeaderLocationChanged(any());\n        final LeaderLocationListener listener2 = mock(LeaderLocationListener.class);\n        doNothing().when(listener2).onLeaderLocationChanged(any());\n        final LeaderLocationListener listener3 = mock(LeaderLocationListener.class);\n        doNothing().when(listener3).onLeaderLocationChanged(any());\n\n        final LeaderLocationListenerRegistration<?> reg1 = shardAccess.registerLeaderLocationListener(listener1);\n        final LeaderLocationListenerRegistration<?> reg2 = shardAccess.registerLeaderLocationListener(listener2);\n        final LeaderLocationListenerRegistration<?> reg3 = shardAccess.registerLeaderLocationListener(listener3);\n\n        // Error in listener1 should not affect dispatching change to other listeners\n        shardAccess.onLeaderLocationChanged(LeaderLocation.LOCAL);\n        verify(listener1).onLeaderLocationChanged(eq(LeaderLocation.LOCAL));\n        verify(listener2).onLeaderLocationChanged(eq(LeaderLocation.LOCAL));\n        verify(listener3).onLeaderLocationChanged(eq(LeaderLocation.LOCAL));\n\n        // Closed listeners shouldn't see new leader location changes\n        reg1.close();\n        reg2.close();\n        shardAccess.onLeaderLocationChanged(LeaderLocation.REMOTE);\n        verify(listener3).onLeaderLocationChanged(eq(LeaderLocation.REMOTE));\n        verifyNoMoreInteractions(listener1);\n        verifyNoMoreInteractions(listener2);\n\n        // Closed shard access should not dispatch any new events\n        shardAccess.close();\n        shardAccess.onLeaderLocationChanged(LeaderLocation.UNKNOWN);\n        verifyNoMoreInteractions(listener1);\n        verifyNoMoreInteractions(listener2);\n        verifyNoMoreInteractions(listener3);\n\n        reg3.close();\n    }", "signature": "void testOnLeaderLocationChanged()", "full_signature": "@Test @SuppressWarnings(\"checkstyle:IllegalCatch\") public void testOnLeaderLocationChanged()", "class_method_signature": "CDSShardAccessImplTest.testOnLeaderLocationChanged()", "testcase": true, "constructor": false, "invocations": ["mock", "onLeaderLocationChanged", "when", "doThrow", "any", "mock", "onLeaderLocationChanged", "when", "doNothing", "any", "mock", "onLeaderLocationChanged", "when", "doNothing", "any", "registerLeaderLocationListener", "registerLeaderLocationListener", "registerLeaderLocationListener", "onLeaderLocationChanged", "onLeaderLocationChanged", "verify", "eq", "onLeaderLocationChanged", "verify", "eq", "onLeaderLocationChanged", "verify", "eq", "close", "close", "onLeaderLocationChanged", "onLeaderLocationChanged", "verify", "eq", "verifyNoMoreInteractions", "verifyNoMoreInteractions", "close", "onLeaderLocationChanged", "verifyNoMoreInteractions", "verifyNoMoreInteractions", "verifyNoMoreInteractions", "close"]}, "focal_class": {"identifier": "CDSShardAccessImpl", "superclass": "", "interfaces": "implements CDSShardAccess, LeaderLocationListener, AutoCloseable", "fields": [{"original_string": "private static final Logger LOG = LoggerFactory.getLogger(CDSShardAccessImpl.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOG = LoggerFactory.getLogger(CDSShardAccessImpl.class)", "var_name": "LOG"}, {"original_string": "private final Collection<LeaderLocationListener> listeners = ConcurrentHashMap.newKeySet();", "modifier": "private final", "type": "Collection<LeaderLocationListener>", "declarator": "listeners = ConcurrentHashMap.newKeySet()", "var_name": "listeners"}, {"original_string": "private final DOMDataTreeIdentifier prefix;", "modifier": "private final", "type": "DOMDataTreeIdentifier", "declarator": "prefix", "var_name": "prefix"}, {"original_string": "private final ActorUtils actorUtils;", "modifier": "private final", "type": "ActorUtils", "declarator": "actorUtils", "var_name": "actorUtils"}, {"original_string": "private final Timeout makeLeaderLocalTimeout;", "modifier": "private final", "type": "Timeout", "declarator": "makeLeaderLocalTimeout", "var_name": "makeLeaderLocalTimeout"}, {"original_string": "private ActorRef roleChangeListenerActor;", "modifier": "private", "type": "ActorRef", "declarator": "roleChangeListenerActor", "var_name": "roleChangeListenerActor"}, {"original_string": "private volatile LeaderLocation currentLeader = LeaderLocation.UNKNOWN;", "modifier": "private volatile", "type": "LeaderLocation", "declarator": "currentLeader = LeaderLocation.UNKNOWN", "var_name": "currentLeader"}, {"original_string": "private volatile boolean closed = false;", "modifier": "private volatile", "type": "boolean", "declarator": "closed = false", "var_name": "closed"}], "methods": [{"identifier": "CDSShardAccessImpl", "parameters": "(final DOMDataTreeIdentifier prefix, final ActorUtils actorUtils)", "modifiers": "", "return": "", "signature": " CDSShardAccessImpl(final DOMDataTreeIdentifier prefix, final ActorUtils actorUtils)", "full_signature": "  CDSShardAccessImpl(final DOMDataTreeIdentifier prefix, final ActorUtils actorUtils)", "class_method_signature": "CDSShardAccessImpl.CDSShardAccessImpl(final DOMDataTreeIdentifier prefix, final ActorUtils actorUtils)", "testcase": false, "constructor": true}, {"identifier": "checkNotClosed", "parameters": "()", "modifiers": "private", "return": "void", "signature": "void checkNotClosed()", "full_signature": "private void checkNotClosed()", "class_method_signature": "CDSShardAccessImpl.checkNotClosed()", "testcase": false, "constructor": false}, {"identifier": "getShardIdentifier", "parameters": "()", "modifiers": "@Override public", "return": "DOMDataTreeIdentifier", "signature": "DOMDataTreeIdentifier getShardIdentifier()", "full_signature": "@Override public DOMDataTreeIdentifier getShardIdentifier()", "class_method_signature": "CDSShardAccessImpl.getShardIdentifier()", "testcase": false, "constructor": false}, {"identifier": "getLeaderLocation", "parameters": "()", "modifiers": "@Override public", "return": "LeaderLocation", "signature": "LeaderLocation getLeaderLocation()", "full_signature": "@Override public LeaderLocation getLeaderLocation()", "class_method_signature": "CDSShardAccessImpl.getLeaderLocation()", "testcase": false, "constructor": false}, {"identifier": "makeLeaderLocal", "parameters": "()", "modifiers": "@Override public", "return": "CompletionStage<Void>", "signature": "CompletionStage<Void> makeLeaderLocal()", "full_signature": "@Override public CompletionStage<Void> makeLeaderLocal()", "class_method_signature": "CDSShardAccessImpl.makeLeaderLocal()", "testcase": false, "constructor": false}, {"identifier": "registerLeaderLocationListener", "parameters": "(final L listener)", "modifiers": "@Override public", "return": "LeaderLocationListenerRegistration<L>", "signature": "LeaderLocationListenerRegistration<L> registerLeaderLocationListener(final L listener)", "full_signature": "@Override public LeaderLocationListenerRegistration<L> registerLeaderLocationListener(final L listener)", "class_method_signature": "CDSShardAccessImpl.registerLeaderLocationListener(final L listener)", "testcase": false, "constructor": false}, {"identifier": "onLeaderLocationChanged", "parameters": "(final LeaderLocation location)", "modifiers": "@Override @SuppressWarnings(\"checkstyle:IllegalCatch\") public", "return": "void", "signature": "void onLeaderLocationChanged(final LeaderLocation location)", "full_signature": "@Override @SuppressWarnings(\"checkstyle:IllegalCatch\") public void onLeaderLocationChanged(final LeaderLocation location)", "class_method_signature": "CDSShardAccessImpl.onLeaderLocationChanged(final LeaderLocation location)", "testcase": false, "constructor": false}, {"identifier": "close", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void close()", "full_signature": "@Override public void close()", "class_method_signature": "CDSShardAccessImpl.close()", "testcase": false, "constructor": false}], "file": "opendaylight/md-sal/sal-distributed-datastore/src/main/java/org/opendaylight/controller/cluster/sharding/CDSShardAccessImpl.java"}, "focal_method": {"identifier": "onLeaderLocationChanged", "parameters": "(final LeaderLocation location)", "modifiers": "@Override @SuppressWarnings(\"checkstyle:IllegalCatch\") public", "return": "void", "body": "@Override\n    @SuppressWarnings(\"checkstyle:IllegalCatch\")\n    public void onLeaderLocationChanged(final LeaderLocation location) {\n        if (closed) {\n            // we are closed already. Do not dispatch any new leader location\n            // change events.\n            return;\n        }\n\n        LOG.debug(\"Received leader location change notification. New leader location: {}\", location);\n        currentLeader = location;\n        listeners.forEach(listener -> {\n            try {\n                listener.onLeaderLocationChanged(location);\n            } catch (Exception e) {\n                LOG.warn(\"Ignoring uncaught exception thrown be LeaderLocationListener {} \"\n                        + \"during processing leader location change {}\", listener, location, e);\n            }\n        });\n    }", "signature": "void onLeaderLocationChanged(final LeaderLocation location)", "full_signature": "@Override @SuppressWarnings(\"checkstyle:IllegalCatch\") public void onLeaderLocationChanged(final LeaderLocation location)", "class_method_signature": "CDSShardAccessImpl.onLeaderLocationChanged(final LeaderLocation location)", "testcase": false, "constructor": false, "invocations": ["debug", "forEach", "onLeaderLocationChanged", "warn"]}, "repository": {"repo_id": 16362479, "url": "https://github.com/opendaylight/controller", "stars": 313, "created": "1/29/2014 11:10:45 PM +00:00", "updates": "2020-01-20T11:02:36+00:00", "fork": "False", "license": "licensed"}}