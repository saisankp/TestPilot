{"test_class": {"identifier": "SecretManagementServiceTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String SOME_DEVICE = \"SOME_DEVICE\";", "modifier": "private static final", "type": "String", "declarator": "SOME_DEVICE = \"SOME_DEVICE\"", "var_name": "SOME_DEVICE"}, {"original_string": "private SecretManagementService service;", "modifier": "private", "type": "SecretManagementService", "declarator": "service", "var_name": "service"}, {"original_string": "@Mock\n    private EncryptionDelegate encryptionDelegate;", "modifier": "@Mock\n    private", "type": "EncryptionDelegate", "declarator": "encryptionDelegate", "var_name": "encryptionDelegate"}, {"original_string": "@Mock\n    private DbEncryptedSecretRepository secretRepository;", "modifier": "@Mock\n    private", "type": "DbEncryptedSecretRepository", "declarator": "secretRepository", "var_name": "secretRepository"}, {"original_string": "@Mock\n    private DbEncryptionKeyRepository keyRepository;", "modifier": "@Mock\n    private", "type": "DbEncryptionKeyRepository", "declarator": "keyRepository", "var_name": "keyRepository"}], "file": "osgp/platform/osgp-secret-management/src/test/java/org/opensmartgridplatform/secretmanagement/application/services/SecretManagementServiceTest.java"}, "test_case": {"identifier": "retrieveSecrets", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void retrieveSecrets() throws Exception {\n        //GIVEN\n        final DbEncryptionKeyReference keyReference = new DbEncryptionKeyReference();\n        final DbEncryptedSecret secret = new DbEncryptedSecret();\n        secret.setSecretType(SecretType.E_METER_MASTER_KEY);\n        secret.setEncryptionKeyReference(keyReference);\n        final Secret decryptedSecret = new Secret(\"secret\".getBytes());\n\n        //WHEN\n        when(this.secretRepository.findIdOfValidMostRecent(any(), any(), any())).thenReturn(1L);\n        when(this.secretRepository.findById(any())).thenReturn(Optional.of(secret));\n        when(this.encryptionDelegate.decrypt(any(), any())).thenReturn(decryptedSecret);\n        final List<TypedSecret> typedSecrets = this.service.retrieveSecrets(SOME_DEVICE,\n                Arrays.asList(SecretType.E_METER_MASTER_KEY));\n\n        //THEN\n        assertThat(typedSecrets).isNotNull();\n        assertThat(typedSecrets.size()).isEqualTo(1);\n        final TypedSecret typedSecret = typedSecrets.get(0);\n        assertThat(typedSecret.getSecret()).isEqualTo(HexUtils.toHexString(\"secret\".getBytes()));\n        assertThat(typedSecret.getSecretType()).isEqualTo(SecretType.E_METER_MASTER_KEY);\n    }", "signature": "void retrieveSecrets()", "full_signature": "@Test public void retrieveSecrets()", "class_method_signature": "SecretManagementServiceTest.retrieveSecrets()", "testcase": true, "constructor": false, "invocations": ["setSecretType", "setEncryptionKeyReference", "getBytes", "thenReturn", "when", "findIdOfValidMostRecent", "any", "any", "any", "thenReturn", "when", "findById", "any", "of", "thenReturn", "when", "decrypt", "any", "any", "retrieveSecrets", "asList", "isNotNull", "assertThat", "isEqualTo", "assertThat", "size", "get", "isEqualTo", "assertThat", "getSecret", "toHexString", "getBytes", "isEqualTo", "assertThat", "getSecretType"]}, "focal_class": {"identifier": "SecretManagementService", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final EncryptionDelegate encryptionDelegate;", "modifier": "private final", "type": "EncryptionDelegate", "declarator": "encryptionDelegate", "var_name": "encryptionDelegate"}, {"original_string": "private final EncryptionProviderType encryptionProviderType;", "modifier": "private final", "type": "EncryptionProviderType", "declarator": "encryptionProviderType", "var_name": "encryptionProviderType"}, {"original_string": "private final DbEncryptedSecretRepository secretRepository;", "modifier": "private final", "type": "DbEncryptedSecretRepository", "declarator": "secretRepository", "var_name": "secretRepository"}, {"original_string": "private final DbEncryptionKeyRepository keyRepository;", "modifier": "private final", "type": "DbEncryptionKeyRepository", "declarator": "keyRepository", "var_name": "keyRepository"}], "methods": [{"identifier": "SecretManagementService", "parameters": "(\n            @Qualifier(\"DefaultEncryptionDelegate\") final EncryptionDelegate defaultEncryptionDelegate,\n            final EncryptionProviderType encryptionProviderType, final DbEncryptedSecretRepository secretRepository,\n            final DbEncryptionKeyRepository keyRepository)", "modifiers": "public", "return": "", "signature": " SecretManagementService(\n            @Qualifier(\"DefaultEncryptionDelegate\") final EncryptionDelegate defaultEncryptionDelegate,\n            final EncryptionProviderType encryptionProviderType, final DbEncryptedSecretRepository secretRepository,\n            final DbEncryptionKeyRepository keyRepository)", "full_signature": "public  SecretManagementService(\n            @Qualifier(\"DefaultEncryptionDelegate\") final EncryptionDelegate defaultEncryptionDelegate,\n            final EncryptionProviderType encryptionProviderType, final DbEncryptedSecretRepository secretRepository,\n            final DbEncryptionKeyRepository keyRepository)", "class_method_signature": "SecretManagementService.SecretManagementService(\n            @Qualifier(\"DefaultEncryptionDelegate\") final EncryptionDelegate defaultEncryptionDelegate,\n            final EncryptionProviderType encryptionProviderType, final DbEncryptedSecretRepository secretRepository,\n            final DbEncryptionKeyRepository keyRepository)", "testcase": false, "constructor": true}, {"identifier": "storeSecrets", "parameters": "(final String deviceIdentification, final List<TypedSecret> secrets)", "modifiers": "public", "return": "void", "signature": "void storeSecrets(final String deviceIdentification, final List<TypedSecret> secrets)", "full_signature": "public void storeSecrets(final String deviceIdentification, final List<TypedSecret> secrets)", "class_method_signature": "SecretManagementService.storeSecrets(final String deviceIdentification, final List<TypedSecret> secrets)", "testcase": false, "constructor": false}, {"identifier": "getKey", "parameters": "()", "modifiers": "private", "return": "DbEncryptionKeyReference", "signature": "DbEncryptionKeyReference getKey()", "full_signature": "private DbEncryptionKeyReference getKey()", "class_method_signature": "SecretManagementService.getKey()", "testcase": false, "constructor": false}, {"identifier": "validateSecret", "parameters": "(final String deviceIdentification, final TypedSecret secret)", "modifiers": "private", "return": "TypedSecret", "signature": "TypedSecret validateSecret(final String deviceIdentification, final TypedSecret secret)", "full_signature": "private TypedSecret validateSecret(final String deviceIdentification, final TypedSecret secret)", "class_method_signature": "SecretManagementService.validateSecret(final String deviceIdentification, final TypedSecret secret)", "testcase": false, "constructor": false}, {"identifier": "isIdenticalToCurrent", "parameters": "(final String deviceIdentification, final TypedSecret secret)", "modifiers": "private", "return": "boolean", "signature": "boolean isIdenticalToCurrent(final String deviceIdentification, final TypedSecret secret)", "full_signature": "private boolean isIdenticalToCurrent(final String deviceIdentification, final TypedSecret secret)", "class_method_signature": "SecretManagementService.isIdenticalToCurrent(final String deviceIdentification, final TypedSecret secret)", "testcase": false, "constructor": false}, {"identifier": "createEncrypted", "parameters": "(final String deviceIdentification, final TypedSecret typedSecret,\n                                              final DbEncryptionKeyReference keyReference)", "modifiers": "private", "return": "DbEncryptedSecret", "signature": "DbEncryptedSecret createEncrypted(final String deviceIdentification, final TypedSecret typedSecret,\n                                              final DbEncryptionKeyReference keyReference)", "full_signature": "private DbEncryptedSecret createEncrypted(final String deviceIdentification, final TypedSecret typedSecret,\n                                              final DbEncryptionKeyReference keyReference)", "class_method_signature": "SecretManagementService.createEncrypted(final String deviceIdentification, final TypedSecret typedSecret,\n                                              final DbEncryptionKeyReference keyReference)", "testcase": false, "constructor": false}, {"identifier": "retrieveSecrets", "parameters": "(final String deviceIdentification, final List<SecretType> secretTypes)", "modifiers": "public", "return": "List<TypedSecret>", "signature": "List<TypedSecret> retrieveSecrets(final String deviceIdentification, final List<SecretType> secretTypes)", "full_signature": "public List<TypedSecret> retrieveSecrets(final String deviceIdentification, final List<SecretType> secretTypes)", "class_method_signature": "SecretManagementService.retrieveSecrets(final String deviceIdentification, final List<SecretType> secretTypes)", "testcase": false, "constructor": false}, {"identifier": "retrieveSecret", "parameters": "(final String deviceIdentification, final SecretType secretType)", "modifiers": "public", "return": "Optional<TypedSecret>", "signature": "Optional<TypedSecret> retrieveSecret(final String deviceIdentification, final SecretType secretType)", "full_signature": "public Optional<TypedSecret> retrieveSecret(final String deviceIdentification, final SecretType secretType)", "class_method_signature": "SecretManagementService.retrieveSecret(final String deviceIdentification, final SecretType secretType)", "testcase": false, "constructor": false}, {"identifier": "getTypedSecret", "parameters": "(final Optional<DbEncryptedSecret> dbEncryptedSecret)", "modifiers": "private", "return": "TypedSecret", "signature": "TypedSecret getTypedSecret(final Optional<DbEncryptedSecret> dbEncryptedSecret)", "full_signature": "private TypedSecret getTypedSecret(final Optional<DbEncryptedSecret> dbEncryptedSecret)", "class_method_signature": "SecretManagementService.getTypedSecret(final Optional<DbEncryptedSecret> dbEncryptedSecret)", "testcase": false, "constructor": false}, {"identifier": "createTypedSecret", "parameters": "(final DbEncryptedSecret dbEncryptedSecret,\n                                          final DbEncryptionKeyReference keyReference, final EncryptedSecret encryptedSecret)", "modifiers": "private", "return": "TypedSecret", "signature": "TypedSecret createTypedSecret(final DbEncryptedSecret dbEncryptedSecret,\n                                          final DbEncryptionKeyReference keyReference, final EncryptedSecret encryptedSecret)", "full_signature": "private TypedSecret createTypedSecret(final DbEncryptedSecret dbEncryptedSecret,\n                                          final DbEncryptionKeyReference keyReference, final EncryptedSecret encryptedSecret)", "class_method_signature": "SecretManagementService.createTypedSecret(final DbEncryptedSecret dbEncryptedSecret,\n                                          final DbEncryptionKeyReference keyReference, final EncryptedSecret encryptedSecret)", "testcase": false, "constructor": false}], "file": "osgp/platform/osgp-secret-management/src/main/java/org/opensmartgridplatform/secretmanagement/application/services/SecretManagementService.java"}, "focal_method": {"identifier": "retrieveSecrets", "parameters": "(final String deviceIdentification, final List<SecretType> secretTypes)", "modifiers": "public", "return": "List<TypedSecret>", "body": "public List<TypedSecret> retrieveSecrets(final String deviceIdentification, final List<SecretType> secretTypes) {\n        try {\n            //@formatter:off\n            return secretTypes.stream()\n                    .map(secretType -> this.retrieveSecret(deviceIdentification, secretType))\n                    .map(Optional::get)\n                    .collect(Collectors.toList());\n            //@formatter:on\n        } catch (final Exception exc) {\n            throw new IllegalStateException(\n                    String.format(\"Something went wrong retrieving secrets for device %s\", deviceIdentification), exc);\n        }\n    }", "signature": "List<TypedSecret> retrieveSecrets(final String deviceIdentification, final List<SecretType> secretTypes)", "full_signature": "public List<TypedSecret> retrieveSecrets(final String deviceIdentification, final List<SecretType> secretTypes)", "class_method_signature": "SecretManagementService.retrieveSecrets(final String deviceIdentification, final List<SecretType> secretTypes)", "testcase": false, "constructor": false, "invocations": ["collect", "map", "map", "stream", "retrieveSecret", "toList", "format"]}, "repository": {"repo_id": 154302277, "url": "https://github.com/OSGP/open-smart-grid-platform", "stars": 30, "created": "10/23/2018 9:41:12 AM +00:00", "updates": "2020-01-26T20:15:09+00:00", "fork": "False", "license": "licensed"}}