{"test_class": {"identifier": "UpgradeAPITest", "superclass": "extends ApiServiceTestBase", "interfaces": "", "fields": [{"original_string": "@Value(\"${local.server.port}\")\n    public int port;", "modifier": "@Value(\"${local.server.port}\")\n    public", "type": "int", "declarator": "port", "var_name": "port"}, {"original_string": "@Autowired\n    ObjectMapper mapper;", "modifier": "@Autowired", "type": "ObjectMapper", "declarator": "mapper", "var_name": "mapper"}, {"original_string": "@Autowired\n    UpgradeAPI upgradeAPI;", "modifier": "@Autowired", "type": "UpgradeAPI", "declarator": "upgradeAPI", "var_name": "upgradeAPI"}, {"original_string": "@Autowired\n    VersionService versionService;", "modifier": "@Autowired", "type": "VersionService", "declarator": "versionService", "var_name": "versionService"}], "file": "dataprep-api/src/test/java/org/talend/dataprep/api/service/UpgradeAPITest.java"}, "test_case": {"identifier": "checkDynamicUpgradeServer", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void checkDynamicUpgradeServer() throws Exception {\n        // When\n        // Server deliver response based on sent content\n        upgradeAPI.setUpgradeVersionLocation(\"http://localhost:\" + port + \"/upgrade/server/dynamic\");\n\n        // Then\n        String response = RestAssured.when().get(\"/api/upgrade/check\").asString();\n        final List<UpgradeServerVersion> versions = mapper.readerFor(new TypeReference<List<UpgradeServerVersion>>() {\n        }).readValue(response);\n        assertEquals(1, versions.size());\n        final UpgradeServerVersion actual = versions.get(0);\n\n        final String expectedVersion = versionService.version().getVersionId();\n        final String expectedToken = TokenGenerator.generateMachineToken(new CryptoHelper(\"DataPrepIsSoCool\"));\n        assertEquals(expectedToken, actual.getTitle());\n        assertEquals(expectedVersion, actual.getDownloadUrl());\n    }", "signature": "void checkDynamicUpgradeServer()", "full_signature": "@Test public void checkDynamicUpgradeServer()", "class_method_signature": "UpgradeAPITest.checkDynamicUpgradeServer()", "testcase": true, "constructor": false, "invocations": ["setUpgradeVersionLocation", "asString", "get", "when", "readValue", "readerFor", "assertEquals", "size", "get", "getVersionId", "version", "generateMachineToken", "assertEquals", "getTitle", "assertEquals", "getDownloadUrl"]}, "focal_class": {"identifier": "UpgradeAPI", "superclass": "extends APIService", "interfaces": "", "fields": [{"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(UpgradeAPI.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(UpgradeAPI.class)", "var_name": "LOGGER"}, {"original_string": "@Autowired\n    private HttpClient httpClient;", "modifier": "@Autowired\n    private", "type": "HttpClient", "declarator": "httpClient", "var_name": "httpClient"}, {"original_string": "@Autowired\n    private VersionService service;", "modifier": "@Autowired\n    private", "type": "VersionService", "declarator": "service", "var_name": "service"}, {"original_string": "@Value(\"${upgrade.location:}\")\n    private String upgradeVersionLocation;", "modifier": "@Value(\"${upgrade.location:}\")\n    private", "type": "String", "declarator": "upgradeVersionLocation", "var_name": "upgradeVersionLocation"}, {"original_string": "private String token;", "modifier": "private", "type": "String", "declarator": "token", "var_name": "token"}], "methods": [{"identifier": "toString", "parameters": "(List<UpgradeServerVersion> versions)", "modifiers": "private static", "return": "String", "signature": "String toString(List<UpgradeServerVersion> versions)", "full_signature": "private static String toString(List<UpgradeServerVersion> versions)", "class_method_signature": "UpgradeAPI.toString(List<UpgradeServerVersion> versions)", "testcase": false, "constructor": false}, {"identifier": "init", "parameters": "()", "modifiers": "@PostConstruct public", "return": "void", "signature": "void init()", "full_signature": "@PostConstruct public void init()", "class_method_signature": "UpgradeAPI.init()", "testcase": false, "constructor": false}, {"identifier": "setUpgradeVersionLocation", "parameters": "(String upgradeVersionLocation)", "modifiers": "", "return": "void", "signature": "void setUpgradeVersionLocation(String upgradeVersionLocation)", "full_signature": " void setUpgradeVersionLocation(String upgradeVersionLocation)", "class_method_signature": "UpgradeAPI.setUpgradeVersionLocation(String upgradeVersionLocation)", "testcase": false, "constructor": false}, {"identifier": "check", "parameters": "()", "modifiers": "@RequestMapping(value = \"/api/upgrade/check\", method = GET) @ApiOperation(value = \"Checks if a newer versions are available and returns them as JSON.\", produces = MediaType.APPLICATION_JSON_VALUE) @Timed @PublicAPI public", "return": "Stream<UpgradeServerVersion>", "signature": "Stream<UpgradeServerVersion> check()", "full_signature": "@RequestMapping(value = \"/api/upgrade/check\", method = GET) @ApiOperation(value = \"Checks if a newer versions are available and returns them as JSON.\", produces = MediaType.APPLICATION_JSON_VALUE) @Timed @PublicAPI public Stream<UpgradeServerVersion> check()", "class_method_signature": "UpgradeAPI.check()", "testcase": false, "constructor": false}, {"identifier": "fetchServerUpgradeVersions", "parameters": "(org.talend.dataprep.info.Version version)", "modifiers": "private", "return": "List<UpgradeServerVersion>", "signature": "List<UpgradeServerVersion> fetchServerUpgradeVersions(org.talend.dataprep.info.Version version)", "full_signature": "private List<UpgradeServerVersion> fetchServerUpgradeVersions(org.talend.dataprep.info.Version version)", "class_method_signature": "UpgradeAPI.fetchServerUpgradeVersions(org.talend.dataprep.info.Version version)", "testcase": false, "constructor": false}], "file": "dataprep-api/src/main/java/org/talend/dataprep/api/service/UpgradeAPI.java"}, "focal_method": {"identifier": "setUpgradeVersionLocation", "parameters": "(String upgradeVersionLocation)", "modifiers": "", "return": "void", "body": "void setUpgradeVersionLocation(String upgradeVersionLocation) {\n        this.upgradeVersionLocation = upgradeVersionLocation;\n    }", "signature": "void setUpgradeVersionLocation(String upgradeVersionLocation)", "full_signature": " void setUpgradeVersionLocation(String upgradeVersionLocation)", "class_method_signature": "UpgradeAPI.setUpgradeVersionLocation(String upgradeVersionLocation)", "testcase": false, "constructor": false, "invocations": []}, "repository": {"repo_id": 26644682, "url": "https://github.com/Talend/data-prep", "language": "Java", "is_fork": false, "fork_count": 29, "stargazer_count": 53, "size": 70450, "license": "licensed"}}