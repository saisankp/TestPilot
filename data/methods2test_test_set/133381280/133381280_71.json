{"test_class": {"identifier": "ReportDeciderTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "AddressService addressService = new DefaultAddressService();", "modifier": "", "type": "AddressService", "declarator": "addressService = new DefaultAddressService()", "var_name": "addressService"}, {"original_string": "ReportDecider  reportDecider  = new ReportDecider2(addressService);", "modifier": "", "type": "ReportDecider", "declarator": "reportDecider  = new ReportDecider2(addressService)", "var_name": "reportDecider"}], "file": "client/lookout-reg-server/src/test/java/com/alipay/lookout/remote/report/support/http/ReportDeciderTest.java"}, "test_case": {"identifier": "testRefreshAddressCache", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testRefreshAddressCache() {\n        addressService.setAgentServerVip(\"10.0.0.1\");\n        reportDecider.refreshAddressCache();\n        Assert.assertEquals(\"10.0.0.1\", reportDecider.getAvailableAddress().ip());\n    }", "signature": "void testRefreshAddressCache()", "full_signature": "@Test public void testRefreshAddressCache()", "class_method_signature": "ReportDeciderTest.testRefreshAddressCache()", "testcase": true, "constructor": false, "invocations": ["setAgentServerVip", "refreshAddressCache", "assertEquals", "ip", "getAvailableAddress"]}, "focal_class": {"identifier": "ReportDecider", "superclass": "", "interfaces": "implements HttpRequestProcessor", "fields": [{"original_string": "private static final Logger      logger                  = LookoutLoggerFactory\n                                                                 .getLogger(ReportDecider.class);", "modifier": "private static final", "type": "Logger", "declarator": "logger                  = LookoutLoggerFactory\n                                                                 .getLogger(ReportDecider.class)", "var_name": "logger"}, {"original_string": "private volatile long            silentTime              = -1;", "modifier": "private volatile", "type": "long", "declarator": "silentTime              = -1", "var_name": "silentTime"}, {"original_string": "private AtomicReference<Address> addressHolder           = new AtomicReference<Address>();", "modifier": "private", "type": "AtomicReference<Address>", "declarator": "addressHolder           = new AtomicReference<Address>()", "var_name": "addressHolder"}, {"original_string": "private volatile long            addressLastModifiedTime = -1;", "modifier": "private volatile", "type": "long", "declarator": "addressLastModifiedTime = -1", "var_name": "addressLastModifiedTime"}, {"original_string": "private long                     expiredTime             = 65000;", "modifier": "private", "type": "long", "declarator": "expiredTime             = 65000", "var_name": "expiredTime"}, {"original_string": "private AddressService           addressService;", "modifier": "private", "type": "AddressService", "declarator": "addressService", "var_name": "addressService"}, {"original_string": "private MetricConfig             metricConfig;", "modifier": "private", "type": "MetricConfig", "declarator": "metricConfig", "var_name": "metricConfig"}], "methods": [{"identifier": "ReportDecider", "parameters": "(AddressService addressService, MetricConfig metricConfig)", "modifiers": "public", "return": "", "signature": " ReportDecider(AddressService addressService, MetricConfig metricConfig)", "full_signature": "public  ReportDecider(AddressService addressService, MetricConfig metricConfig)", "class_method_signature": "ReportDecider.ReportDecider(AddressService addressService, MetricConfig metricConfig)", "testcase": false, "constructor": true}, {"identifier": "getMetricConfig", "parameters": "()", "modifiers": "protected", "return": "MetricConfig", "signature": "MetricConfig getMetricConfig()", "full_signature": "protected MetricConfig getMetricConfig()", "class_method_signature": "ReportDecider.getMetricConfig()", "testcase": false, "constructor": false}, {"identifier": "stillSilent", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean stillSilent()", "full_signature": "public boolean stillSilent()", "class_method_signature": "ReportDecider.stillSilent()", "testcase": false, "constructor": false}, {"identifier": "changeSilentTime", "parameters": "(int wait, TimeUnit timeUnit)", "modifiers": "", "return": "void", "signature": "void changeSilentTime(int wait, TimeUnit timeUnit)", "full_signature": " void changeSilentTime(int wait, TimeUnit timeUnit)", "class_method_signature": "ReportDecider.changeSilentTime(int wait, TimeUnit timeUnit)", "testcase": false, "constructor": false}, {"identifier": "getAvailableAddress", "parameters": "()", "modifiers": "public synchronized", "return": "Address", "signature": "Address getAvailableAddress()", "full_signature": "public synchronized Address getAvailableAddress()", "class_method_signature": "ReportDecider.getAvailableAddress()", "testcase": false, "constructor": false}, {"identifier": "refreshAddressCache", "parameters": "()", "modifiers": "", "return": "void", "signature": "void refreshAddressCache()", "full_signature": " void refreshAddressCache()", "class_method_signature": "ReportDecider.refreshAddressCache()", "testcase": false, "constructor": false}, {"identifier": "isAddressExpired", "parameters": "()", "modifiers": "private", "return": "boolean", "signature": "boolean isAddressExpired()", "full_signature": "private boolean isAddressExpired()", "class_method_signature": "ReportDecider.isAddressExpired()", "testcase": false, "constructor": false}, {"identifier": "filter", "parameters": "(List<LookoutMeasurement> measures)", "modifiers": "public abstract", "return": "List<LookoutMeasurement>", "signature": "List<LookoutMeasurement> filter(List<LookoutMeasurement> measures)", "full_signature": "public abstract List<LookoutMeasurement> filter(List<LookoutMeasurement> measures)", "class_method_signature": "ReportDecider.filter(List<LookoutMeasurement> measures)", "testcase": false, "constructor": false}], "file": "client/lookout-reg-server/src/main/java/com/alipay/lookout/remote/report/support/http/ReportDecider.java"}, "focal_method": {"identifier": "refreshAddressCache", "parameters": "()", "modifiers": "", "return": "void", "body": "void refreshAddressCache() {\n        //get a new one\n        Address oldOne = addressHolder.get();\n        Address newOne = addressService.getAgentServerHost();\n        if (newOne == null) {\n            logger.debug(\"No gateway address found!\");\n            return;\n        }\n        //check new address\n        try {\n            boolean ok = sendGetRequest(\n                new HttpGet(String.format(\"http://%s:%d/datas\", newOne.ip(), newOne.port())), null);\n            if (!ok) {\n                return;\n            }\n            // address is checked!\n            if (oldOne == null) {\n                addressHolder.set(newOne);\n            } else if (!newOne.ip().equals(oldOne.ip())) {\n                addressHolder.compareAndSet(oldOne, newOne);\n            }\n            addressLastModifiedTime = System.currentTimeMillis();\n            logger.debug(\"change gateway address ,from {} to {} .\", oldOne, newOne);\n            return;\n        } catch (Throwable e) {\n            logger.debug(\"check gateway address {} fail:{}. old address:{}!\", newOne.ip(),\n                e.getMessage(), oldOne == null ? \"\" : oldOne.ip());\n\n        }\n\n    }", "signature": "void refreshAddressCache()", "full_signature": " void refreshAddressCache()", "class_method_signature": "ReportDecider.refreshAddressCache()", "testcase": false, "constructor": false, "invocations": ["get", "getAgentServerHost", "debug", "sendGetRequest", "format", "ip", "port", "set", "equals", "ip", "ip", "compareAndSet", "currentTimeMillis", "debug", "debug", "ip", "getMessage", "ip"]}, "repository": {"repo_id": 133381280, "url": "https://github.com/sofastack/sofa-lookout", "language": "Java", "is_fork": false, "fork_count": 113, "stargazer_count": 318, "size": 1394, "license": "licensed"}}