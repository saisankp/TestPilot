{"test_class": {"identifier": "DatabaseSchemaVersionManagerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final ChangeScript script = new ChangeScript(99, \"Some Description\");", "modifier": "private final", "type": "ChangeScript", "declarator": "script = new ChangeScript(99, \"Some Description\")", "var_name": "script"}, {"original_string": "private DatabaseSchemaVersionManager schemaVersionManager;", "modifier": "private", "type": "DatabaseSchemaVersionManager", "declarator": "schemaVersionManager", "var_name": "schemaVersionManager"}, {"original_string": "@Mock private ResultSet expectedResultSet;", "modifier": "@Mock private", "type": "ResultSet", "declarator": "expectedResultSet", "var_name": "expectedResultSet"}, {"original_string": "@Mock private QueryExecuter queryExecuter;", "modifier": "@Mock private", "type": "QueryExecuter", "declarator": "queryExecuter", "var_name": "queryExecuter"}, {"original_string": "@Mock private DatabaseSchemaVersionManager.CurrentTimeProvider timeProvider;", "modifier": "@Mock private", "type": "DatabaseSchemaVersionManager.CurrentTimeProvider", "declarator": "timeProvider", "var_name": "timeProvider"}], "file": "dbdeploy-core/src/test/java/com/dbdeploy/database/changelog/DatabaseSchemaVersionManagerTest.java"}, "test_case": {"identifier": "shouldUpdateChangelogTable", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void shouldUpdateChangelogTable() throws Exception {\n        Date now = new Date();\n\n        when(queryExecuter.getDatabaseUsername()).thenReturn(\"DBUSER\");\n        when(timeProvider.now()).thenReturn(now);\n\n        schemaVersionManager.recordScriptApplied(script);\n        String expected =\n                \"INSERT INTO changelog (change_number, complete_dt, applied_by, description) \" +\n                        \"VALUES (?, ?, ?, ?)\";\n\n        verify(queryExecuter).execute(expected, script.getId(),\n                new Timestamp(now.getTime()), \"DBUSER\", script.getDescription());\n    }", "signature": "void shouldUpdateChangelogTable()", "full_signature": "@Test public void shouldUpdateChangelogTable()", "class_method_signature": "DatabaseSchemaVersionManagerTest.shouldUpdateChangelogTable()", "testcase": true, "constructor": false, "invocations": ["thenReturn", "when", "getDatabaseUsername", "thenReturn", "when", "now", "recordScriptApplied", "execute", "verify", "getId", "getTime", "getDescription"]}, "focal_class": {"identifier": "DatabaseSchemaVersionManager", "superclass": "", "interfaces": "implements AppliedChangesProvider", "fields": [{"original_string": "private final QueryExecuter queryExecuter;", "modifier": "private final", "type": "QueryExecuter", "declarator": "queryExecuter", "var_name": "queryExecuter"}, {"original_string": "private final String changeLogTableName;", "modifier": "private final", "type": "String", "declarator": "changeLogTableName", "var_name": "changeLogTableName"}, {"original_string": "private CurrentTimeProvider timeProvider = new CurrentTimeProvider();", "modifier": "private", "type": "CurrentTimeProvider", "declarator": "timeProvider = new CurrentTimeProvider()", "var_name": "timeProvider"}], "methods": [{"identifier": "DatabaseSchemaVersionManager", "parameters": "(QueryExecuter queryExecuter, String changeLogTableName)", "modifiers": "public", "return": "", "signature": " DatabaseSchemaVersionManager(QueryExecuter queryExecuter, String changeLogTableName)", "full_signature": "public  DatabaseSchemaVersionManager(QueryExecuter queryExecuter, String changeLogTableName)", "class_method_signature": "DatabaseSchemaVersionManager.DatabaseSchemaVersionManager(QueryExecuter queryExecuter, String changeLogTableName)", "testcase": false, "constructor": true}, {"identifier": "getAppliedChanges", "parameters": "()", "modifiers": "public", "return": "List<Long>", "signature": "List<Long> getAppliedChanges()", "full_signature": "public List<Long> getAppliedChanges()", "class_method_signature": "DatabaseSchemaVersionManager.getAppliedChanges()", "testcase": false, "constructor": false}, {"identifier": "getChangelogDeleteSql", "parameters": "(ChangeScript script)", "modifiers": "public", "return": "String", "signature": "String getChangelogDeleteSql(ChangeScript script)", "full_signature": "public String getChangelogDeleteSql(ChangeScript script)", "class_method_signature": "DatabaseSchemaVersionManager.getChangelogDeleteSql(ChangeScript script)", "testcase": false, "constructor": false}, {"identifier": "recordScriptApplied", "parameters": "(ChangeScript script)", "modifiers": "public", "return": "void", "signature": "void recordScriptApplied(ChangeScript script)", "full_signature": "public void recordScriptApplied(ChangeScript script)", "class_method_signature": "DatabaseSchemaVersionManager.recordScriptApplied(ChangeScript script)", "testcase": false, "constructor": false}, {"identifier": "setTimeProvider", "parameters": "(CurrentTimeProvider timeProvider)", "modifiers": "public", "return": "void", "signature": "void setTimeProvider(CurrentTimeProvider timeProvider)", "full_signature": "public void setTimeProvider(CurrentTimeProvider timeProvider)", "class_method_signature": "DatabaseSchemaVersionManager.setTimeProvider(CurrentTimeProvider timeProvider)", "testcase": false, "constructor": false}], "file": "dbdeploy-core/src/main/java/com/dbdeploy/database/changelog/DatabaseSchemaVersionManager.java"}, "focal_method": {"identifier": "recordScriptApplied", "parameters": "(ChangeScript script)", "modifiers": "public", "return": "void", "body": "public void recordScriptApplied(ChangeScript script) {\n        try {\n            queryExecuter.execute(\n                    \"INSERT INTO \" + changeLogTableName + \" (change_number, complete_dt, applied_by, description)\" +\n                            \" VALUES (?, ?, ?, ?)\",\n                    script.getId(),\n                    new Timestamp(timeProvider.now().getTime()),\n                    queryExecuter.getDatabaseUsername(),\n                    script.getDescription()\n                    );\n        } catch (SQLException e) {\n            throw new SchemaVersionTrackingException(\"Could not update change log because: \"\n                    + e.getMessage(), e);\n        }\n    }", "signature": "void recordScriptApplied(ChangeScript script)", "full_signature": "public void recordScriptApplied(ChangeScript script)", "class_method_signature": "DatabaseSchemaVersionManager.recordScriptApplied(ChangeScript script)", "testcase": false, "constructor": false, "invocations": ["execute", "getId", "getTime", "now", "getDatabaseUsername", "getDescription", "getMessage"]}, "repository": {"repo_id": 145875, "url": "https://github.com/tackley/dbdeploy", "language": "Java", "is_fork": false, "fork_count": 54, "stargazer_count": 64, "size": 7295, "license": "licensed"}}