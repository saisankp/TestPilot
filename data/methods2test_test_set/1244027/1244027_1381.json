{"test_class": {"identifier": "LocalDuplicateIndexTest", "superclass": "extends AbstractLocalIndexTest", "interfaces": "", "fields": [], "file": "modeshape-jcr/src/test/java/org/modeshape/jcr/index/local/LocalDuplicateIndexTest.java"}, "test_case": {"identifier": "shouldAllowRemovingAllValuesForKey", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void shouldAllowRemovingAllValuesForKey() {\n        LocalDuplicateIndex<Long> index = duplicateValueIndex(Long.class);\n        loadLongIndexWithNoDuplicates(index, 10);\n        assertThat(index.estimateTotalCount(), is(10L));\n\n        // Check the values that are in the index ...\n        assertThat(index.estimateTotalCount(), is(10L));\n        assertMatch(index, Operator.EQUAL_TO, 20L, key(2));\n\n        // Remove the value associated with a given key and verify they are indeed gone ...\n        index.remove(key(2));\n        assertNoMatch(index, Operator.EQUAL_TO, 20L);\n        assertThat(index.estimateTotalCount(), is(9L));\n\n        // Try to remove the values associated with a key not in the index ...\n        assertNoMatch(index, Operator.EQUAL_TO, 200L);\n        index.remove(key(20));\n        assertNoMatch(index, Operator.EQUAL_TO, 200L);\n        assertThat(index.estimateTotalCount(), is(9L));\n\n        // Remove a value and key pair that's in the index, and verify they are indeed gone ...\n        index.remove(key(3), null, 30L);\n        assertNoMatch(index, Operator.EQUAL_TO, 30L);\n        assertThat(index.estimateTotalCount(), is(8L));\n\n        // Try to remove a non-existent value-key pair, and verify nothing is removed ...\n        index.remove(key(3), null, 3000L);\n        assertNoMatch(index, Operator.EQUAL_TO, 30L);\n        assertThat(index.estimateTotalCount(), is(8L));\n    }", "signature": "void shouldAllowRemovingAllValuesForKey()", "full_signature": "@Test public void shouldAllowRemovingAllValuesForKey()", "class_method_signature": "LocalDuplicateIndexTest.shouldAllowRemovingAllValuesForKey()", "testcase": true, "constructor": false, "invocations": ["duplicateValueIndex", "loadLongIndexWithNoDuplicates", "assertThat", "estimateTotalCount", "is", "assertThat", "estimateTotalCount", "is", "assertMatch", "key", "remove", "key", "assertNoMatch", "assertThat", "estimateTotalCount", "is", "assertNoMatch", "remove", "key", "assertNoMatch", "assertThat", "estimateTotalCount", "is", "remove", "key", "assertNoMatch", "assertThat", "estimateTotalCount", "is", "remove", "key", "assertNoMatch", "assertThat", "estimateTotalCount", "is"]}, "focal_class": {"identifier": "LocalDuplicateIndex", "superclass": "extends LocalMapIndex<UniqueKey<T>, T>", "interfaces": "", "fields": [{"original_string": "private static final String NEXT_COUNTER = \"next-counter\";", "modifier": "private static final", "type": "String", "declarator": "NEXT_COUNTER = \"next-counter\"", "var_name": "NEXT_COUNTER"}, {"original_string": "private final Logger logger = Logger.getLogger(getClass());", "modifier": "private final", "type": "Logger", "declarator": "logger = Logger.getLogger(getClass())", "var_name": "logger"}, {"original_string": "private final AtomicLong counter;", "modifier": "private final", "type": "AtomicLong", "declarator": "counter", "var_name": "counter"}], "methods": [{"identifier": "create", "parameters": "( String name,\n                                              String workspaceName,\n                                              DB db,\n                                              Converter<T> converter,\n                                              Serializer<T> valueSerializer,\n                                              Comparator<T> comparator )", "modifiers": "static", "return": "LocalDuplicateIndex<T>", "signature": "LocalDuplicateIndex<T> create( String name,\n                                              String workspaceName,\n                                              DB db,\n                                              Converter<T> converter,\n                                              Serializer<T> valueSerializer,\n                                              Comparator<T> comparator )", "full_signature": "static LocalDuplicateIndex<T> create( String name,\n                                              String workspaceName,\n                                              DB db,\n                                              Converter<T> converter,\n                                              Serializer<T> valueSerializer,\n                                              Comparator<T> comparator )", "class_method_signature": "LocalDuplicateIndex.create( String name,\n                                              String workspaceName,\n                                              DB db,\n                                              Converter<T> converter,\n                                              Serializer<T> valueSerializer,\n                                              Comparator<T> comparator )", "testcase": false, "constructor": false}, {"identifier": "LocalDuplicateIndex", "parameters": "( String name,\n                                   String workspaceName,\n                                   DB db,\n                                   Converter<T> converter,\n                                   Serializer<T> valueSerializer,\n                                   Comparator<T> comparator )", "modifiers": "protected", "return": "", "signature": " LocalDuplicateIndex( String name,\n                                   String workspaceName,\n                                   DB db,\n                                   Converter<T> converter,\n                                   Serializer<T> valueSerializer,\n                                   Comparator<T> comparator )", "full_signature": "protected  LocalDuplicateIndex( String name,\n                                   String workspaceName,\n                                   DB db,\n                                   Converter<T> converter,\n                                   Serializer<T> valueSerializer,\n                                   Comparator<T> comparator )", "class_method_signature": "LocalDuplicateIndex.LocalDuplicateIndex( String name,\n                                   String workspaceName,\n                                   DB db,\n                                   Converter<T> converter,\n                                   Serializer<T> valueSerializer,\n                                   Comparator<T> comparator )", "testcase": false, "constructor": true}, {"identifier": "add", "parameters": "( String nodeKey,\n                     String propertyName, \n                     T value )", "modifiers": "@Override public", "return": "void", "signature": "void add( String nodeKey,\n                     String propertyName, \n                     T value )", "full_signature": "@Override public void add( String nodeKey,\n                     String propertyName, \n                     T value )", "class_method_signature": "LocalDuplicateIndex.add( String nodeKey,\n                     String propertyName, \n                     T value )", "testcase": false, "constructor": false}, {"identifier": "remove", "parameters": "( String nodeKey,\n                        String propertyName, \n                        T value )", "modifiers": "@Override public", "return": "void", "signature": "void remove( String nodeKey,\n                        String propertyName, \n                        T value )", "full_signature": "@Override public void remove( String nodeKey,\n                        String propertyName, \n                        T value )", "class_method_signature": "LocalDuplicateIndex.remove( String nodeKey,\n                        String propertyName, \n                        T value )", "testcase": false, "constructor": false}, {"identifier": "remove", "parameters": "( String nodeKey )", "modifiers": "@Override public", "return": "void", "signature": "void remove( String nodeKey )", "full_signature": "@Override public void remove( String nodeKey )", "class_method_signature": "LocalDuplicateIndex.remove( String nodeKey )", "testcase": false, "constructor": false}], "file": "modeshape-jcr/src/main/java/org/modeshape/jcr/index/local/LocalDuplicateIndex.java"}, "focal_method": {"identifier": "remove", "parameters": "( String nodeKey,\n                        String propertyName, \n                        T value )", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void remove( String nodeKey,\n                        String propertyName, \n                        T value ) {\n        // Find all of the T values (entry keys) for the given node key (entry values) and remove those which have value 'value'\n        for (UniqueKey<T> key : Fun.filter(valuesByKey, nodeKey)) {\n            if (key.actualKey.equals(value)) {\n                logger.trace(\"Removing node '{0}' from '{1}' index with value '{2}'\", nodeKey, name, key.actualKey);\n                keysByValue.remove(key);\n            }\n        }\n    }", "signature": "void remove( String nodeKey,\n                        String propertyName, \n                        T value )", "full_signature": "@Override public void remove( String nodeKey,\n                        String propertyName, \n                        T value )", "class_method_signature": "LocalDuplicateIndex.remove( String nodeKey,\n                        String propertyName, \n                        T value )", "testcase": false, "constructor": false, "invocations": ["filter", "equals", "trace", "remove"]}, "repository": {"repo_id": 1244027, "url": "https://github.com/ModeShape/modeshape", "language": "Java", "is_fork": false, "fork_count": 213, "stargazer_count": 208, "size": 134266, "license": "licensed"}}