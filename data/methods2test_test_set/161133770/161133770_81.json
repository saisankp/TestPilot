{"test_class": {"identifier": "JobControllerServiceTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "JobRepository jobRepository;", "modifier": "", "type": "JobRepository", "declarator": "jobRepository", "var_name": "jobRepository"}, {"original_string": "@Mock CoreServiceGrpc.CoreServiceBlockingStub specService;", "modifier": "@Mock", "type": "CoreServiceGrpc.CoreServiceBlockingStub", "declarator": "specService", "var_name": "specService"}, {"original_string": "private FeastProperties feastProperties;", "modifier": "private", "type": "FeastProperties", "declarator": "feastProperties", "var_name": "feastProperties"}, {"original_string": "private JobControllerService controllerWithConsolidation;", "modifier": "private", "type": "JobControllerService", "declarator": "controllerWithConsolidation", "var_name": "controllerWithConsolidation"}, {"original_string": "private JobControllerService controllerWithJobPerStore;", "modifier": "private", "type": "JobControllerService", "declarator": "controllerWithJobPerStore", "var_name": "controllerWithJobPerStore"}], "file": "job-controller/src/test/java/feast/jobcontroller/service/JobControllerServiceTest.java"}, "test_case": {"identifier": "shouldSelectOnlyFeatureSetsThatJobManagerSubscribedTo", "parameters": "()", "modifiers": "@Test @SneakyThrows public", "return": "void", "body": "@Test\n  @SneakyThrows\n  public void shouldSelectOnlyFeatureSetsThatJobManagerSubscribedTo() {\n    Store store = DataGenerator.getDefaultStore();\n    Source source = DataGenerator.getDefaultSource();\n\n    FeatureSet featureSet1 = DataGenerator.createFeatureSet(source, \"default\", \"fs1\");\n    FeatureSet featureSet2 = DataGenerator.createFeatureSet(source, \"project\", \"fs3\");\n    FeatureSet featureSet3 = DataGenerator.createFeatureSet(source, \"default\", \"not-fs\");\n\n    when(specService.listFeatureSets(\n            CoreServiceProto.ListFeatureSetsRequest.newBuilder()\n                .setFilter(Filter.newBuilder().setFeatureSetName(\"*\").setProject(\"*\").build())\n                .build()))\n        .thenReturn(\n            ListFeatureSetsResponse.newBuilder()\n                .addAllFeatureSets(Lists.newArrayList(featureSet1, featureSet2, featureSet3))\n                .build());\n\n    List<FeatureSet> featureSetsForStore =\n        controllerWithConsolidation.getFeatureSetsForStore(store);\n    assertThat(featureSetsForStore, containsInAnyOrder(featureSet1, featureSet2));\n  }", "signature": "void shouldSelectOnlyFeatureSetsThatJobManagerSubscribedTo()", "full_signature": "@Test @SneakyThrows public void shouldSelectOnlyFeatureSetsThatJobManagerSubscribedTo()", "class_method_signature": "JobControllerServiceTest.shouldSelectOnlyFeatureSetsThatJobManagerSubscribedTo()", "testcase": true, "constructor": false, "invocations": ["getDefaultStore", "getDefaultSource", "createFeatureSet", "createFeatureSet", "createFeatureSet", "thenReturn", "when", "listFeatureSets", "build", "setFilter", "newBuilder", "build", "setProject", "setFeatureSetName", "newBuilder", "build", "addAllFeatureSets", "newBuilder", "newArrayList", "getFeatureSetsForStore", "assertThat", "containsInAnyOrder"]}, "focal_class": {"identifier": "JobControllerService", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final int SPEC_PUBLISHING_TIMEOUT_SECONDS = 5;", "modifier": "private final", "type": "int", "declarator": "SPEC_PUBLISHING_TIMEOUT_SECONDS = 5", "var_name": "SPEC_PUBLISHING_TIMEOUT_SECONDS"}, {"original_string": "public static final String VERSION_LABEL = \"feast_version\";", "modifier": "public static final", "type": "String", "declarator": "VERSION_LABEL = \"feast_version\"", "var_name": "VERSION_LABEL"}, {"original_string": "private final JobRepository jobRepository;", "modifier": "private final", "type": "JobRepository", "declarator": "jobRepository", "var_name": "jobRepository"}, {"original_string": "private final CoreServiceGrpc.CoreServiceBlockingStub specService;", "modifier": "private final", "type": "CoreServiceGrpc.CoreServiceBlockingStub", "declarator": "specService", "var_name": "specService"}, {"original_string": "private final JobManager jobManager;", "modifier": "private final", "type": "JobManager", "declarator": "jobManager", "var_name": "jobManager"}, {"original_string": "private final JobProperties jobProperties;", "modifier": "private final", "type": "JobProperties", "declarator": "jobProperties", "var_name": "jobProperties"}, {"original_string": "private final JobGroupingStrategy groupingStrategy;", "modifier": "private final", "type": "JobGroupingStrategy", "declarator": "groupingStrategy", "var_name": "groupingStrategy"}, {"original_string": "private final KafkaTemplate<String, FeatureSetSpec> specPublisher;", "modifier": "private final", "type": "KafkaTemplate<String, FeatureSetSpec>", "declarator": "specPublisher", "var_name": "specPublisher"}, {"original_string": "private final List<Store.Subscription> featureSetSubscriptions;", "modifier": "private final", "type": "List<Store.Subscription>", "declarator": "featureSetSubscriptions", "var_name": "featureSetSubscriptions"}, {"original_string": "private final List<String> whitelistedStores;", "modifier": "private final", "type": "List<String>", "declarator": "whitelistedStores", "var_name": "whitelistedStores"}, {"original_string": "private final Map<String, String> jobLabels;", "modifier": "private final", "type": "Map<String, String>", "declarator": "jobLabels", "var_name": "jobLabels"}, {"original_string": "private final String currentVersion;", "modifier": "private final", "type": "String", "declarator": "currentVersion", "var_name": "currentVersion"}], "methods": [{"identifier": "JobControllerService", "parameters": "(\n      JobRepository jobRepository,\n      CoreServiceGrpc.CoreServiceBlockingStub specService,\n      JobManager jobManager,\n      FeastProperties feastProperties,\n      JobGroupingStrategy groupingStrategy,\n      KafkaTemplate<String, FeatureSetSpec> specPublisher)", "modifiers": "@Autowired public", "return": "", "signature": " JobControllerService(\n      JobRepository jobRepository,\n      CoreServiceGrpc.CoreServiceBlockingStub specService,\n      JobManager jobManager,\n      FeastProperties feastProperties,\n      JobGroupingStrategy groupingStrategy,\n      KafkaTemplate<String, FeatureSetSpec> specPublisher)", "full_signature": "@Autowired public  JobControllerService(\n      JobRepository jobRepository,\n      CoreServiceGrpc.CoreServiceBlockingStub specService,\n      JobManager jobManager,\n      FeastProperties feastProperties,\n      JobGroupingStrategy groupingStrategy,\n      KafkaTemplate<String, FeatureSetSpec> specPublisher)", "class_method_signature": "JobControllerService.JobControllerService(\n      JobRepository jobRepository,\n      CoreServiceGrpc.CoreServiceBlockingStub specService,\n      JobManager jobManager,\n      FeastProperties feastProperties,\n      JobGroupingStrategy groupingStrategy,\n      KafkaTemplate<String, FeatureSetSpec> specPublisher)", "testcase": false, "constructor": true}, {"identifier": "getVersionLabel", "parameters": "()", "modifiers": "private", "return": "String", "signature": "String getVersionLabel()", "full_signature": "private String getVersionLabel()", "class_method_signature": "JobControllerService.getVersionLabel()", "testcase": false, "constructor": false}, {"identifier": "Poll", "parameters": "()", "modifiers": "@Scheduled(fixedDelayString = \"${feast.jobs.polling_interval_milliseconds}\") public", "return": "void", "signature": "void Poll()", "full_signature": "@Scheduled(fixedDelayString = \"${feast.jobs.polling_interval_milliseconds}\") public void Poll()", "class_method_signature": "JobControllerService.Poll()", "testcase": false, "constructor": false}, {"identifier": "startOrUpdateJobs", "parameters": "(List<JobTask> tasks)", "modifiers": "", "return": "void", "signature": "void startOrUpdateJobs(List<JobTask> tasks)", "full_signature": " void startOrUpdateJobs(List<JobTask> tasks)", "class_method_signature": "JobControllerService.startOrUpdateJobs(List<JobTask> tasks)", "testcase": false, "constructor": false}, {"identifier": "makeJobUpdateTasks", "parameters": "(Iterable<Pair<Source, Set<Store>>> sourceToStores)", "modifiers": "", "return": "List<JobTask>", "signature": "List<JobTask> makeJobUpdateTasks(Iterable<Pair<Source, Set<Store>>> sourceToStores)", "full_signature": " List<JobTask> makeJobUpdateTasks(Iterable<Pair<Source, Set<Store>>> sourceToStores)", "class_method_signature": "JobControllerService.makeJobUpdateTasks(Iterable<Pair<Source, Set<Store>>> sourceToStores)", "testcase": false, "constructor": false}, {"identifier": "jobRequiresUpgrade", "parameters": "(Job job, Set<Store> stores)", "modifiers": "private", "return": "boolean", "signature": "boolean jobRequiresUpgrade(Job job, Set<Store> stores)", "full_signature": "private boolean jobRequiresUpgrade(Job job, Set<Store> stores)", "class_method_signature": "JobControllerService.jobRequiresUpgrade(Job job, Set<Store> stores)", "testcase": false, "constructor": false}, {"identifier": "allocateFeatureSetToJobs", "parameters": "(FeatureSet featureSet)", "modifiers": "", "return": "FeatureSet", "signature": "FeatureSet allocateFeatureSetToJobs(FeatureSet featureSet)", "full_signature": " FeatureSet allocateFeatureSetToJobs(FeatureSet featureSet)", "class_method_signature": "JobControllerService.allocateFeatureSetToJobs(FeatureSet featureSet)", "testcase": false, "constructor": false}, {"identifier": "getExtraJobs", "parameters": "(List<Job> keepJobs)", "modifiers": "private", "return": "Collection<Job>", "signature": "Collection<Job> getExtraJobs(List<Job> keepJobs)", "full_signature": "private Collection<Job> getExtraJobs(List<Job> keepJobs)", "class_method_signature": "JobControllerService.getExtraJobs(List<Job> keepJobs)", "testcase": false, "constructor": false}, {"identifier": "getAllStores", "parameters": "()", "modifiers": "private", "return": "List<Store>", "signature": "List<Store> getAllStores()", "full_signature": "private List<Store> getAllStores()", "class_method_signature": "JobControllerService.getAllStores()", "testcase": false, "constructor": false}, {"identifier": "getSourceToStoreMappings", "parameters": "()", "modifiers": "", "return": "Iterable<Pair<Source, Set<Store>>>", "signature": "Iterable<Pair<Source, Set<Store>>> getSourceToStoreMappings()", "full_signature": " Iterable<Pair<Source, Set<Store>>> getSourceToStoreMappings()", "class_method_signature": "JobControllerService.getSourceToStoreMappings()", "testcase": false, "constructor": false}, {"identifier": "getFeatureSetsForStore", "parameters": "(Store store)", "modifiers": "", "return": "List<FeatureSet>", "signature": "List<FeatureSet> getFeatureSetsForStore(Store store)", "full_signature": " List<FeatureSet> getFeatureSetsForStore(Store store)", "class_method_signature": "JobControllerService.getFeatureSetsForStore(Store store)", "testcase": false, "constructor": false}, {"identifier": "notifyJobsWhenFeatureSetUpdated", "parameters": "()", "modifiers": "@Scheduled(fixedDelayString = \"${feast.stream.specsOptions.notifyIntervalMilliseconds}\") public", "return": "void", "signature": "void notifyJobsWhenFeatureSetUpdated()", "full_signature": "@Scheduled(fixedDelayString = \"${feast.stream.specsOptions.notifyIntervalMilliseconds}\") public void notifyJobsWhenFeatureSetUpdated()", "class_method_signature": "JobControllerService.notifyJobsWhenFeatureSetUpdated()", "testcase": false, "constructor": false}, {"identifier": "listenAckFromJobs", "parameters": "(\n      ConsumerRecord<String, IngestionJobProto.FeatureSetSpecAck> record)", "modifiers": "@KafkaListener( topics = {\"${feast.stream.specsOptions.specsAckTopic}\"}, containerFactory = \"kafkaAckListenerContainerFactory\") public", "return": "void", "signature": "void listenAckFromJobs(\n      ConsumerRecord<String, IngestionJobProto.FeatureSetSpecAck> record)", "full_signature": "@KafkaListener( topics = {\"${feast.stream.specsOptions.specsAckTopic}\"}, containerFactory = \"kafkaAckListenerContainerFactory\") public void listenAckFromJobs(\n      ConsumerRecord<String, IngestionJobProto.FeatureSetSpecAck> record)", "class_method_signature": "JobControllerService.listenAckFromJobs(\n      ConsumerRecord<String, IngestionJobProto.FeatureSetSpecAck> record)", "testcase": false, "constructor": false}], "file": "job-controller/src/main/java/feast/jobcontroller/service/JobControllerService.java"}, "focal_method": {"identifier": "getFeatureSetsForStore", "parameters": "(Store store)", "modifiers": "", "return": "List<FeatureSet>", "body": "List<FeatureSet> getFeatureSetsForStore(Store store) {\n    return store.getSubscriptionsList().stream()\n        .flatMap(\n            subscription -> {\n              return specService\n                  .listFeatureSets(\n                      CoreServiceProto.ListFeatureSetsRequest.newBuilder()\n                          .setFilter(\n                              CoreServiceProto.ListFeatureSetsRequest.Filter.newBuilder()\n                                  .setProject(subscription.getProject())\n                                  .setFeatureSetName(subscription.getName())\n                                  .build())\n                          .build())\n                  .getFeatureSetsList().stream()\n                  .filter(\n                      f ->\n                          this.featureSetSubscriptions.isEmpty()\n                              || isSubscribedToFeatureSet(\n                                  this.featureSetSubscriptions,\n                                  f.getSpec().getProject(),\n                                  f.getSpec().getName()));\n            })\n        .distinct()\n        .collect(Collectors.toList());\n  }", "signature": "List<FeatureSet> getFeatureSetsForStore(Store store)", "full_signature": " List<FeatureSet> getFeatureSetsForStore(Store store)", "class_method_signature": "JobControllerService.getFeatureSetsForStore(Store store)", "testcase": false, "constructor": false, "invocations": ["collect", "distinct", "flatMap", "stream", "getSubscriptionsList", "filter", "stream", "getFeatureSetsList", "listFeatureSets", "build", "setFilter", "newBuilder", "build", "setFeatureSetName", "setProject", "newBuilder", "getProject", "getName", "isEmpty", "isSubscribedToFeatureSet", "getProject", "getSpec", "getName", "getSpec", "toList"]}, "repository": {"repo_id": 161133770, "url": "https://github.com/gojek/feast", "stars": 633, "created": "12/10/2018 7:20:15 AM +00:00", "updates": "2020-01-27T12:39:33+00:00", "fork": "False", "license": "licensed"}}