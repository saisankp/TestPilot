{"test_class": {"identifier": "RsrcCtxWrapperTest", "superclass": "", "interfaces": "", "fields": [], "file": "servers/zms/src/test/java/com/yahoo/athenz/zms/RsrcCtxWrapperTest.java"}, "test_case": {"identifier": "testAuthorize", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testAuthorize() {\n        HttpServletRequest reqMock = Mockito.mock(HttpServletRequest.class);\n        HttpServletResponse resMock = Mockito.mock(HttpServletResponse.class);\n\n        AuthorityList authListMock = new AuthorityList();\n        Authorizer authorizerMock = Mockito.mock(Authorizer.class);\n        Authority authMock = Mockito.mock(Authority.class);\n        Principal prin = Mockito.mock(Principal.class);\n\n        Mockito.when(authMock.getHeader()).thenReturn(\"testheader\");\n        Mockito.when(reqMock.getHeader(\"testheader\")).thenReturn(\"testcred\");\n        Mockito.when(authMock.getCredSource()).thenReturn(Authority.CredSource.HEADER);\n        Mockito.when(authMock.authenticate(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any()))\n                .thenReturn(prin);\n        Mockito.when(reqMock.getRemoteAddr()).thenReturn(\"1.1.1.1\");\n        Mockito.when(reqMock.getMethod()).thenReturn(\"POST\");\n        authListMock.add(authMock);\n\n        // force true access right\n        Mockito.when(authorizerMock.access(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any()))\n                .thenReturn(true);\n\n        Object timerMetric = new Object();\n        RsrcCtxWrapper wrapper = new RsrcCtxWrapper(reqMock, resMock, authListMock, false, authorizerMock, timerMetric, \"apiName\");\n\n        wrapper.authorize(\"add-domain\", \"test\", \"test\");\n\n        // after authorize success, principal should be set\n        assertEquals(wrapper.principal(), prin);\n    }", "signature": "void testAuthorize()", "full_signature": "@Test public void testAuthorize()", "class_method_signature": "RsrcCtxWrapperTest.testAuthorize()", "testcase": true, "constructor": false, "invocations": ["mock", "mock", "mock", "mock", "mock", "thenReturn", "when", "getHeader", "thenReturn", "when", "getHeader", "thenReturn", "when", "getCredSource", "thenReturn", "when", "authenticate", "any", "any", "any", "any", "thenReturn", "when", "getRemoteAddr", "thenReturn", "when", "getMethod", "add", "thenReturn", "when", "access", "any", "any", "any", "any", "authorize", "assertEquals", "principal"]}, "focal_class": {"identifier": "RsrcCtxWrapper", "superclass": "", "interfaces": "implements ResourceContext", "fields": [{"original_string": "private final com.yahoo.athenz.common.server.rest.ResourceContext ctx;", "modifier": "private final", "type": "com.yahoo.athenz.common.server.rest.ResourceContext", "declarator": "ctx", "var_name": "ctx"}, {"original_string": "private Object timerMetric;", "modifier": "private", "type": "Object", "declarator": "timerMetric", "var_name": "timerMetric"}, {"original_string": "private boolean optionalAuth;", "modifier": "private", "type": "boolean", "declarator": "optionalAuth", "var_name": "optionalAuth"}, {"original_string": "private String apiName;", "modifier": "private", "type": "String", "declarator": "apiName", "var_name": "apiName"}], "methods": [{"identifier": "RsrcCtxWrapper", "parameters": "(HttpServletRequest request, HttpServletResponse response,\n                   Http.AuthorityList authList, boolean optionalAuth,\n                   Authorizer authorizer, Object timerMetric, String apiName)", "modifiers": "", "return": "", "signature": " RsrcCtxWrapper(HttpServletRequest request, HttpServletResponse response,\n                   Http.AuthorityList authList, boolean optionalAuth,\n                   Authorizer authorizer, Object timerMetric, String apiName)", "full_signature": "  RsrcCtxWrapper(HttpServletRequest request, HttpServletResponse response,\n                   Http.AuthorityList authList, boolean optionalAuth,\n                   Authorizer authorizer, Object timerMetric, String apiName)", "class_method_signature": "RsrcCtxWrapper.RsrcCtxWrapper(HttpServletRequest request, HttpServletResponse response,\n                   Http.AuthorityList authList, boolean optionalAuth,\n                   Authorizer authorizer, Object timerMetric, String apiName)", "testcase": false, "constructor": true}, {"identifier": "context", "parameters": "()", "modifiers": "", "return": "com.yahoo.athenz.common.server.rest.ResourceContext", "signature": "com.yahoo.athenz.common.server.rest.ResourceContext context()", "full_signature": " com.yahoo.athenz.common.server.rest.ResourceContext context()", "class_method_signature": "RsrcCtxWrapper.context()", "testcase": false, "constructor": false}, {"identifier": "principal", "parameters": "()", "modifiers": "public", "return": "Principal", "signature": "Principal principal()", "full_signature": "public Principal principal()", "class_method_signature": "RsrcCtxWrapper.principal()", "testcase": false, "constructor": false}, {"identifier": "getRequestDomain", "parameters": "()", "modifiers": "public", "return": "String", "signature": "String getRequestDomain()", "full_signature": "public String getRequestDomain()", "class_method_signature": "RsrcCtxWrapper.getRequestDomain()", "testcase": false, "constructor": false}, {"identifier": "getTimerMetric", "parameters": "()", "modifiers": "public", "return": "Object", "signature": "Object getTimerMetric()", "full_signature": "public Object getTimerMetric()", "class_method_signature": "RsrcCtxWrapper.getTimerMetric()", "testcase": false, "constructor": false}, {"identifier": "setRequestDomain", "parameters": "(String requestDomain)", "modifiers": "public", "return": "void", "signature": "void setRequestDomain(String requestDomain)", "full_signature": "public void setRequestDomain(String requestDomain)", "class_method_signature": "RsrcCtxWrapper.setRequestDomain(String requestDomain)", "testcase": false, "constructor": false}, {"identifier": "getApiName", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String getApiName()", "full_signature": "@Override public String getApiName()", "class_method_signature": "RsrcCtxWrapper.getApiName()", "testcase": false, "constructor": false}, {"identifier": "getHttpMethod", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String getHttpMethod()", "full_signature": "@Override public String getHttpMethod()", "class_method_signature": "RsrcCtxWrapper.getHttpMethod()", "testcase": false, "constructor": false}, {"identifier": "request", "parameters": "()", "modifiers": "@Override public", "return": "HttpServletRequest", "signature": "HttpServletRequest request()", "full_signature": "@Override public HttpServletRequest request()", "class_method_signature": "RsrcCtxWrapper.request()", "testcase": false, "constructor": false}, {"identifier": "response", "parameters": "()", "modifiers": "@Override public", "return": "HttpServletResponse", "signature": "HttpServletResponse response()", "full_signature": "@Override public HttpServletResponse response()", "class_method_signature": "RsrcCtxWrapper.response()", "testcase": false, "constructor": false}, {"identifier": "authenticate", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void authenticate()", "full_signature": "@Override public void authenticate()", "class_method_signature": "RsrcCtxWrapper.authenticate()", "testcase": false, "constructor": false}, {"identifier": "authorize", "parameters": "(String action, String resource, String trustedDomain)", "modifiers": "@Override public", "return": "void", "signature": "void authorize(String action, String resource, String trustedDomain)", "full_signature": "@Override public void authorize(String action, String resource, String trustedDomain)", "class_method_signature": "RsrcCtxWrapper.authorize(String action, String resource, String trustedDomain)", "testcase": false, "constructor": false}, {"identifier": "logPrincipal", "parameters": "(final Principal principal)", "modifiers": "public", "return": "void", "signature": "void logPrincipal(final Principal principal)", "full_signature": "public void logPrincipal(final Principal principal)", "class_method_signature": "RsrcCtxWrapper.logPrincipal(final Principal principal)", "testcase": false, "constructor": false}, {"identifier": "logAuthorityId", "parameters": "(Authority authority)", "modifiers": "public", "return": "void", "signature": "void logAuthorityId(Authority authority)", "full_signature": "public void logAuthorityId(Authority authority)", "class_method_signature": "RsrcCtxWrapper.logAuthorityId(Authority authority)", "testcase": false, "constructor": false}, {"identifier": "throwZmsException", "parameters": "(com.yahoo.athenz.common.server.rest.ResourceException restExc)", "modifiers": "", "return": "void", "signature": "void throwZmsException(com.yahoo.athenz.common.server.rest.ResourceException restExc)", "full_signature": " void throwZmsException(com.yahoo.athenz.common.server.rest.ResourceException restExc)", "class_method_signature": "RsrcCtxWrapper.throwZmsException(com.yahoo.athenz.common.server.rest.ResourceException restExc)", "testcase": false, "constructor": false}], "file": "servers/zms/src/main/java/com/yahoo/athenz/zms/RsrcCtxWrapper.java"}, "focal_method": {"identifier": "authorize", "parameters": "(String action, String resource, String trustedDomain)", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void authorize(String action, String resource, String trustedDomain) {\n        try {\n            ctx.authorize(action, resource, trustedDomain);\n        } catch (com.yahoo.athenz.common.server.rest.ResourceException restExc) {\n            logPrincipal(ctx.principal());\n            throwZmsException(restExc);\n        }\n    }", "signature": "void authorize(String action, String resource, String trustedDomain)", "full_signature": "@Override public void authorize(String action, String resource, String trustedDomain)", "class_method_signature": "RsrcCtxWrapper.authorize(String action, String resource, String trustedDomain)", "testcase": false, "constructor": false, "invocations": ["authorize", "logPrincipal", "principal", "throwZmsException"]}, "repository": {"repo_id": 73948366, "url": "https://github.com/yahoo/athenz", "stars": 394, "created": "11/16/2016 6:23:08 PM +00:00", "updates": "2020-01-27T15:36:13+00:00", "fork": "False", "license": "licensed"}}