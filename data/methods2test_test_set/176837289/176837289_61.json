{"test_class": {"identifier": "RedisCacheTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static RedissonClient client;", "modifier": "private static", "type": "RedissonClient", "declarator": "client", "var_name": "client"}, {"original_string": "private static RedisCache cache;", "modifier": "private static", "type": "RedisCache", "declarator": "cache", "var_name": "cache"}, {"original_string": "@ClassRule\n    public static SettingsOverride settingsOverride = new SettingsOverride(Map.of(\n        AppSettings.REDIS_CACHE_HOST, \"localhost\",\n        AppSettings.REDIS_CACHE_PORT, 6379,\n        AppSettings.REDIS_CACHE_DB, 0\n    ));", "modifier": "@ClassRule\n    public static", "type": "SettingsOverride", "declarator": "settingsOverride = new SettingsOverride(Map.of(\n        AppSettings.REDIS_CACHE_HOST, \"localhost\",\n        AppSettings.REDIS_CACHE_PORT, 6379,\n        AppSettings.REDIS_CACHE_DB, 0\n    ))", "var_name": "settingsOverride"}], "file": "code/extensions/caching/redis/src/test/java/com/google/cloud/broker/caching/remote/RedisCacheTest.java"}, "test_case": {"identifier": "testLock", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testLock() throws InterruptedException {\n        String LOCK_NAME = \"test-lock\";\n        int WAIT = 20;\n        List<String> list = Collections.synchronizedList(new ArrayList<>());\n\n        // Define the concurrent tasks\n        Callable<Object> task1 = () -> {\n            Lock lock = cache.acquireLock(LOCK_NAME);\n            Thread.sleep(WAIT);\n            list.add(\"a1\");\n            Thread.sleep(WAIT);\n            list.add(\"b1\");\n            Thread.sleep(WAIT);\n            list.add(\"c1\");\n            lock.unlock();\n            return null;\n        };\n        Callable<Object> task2 = () -> {\n            Lock lock = cache.acquireLock(LOCK_NAME);\n            Thread.sleep(WAIT);\n            list.add(\"a2\");\n            Thread.sleep(WAIT);\n            list.add(\"b2\");\n            Thread.sleep(WAIT);\n            list.add(\"c2\");\n            lock.unlock();\n            return null;\n        };\n        List<Callable<Object>> tasks = new ArrayList<>();\n        tasks.add(task1);\n        tasks.add(task2);\n\n        // Execute the tasks concurrently\n        ExecutorService executorService = Executors.newFixedThreadPool(2);\n        executorService.invokeAll(tasks);\n\n        // Verify that the tasks updated the shared list in sequence\n        String result = String.join(\",\", list);\n        assertTrue(result.equals(\"a1,b1,c1,a2,b2,c2\") || result.equals(\"a2,b2,c2,a1,b1,c1\"));\n    }", "signature": "void testLock()", "full_signature": "@Test public void testLock()", "class_method_signature": "RedisCacheTest.testLock()", "testcase": true, "constructor": false, "invocations": ["synchronizedList", "acquireLock", "sleep", "add", "sleep", "add", "sleep", "add", "unlock", "acquireLock", "sleep", "add", "sleep", "add", "sleep", "add", "unlock", "add", "add", "newFixedThreadPool", "invokeAll", "join", "assertTrue", "equals", "equals"]}, "focal_class": {"identifier": "RedisCache", "superclass": "extends AbstractRemoteCache", "interfaces": "", "fields": [{"original_string": "private RedissonClient client;", "modifier": "private", "type": "RedissonClient", "declarator": "client", "var_name": "client"}], "methods": [{"identifier": "RedisCache", "parameters": "()", "modifiers": "public", "return": "", "signature": " RedisCache()", "full_signature": "public  RedisCache()", "class_method_signature": "RedisCache.RedisCache()", "testcase": false, "constructor": true}, {"identifier": "getClient", "parameters": "()", "modifiers": "private", "return": "RedissonClient", "signature": "RedissonClient getClient()", "full_signature": "private RedissonClient getClient()", "class_method_signature": "RedisCache.getClient()", "testcase": false, "constructor": false}, {"identifier": "get", "parameters": "(String key)", "modifiers": "public", "return": "byte[]", "signature": "byte[] get(String key)", "full_signature": "public byte[] get(String key)", "class_method_signature": "RedisCache.get(String key)", "testcase": false, "constructor": false}, {"identifier": "set", "parameters": "(String key, byte[] value)", "modifiers": "public", "return": "void", "signature": "void set(String key, byte[] value)", "full_signature": "public void set(String key, byte[] value)", "class_method_signature": "RedisCache.set(String key, byte[] value)", "testcase": false, "constructor": false}, {"identifier": "set", "parameters": "(String key, byte[] value, int expireIn)", "modifiers": "public", "return": "void", "signature": "void set(String key, byte[] value, int expireIn)", "full_signature": "public void set(String key, byte[] value, int expireIn)", "class_method_signature": "RedisCache.set(String key, byte[] value, int expireIn)", "testcase": false, "constructor": false}, {"identifier": "delete", "parameters": "(String key)", "modifiers": "public", "return": "void", "signature": "void delete(String key)", "full_signature": "public void delete(String key)", "class_method_signature": "RedisCache.delete(String key)", "testcase": false, "constructor": false}, {"identifier": "acquireLock", "parameters": "(String lockName)", "modifiers": "public", "return": "Lock", "signature": "Lock acquireLock(String lockName)", "full_signature": "public Lock acquireLock(String lockName)", "class_method_signature": "RedisCache.acquireLock(String lockName)", "testcase": false, "constructor": false}, {"identifier": "checkConnection", "parameters": "()", "modifiers": "@Override public", "return": "CheckResult", "signature": "CheckResult checkConnection()", "full_signature": "@Override public CheckResult checkConnection()", "class_method_signature": "RedisCache.checkConnection()", "testcase": false, "constructor": false}], "file": "code/extensions/caching/redis/src/main/java/com/google/cloud/broker/caching/remote/RedisCache.java"}, "focal_method": {"identifier": "acquireLock", "parameters": "(String lockName)", "modifiers": "public", "return": "Lock", "body": "public Lock acquireLock(String lockName) {\n        RLock lock = getClient().getLock(lockName);\n        lock.lock();\n        return lock;\n    }", "signature": "Lock acquireLock(String lockName)", "full_signature": "public Lock acquireLock(String lockName)", "class_method_signature": "RedisCache.acquireLock(String lockName)", "testcase": false, "constructor": false, "invocations": ["getLock", "getClient", "lock"]}, "repository": {"repo_id": 176837289, "url": "https://github.com/GoogleCloudPlatform/gcp-token-broker", "language": "Java", "is_fork": false, "fork_count": 25, "stargazer_count": 27, "size": 1700, "license": "licensed"}}