{"test_class": {"identifier": "JDBCBranchQueriesTest", "superclass": "extends PostgresTestCase", "interfaces": "", "fields": [{"original_string": "private DeveloperQueries developerQueries;", "modifier": "private", "type": "DeveloperQueries", "declarator": "developerQueries", "var_name": "developerQueries"}, {"original_string": "private ProjectQueries projectQueries;", "modifier": "private", "type": "ProjectQueries", "declarator": "projectQueries", "var_name": "projectQueries"}, {"original_string": "private BranchQueries queries;", "modifier": "private", "type": "BranchQueries", "declarator": "queries", "var_name": "queries"}, {"original_string": "private int projectId;", "modifier": "private", "type": "int", "declarator": "projectId", "var_name": "projectId"}, {"original_string": "private String mainDev;", "modifier": "private", "type": "String", "declarator": "mainDev", "var_name": "mainDev"}, {"original_string": "private SmellQueries smellQueries;", "modifier": "private", "type": "SmellQueries", "declarator": "smellQueries", "var_name": "smellQueries"}, {"original_string": "private CommitQueries commitQueries;", "modifier": "private", "type": "CommitQueries", "declarator": "commitQueries", "var_name": "commitQueries"}, {"original_string": "private Commit originCommit;", "modifier": "private", "type": "Commit", "declarator": "originCommit", "var_name": "originCommit"}, {"original_string": "private Commit mergedIntoCommit;", "modifier": "private", "type": "Commit", "declarator": "mergedIntoCommit", "var_name": "mergedIntoCommit"}, {"original_string": "private int mergedIntoCommitId;", "modifier": "private", "type": "int", "declarator": "mergedIntoCommitId", "var_name": "mergedIntoCommitId"}, {"original_string": "private int originCommitId;", "modifier": "private", "type": "int", "declarator": "originCommitId", "var_name": "originCommitId"}], "file": "SmellTracker/src/test/java/fr/inria/sniffer/tracker/analysis/persistence/queries/JDBCBranchQueriesTest.java"}, "test_case": {"identifier": "testBranchCommitInsertionQuery", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testBranchCommitInsertionQuery() {\n        long count = 0;\n\n        executeSuccess(queries.branchInsertionStatement(projectId, 0, originCommit, mergedIntoCommit));\n\n        // We can't call on not existing branch\n        executeFailure(queries.branchCommitInsertionQuery(projectId, 1, \"sha\", 1));\n        assertEquals(count, getBranchCommitCount());\n\n        // We can't call on not existing commit\n        executeFailure(queries.branchCommitInsertionQuery(projectId, 0, \"sha\", 1));\n        assertEquals(count, getBranchCommitCount());\n\n        // We can insert a commit in a branch\n        Commit branchCommit = prepareCommit(\"sha\", 0);\n        Commit anotherCommit = prepareCommit(\"another\", 4);\n        executeSuccess(queries.branchCommitInsertionQuery(projectId, 0, branchCommit.sha, 1));\n        assertEquals(++count, getBranchCommitCount());\n        executeSuccess(queries.branchCommitInsertionQuery(projectId, 0, anotherCommit.sha, 2));\n        assertEquals(++count, getBranchCommitCount());\n\n        // We can insert the same commit in another branch\n        executeSuccess(queries.branchInsertionStatement(projectId, 1, originCommit, mergedIntoCommit));\n        executeSuccess(queries.branchCommitInsertionQuery(projectId, 1, branchCommit.sha, 1));\n        assertEquals(++count, getBranchCommitCount());\n        executeSuccess(queries.branchCommitInsertionQuery(projectId, 1, anotherCommit.sha, 4));\n        assertEquals(++count, getBranchCommitCount());\n\n        // We can insert the same branch ordinal in another project\n        int secondProjectID = createProject(\"anotherProject\", projectQueries);\n        executeSuccess(commitQueries.commitInsertionStatement(secondProjectID, originCommit, GitDiff.EMPTY));\n        executeSuccess(commitQueries.commitInsertionStatement(secondProjectID, mergedIntoCommit, GitDiff.EMPTY));\n        executeSuccess(commitQueries.commitInsertionStatement(secondProjectID, branchCommit, GitDiff.EMPTY));\n        executeSuccess(commitQueries.commitInsertionStatement(secondProjectID, anotherCommit, GitDiff.EMPTY));\n        executeSuccess(queries.branchInsertionStatement(secondProjectID, 0, originCommit, mergedIntoCommit));\n        executeSuccess(queries.branchCommitInsertionQuery(secondProjectID, 0, branchCommit.sha, 1));\n        assertEquals(++count, getBranchCommitCount());\n        executeSuccess(queries.branchCommitInsertionQuery(secondProjectID, 0, anotherCommit.sha, 3));\n        assertEquals(++count, getBranchCommitCount());\n\n        // We can't insert the same ordinal, whichever the commit\n        executeNothinhDone(queries.branchCommitInsertionQuery(projectId, 0, branchCommit.sha, 1));\n        assertEquals(count, getBranchCommitCount());\n        executeNothinhDone(queries.branchCommitInsertionQuery(projectId, 0, anotherCommit.sha, 2));\n        assertEquals(count, getBranchCommitCount());\n\n        // We can't insert the same commit, whichever the ordinal\n        executeNothinhDone(queries.branchCommitInsertionQuery(projectId, 0, anotherCommit.sha, 1));\n        assertEquals(count, getBranchCommitCount());\n        executeNothinhDone(queries.branchCommitInsertionQuery(projectId, 0, branchCommit.sha, 2));\n        assertEquals(count, getBranchCommitCount());\n        executeNothinhDone(queries.branchCommitInsertionQuery(projectId, 0, anotherCommit.sha, 45));\n        assertEquals(count, getBranchCommitCount());\n        executeNothinhDone(queries.branchCommitInsertionQuery(projectId, 0, branchCommit.sha, 27));\n        assertEquals(count, getBranchCommitCount());\n    }", "signature": "void testBranchCommitInsertionQuery()", "full_signature": "@Test public void testBranchCommitInsertionQuery()", "class_method_signature": "JDBCBranchQueriesTest.testBranchCommitInsertionQuery()", "testcase": true, "constructor": false, "invocations": ["executeSuccess", "branchInsertionStatement", "executeFailure", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "executeFailure", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "prepareCommit", "prepareCommit", "executeSuccess", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "executeSuccess", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "executeSuccess", "branchInsertionStatement", "executeSuccess", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "executeSuccess", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "createProject", "executeSuccess", "commitInsertionStatement", "executeSuccess", "commitInsertionStatement", "executeSuccess", "commitInsertionStatement", "executeSuccess", "commitInsertionStatement", "executeSuccess", "branchInsertionStatement", "executeSuccess", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "executeSuccess", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "executeNothinhDone", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "executeNothinhDone", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "executeNothinhDone", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "executeNothinhDone", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "executeNothinhDone", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount", "executeNothinhDone", "branchCommitInsertionQuery", "assertEquals", "getBranchCommitCount"]}, "focal_class": {"identifier": "JDBCBranchQueries", "superclass": "extends JDBCQueriesHelper", "interfaces": "implements BranchQueries", "fields": [{"original_string": "private CommitQueries commitQueries;", "modifier": "private", "type": "CommitQueries", "declarator": "commitQueries", "var_name": "commitQueries"}, {"original_string": "private SmellQueries smellQueries;", "modifier": "private", "type": "SmellQueries", "declarator": "smellQueries", "var_name": "smellQueries"}], "methods": [{"identifier": "JDBCBranchQueries", "parameters": "(CommitQueries commitQueries, SmellQueries smellQueries)", "modifiers": "public", "return": "", "signature": " JDBCBranchQueries(CommitQueries commitQueries, SmellQueries smellQueries)", "full_signature": "public  JDBCBranchQueries(CommitQueries commitQueries, SmellQueries smellQueries)", "class_method_signature": "JDBCBranchQueries.JDBCBranchQueries(CommitQueries commitQueries, SmellQueries smellQueries)", "testcase": false, "constructor": true}, {"identifier": "branchInsertionStatement", "parameters": "(int projectId, int ordinal, Commit parentCommit, Commit mergedInto)", "modifiers": "@Override public", "return": "String", "signature": "String branchInsertionStatement(int projectId, int ordinal, Commit parentCommit, Commit mergedInto)", "full_signature": "@Override public String branchInsertionStatement(int projectId, int ordinal, Commit parentCommit, Commit mergedInto)", "class_method_signature": "JDBCBranchQueries.branchInsertionStatement(int projectId, int ordinal, Commit parentCommit, Commit mergedInto)", "testcase": false, "constructor": false}, {"identifier": "branchCommitInsertionQuery", "parameters": "(int projectId, int branchOrdinal, String commitSha, int ordinal)", "modifiers": "@Override public", "return": "String", "signature": "String branchCommitInsertionQuery(int projectId, int branchOrdinal, String commitSha, int ordinal)", "full_signature": "@Override public String branchCommitInsertionQuery(int projectId, int branchOrdinal, String commitSha, int ordinal)", "class_method_signature": "JDBCBranchQueries.branchCommitInsertionQuery(int projectId, int branchOrdinal, String commitSha, int ordinal)", "testcase": false, "constructor": false}, {"identifier": "idFromOrdinalQueryStatement", "parameters": "(int projectId, int branchOrdinal)", "modifiers": "@Override public", "return": "String", "signature": "String idFromOrdinalQueryStatement(int projectId, int branchOrdinal)", "full_signature": "@Override public String idFromOrdinalQueryStatement(int projectId, int branchOrdinal)", "class_method_signature": "JDBCBranchQueries.idFromOrdinalQueryStatement(int projectId, int branchOrdinal)", "testcase": false, "constructor": false}, {"identifier": "idFromCommitQueryStatement", "parameters": "(int projectId, Commit commit)", "modifiers": "public", "return": "String", "signature": "String idFromCommitQueryStatement(int projectId, Commit commit)", "full_signature": "public String idFromCommitQueryStatement(int projectId, Commit commit)", "class_method_signature": "JDBCBranchQueries.idFromCommitQueryStatement(int projectId, Commit commit)", "testcase": false, "constructor": false}, {"identifier": "parentCommitSmellsQuery", "parameters": "(int projectId, int branchId, String smellType)", "modifiers": "@Override public", "return": "String", "signature": "String parentCommitSmellsQuery(int projectId, int branchId, String smellType)", "full_signature": "@Override public String parentCommitSmellsQuery(int projectId, int branchId, String smellType)", "class_method_signature": "JDBCBranchQueries.parentCommitSmellsQuery(int projectId, int branchId, String smellType)", "testcase": false, "constructor": false}, {"identifier": "lastCommitSmellsQuery", "parameters": "(int projectId, Commit merge, String smellType)", "modifiers": "@Override public", "return": "String", "signature": "String lastCommitSmellsQuery(int projectId, Commit merge, String smellType)", "full_signature": "@Override public String lastCommitSmellsQuery(int projectId, Commit merge, String smellType)", "class_method_signature": "JDBCBranchQueries.lastCommitSmellsQuery(int projectId, Commit merge, String smellType)", "testcase": false, "constructor": false}, {"identifier": "mergedBranchIdQuery", "parameters": "(int projectId, Commit commit)", "modifiers": "@Override public", "return": "String", "signature": "String mergedBranchIdQuery(int projectId, Commit commit)", "full_signature": "@Override public String mergedBranchIdQuery(int projectId, Commit commit)", "class_method_signature": "JDBCBranchQueries.mergedBranchIdQuery(int projectId, Commit commit)", "testcase": false, "constructor": false}, {"identifier": "shaFromOrdinalQuery", "parameters": "(int projectId, int branchId, int ordinal)", "modifiers": "@Override public", "return": "String", "signature": "String shaFromOrdinalQuery(int projectId, int branchId, int ordinal)", "full_signature": "@Override public String shaFromOrdinalQuery(int projectId, int branchId, int ordinal)", "class_method_signature": "JDBCBranchQueries.shaFromOrdinalQuery(int projectId, int branchId, int ordinal)", "testcase": false, "constructor": false}, {"identifier": "shaFromOrdinalQuery", "parameters": "(int projectId, int branchId, int ordinal, boolean paprikaOnly)", "modifiers": "@Override public", "return": "String", "signature": "String shaFromOrdinalQuery(int projectId, int branchId, int ordinal, boolean paprikaOnly)", "full_signature": "@Override public String shaFromOrdinalQuery(int projectId, int branchId, int ordinal, boolean paprikaOnly)", "class_method_signature": "JDBCBranchQueries.shaFromOrdinalQuery(int projectId, int branchId, int ordinal, boolean paprikaOnly)", "testcase": false, "constructor": false}, {"identifier": "parentCommitIdQuery", "parameters": "(int projectId, int branchId)", "modifiers": "@Override public", "return": "String", "signature": "String parentCommitIdQuery(int projectId, int branchId)", "full_signature": "@Override public String parentCommitIdQuery(int projectId, int branchId)", "class_method_signature": "JDBCBranchQueries.parentCommitIdQuery(int projectId, int branchId)", "testcase": false, "constructor": false}, {"identifier": "parentCommitShaQuery", "parameters": "(int projectId, int branchId)", "modifiers": "@Override public", "return": "String", "signature": "String parentCommitShaQuery(int projectId, int branchId)", "full_signature": "@Override public String parentCommitShaQuery(int projectId, int branchId)", "class_method_signature": "JDBCBranchQueries.parentCommitShaQuery(int projectId, int branchId)", "testcase": false, "constructor": false}, {"identifier": "lastCommitShaQuery", "parameters": "(int projectId, int branchId)", "modifiers": "@Override public", "return": "String", "signature": "String lastCommitShaQuery(int projectId, int branchId)", "full_signature": "@Override public String lastCommitShaQuery(int projectId, int branchId)", "class_method_signature": "JDBCBranchQueries.lastCommitShaQuery(int projectId, int branchId)", "testcase": false, "constructor": false}, {"identifier": "lastCommitIdQuery", "parameters": "(int projectId, int branchId)", "modifiers": "@Override public", "return": "String", "signature": "String lastCommitIdQuery(int projectId, int branchId)", "full_signature": "@Override public String lastCommitIdQuery(int projectId, int branchId)", "class_method_signature": "JDBCBranchQueries.lastCommitIdQuery(int projectId, int branchId)", "testcase": false, "constructor": false}, {"identifier": "commitOrdinalQuery", "parameters": "(int projectId, int branchId, Commit commit)", "modifiers": "@Override public", "return": "String", "signature": "String commitOrdinalQuery(int projectId, int branchId, Commit commit)", "full_signature": "@Override public String commitOrdinalQuery(int projectId, int branchId, Commit commit)", "class_method_signature": "JDBCBranchQueries.commitOrdinalQuery(int projectId, int branchId, Commit commit)", "testcase": false, "constructor": false}, {"identifier": "branchLastCommitQuery", "parameters": "(int projectId, int branchId, String field)", "modifiers": "private", "return": "String", "signature": "String branchLastCommitQuery(int projectId, int branchId, String field)", "full_signature": "private String branchLastCommitQuery(int projectId, int branchId, String field)", "class_method_signature": "JDBCBranchQueries.branchLastCommitQuery(int projectId, int branchId, String field)", "testcase": false, "constructor": false}, {"identifier": "branchLastCommitQuery", "parameters": "(int projectId, String branchId, String field)", "modifiers": "private", "return": "String", "signature": "String branchLastCommitQuery(int projectId, String branchId, String field)", "full_signature": "private String branchLastCommitQuery(int projectId, String branchId, String field)", "class_method_signature": "JDBCBranchQueries.branchLastCommitQuery(int projectId, String branchId, String field)", "testcase": false, "constructor": false}], "file": "SmellTracker/src/main/java/fr/inria/sniffer/tracker/analysis/persistence/queries/JDBCBranchQueries.java"}, "focal_method": {"identifier": "branchCommitInsertionQuery", "parameters": "(int projectId, int branchOrdinal, String commitSha, int ordinal)", "modifiers": "@Override public", "return": "String", "body": "@Override\n    public String branchCommitInsertionQuery(int projectId, int branchOrdinal, String commitSha, int ordinal) {\n        return \"INSERT INTO branch_commit (branch_id, commit_id, ordinal) VALUES (\" +\n                \"(\" + idFromOrdinalQueryStatement(projectId, branchOrdinal) + \"), \" +\n                \"(\" + commitQueries.idFromShaQuery(projectId, commitSha) + \"), \" + ordinal + \") ON CONFLICT DO NOTHING;\";\n    }", "signature": "String branchCommitInsertionQuery(int projectId, int branchOrdinal, String commitSha, int ordinal)", "full_signature": "@Override public String branchCommitInsertionQuery(int projectId, int branchOrdinal, String commitSha, int ordinal)", "class_method_signature": "JDBCBranchQueries.branchCommitInsertionQuery(int projectId, int branchOrdinal, String commitSha, int ordinal)", "testcase": false, "constructor": false, "invocations": ["idFromOrdinalQueryStatement", "idFromShaQuery"]}, "repository": {"repo_id": 175298978, "url": "https://github.com/HabchiSarra/Sniffer", "language": "Java", "is_fork": false, "fork_count": 2, "stargazer_count": 10, "size": 587, "license": "licensed"}}