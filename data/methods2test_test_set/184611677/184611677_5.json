{"test_class": {"identifier": "SmsServiceImplTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Autowired\n    private SmsService smsService;", "modifier": "@Autowired\n    private", "type": "SmsService", "declarator": "smsService", "var_name": "smsService"}], "file": "moved/system/system-service-impl/src/test/java/cn/iocoder/mall/admin/service/SmsServiceImplTest.java"}, "test_case": {"identifier": "batchSendTest", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void batchSendTest() {\n        String mobile = \"13302926050\";\n        Integer templateId = 7;\n        smsService.batchSend(Lists.newArrayList(mobile), templateId, ImmutableMap.of(\"code\", \"8888\"));\n    }", "signature": "void batchSendTest()", "full_signature": "@Test public void batchSendTest()", "class_method_signature": "SmsServiceImplTest.batchSendTest()", "testcase": true, "constructor": false, "invocations": ["batchSend", "newArrayList", "of"]}, "focal_class": {"identifier": "SmsServiceImpl", "superclass": "", "interfaces": "implements SmsService", "fields": [{"original_string": "@Autowired\n    private SmsSignMapper smsSignMapper;", "modifier": "@Autowired\n    private", "type": "SmsSignMapper", "declarator": "smsSignMapper", "var_name": "smsSignMapper"}, {"original_string": "@Autowired\n    private SmsTemplateMapper smsTemplateMapper;", "modifier": "@Autowired\n    private", "type": "SmsTemplateMapper", "declarator": "smsTemplateMapper", "var_name": "smsTemplateMapper"}, {"original_string": "@Autowired\n    private SmsSendMapper smsSendMapper;", "modifier": "@Autowired\n    private", "type": "SmsSendMapper", "declarator": "smsSendMapper", "var_name": "smsSendMapper"}, {"original_string": "@Autowired\n    @Qualifier(\"smsYunPianClient\")\n    private SmsClient smsYunPianClient;", "modifier": "@Autowired\n    @Qualifier(\"smsYunPianClient\")\n    private", "type": "SmsClient", "declarator": "smsYunPianClient", "var_name": "smsYunPianClient"}, {"original_string": "@Autowired\n    @Qualifier(\"smsAliYunClient\")\n    private SmsClient smsAliYunClient;", "modifier": "@Autowired\n    @Qualifier(\"smsAliYunClient\")\n    private", "type": "SmsClient", "declarator": "smsAliYunClient", "var_name": "smsAliYunClient"}], "methods": [{"identifier": "pageSmsSign", "parameters": "(PageQuerySmsSignDTO queryDTO)", "modifiers": "@Override public", "return": "PageSmsSignBO", "signature": "PageSmsSignBO pageSmsSign(PageQuerySmsSignDTO queryDTO)", "full_signature": "@Override public PageSmsSignBO pageSmsSign(PageQuerySmsSignDTO queryDTO)", "class_method_signature": "SmsServiceImpl.pageSmsSign(PageQuerySmsSignDTO queryDTO)", "testcase": false, "constructor": false}, {"identifier": "pageSmsTemplate", "parameters": "(PageQuerySmsTemplateDTO queryDTO)", "modifiers": "@Override public", "return": "PageSmsTemplateBO", "signature": "PageSmsTemplateBO pageSmsTemplate(PageQuerySmsTemplateDTO queryDTO)", "full_signature": "@Override public PageSmsTemplateBO pageSmsTemplate(PageQuerySmsTemplateDTO queryDTO)", "class_method_signature": "SmsServiceImpl.pageSmsTemplate(PageQuerySmsTemplateDTO queryDTO)", "testcase": false, "constructor": false}, {"identifier": "addSign", "parameters": "(String sign, Integer platform)", "modifiers": "@Override @Transactional public", "return": "void", "signature": "void addSign(String sign, Integer platform)", "full_signature": "@Override @Transactional public void addSign(String sign, Integer platform)", "class_method_signature": "SmsServiceImpl.addSign(String sign, Integer platform)", "testcase": false, "constructor": false}, {"identifier": "getSign", "parameters": "(Integer signId)", "modifiers": "@Override public", "return": "SmsSignBO", "signature": "SmsSignBO getSign(Integer signId)", "full_signature": "@Override public SmsSignBO getSign(Integer signId)", "class_method_signature": "SmsServiceImpl.getSign(Integer signId)", "testcase": false, "constructor": false}, {"identifier": "updateSign", "parameters": "(Integer id, String newSign, Integer platform)", "modifiers": "@Override @Transactional public", "return": "void", "signature": "void updateSign(Integer id, String newSign, Integer platform)", "full_signature": "@Override @Transactional public void updateSign(Integer id, String newSign, Integer platform)", "class_method_signature": "SmsServiceImpl.updateSign(Integer id, String newSign, Integer platform)", "testcase": false, "constructor": false}, {"identifier": "deleteSign", "parameters": "(Integer id)", "modifiers": "@Override public", "return": "void", "signature": "void deleteSign(Integer id)", "full_signature": "@Override public void deleteSign(Integer id)", "class_method_signature": "SmsServiceImpl.deleteSign(Integer id)", "testcase": false, "constructor": false}, {"identifier": "addTemplate", "parameters": "(Integer smsSignId, String templateCode,\n                            String template, Integer platform, Integer smsType)", "modifiers": "@Override @Transactional public", "return": "void", "signature": "void addTemplate(Integer smsSignId, String templateCode,\n                            String template, Integer platform, Integer smsType)", "full_signature": "@Override @Transactional public void addTemplate(Integer smsSignId, String templateCode,\n                            String template, Integer platform, Integer smsType)", "class_method_signature": "SmsServiceImpl.addTemplate(Integer smsSignId, String templateCode,\n                            String template, Integer platform, Integer smsType)", "testcase": false, "constructor": false}, {"identifier": "getTemplate", "parameters": "(Integer id, Integer platform)", "modifiers": "@Override public", "return": "SmsTemplateBO", "signature": "SmsTemplateBO getTemplate(Integer id, Integer platform)", "full_signature": "@Override public SmsTemplateBO getTemplate(Integer id, Integer platform)", "class_method_signature": "SmsServiceImpl.getTemplate(Integer id, Integer platform)", "testcase": false, "constructor": false}, {"identifier": "updateTemplate", "parameters": "(Integer id, Integer smsSignId, String templateCode,\n                               String template, Integer platform, Integer smsType)", "modifiers": "@Override @Transactional public", "return": "void", "signature": "void updateTemplate(Integer id, Integer smsSignId, String templateCode,\n                               String template, Integer platform, Integer smsType)", "full_signature": "@Override @Transactional public void updateTemplate(Integer id, Integer smsSignId, String templateCode,\n                               String template, Integer platform, Integer smsType)", "class_method_signature": "SmsServiceImpl.updateTemplate(Integer id, Integer smsSignId, String templateCode,\n                               String template, Integer platform, Integer smsType)", "testcase": false, "constructor": false}, {"identifier": "deleteTemplate", "parameters": "(Integer id)", "modifiers": "@Override @Transactional public", "return": "void", "signature": "void deleteTemplate(Integer id)", "full_signature": "@Override @Transactional public void deleteTemplate(Integer id)", "class_method_signature": "SmsServiceImpl.deleteTemplate(Integer id)", "testcase": false, "constructor": false}, {"identifier": "singleSend", "parameters": "(String mobile, Integer smsTemplateId, Map<String, String> params)", "modifiers": "@Override public", "return": "void", "signature": "void singleSend(String mobile, Integer smsTemplateId, Map<String, String> params)", "full_signature": "@Override public void singleSend(String mobile, Integer smsTemplateId, Map<String, String> params)", "class_method_signature": "SmsServiceImpl.singleSend(String mobile, Integer smsTemplateId, Map<String, String> params)", "testcase": false, "constructor": false}, {"identifier": "batchSend", "parameters": "(List<String> mobileList, Integer smsTemplateId, Map<String, String> params)", "modifiers": "@Override public", "return": "void", "signature": "void batchSend(List<String> mobileList, Integer smsTemplateId, Map<String, String> params)", "full_signature": "@Override public void batchSend(List<String> mobileList, Integer smsTemplateId, Map<String, String> params)", "class_method_signature": "SmsServiceImpl.batchSend(List<String> mobileList, Integer smsTemplateId, Map<String, String> params)", "testcase": false, "constructor": false}, {"identifier": "getSmsClient", "parameters": "(Integer platform)", "modifiers": "private", "return": "SmsClient", "signature": "SmsClient getSmsClient(Integer platform)", "full_signature": "private SmsClient getSmsClient(Integer platform)", "class_method_signature": "SmsServiceImpl.getSmsClient(Integer platform)", "testcase": false, "constructor": false}], "file": "moved/system/system-service-impl/src/main/java/cn/iocoder/mall/admin/service/SmsServiceImpl.java"}, "focal_method": {"identifier": "batchSend", "parameters": "(List<String> mobileList, Integer smsTemplateId, Map<String, String> params)", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void batchSend(List<String> mobileList, Integer smsTemplateId, Map<String, String> params) {\n        SmsTemplateDO smsTemplateDO = smsTemplateMapper.selectOne(\n                new QueryWrapper<SmsTemplateDO>().eq(\"id\", smsTemplateId));\n\n        if (smsTemplateDO == null\n                || smsTemplateDO.getDeleted().equals(DeletedStatusEnum.DELETED_YES.getValue())) {\n            throw new ServiceException(AdminErrorCodeEnum.SMS_TEMPLATE_NOT_EXISTENT.getCode(),\n                    AdminErrorCodeEnum.SMS_TEMPLATE_NOT_EXISTENT.getMessage());\n        }\n\n        SmsSignDO smsSignDO = smsSignMapper.selectOne(\n                new QueryWrapper<SmsSignDO>().eq(\"id\", smsTemplateDO.getSmsSignId()));\n\n        if (smsSignDO == null) {\n            // \u6dfb\u52a0\u65e5\u5fd7\n            smsSendMapper.insert(\n                    (SmsSendLogDO) new SmsSendLogDO()\n                            .setTemplateId(smsTemplateDO.getId())\n                            .setTemplate(smsTemplateDO.getTemplate())\n                            .setMessage(\"\u53d1\u9001\u6210\u529f!\")\n                            .setCreateTime(new Date())\n            );\n\n            throw new ServiceException(AdminErrorCodeEnum.SMS_SIGN_NOT_EXISTENT.getCode(),\n                    AdminErrorCodeEnum.SMS_SIGN_NOT_EXISTENT.getMessage());\n        }\n\n        // \u83b7\u53d6 client\n        SmsClient smsClient = getSmsClient(smsTemplateDO.getPlatform());\n\n        // \u53d1\u9001\u77ed\u4fe1\n        SmsClient.SendResult sendResult = smsClient.batchSend(mobileList, smsSignDO.getSign(),\n                smsTemplateDO.getTemplateCode(), smsTemplateDO.getTemplate(), params);\n\n        // \u6dfb\u52a0\u65e5\u5fd7\n        smsSendMapper.insert(\n                (SmsSendLogDO) new SmsSendLogDO()\n                        .setTemplateId(smsTemplateDO.getId())\n                        .setTemplate(smsTemplateDO.getTemplate())\n                        .setMessage(sendResult.getMessage())\n                        .setCreateTime(new Date())\n        );\n    }", "signature": "void batchSend(List<String> mobileList, Integer smsTemplateId, Map<String, String> params)", "full_signature": "@Override public void batchSend(List<String> mobileList, Integer smsTemplateId, Map<String, String> params)", "class_method_signature": "SmsServiceImpl.batchSend(List<String> mobileList, Integer smsTemplateId, Map<String, String> params)", "testcase": false, "constructor": false, "invocations": ["selectOne", "eq", "equals", "getDeleted", "getValue", "getCode", "getMessage", "selectOne", "eq", "getSmsSignId", "insert", "setCreateTime", "setMessage", "setTemplate", "setTemplateId", "getId", "getTemplate", "getCode", "getMessage", "getSmsClient", "getPlatform", "batchSend", "getSign", "getTemplateCode", "getTemplate", "insert", "setCreateTime", "setMessage", "setTemplate", "setTemplateId", "getId", "getTemplate", "getMessage"]}, "repository": {"repo_id": 184611677, "url": "https://github.com/YunaiV/onemall", "language": "Java", "is_fork": false, "fork_count": 1162, "stargazer_count": 2893, "size": 7986, "license": "licensed"}}