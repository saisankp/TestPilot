{"test_class": {"identifier": "AwsClientFactoryTest", "superclass": "extends AbstractDaoTest", "interfaces": "", "fields": [{"original_string": "@Autowired\n    private AwsClientFactory awsClientFactory;", "modifier": "@Autowired\n    private", "type": "AwsClientFactory", "declarator": "awsClientFactory", "var_name": "awsClientFactory"}, {"original_string": "@Autowired\n    private CacheManager cacheManager;", "modifier": "@Autowired\n    private", "type": "CacheManager", "declarator": "cacheManager", "var_name": "cacheManager"}], "file": "herd-code/herd-dao/src/test/java/org/finra/herd/dao/AwsClientFactoryTest.java"}, "test_case": {"identifier": "testGetEmrClientCacheHitMiss", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testGetEmrClientCacheHitMiss()\n    {\n        // Create an AWS parameters DTO that contains both AWS credentials and proxy information.\n        AwsParamsDto awsParamsDto =\n            new AwsParamsDto(AWS_ASSUMED_ROLE_ACCESS_KEY, AWS_ASSUMED_ROLE_SECRET_KEY, AWS_ASSUMED_ROLE_SESSION_TOKEN, HTTP_PROXY_HOST, HTTP_PROXY_PORT,\n                AWS_REGION_NAME_US_EAST_1);\n\n        // Get an Amazon EMR client.\n        AmazonElasticMapReduce amazonElasticMapReduceClient = awsClientFactory.getEmrClient(awsParamsDto);\n\n        // Confirm a cache hit.\n        assertEquals(amazonElasticMapReduceClient, awsClientFactory.getEmrClient(\n            new AwsParamsDto(AWS_ASSUMED_ROLE_ACCESS_KEY, AWS_ASSUMED_ROLE_SECRET_KEY, AWS_ASSUMED_ROLE_SESSION_TOKEN, HTTP_PROXY_HOST, HTTP_PROXY_PORT,\n                AWS_REGION_NAME_US_EAST_1)));\n\n        // Confirm a cache miss due to AWS credentials.\n        assertNotEquals(amazonElasticMapReduceClient, awsClientFactory.getEmrClient(\n            new AwsParamsDto(AWS_ASSUMED_ROLE_ACCESS_KEY_2, AWS_ASSUMED_ROLE_SECRET_KEY_2, AWS_ASSUMED_ROLE_SESSION_TOKEN_2, HTTP_PROXY_HOST, HTTP_PROXY_PORT,\n                AWS_REGION_NAME_US_EAST_1)));\n\n        // Confirm a cache miss due to http proxy information.\n        assertNotEquals(amazonElasticMapReduceClient, awsClientFactory.getEmrClient(\n            new AwsParamsDto(AWS_ASSUMED_ROLE_ACCESS_KEY, AWS_ASSUMED_ROLE_SECRET_KEY, AWS_ASSUMED_ROLE_SESSION_TOKEN, HTTP_PROXY_HOST_2, HTTP_PROXY_PORT_2,\n                AWS_REGION_NAME_US_EAST_1)));\n\n        // Clear the cache.\n        cacheManager.getCache(DaoSpringModuleConfig.HERD_CACHE_NAME).clear();\n\n        // Confirm a cache miss due to cleared cache.\n        assertNotEquals(amazonElasticMapReduceClient, awsClientFactory.getEmrClient(awsParamsDto));\n    }", "signature": "void testGetEmrClientCacheHitMiss()", "full_signature": "@Test public void testGetEmrClientCacheHitMiss()", "class_method_signature": "AwsClientFactoryTest.testGetEmrClientCacheHitMiss()", "testcase": true, "constructor": false, "invocations": ["getEmrClient", "assertEquals", "getEmrClient", "assertNotEquals", "getEmrClient", "assertNotEquals", "getEmrClient", "clear", "getCache", "assertNotEquals", "getEmrClient"]}, "focal_class": {"identifier": "AwsClientFactory", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Autowired\n    private AwsHelper awsHelper;", "modifier": "@Autowired\n    private", "type": "AwsHelper", "declarator": "awsHelper", "var_name": "awsHelper"}], "methods": [{"identifier": "getAmazonSNSClient", "parameters": "(AwsParamsDto awsParamsDto)", "modifiers": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public", "return": "AmazonSNS", "signature": "AmazonSNS getAmazonSNSClient(AwsParamsDto awsParamsDto)", "full_signature": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public AmazonSNS getAmazonSNSClient(AwsParamsDto awsParamsDto)", "class_method_signature": "AwsClientFactory.getAmazonSNSClient(AwsParamsDto awsParamsDto)", "testcase": false, "constructor": false}, {"identifier": "getAmazonSQSClient", "parameters": "(AwsParamsDto awsParamsDto)", "modifiers": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public", "return": "AmazonSQS", "signature": "AmazonSQS getAmazonSQSClient(AwsParamsDto awsParamsDto)", "full_signature": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public AmazonSQS getAmazonSQSClient(AwsParamsDto awsParamsDto)", "class_method_signature": "AwsClientFactory.getAmazonSQSClient(AwsParamsDto awsParamsDto)", "testcase": false, "constructor": false}, {"identifier": "getEc2Client", "parameters": "(AwsParamsDto awsParamsDto)", "modifiers": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public", "return": "AmazonEC2", "signature": "AmazonEC2 getEc2Client(AwsParamsDto awsParamsDto)", "full_signature": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public AmazonEC2 getEc2Client(AwsParamsDto awsParamsDto)", "class_method_signature": "AwsClientFactory.getEc2Client(AwsParamsDto awsParamsDto)", "testcase": false, "constructor": false}, {"identifier": "getEmrClient", "parameters": "(AwsParamsDto awsParamsDto)", "modifiers": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public", "return": "AmazonElasticMapReduce", "signature": "AmazonElasticMapReduce getEmrClient(AwsParamsDto awsParamsDto)", "full_signature": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public AmazonElasticMapReduce getEmrClient(AwsParamsDto awsParamsDto)", "class_method_signature": "AwsClientFactory.getEmrClient(AwsParamsDto awsParamsDto)", "testcase": false, "constructor": false}, {"identifier": "getSesClient", "parameters": "(AwsParamsDto awsParamsDto)", "modifiers": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public", "return": "AmazonSimpleEmailService", "signature": "AmazonSimpleEmailService getSesClient(AwsParamsDto awsParamsDto)", "full_signature": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public AmazonSimpleEmailService getSesClient(AwsParamsDto awsParamsDto)", "class_method_signature": "AwsClientFactory.getSesClient(AwsParamsDto awsParamsDto)", "testcase": false, "constructor": false}], "file": "herd-code/herd-dao/src/main/java/org/finra/herd/dao/AwsClientFactory.java"}, "focal_method": {"identifier": "getEmrClient", "parameters": "(AwsParamsDto awsParamsDto)", "modifiers": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public", "return": "AmazonElasticMapReduce", "body": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME)\n    public AmazonElasticMapReduce getEmrClient(AwsParamsDto awsParamsDto)\n    {\n        // Get client configuration.\n        ClientConfiguration clientConfiguration = awsHelper.getClientConfiguration(awsParamsDto);\n\n        // If specified, use the AWS credentials passed in.\n        if (StringUtils.isNotBlank(awsParamsDto.getAwsAccessKeyId()))\n        {\n            return AmazonElasticMapReduceClientBuilder.standard().withCredentials(new AWSStaticCredentialsProvider(\n                new BasicSessionCredentials(awsParamsDto.getAwsAccessKeyId(), awsParamsDto.getAwsSecretKey(), awsParamsDto.getSessionToken())))\n                .withClientConfiguration(clientConfiguration).withRegion(awsParamsDto.getAwsRegionName()).build();\n        }\n        // Otherwise, use the default AWS credentials provider chain.\n        else\n        {\n            return AmazonElasticMapReduceClientBuilder.standard().withClientConfiguration(clientConfiguration).withRegion(awsParamsDto.getAwsRegionName())\n                .build();\n        }\n    }", "signature": "AmazonElasticMapReduce getEmrClient(AwsParamsDto awsParamsDto)", "full_signature": "@Cacheable(DaoSpringModuleConfig.HERD_CACHE_NAME) public AmazonElasticMapReduce getEmrClient(AwsParamsDto awsParamsDto)", "class_method_signature": "AwsClientFactory.getEmrClient(AwsParamsDto awsParamsDto)", "testcase": false, "constructor": false, "invocations": ["getClientConfiguration", "isNotBlank", "getAwsAccessKeyId", "build", "withRegion", "withClientConfiguration", "withCredentials", "standard", "getAwsAccessKeyId", "getAwsSecretKey", "getSessionToken", "getAwsRegionName", "build", "withRegion", "withClientConfiguration", "standard", "getAwsRegionName"]}, "repository": {"repo_id": 42949039, "url": "https://github.com/FINRAOS/herd", "language": "Java", "is_fork": false, "fork_count": 36, "stargazer_count": 120, "size": 205797, "license": "licensed"}}