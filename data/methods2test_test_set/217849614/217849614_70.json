{"test_class": {"identifier": "PersistentManagerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private BloomFilterFactory factory;", "modifier": "private", "type": "BloomFilterFactory", "declarator": "factory", "var_name": "factory"}, {"original_string": "private Path tempDirPath;", "modifier": "private", "type": "Path", "declarator": "tempDirPath", "var_name": "tempDirPath"}, {"original_string": "private BloomFilterManager filterManager;", "modifier": "private", "type": "BloomFilterManager", "declarator": "filterManager", "var_name": "filterManager"}, {"original_string": "private PersistentManager<BloomFilter> manager;", "modifier": "private", "type": "PersistentManager<BloomFilter>", "declarator": "manager", "var_name": "manager"}], "file": "filter-service-core/src/test/java/cn/leancloud/filter/service/PersistentManagerTest.java"}, "test_case": {"identifier": "testNoFilesToRecover", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testNoFilesToRecover() throws IOException {\n        manager.recoverFilters(factory, true);\n        verify(filterManager, never()).addFilters(anyCollection());\n    }", "signature": "void testNoFilesToRecover()", "full_signature": "@Test public void testNoFilesToRecover()", "class_method_signature": "PersistentManagerTest.testNoFilesToRecover()", "testcase": true, "constructor": false, "invocations": ["recoverFilters", "addFilters", "verify", "never", "anyCollection"]}, "focal_class": {"identifier": "PersistentManager", "superclass": "", "interfaces": "implements Closeable", "fields": [{"original_string": "private static final Logger logger = LoggerFactory.getLogger(PersistentManager.class);", "modifier": "private static final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(PersistentManager.class)", "var_name": "logger"}, {"original_string": "private static final String LOCK_FILE_NAME = \"lock\";", "modifier": "private static final", "type": "String", "declarator": "LOCK_FILE_NAME = \"lock\"", "var_name": "LOCK_FILE_NAME"}, {"original_string": "private static final String TEMPORARY_PERSISTENT_FILE_SUFFIX = \".tmp\";", "modifier": "private static final", "type": "String", "declarator": "TEMPORARY_PERSISTENT_FILE_SUFFIX = \".tmp\"", "var_name": "TEMPORARY_PERSISTENT_FILE_SUFFIX"}, {"original_string": "private static final String PERSISTENT_FILE_SUFFIX = \".db\";", "modifier": "private static final", "type": "String", "declarator": "PERSISTENT_FILE_SUFFIX = \".db\"", "var_name": "PERSISTENT_FILE_SUFFIX"}, {"original_string": "private static final String PERSISTENT_FILE_NAME = \"snapshot\";", "modifier": "private static final", "type": "String", "declarator": "PERSISTENT_FILE_NAME = \"snapshot\"", "var_name": "PERSISTENT_FILE_NAME"}, {"original_string": "private final Path basePath;", "modifier": "private final", "type": "Path", "declarator": "basePath", "var_name": "basePath"}, {"original_string": "private final FileLock fileLock;", "modifier": "private final", "type": "FileLock", "declarator": "fileLock", "var_name": "fileLock"}], "methods": [{"identifier": "PersistentManager", "parameters": "(Path persistentPath)", "modifiers": "", "return": "", "signature": " PersistentManager(Path persistentPath)", "full_signature": "  PersistentManager(Path persistentPath)", "class_method_signature": "PersistentManager.PersistentManager(Path persistentPath)", "testcase": false, "constructor": true}, {"identifier": "freezeAllFilters", "parameters": "(Iterable<FilterRecord<F>> records)", "modifiers": "synchronized", "return": "void", "signature": "void freezeAllFilters(Iterable<FilterRecord<F>> records)", "full_signature": "synchronized void freezeAllFilters(Iterable<FilterRecord<F>> records)", "class_method_signature": "PersistentManager.freezeAllFilters(Iterable<FilterRecord<F>> records)", "testcase": false, "constructor": false}, {"identifier": "recoverFilters", "parameters": "(BloomFilterFactory<? extends F, ?> factory,\n                                                                boolean allowRecoverFromCorruptedFile)", "modifiers": "synchronized", "return": "List<FilterRecord<? extends F>>", "signature": "List<FilterRecord<? extends F>> recoverFilters(BloomFilterFactory<? extends F, ?> factory,\n                                                                boolean allowRecoverFromCorruptedFile)", "full_signature": "synchronized List<FilterRecord<? extends F>> recoverFilters(BloomFilterFactory<? extends F, ?> factory,\n                                                                boolean allowRecoverFromCorruptedFile)", "class_method_signature": "PersistentManager.recoverFilters(BloomFilterFactory<? extends F, ?> factory,\n                                                                boolean allowRecoverFromCorruptedFile)", "testcase": false, "constructor": false}, {"identifier": "close", "parameters": "()", "modifiers": "@Override public synchronized", "return": "void", "signature": "void close()", "full_signature": "@Override public synchronized void close()", "class_method_signature": "PersistentManager.close()", "testcase": false, "constructor": false}, {"identifier": "temporaryPersistentFilePath", "parameters": "()", "modifiers": "", "return": "Path", "signature": "Path temporaryPersistentFilePath()", "full_signature": " Path temporaryPersistentFilePath()", "class_method_signature": "PersistentManager.temporaryPersistentFilePath()", "testcase": false, "constructor": false}, {"identifier": "persistentFilePath", "parameters": "()", "modifiers": "", "return": "Path", "signature": "Path persistentFilePath()", "full_signature": " Path persistentFilePath()", "class_method_signature": "PersistentManager.persistentFilePath()", "testcase": false, "constructor": false}, {"identifier": "recoverFiltersFromFile", "parameters": "(BloomFilterFactory<? extends F, ?> factory,\n                                                                   boolean allowRecoverFromCorruptedFile,\n                                                                   Path filePath)", "modifiers": "private", "return": "List<FilterRecord<? extends F>>", "signature": "List<FilterRecord<? extends F>> recoverFiltersFromFile(BloomFilterFactory<? extends F, ?> factory,\n                                                                   boolean allowRecoverFromCorruptedFile,\n                                                                   Path filePath)", "full_signature": "private List<FilterRecord<? extends F>> recoverFiltersFromFile(BloomFilterFactory<? extends F, ?> factory,\n                                                                   boolean allowRecoverFromCorruptedFile,\n                                                                   Path filePath)", "class_method_signature": "PersistentManager.recoverFiltersFromFile(BloomFilterFactory<? extends F, ?> factory,\n                                                                   boolean allowRecoverFromCorruptedFile,\n                                                                   Path filePath)", "testcase": false, "constructor": false}, {"identifier": "readFiltersFromFile", "parameters": "(FilterRecordInputStream<? extends F> filterStream)", "modifiers": "private", "return": "Iterable<FilterRecord<? extends F>>", "signature": "Iterable<FilterRecord<? extends F>> readFiltersFromFile(FilterRecordInputStream<? extends F> filterStream)", "full_signature": "private Iterable<FilterRecord<? extends F>> readFiltersFromFile(FilterRecordInputStream<? extends F> filterStream)", "class_method_signature": "PersistentManager.readFiltersFromFile(FilterRecordInputStream<? extends F> filterStream)", "testcase": false, "constructor": false}], "file": "filter-service-core/src/main/java/cn/leancloud/filter/service/PersistentManager.java"}, "focal_method": {"identifier": "recoverFilters", "parameters": "(BloomFilterFactory<? extends F, ?> factory,\n                                                                boolean allowRecoverFromCorruptedFile)", "modifiers": "synchronized", "return": "List<FilterRecord<? extends F>>", "body": "synchronized List<FilterRecord<? extends F>> recoverFilters(BloomFilterFactory<? extends F, ?> factory,\n                                                                boolean allowRecoverFromCorruptedFile)\n            throws IOException {\n        final List<FilterRecord<? extends F>> records = new ArrayList<>();\n        if (persistentFilePath().toFile().exists()) {\n            records.addAll(recoverFiltersFromFile(factory, allowRecoverFromCorruptedFile, persistentFilePath()));\n        }\n\n        if (temporaryPersistentFilePath().toFile().exists()) {\n            try {\n                records.addAll(recoverFiltersFromFile(factory, allowRecoverFromCorruptedFile, temporaryPersistentFilePath()));\n            } catch (IOException | PersistentStorageException ex) {\n                logger.warn(\"Failed to recover from the file: \\\"{}\\\" and got error msg: \\\"{}\\\". We just ignore it and carry on.\",\n                        temporaryPersistentFilePath(), ex.getMessage());\n            }\n        }\n\n        return records;\n    }", "signature": "List<FilterRecord<? extends F>> recoverFilters(BloomFilterFactory<? extends F, ?> factory,\n                                                                boolean allowRecoverFromCorruptedFile)", "full_signature": "synchronized List<FilterRecord<? extends F>> recoverFilters(BloomFilterFactory<? extends F, ?> factory,\n                                                                boolean allowRecoverFromCorruptedFile)", "class_method_signature": "PersistentManager.recoverFilters(BloomFilterFactory<? extends F, ?> factory,\n                                                                boolean allowRecoverFromCorruptedFile)", "testcase": false, "constructor": false, "invocations": ["exists", "toFile", "persistentFilePath", "addAll", "recoverFiltersFromFile", "persistentFilePath", "exists", "toFile", "temporaryPersistentFilePath", "addAll", "recoverFiltersFromFile", "temporaryPersistentFilePath", "warn", "temporaryPersistentFilePath", "getMessage"]}, "repository": {"repo_id": 217849614, "url": "https://github.com/leancloud/filter-service", "language": "Java", "is_fork": false, "fork_count": 0, "stargazer_count": 14, "size": 2797, "license": "licensed"}}