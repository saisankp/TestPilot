{"test_class": {"identifier": "ApolloDynamicConfigurationTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String SESSION_TIMEOUT_KEY = \"session\";", "modifier": "private static final", "type": "String", "declarator": "SESSION_TIMEOUT_KEY = \"session\"", "var_name": "SESSION_TIMEOUT_KEY"}, {"original_string": "private static final String DEFAULT_NAMESPACE = \"dubbo\";", "modifier": "private static final", "type": "String", "declarator": "DEFAULT_NAMESPACE = \"dubbo\"", "var_name": "DEFAULT_NAMESPACE"}, {"original_string": "private static ApolloDynamicConfiguration apolloDynamicConfiguration;", "modifier": "private static", "type": "ApolloDynamicConfiguration", "declarator": "apolloDynamicConfiguration", "var_name": "apolloDynamicConfiguration"}, {"original_string": "private static URL url;", "modifier": "private static", "type": "URL", "declarator": "url", "var_name": "url"}, {"original_string": "@ClassRule\n    public static EmbeddedApollo embeddedApollo = new EmbeddedApollo();", "modifier": "@ClassRule\n    public static", "type": "EmbeddedApollo", "declarator": "embeddedApollo = new EmbeddedApollo()", "var_name": "embeddedApollo"}], "file": "dubbo-configcenter/dubbo-configcenter-apollo/src/test/java/org/apache/dubbo/configcenter/support/apollo/ApolloDynamicConfigurationTest.java"}, "test_case": {"identifier": "testAddListener", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testAddListener() throws Exception {\n        String mockKey = \"mockKey3\";\n        String mockValue = String.valueOf(new Random().nextInt());\n\n        final SettableFuture<org.apache.dubbo.common.config.configcenter.ConfigChangedEvent> future = SettableFuture.create();\n\n        apolloDynamicConfiguration = new ApolloDynamicConfiguration(url);\n\n        apolloDynamicConfiguration.addListener(mockKey, DEFAULT_NAMESPACE, new ConfigurationListener() {\n            @Override\n            public void process(org.apache.dubbo.common.config.configcenter.ConfigChangedEvent event) {\n                future.set(event);\n            }\n        });\n\n        putData(mockKey, mockValue);\n        org.apache.dubbo.common.config.configcenter.ConfigChangedEvent result = future.get(3000, TimeUnit.MILLISECONDS);\n        assertEquals(mockValue, result.getContent());\n        assertEquals(mockKey, result.getKey());\n        assertEquals(ConfigChangeType.MODIFIED, result.getChangeType());\n    }", "signature": "void testAddListener()", "full_signature": "@Test public void testAddListener()", "class_method_signature": "ApolloDynamicConfigurationTest.testAddListener()", "testcase": true, "constructor": false, "invocations": ["valueOf", "nextInt", "create", "addListener", "set", "putData", "get", "assertEquals", "getContent", "assertEquals", "getKey", "assertEquals", "getChangeType"]}, "focal_class": {"identifier": "ApolloDynamicConfiguration", "superclass": "", "interfaces": "implements DynamicConfiguration", "fields": [{"original_string": "private static final Logger logger = LoggerFactory.getLogger(ApolloDynamicConfiguration.class);", "modifier": "private static final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(ApolloDynamicConfiguration.class)", "var_name": "logger"}, {"original_string": "private static final String APOLLO_ENV_KEY = \"env\";", "modifier": "private static final", "type": "String", "declarator": "APOLLO_ENV_KEY = \"env\"", "var_name": "APOLLO_ENV_KEY"}, {"original_string": "private static final String APOLLO_ADDR_KEY = \"apollo.meta\";", "modifier": "private static final", "type": "String", "declarator": "APOLLO_ADDR_KEY = \"apollo.meta\"", "var_name": "APOLLO_ADDR_KEY"}, {"original_string": "private static final String APOLLO_CLUSTER_KEY = \"apollo.cluster\";", "modifier": "private static final", "type": "String", "declarator": "APOLLO_CLUSTER_KEY = \"apollo.cluster\"", "var_name": "APOLLO_CLUSTER_KEY"}, {"original_string": "private static final String APOLLO_PROTOCOL_PREFIX = \"http://\";", "modifier": "private static final", "type": "String", "declarator": "APOLLO_PROTOCOL_PREFIX = \"http://\"", "var_name": "APOLLO_PROTOCOL_PREFIX"}, {"original_string": "private static final String APOLLO_APPLICATION_KEY = \"application\";", "modifier": "private static final", "type": "String", "declarator": "APOLLO_APPLICATION_KEY = \"application\"", "var_name": "APOLLO_APPLICATION_KEY"}, {"original_string": "private static final String APOLLO_APPID_KEY = \"app.id\";", "modifier": "private static final", "type": "String", "declarator": "APOLLO_APPID_KEY = \"app.id\"", "var_name": "APOLLO_APPID_KEY"}, {"original_string": "private URL url;", "modifier": "private", "type": "URL", "declarator": "url", "var_name": "url"}, {"original_string": "private Config dubboConfig;", "modifier": "private", "type": "Config", "declarator": "dubboConfig", "var_name": "dubboConfig"}, {"original_string": "private ConfigFile dubboConfigFile;", "modifier": "private", "type": "ConfigFile", "declarator": "dubboConfigFile", "var_name": "dubboConfigFile"}, {"original_string": "private ConcurrentMap<String, ApolloListener> listeners = new ConcurrentHashMap<>();", "modifier": "private", "type": "ConcurrentMap<String, ApolloListener>", "declarator": "listeners = new ConcurrentHashMap<>()", "var_name": "listeners"}], "methods": [{"identifier": "ApolloDynamicConfiguration", "parameters": "(URL url)", "modifiers": "", "return": "", "signature": " ApolloDynamicConfiguration(URL url)", "full_signature": "  ApolloDynamicConfiguration(URL url)", "class_method_signature": "ApolloDynamicConfiguration.ApolloDynamicConfiguration(URL url)", "testcase": false, "constructor": true}, {"identifier": "getAddressWithProtocolPrefix", "parameters": "(URL url)", "modifiers": "private", "return": "String", "signature": "String getAddressWithProtocolPrefix(URL url)", "full_signature": "private String getAddressWithProtocolPrefix(URL url)", "class_method_signature": "ApolloDynamicConfiguration.getAddressWithProtocolPrefix(URL url)", "testcase": false, "constructor": false}, {"identifier": "addListener", "parameters": "(String key, String group, ConfigurationListener listener)", "modifiers": "@Override public", "return": "void", "signature": "void addListener(String key, String group, ConfigurationListener listener)", "full_signature": "@Override public void addListener(String key, String group, ConfigurationListener listener)", "class_method_signature": "ApolloDynamicConfiguration.addListener(String key, String group, ConfigurationListener listener)", "testcase": false, "constructor": false}, {"identifier": "removeListener", "parameters": "(String key, String group, ConfigurationListener listener)", "modifiers": "@Override public", "return": "void", "signature": "void removeListener(String key, String group, ConfigurationListener listener)", "full_signature": "@Override public void removeListener(String key, String group, ConfigurationListener listener)", "class_method_signature": "ApolloDynamicConfiguration.removeListener(String key, String group, ConfigurationListener listener)", "testcase": false, "constructor": false}, {"identifier": "getConfig", "parameters": "(String key, String group, long timeout)", "modifiers": "@Override public", "return": "String", "signature": "String getConfig(String key, String group, long timeout)", "full_signature": "@Override public String getConfig(String key, String group, long timeout)", "class_method_signature": "ApolloDynamicConfiguration.getConfig(String key, String group, long timeout)", "testcase": false, "constructor": false}, {"identifier": "getProperties", "parameters": "(String key, String group, long timeout)", "modifiers": "@Override public", "return": "String", "signature": "String getProperties(String key, String group, long timeout)", "full_signature": "@Override public String getProperties(String key, String group, long timeout)", "class_method_signature": "ApolloDynamicConfiguration.getProperties(String key, String group, long timeout)", "testcase": false, "constructor": false}, {"identifier": "getInternalProperty", "parameters": "(String key)", "modifiers": "@Override public", "return": "String", "signature": "String getInternalProperty(String key)", "full_signature": "@Override public String getInternalProperty(String key)", "class_method_signature": "ApolloDynamicConfiguration.getInternalProperty(String key)", "testcase": false, "constructor": false}, {"identifier": "createTargetListener", "parameters": "(String key, String group)", "modifiers": "private", "return": "ApolloListener", "signature": "ApolloListener createTargetListener(String key, String group)", "full_signature": "private ApolloListener createTargetListener(String key, String group)", "class_method_signature": "ApolloDynamicConfiguration.createTargetListener(String key, String group)", "testcase": false, "constructor": false}], "file": "dubbo-configcenter/dubbo-configcenter-apollo/src/main/java/org/apache/dubbo/configcenter/support/apollo/ApolloDynamicConfiguration.java"}, "focal_method": {"identifier": "addListener", "parameters": "(String key, String group, ConfigurationListener listener)", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void addListener(String key, String group, ConfigurationListener listener) {\n        ApolloListener apolloListener = listeners.computeIfAbsent(group + key, k -> createTargetListener(key, group));\n        apolloListener.addListener(listener);\n        dubboConfig.addChangeListener(apolloListener, Collections.singleton(key));\n    }", "signature": "void addListener(String key, String group, ConfigurationListener listener)", "full_signature": "@Override public void addListener(String key, String group, ConfigurationListener listener)", "class_method_signature": "ApolloDynamicConfiguration.addListener(String key, String group, ConfigurationListener listener)", "testcase": false, "constructor": false, "invocations": ["computeIfAbsent", "createTargetListener", "addListener", "addChangeListener", "singleton"]}, "repository": {"repo_id": 4710920, "url": "https://github.com/apache/dubbo", "stars": 30960, "created": "6/19/2012 7:56:02 AM +00:00", "updates": "2020-01-27T14:21:03+00:00", "fork": "False", "license": "licensed"}}