{"test_class": {"identifier": "ApiExtControllerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Autowired\n    private WebApplicationContext webApplicationContext;", "modifier": "@Autowired\n    private", "type": "WebApplicationContext", "declarator": "webApplicationContext", "var_name": "webApplicationContext"}, {"original_string": "@MockBean\n    private UserLoginInterceptor userLoginInterceptor;", "modifier": "@MockBean\n    private", "type": "UserLoginInterceptor", "declarator": "userLoginInterceptor", "var_name": "userLoginInterceptor"}, {"original_string": "@MockBean\n    private CommStatusInterceptor commStatusInterceptor;", "modifier": "@MockBean\n    private", "type": "CommStatusInterceptor", "declarator": "commStatusInterceptor", "var_name": "commStatusInterceptor"}, {"original_string": "@MockBean\n    private ProjectDao projectDao;", "modifier": "@MockBean\n    private", "type": "ProjectDao", "declarator": "projectDao", "var_name": "projectDao"}, {"original_string": "@MockBean\n    private DataBaseDao dataBaseDao;", "modifier": "@MockBean\n    private", "type": "DataBaseDao", "declarator": "dataBaseDao", "var_name": "dataBaseDao"}, {"original_string": "@MockBean\n    private DatabaseSetDao databaseSetDao;", "modifier": "@MockBean\n    private", "type": "DatabaseSetDao", "declarator": "databaseSetDao", "var_name": "databaseSetDao"}, {"original_string": "private MockMvc mvc;", "modifier": "private", "type": "MockMvc", "declarator": "mvc", "var_name": "mvc"}, {"original_string": "private MockHttpSession session;", "modifier": "private", "type": "MockHttpSession", "declarator": "session", "var_name": "session"}], "file": "das-console-manager/src/test/java/com/ppdai/das/console/controller/ApiExtControllerTest.java"}, "test_case": {"identifier": "checkAll", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void checkAll() throws Exception {\n        mvc.perform(MockMvcRequestBuilders.get(\"/apiext/checkAll?appid=1001\")\n                .contentType(MediaType.APPLICATION_JSON_UTF8)\n                .accept(MediaType.APPLICATION_JSON_UTF8))\n                .andExpect(MockMvcResultMatchers.status().isOk())\n                //.andExpect(MockMvcResultMatchers.jsonPath(\"$.author\").value(\"\u561f\u561fMD\u72ec\u7acb\u535a\u5ba2\"))\n                //.andExpect(MockMvcResultMatchers.jsonPath(\"$.title\").value(\"Spring Boot\u5e72\u8d27\u7cfb\u5217\"))\n                .andDo(MockMvcResultHandlers.print());\n    }", "signature": "void checkAll()", "full_signature": "@Test public void checkAll()", "class_method_signature": "ApiExtControllerTest.checkAll()", "testcase": true, "constructor": false, "invocations": ["andDo", "andExpect", "perform", "accept", "contentType", "get", "isOk", "status", "print"]}, "focal_class": {"identifier": "ApiExtController", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Autowired\n    private ProjectDao projectDao;", "modifier": "@Autowired\n    private", "type": "ProjectDao", "declarator": "projectDao", "var_name": "projectDao"}, {"original_string": "@Autowired\n    private ProjectService projectService;", "modifier": "@Autowired\n    private", "type": "ProjectService", "declarator": "projectService", "var_name": "projectService"}, {"original_string": "@Autowired\n    private DatabaseSetService databaseSetService;", "modifier": "@Autowired\n    private", "type": "DatabaseSetService", "declarator": "databaseSetService", "var_name": "databaseSetService"}, {"original_string": "@Autowired\n    private DataBaseDao dataBaseDao;", "modifier": "@Autowired\n    private", "type": "DataBaseDao", "declarator": "dataBaseDao", "var_name": "dataBaseDao"}, {"original_string": "@Autowired\n    private DatabaseSetDao databaseSetDao;", "modifier": "@Autowired\n    private", "type": "DatabaseSetDao", "declarator": "databaseSetDao", "var_name": "databaseSetDao"}, {"original_string": "@Autowired\n    private DatabaseService databaseService;", "modifier": "@Autowired\n    private", "type": "DatabaseService", "declarator": "databaseService", "var_name": "databaseService"}], "methods": [{"identifier": "check", "parameters": "(@RequestParam(\"appid\") String appid)", "modifiers": "@RequestMapping(value = \"/check\") public", "return": "ServiceResult", "signature": "ServiceResult check(@RequestParam(\"appid\") String appid)", "full_signature": "@RequestMapping(value = \"/check\") public ServiceResult check(@RequestParam(\"appid\") String appid)", "class_method_signature": "ApiExtController.check(@RequestParam(\"appid\") String appid)", "testcase": false, "constructor": false}, {"identifier": "checkDblist", "parameters": "(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user)", "modifiers": "@RequestMapping(value = \"/checkDblist\") public", "return": "ServiceResult", "signature": "ServiceResult checkDblist(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user)", "full_signature": "@RequestMapping(value = \"/checkDblist\") public ServiceResult checkDblist(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user)", "class_method_signature": "ApiExtController.checkDblist(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user)", "testcase": false, "constructor": false}, {"identifier": "checkAll", "parameters": "(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user, HttpServletRequest request)", "modifiers": "@RequestMapping(value = \"/checkAll\") public", "return": "ServiceResult<String>", "signature": "ServiceResult<String> checkAll(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user, HttpServletRequest request)", "full_signature": "@RequestMapping(value = \"/checkAll\") public ServiceResult<String> checkAll(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user, HttpServletRequest request)", "class_method_signature": "ApiExtController.checkAll(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user, HttpServletRequest request)", "testcase": false, "constructor": false}, {"identifier": "appidExist", "parameters": "(@RequestParam(value = \"appid\", defaultValue = \"0\") String appid)", "modifiers": "@RequestMapping(value = \"/appidExist\") public", "return": "ServiceResult", "signature": "ServiceResult appidExist(@RequestParam(value = \"appid\", defaultValue = \"0\") String appid)", "full_signature": "@RequestMapping(value = \"/appidExist\") public ServiceResult appidExist(@RequestParam(value = \"appid\", defaultValue = \"0\") String appid)", "class_method_signature": "ApiExtController.appidExist(@RequestParam(value = \"appid\", defaultValue = \"0\") String appid)", "testcase": false, "constructor": false}], "file": "das-console-manager/src/main/java/com/ppdai/das/console/controller/ApiExtController.java"}, "focal_method": {"identifier": "checkAll", "parameters": "(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user, HttpServletRequest request)", "modifiers": "@RequestMapping(value = \"/checkAll\") public", "return": "ServiceResult<String>", "body": "@RequestMapping(value = \"/checkAll\")\n    public ServiceResult<String> checkAll(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user, HttpServletRequest request) {\n        String baseurl = DasEnv.getBaseUrl(request);\n        String addmsg = \"\u660e\u7ec6\u8bf7\u67e5\u770b http://\" + baseurl + \"/das/#/api?appid=\" + appid;\n        try {\n            if (null == appid) {\n                return ServiceResult.fail(\"ApiExtController.checkByAppid appid \" + addmsg);\n            }\n            Project project = projectDao.getProjectByAppId(appid);\n            //\u9879\u76ee\u6821\u9a8c\n            ConfigCkeckResult<List<ConfigDataResponse>> cr = projectService.getCheckData(user, project);\n            if (cr.getCode() == ConfigCkeckResult.ERROR) {\n                return ServiceResult.fail(\"projectService.getCheckData appid \" + addmsg);\n            }\n            List<ConfigDataResponse> configDataResponses = cr.getItem();\n            ConfigCkeckResult<ConfigCheckItem> configCkeckResult = ConfigCheckBase.checkData(configDataResponses);\n            if (configCkeckResult.getCode() == ConfigCkeckResult.ERROR) {\n                return ServiceResult.fail(\"\u9879\u76ee\u914d\u7f6e\u6821\u9a8c\u4e0d\u901a\u8fc7\uff0c\" + configCkeckResult.getMsg() + addmsg);\n            }\n            //\u903b\u8f91\u5e93\u6821\u9a8c\n            List<DatabaseSet> dbsets = databaseSetDao.getAllDatabaseSetByGroupId(project.getDal_group_id());\n            if (CollectionUtils.isEmpty(dbsets)) {\n                return ServiceResult.fail(\"\u903b\u8f91\u5e93\u914d\u7f6e\u6821\u9a8c\u4e0d\u901a\u8fc7\uff0c\" + configCkeckResult.getMsg() + addmsg);\n            }\n            List<ConfigDataResponse> configCheckResponses = databaseSetService.getAllCheckData(user, project.getDal_group_id(), dbsets.get(0));\n            configCkeckResult = ConfigCheckBase.checkData(configCheckResponses);\n            //\u7269\u7406\u5e93\u6821\u9a8c\n            if (configCkeckResult.getCode() != ConfigCkeckResult.ERROR) {\n                List<DataBaseInfo> list = dataBaseDao.getAllDbByAppId(appid);\n                for (DataBaseInfo dataBaseInfo : list) {\n                    cr = databaseService.getCheckData(user, dataBaseInfo);\n                    if (cr.getCode() == ConfigCkeckResult.SUCCESS) {\n                        return ServiceResult.fail(\"\u7269\u7406\u5e93\u6821\u9a8c\u4e0d\u901a\u8fc7\uff0c\" + configCkeckResult.getMsg() + addmsg);\n                    }\n                    configCkeckResult = ConfigCheckBase.checkData(cr.getItem());\n                    if (configCkeckResult.getCode() == ConfigCkeckResult.ERROR) {\n                        return ServiceResult.fail(\"\u7269\u7406\u5e93\u6821\u9a8c\u4e0d\u901a\u8fc7\uff0c\" + configCkeckResult.getMsg() + addmsg);\n                    }\n                }\n                return ServiceResult.success();\n            }\n        } catch (Exception e) {\n            return ServiceResult.fail(\"ApiExtController.checkByAppid appid : \" + appid + \"   \" + StringUtil.getMessage(e));\n        }\n        return ServiceResult.fail(\"\u7269\u7406\u5e93\u6821\u9a8c\u4e0d\u901a\u8fc7, \u660e\u7ec6\u8bf7\u67e5\u770b http://\" + baseurl + \"/das/#/api?appid=\" + appid);\n    }", "signature": "ServiceResult<String> checkAll(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user, HttpServletRequest request)", "full_signature": "@RequestMapping(value = \"/checkAll\") public ServiceResult<String> checkAll(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user, HttpServletRequest request)", "class_method_signature": "ApiExtController.checkAll(@RequestParam(\"appid\") String appid, @CurrentUser LoginUser user, HttpServletRequest request)", "testcase": false, "constructor": false, "invocations": ["getBaseUrl", "fail", "getProjectByAppId", "getCheckData", "getCode", "fail", "getItem", "checkData", "getCode", "fail", "", "getAllDatabaseSetByGroupId", "getDal_group_id", "isEmpty", "fail", "", "getAllCheckData", "getDal_group_id", "get", "checkData", "getCode", "getAllDbByAppId", "getCheckData", "getCode", "fail", ";", "checkData", "getItem", "getCode", "fail", ";", "success", "fail", "getMessage", "fail"]}, "repository": {"repo_id": 214933909, "url": "https://github.com/ppdaicorp/das", "stars": 55, "created": "10/14/2019 2:49:17 AM +00:00", "updates": "2020-01-20T09:24:23+00:00", "fork": "False", "license": "licensed"}}