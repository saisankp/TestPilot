{"test_class": {"identifier": "VisibilityFenceTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static Configuration conf = new Configuration();", "modifier": "private static", "type": "Configuration", "declarator": "conf = new Configuration()", "var_name": "conf"}, {"original_string": "private static TransactionManager txManager = null;", "modifier": "private static", "type": "TransactionManager", "declarator": "txManager = null", "var_name": "txManager"}], "file": "tephra-core/src/test/java/co/cask/tephra/visibility/VisibilityFenceTest.java"}, "test_case": {"identifier": "testFence1", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testFence1() throws Exception {\n    byte[] fenceId = \"test_table\".getBytes(Charsets.UTF_8);\n\n    // Writer updates data here in a separate transaction (code not shown)\n    // start tx\n    // update\n    // commit tx\n\n    // Readers use fence to indicate that they are interested in changes to specific data\n    TransactionAware readFenceCase16 = VisibilityFence.create(fenceId);\n    TransactionContext readTxContextCase16 =\n      new TransactionContext(new InMemoryTxSystemClient(txManager), readFenceCase16);\n    readTxContextCase16.start();\n    readTxContextCase16.finish();\n\n    TransactionAware readFenceCase17 = VisibilityFence.create(fenceId);\n    TransactionContext readTxContextCase17 =\n      new TransactionContext(new InMemoryTxSystemClient(txManager), readFenceCase17);\n    readTxContextCase17.start();\n\n    TransactionAware readFenceCase18 = VisibilityFence.create(fenceId);\n    TransactionContext readTxContextCase18 =\n      new TransactionContext(new InMemoryTxSystemClient(txManager), readFenceCase18);\n    readTxContextCase18.start();\n\n    // Now writer needs to wait for in-progress readers to see the change, it uses write fence to do so\n    // Start write fence txn\n    TransactionAware writeFence = new WriteFence(fenceId);\n    TransactionContext writeTxContext = new TransactionContext(new InMemoryTxSystemClient(txManager), writeFence);\n    writeTxContext.start();\n\n    TransactionAware readFenceCase20 = VisibilityFence.create(fenceId);\n    TransactionContext readTxContextCase20 =\n      new TransactionContext(new InMemoryTxSystemClient(txManager), readFenceCase20);\n    readTxContextCase20.start();\n\n    readTxContextCase17.finish();\n\n    assertTxnConflict(writeTxContext);\n    writeTxContext.start();\n\n    // Commit write fence txn can commit without conflicts at this point\n    writeTxContext.finish();\n\n    TransactionAware readFenceCase21 = VisibilityFence.create(fenceId);\n    TransactionContext readTxContextCase21 =\n      new TransactionContext(new InMemoryTxSystemClient(txManager), readFenceCase21);\n    readTxContextCase21.start();\n\n    assertTxnConflict(readTxContextCase18);\n    readTxContextCase20.finish();\n    readTxContextCase21.finish();\n  }", "signature": "void testFence1()", "full_signature": "@Test public void testFence1()", "class_method_signature": "VisibilityFenceTest.testFence1()", "testcase": true, "constructor": false, "invocations": ["getBytes", "create", "start", "finish", "create", "start", "create", "start", "start", "create", "start", "finish", "assertTxnConflict", "start", "finish", "create", "start", "assertTxnConflict", "finish", "finish"]}, "focal_class": {"identifier": "VisibilityFence", "superclass": "", "interfaces": "", "fields": [], "methods": [{"identifier": "VisibilityFence", "parameters": "()", "modifiers": "private", "return": "", "signature": " VisibilityFence()", "full_signature": "private  VisibilityFence()", "class_method_signature": "VisibilityFence.VisibilityFence()", "testcase": false, "constructor": true}, {"identifier": "create", "parameters": "(byte[] fenceId)", "modifiers": "public static", "return": "TransactionAware", "signature": "TransactionAware create(byte[] fenceId)", "full_signature": "public static TransactionAware create(byte[] fenceId)", "class_method_signature": "VisibilityFence.create(byte[] fenceId)", "testcase": false, "constructor": false}, {"identifier": "prepareWait", "parameters": "(byte[] fenceId, TransactionSystemClient txClient)", "modifiers": "public static", "return": "FenceWait", "signature": "FenceWait prepareWait(byte[] fenceId, TransactionSystemClient txClient)", "full_signature": "public static FenceWait prepareWait(byte[] fenceId, TransactionSystemClient txClient)", "class_method_signature": "VisibilityFence.prepareWait(byte[] fenceId, TransactionSystemClient txClient)", "testcase": false, "constructor": false}], "file": "tephra-core/src/main/java/co/cask/tephra/visibility/VisibilityFence.java"}, "focal_method": {"identifier": "create", "parameters": "(byte[] fenceId)", "modifiers": "public static", "return": "TransactionAware", "body": "public static TransactionAware create(byte[] fenceId) {\n    return new ReadFence(fenceId);\n  }", "signature": "TransactionAware create(byte[] fenceId)", "full_signature": "public static TransactionAware create(byte[] fenceId)", "class_method_signature": "VisibilityFence.create(byte[] fenceId)", "testcase": false, "constructor": false, "invocations": []}, "repository": {"repo_id": 21894018, "url": "https://github.com/cdapio/tephra", "language": "Java", "is_fork": false, "fork_count": 43, "stargazer_count": 157, "size": 1415, "license": "licensed"}}