{"test_class": {"identifier": "DataSetComparatorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String COLLECTION_NAME_1 = \"some_collection_1\";", "modifier": "private static final", "type": "String", "declarator": "COLLECTION_NAME_1 = \"some_collection_1\"", "var_name": "COLLECTION_NAME_1"}, {"original_string": "private static final String COLLECTION_NAME_2 = \"some_collection_2\";", "modifier": "private static final", "type": "String", "declarator": "COLLECTION_NAME_2 = \"some_collection_2\"", "var_name": "COLLECTION_NAME_2"}, {"original_string": "private static final String COLLECTION_NAME_3 = \"some_collection_3\";", "modifier": "private static final", "type": "String", "declarator": "COLLECTION_NAME_3 = \"some_collection_3\"", "var_name": "COLLECTION_NAME_3"}, {"original_string": "private static final Document DOCUMENT_1 = new Document().append(\"a\", \"A\").append(\"b\", \"B\");", "modifier": "private static final", "type": "Document", "declarator": "DOCUMENT_1 = new Document().append(\"a\", \"A\").append(\"b\", \"B\")", "var_name": "DOCUMENT_1"}, {"original_string": "private static final Document DOCUMENT_2 = new Document().append(\"c\", \"C\").append(\"d\", \"D\");", "modifier": "private static final", "type": "Document", "declarator": "DOCUMENT_2 = new Document().append(\"c\", \"C\").append(\"d\", \"D\")", "var_name": "DOCUMENT_2"}, {"original_string": "private static final Document DOCUMENT_3 = new Document().append(\"e\", \"E\").append(\"f\", \"F\");", "modifier": "private static final", "type": "Document", "declarator": "DOCUMENT_3 = new Document().append(\"e\", \"E\").append(\"f\", \"F\")", "var_name": "DOCUMENT_3"}, {"original_string": "@Mock\n    private MongoDatabase mongoDatabase;", "modifier": "@Mock\n    private", "type": "MongoDatabase", "declarator": "mongoDatabase", "var_name": "mongoDatabase"}, {"original_string": "private AssertionErrorCollector errorCollector;", "modifier": "private", "type": "AssertionErrorCollector", "declarator": "errorCollector", "var_name": "errorCollector"}], "file": "mongodb/src/test/java/eu/drus/jpa/unit/mongodb/DataSetComparatorTest.java"}, "test_case": {"identifier": "testExpectedDataSetIsASubsetOfCurrentDataSetUsingStringMode", "parameters": "()", "modifiers": "@SuppressWarnings(\"unchecked\") @Test public", "return": "void", "body": "@SuppressWarnings(\"unchecked\")\n    @Test\n    public void testExpectedDataSetIsASubsetOfCurrentDataSetUsingStringMode() {\n        // GIVEN\n        final List<String> currentCollectionNames = Arrays.asList(COLLECTION_NAME_1, COLLECTION_NAME_2);\n        final Iterator<String> currentCollectionNamesIt = currentCollectionNames.iterator();\n        final MongoCursor<String> currentCollectionNamesCursor = mock(MongoCursor.class);\n        when(currentCollectionNamesCursor.hasNext()).thenAnswer((final InvocationOnMock invocation) -> currentCollectionNamesIt.hasNext());\n        when(currentCollectionNamesCursor.next()).thenAnswer((final InvocationOnMock invocation) -> currentCollectionNamesIt.next());\n        doAnswer((final InvocationOnMock invocation) -> {\n            final Consumer<String> c = (Consumer<String>) invocation.getArguments()[0];\n            for (final String name : currentCollectionNames) {\n                c.accept(name);\n            }\n            return null;\n        }).when(currentCollectionNamesCursor).forEachRemaining(any(Consumer.class));\n\n        final MongoIterable<String> collectionIterable = mock(MongoIterable.class);\n        when(collectionIterable.iterator()).thenReturn(currentCollectionNamesCursor);\n\n        when(mongoDatabase.listCollectionNames()).thenReturn(collectionIterable);\n\n        final MongoCursor<Document> documentIteratorWithoutEntries = mock(MongoCursor.class);\n        when(documentIteratorWithoutEntries.hasNext()).thenReturn(Boolean.FALSE);\n\n        final FindIterable<Document> findIterableWithoutEntries = mock(FindIterable.class);\n        when(findIterableWithoutEntries.iterator()).thenReturn(documentIteratorWithoutEntries);\n\n        final MongoCollection<Document> collectionWithoutEntries = mock(MongoCollection.class);\n        when(collectionWithoutEntries.count()).thenReturn(0l);\n        when(collectionWithoutEntries.find(any(Document.class))).thenReturn(findIterableWithoutEntries);\n        when(collectionWithoutEntries.find()).thenReturn(findIterableWithoutEntries);\n        when(mongoDatabase.getCollection(anyString())).thenReturn(collectionWithoutEntries);\n\n        final List<Document> collection1Documents = Arrays.asList(DOCUMENT_1);\n        final Iterator<Document> colleciton1DocumentsIt = collection1Documents.iterator();\n        final MongoCursor<Document> collection1DocumentIterator = mock(MongoCursor.class);\n        when(collection1DocumentIterator.hasNext()).thenAnswer((final InvocationOnMock invocation) -> colleciton1DocumentsIt.hasNext());\n        when(collection1DocumentIterator.next()).thenAnswer((final InvocationOnMock invocation) -> colleciton1DocumentsIt.next());\n        doAnswer((final InvocationOnMock invocation) -> {\n            final Consumer<Document> c = (Consumer<Document>) invocation.getArguments()[0];\n            for (final Document doc : collection1Documents) {\n                c.accept(doc);\n            }\n            return null;\n        }).when(collection1DocumentIterator).forEachRemaining(any(Consumer.class));\n\n        final FindIterable<Document> collection1Iterable = mock(FindIterable.class);\n        when(collection1Iterable.iterator()).thenReturn(collection1DocumentIterator);\n\n        final MongoCollection<Document> collection1 = mock(MongoCollection.class);\n        when(collection1.count()).thenReturn(1l);\n        when(collection1.find(any(Document.class))).thenReturn(collection1Iterable);\n        when(collection1.find()).thenReturn(collection1Iterable);\n        when(mongoDatabase.getCollection(eq(COLLECTION_NAME_1))).thenReturn(collection1);\n\n        final List<Document> collection2Documents = Arrays.asList(DOCUMENT_2);\n        final Iterator<Document> colleciton2DocumentsIt = collection2Documents.iterator();\n        final MongoCursor<Document> collection2DocumentIterator = mock(MongoCursor.class);\n        when(collection2DocumentIterator.hasNext()).thenAnswer((final InvocationOnMock invocation) -> colleciton2DocumentsIt.hasNext());\n        when(collection2DocumentIterator.next()).thenAnswer((final InvocationOnMock invocation) -> colleciton2DocumentsIt.next());\n        doAnswer((final InvocationOnMock invocation) -> {\n            final Consumer<Document> c = (Consumer<Document>) invocation.getArguments()[0];\n            for (final Document doc : collection2Documents) {\n                c.accept(doc);\n            }\n            return null;\n        }).when(collection2DocumentIterator).forEachRemaining(any(Consumer.class));\n\n        final FindIterable<Document> collection2Iterable = mock(FindIterable.class);\n        when(collection2Iterable.iterator()).thenReturn(collection2DocumentIterator);\n\n        final MongoCollection<Document> collection2 = mock(MongoCollection.class);\n        when(collection1.count()).thenReturn(1l);\n        when(collection1.find(any(Document.class))).thenReturn(collection2Iterable);\n        when(collection1.find()).thenReturn(collection2Iterable);\n        when(mongoDatabase.getCollection(eq(COLLECTION_NAME_2))).thenReturn(collection2);\n\n        final String[] toExclude = new String[] {};\n        final Document expectedDataSet = new Document().append(COLLECTION_NAME_1, Arrays.asList(DOCUMENT_1));\n\n        final DataSetComparator comparator = new DataSetComparator(toExclude, true);\n\n        // WHEN\n        comparator.compare(mongoDatabase, expectedDataSet, errorCollector);\n\n        // THEN\n        assertThat(errorCollector.amountOfErrors(), equalTo(1));\n\n        try {\n            errorCollector.report();\n            fail(\"AssertionError expected\");\n        } catch (final AssertionError e) {\n            assertThat(e.getMessage(), containsString(\"failed in 1 case\"));\n            assertThat(e.getMessage(), containsString(COLLECTION_NAME_2 + \" was not expected, but is present\"));\n        }\n    }", "signature": "void testExpectedDataSetIsASubsetOfCurrentDataSetUsingStringMode()", "full_signature": "@SuppressWarnings(\"unchecked\") @Test public void testExpectedDataSetIsASubsetOfCurrentDataSetUsingStringMode()", "class_method_signature": "DataSetComparatorTest.testExpectedDataSetIsASubsetOfCurrentDataSetUsingStringMode()", "testcase": true, "constructor": false, "invocations": ["asList", "iterator", "mock", "thenAnswer", "when", "hasNext", "hasNext", "thenAnswer", "when", "next", "next", "forEachRemaining", "when", "doAnswer", "getArguments", "accept", "any", "mock", "thenReturn", "when", "iterator", "thenReturn", "when", "listCollectionNames", "mock", "thenReturn", "when", "hasNext", "mock", "thenReturn", "when", "iterator", "mock", "thenReturn", "when", "count", "thenReturn", "when", "find", "any", "thenReturn", "when", "find", "thenReturn", "when", "getCollection", "anyString", "asList", "iterator", "mock", "thenAnswer", "when", "hasNext", "hasNext", "thenAnswer", "when", "next", "next", "forEachRemaining", "when", "doAnswer", "getArguments", "accept", "any", "mock", "thenReturn", "when", "iterator", "mock", "thenReturn", "when", "count", "thenReturn", "when", "find", "any", "thenReturn", "when", "find", "thenReturn", "when", "getCollection", "eq", "asList", "iterator", "mock", "thenAnswer", "when", "hasNext", "hasNext", "thenAnswer", "when", "next", "next", "forEachRemaining", "when", "doAnswer", "getArguments", "accept", "any", "mock", "thenReturn", "when", "iterator", "mock", "thenReturn", "when", "count", "thenReturn", "when", "find", "any", "thenReturn", "when", "find", "thenReturn", "when", "getCollection", "eq", "append", "asList", "compare", "assertThat", "amountOfErrors", "equalTo", "report", "fail", "assertThat", "getMessage", "containsString", "assertThat", "getMessage", "containsString"]}, "focal_class": {"identifier": "DataSetComparator", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Function<String, String> ID_MAPPER = (final String name) -> name;", "modifier": "private static final", "type": "Function<String, String>", "declarator": "ID_MAPPER = (final String name) -> name", "var_name": "ID_MAPPER"}, {"original_string": "private ColumnsHolder toExclude;", "modifier": "private", "type": "ColumnsHolder", "declarator": "toExclude", "var_name": "toExclude"}, {"original_string": "private boolean isStrict;", "modifier": "private", "type": "boolean", "declarator": "isStrict", "var_name": "isStrict"}], "methods": [{"identifier": "DataSetComparator", "parameters": "(final String[] toExclude, final boolean isStrict)", "modifiers": "public", "return": "", "signature": " DataSetComparator(final String[] toExclude, final boolean isStrict)", "full_signature": "public  DataSetComparator(final String[] toExclude, final boolean isStrict)", "class_method_signature": "DataSetComparator.DataSetComparator(final String[] toExclude, final boolean isStrict)", "testcase": false, "constructor": true}, {"identifier": "compare", "parameters": "(final MongoDatabase connection, final Document expectedDataSet, final AssertionErrorCollector errorCollector)", "modifiers": "public", "return": "void", "signature": "void compare(final MongoDatabase connection, final Document expectedDataSet, final AssertionErrorCollector errorCollector)", "full_signature": "public void compare(final MongoDatabase connection, final Document expectedDataSet, final AssertionErrorCollector errorCollector)", "class_method_signature": "DataSetComparator.compare(final MongoDatabase connection, final Document expectedDataSet, final AssertionErrorCollector errorCollector)", "testcase": false, "constructor": false}, {"identifier": "shouldBeEmpty", "parameters": "(final MongoDatabase connection, final AssertionErrorCollector errorCollector)", "modifiers": "private", "return": "void", "signature": "void shouldBeEmpty(final MongoDatabase connection, final AssertionErrorCollector errorCollector)", "full_signature": "private void shouldBeEmpty(final MongoDatabase connection, final AssertionErrorCollector errorCollector)", "class_method_signature": "DataSetComparator.shouldBeEmpty(final MongoDatabase connection, final AssertionErrorCollector errorCollector)", "testcase": false, "constructor": false}, {"identifier": "compareContent", "parameters": "(final MongoDatabase connection, final Document expectedDataSet,\n            final AssertionErrorCollector errorCollector)", "modifiers": "private", "return": "void", "signature": "void compareContent(final MongoDatabase connection, final Document expectedDataSet,\n            final AssertionErrorCollector errorCollector)", "full_signature": "private void compareContent(final MongoDatabase connection, final Document expectedDataSet,\n            final AssertionErrorCollector errorCollector)", "class_method_signature": "DataSetComparator.compareContent(final MongoDatabase connection, final Document expectedDataSet,\n            final AssertionErrorCollector errorCollector)", "testcase": false, "constructor": false}, {"identifier": "verifyCollectionNames", "parameters": "(final MongoDatabase connection, final Set<String> expectedCollectionNames,\n            final AssertionErrorCollector errorCollector)", "modifiers": "private", "return": "void", "signature": "void verifyCollectionNames(final MongoDatabase connection, final Set<String> expectedCollectionNames,\n            final AssertionErrorCollector errorCollector)", "full_signature": "private void verifyCollectionNames(final MongoDatabase connection, final Set<String> expectedCollectionNames,\n            final AssertionErrorCollector errorCollector)", "class_method_signature": "DataSetComparator.verifyCollectionNames(final MongoDatabase connection, final Set<String> expectedCollectionNames,\n            final AssertionErrorCollector errorCollector)", "testcase": false, "constructor": false}, {"identifier": "verifyCollectionContent", "parameters": "(final MongoDatabase connection, final Document expectedDataSet, final String collectionName,\n            final AssertionErrorCollector errorCollector)", "modifiers": "private", "return": "void", "signature": "void verifyCollectionContent(final MongoDatabase connection, final Document expectedDataSet, final String collectionName,\n            final AssertionErrorCollector errorCollector)", "full_signature": "private void verifyCollectionContent(final MongoDatabase connection, final Document expectedDataSet, final String collectionName,\n            final AssertionErrorCollector errorCollector)", "class_method_signature": "DataSetComparator.verifyCollectionContent(final MongoDatabase connection, final Document expectedDataSet, final String collectionName,\n            final AssertionErrorCollector errorCollector)", "testcase": false, "constructor": false}, {"identifier": "filterRequest", "parameters": "(final Document expectedEntry, final List<String> columnsToExclude)", "modifiers": "private", "return": "Document", "signature": "Document filterRequest(final Document expectedEntry, final List<String> columnsToExclude)", "full_signature": "private Document filterRequest(final Document expectedEntry, final List<String> columnsToExclude)", "class_method_signature": "DataSetComparator.filterRequest(final Document expectedEntry, final List<String> columnsToExclude)", "testcase": false, "constructor": false}, {"identifier": "getCollectionData", "parameters": "(final Object obj)", "modifiers": "@SuppressWarnings(\"unchecked\") private", "return": "List<Document>", "signature": "List<Document> getCollectionData(final Object obj)", "full_signature": "@SuppressWarnings(\"unchecked\") private List<Document> getCollectionData(final Object obj)", "class_method_signature": "DataSetComparator.getCollectionData(final Object obj)", "testcase": false, "constructor": false}], "file": "mongodb/src/main/java/eu/drus/jpa/unit/mongodb/DataSetComparator.java"}, "focal_method": {"identifier": "compare", "parameters": "(final MongoDatabase connection, final Document expectedDataSet, final AssertionErrorCollector errorCollector)", "modifiers": "public", "return": "void", "body": "public void compare(final MongoDatabase connection, final Document expectedDataSet, final AssertionErrorCollector errorCollector) {\n        if (expectedDataSet.entrySet().isEmpty()) {\n            shouldBeEmpty(connection, errorCollector);\n        } else {\n            compareContent(connection, expectedDataSet, errorCollector);\n        }\n    }", "signature": "void compare(final MongoDatabase connection, final Document expectedDataSet, final AssertionErrorCollector errorCollector)", "full_signature": "public void compare(final MongoDatabase connection, final Document expectedDataSet, final AssertionErrorCollector errorCollector)", "class_method_signature": "DataSetComparator.compare(final MongoDatabase connection, final Document expectedDataSet, final AssertionErrorCollector errorCollector)", "testcase": false, "constructor": false, "invocations": ["isEmpty", "entrySet", "shouldBeEmpty", "compareContent"]}, "repository": {"repo_id": 52435170, "url": "https://github.com/dadrus/jpa-unit", "language": "Java", "is_fork": false, "fork_count": 7, "stargazer_count": 24, "size": 1190, "license": "licensed"}}