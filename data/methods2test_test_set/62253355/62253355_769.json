{"test_class": {"identifier": "GroupRestTest", "superclass": "extends MobiRestTestNg", "interfaces": "", "fields": [{"original_string": "private GroupRest rest;", "modifier": "private", "type": "GroupRest", "declarator": "rest", "var_name": "rest"}, {"original_string": "private ValueFactory vf;", "modifier": "private", "type": "ValueFactory", "declarator": "vf", "var_name": "vf"}, {"original_string": "private OrmFactory<User> userFactory;", "modifier": "private", "type": "OrmFactory<User>", "declarator": "userFactory", "var_name": "userFactory"}, {"original_string": "private OrmFactory<Group> groupFactory;", "modifier": "private", "type": "OrmFactory<Group>", "declarator": "groupFactory", "var_name": "groupFactory"}, {"original_string": "private OrmFactory<Role> roleFactory;", "modifier": "private", "type": "OrmFactory<Role>", "declarator": "roleFactory", "var_name": "roleFactory"}, {"original_string": "private User user;", "modifier": "private", "type": "User", "declarator": "user", "var_name": "user"}, {"original_string": "private Group group;", "modifier": "private", "type": "Group", "declarator": "group", "var_name": "group"}, {"original_string": "private Role role;", "modifier": "private", "type": "Role", "declarator": "role", "var_name": "role"}, {"original_string": "private Set<User> users;", "modifier": "private", "type": "Set<User>", "declarator": "users", "var_name": "users"}, {"original_string": "private Set<Group> groups;", "modifier": "private", "type": "Set<Group>", "declarator": "groups", "var_name": "groups"}, {"original_string": "private Set<Role> roles;", "modifier": "private", "type": "Set<Role>", "declarator": "roles", "var_name": "roles"}, {"original_string": "private static final String ENGINE_NAME = \"com.mobi.jaas.engines.RdfEngine\";", "modifier": "private static final", "type": "String", "declarator": "ENGINE_NAME = \"com.mobi.jaas.engines.RdfEngine\"", "var_name": "ENGINE_NAME"}, {"original_string": "@Mock\n    private EngineManager engineManager;", "modifier": "@Mock\n    private", "type": "EngineManager", "declarator": "engineManager", "var_name": "engineManager"}, {"original_string": "@Mock\n    private RdfEngine rdfEngine;", "modifier": "@Mock\n    private", "type": "RdfEngine", "declarator": "rdfEngine", "var_name": "rdfEngine"}, {"original_string": "@Mock\n    private SesameTransformer transformer;", "modifier": "@Mock\n    private", "type": "SesameTransformer", "declarator": "transformer", "var_name": "transformer"}, {"original_string": "@Mock\n    private GroupFactory groupFactoryMock;", "modifier": "@Mock\n    private", "type": "GroupFactory", "declarator": "groupFactoryMock", "var_name": "groupFactoryMock"}], "file": "com.mobi.jaas.rest/src/test/java/com/mobi/jaas/rest/GroupRestTest.java"}, "test_case": {"identifier": "addGroupUserTest", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void addGroupUserTest() {\n        // Setup:\n        Map<String, User> users = new HashMap<>();\n        IntStream.range(1, 6)\n                .mapToObj(Integer::toString)\n                .forEach(s -> users.put(s, userFactory.createNew(vf.createIRI(\"http://mobi.com/users/\" + s))));\n        Group newGroup = groupFactory.createNew(vf.createIRI(\"http://mobi.com/groups/testGroup\"));\n        newGroup.setMember(Collections.singleton(user));\n        when(engineManager.retrieveUser(anyString())).thenAnswer(i -> Optional.of(users.get(i.getArgumentAt(0, String.class))));\n        when(engineManager.retrieveGroup(eq(ENGINE_NAME), anyString())).thenReturn(Optional.of(newGroup));\n\n        Response response = target().path(\"groups/testGroup/users\").queryParam(\"users\", users.keySet().toArray())\n                .request().put(Entity.entity(\"\", MediaType.MULTIPART_FORM_DATA));\n        assertEquals(response.getStatus(), 200);\n        verify(engineManager).retrieveGroup(ENGINE_NAME, \"testGroup\");\n        users.keySet().forEach(s -> verify(engineManager).retrieveUser(s));\n        ArgumentCaptor<Group> captor = ArgumentCaptor.forClass(Group.class);\n        verify(engineManager).updateGroup(eq(ENGINE_NAME), captor.capture());\n        Group updatedGroup = captor.getValue();\n        assertEquals(newGroup.getResource(), updatedGroup.getResource());\n        Set<Resource> updatedMembers = updatedGroup.getMember_resource();\n        assertEquals(users.size() + 1, updatedMembers.size());\n        assertTrue(updatedMembers.contains(user.getResource()));\n        users.values().forEach(user -> assertTrue(updatedMembers.contains(user.getResource())));\n    }", "signature": "void addGroupUserTest()", "full_signature": "@Test public void addGroupUserTest()", "class_method_signature": "GroupRestTest.addGroupUserTest()", "testcase": true, "constructor": false, "invocations": ["forEach", "mapToObj", "range", "put", "createNew", "createIRI", "createNew", "createIRI", "setMember", "singleton", "thenAnswer", "when", "retrieveUser", "anyString", "of", "get", "getArgumentAt", "thenReturn", "when", "retrieveGroup", "eq", "anyString", "of", "put", "request", "queryParam", "path", "target", "toArray", "keySet", "entity", "assertEquals", "getStatus", "retrieveGroup", "verify", "forEach", "keySet", "retrieveUser", "verify", "forClass", "updateGroup", "verify", "eq", "capture", "getValue", "assertEquals", "getResource", "getResource", "getMember_resource", "assertEquals", "size", "size", "assertTrue", "contains", "getResource", "forEach", "values", "assertTrue", "contains", "getResource"]}, "focal_class": {"identifier": "GroupRest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private EngineManager engineManager;", "modifier": "private", "type": "EngineManager", "declarator": "engineManager", "var_name": "engineManager"}, {"original_string": "private ValueFactory vf;", "modifier": "private", "type": "ValueFactory", "declarator": "vf", "var_name": "vf"}, {"original_string": "private UserFactory userFactory;", "modifier": "private", "type": "UserFactory", "declarator": "userFactory", "var_name": "userFactory"}, {"original_string": "private GroupFactory groupFactory;", "modifier": "private", "type": "GroupFactory", "declarator": "groupFactory", "var_name": "groupFactory"}, {"original_string": "private SesameTransformer transformer;", "modifier": "private", "type": "SesameTransformer", "declarator": "transformer", "var_name": "transformer"}, {"original_string": "private Engine rdfEngine;", "modifier": "private", "type": "Engine", "declarator": "rdfEngine", "var_name": "rdfEngine"}, {"original_string": "private final Logger logger = LoggerFactory.getLogger(GroupRest.class);", "modifier": "private final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(GroupRest.class)", "var_name": "logger"}], "methods": [{"identifier": "setEngineManager", "parameters": "(EngineManager engineManager)", "modifiers": "@Reference", "return": "void", "signature": "void setEngineManager(EngineManager engineManager)", "full_signature": "@Reference void setEngineManager(EngineManager engineManager)", "class_method_signature": "GroupRest.setEngineManager(EngineManager engineManager)", "testcase": false, "constructor": false}, {"identifier": "setValueFactory", "parameters": "(ValueFactory vf)", "modifiers": "@Reference", "return": "void", "signature": "void setValueFactory(ValueFactory vf)", "full_signature": "@Reference void setValueFactory(ValueFactory vf)", "class_method_signature": "GroupRest.setValueFactory(ValueFactory vf)", "testcase": false, "constructor": false}, {"identifier": "setUserFactory", "parameters": "(UserFactory userFactory)", "modifiers": "@Reference", "return": "void", "signature": "void setUserFactory(UserFactory userFactory)", "full_signature": "@Reference void setUserFactory(UserFactory userFactory)", "class_method_signature": "GroupRest.setUserFactory(UserFactory userFactory)", "testcase": false, "constructor": false}, {"identifier": "setGroupFactory", "parameters": "(GroupFactory groupFactory)", "modifiers": "@Reference", "return": "void", "signature": "void setGroupFactory(GroupFactory groupFactory)", "full_signature": "@Reference void setGroupFactory(GroupFactory groupFactory)", "class_method_signature": "GroupRest.setGroupFactory(GroupFactory groupFactory)", "testcase": false, "constructor": false}, {"identifier": "setTransformer", "parameters": "(SesameTransformer transformer)", "modifiers": "@Reference", "return": "void", "signature": "void setTransformer(SesameTransformer transformer)", "full_signature": "@Reference void setTransformer(SesameTransformer transformer)", "class_method_signature": "GroupRest.setTransformer(SesameTransformer transformer)", "testcase": false, "constructor": false}, {"identifier": "setRdfEngine", "parameters": "(Engine engine)", "modifiers": "@Reference(target = \"(engineName=RdfEngine)\")", "return": "void", "signature": "void setRdfEngine(Engine engine)", "full_signature": "@Reference(target = \"(engineName=RdfEngine)\") void setRdfEngine(Engine engine)", "class_method_signature": "GroupRest.setRdfEngine(Engine engine)", "testcase": false, "constructor": false}, {"identifier": "getGroups", "parameters": "()", "modifiers": "@GET @RolesAllowed(\"user\") @Produces(MediaType.APPLICATION_JSON) @ApiOperation(\"Get all Mobi Groups\") public", "return": "Response", "signature": "Response getGroups()", "full_signature": "@GET @RolesAllowed(\"user\") @Produces(MediaType.APPLICATION_JSON) @ApiOperation(\"Get all Mobi Groups\") public Response getGroups()", "class_method_signature": "GroupRest.getGroups()", "testcase": false, "constructor": false}, {"identifier": "createGroup", "parameters": "(@FormDataParam(\"title\") String title,\n                         @FormDataParam(\"description\") String description,\n                         @FormDataParam(\"roles\") List<FormDataBodyPart> roles,\n                         @FormDataParam(\"members\") List<FormDataBodyPart> members)", "modifiers": "@POST @RolesAllowed(\"admin\") @ApiOperation(\"Create a new Mobi Group\") @Produces(MediaType.TEXT_PLAIN) @Consumes(MediaType.MULTIPART_FORM_DATA) public", "return": "Response", "signature": "Response createGroup(@FormDataParam(\"title\") String title,\n                         @FormDataParam(\"description\") String description,\n                         @FormDataParam(\"roles\") List<FormDataBodyPart> roles,\n                         @FormDataParam(\"members\") List<FormDataBodyPart> members)", "full_signature": "@POST @RolesAllowed(\"admin\") @ApiOperation(\"Create a new Mobi Group\") @Produces(MediaType.TEXT_PLAIN) @Consumes(MediaType.MULTIPART_FORM_DATA) public Response createGroup(@FormDataParam(\"title\") String title,\n                         @FormDataParam(\"description\") String description,\n                         @FormDataParam(\"roles\") List<FormDataBodyPart> roles,\n                         @FormDataParam(\"members\") List<FormDataBodyPart> members)", "class_method_signature": "GroupRest.createGroup(@FormDataParam(\"title\") String title,\n                         @FormDataParam(\"description\") String description,\n                         @FormDataParam(\"roles\") List<FormDataBodyPart> roles,\n                         @FormDataParam(\"members\") List<FormDataBodyPart> members)", "testcase": false, "constructor": false}, {"identifier": "getGroup", "parameters": "(@PathParam(\"groupTitle\") String groupTitle)", "modifiers": "@GET @Path(\"{groupTitle}\") @RolesAllowed(\"user\") @Produces(MediaType.APPLICATION_JSON) @ApiOperation(\"Get a single Mobi Group\") public", "return": "Response", "signature": "Response getGroup(@PathParam(\"groupTitle\") String groupTitle)", "full_signature": "@GET @Path(\"{groupTitle}\") @RolesAllowed(\"user\") @Produces(MediaType.APPLICATION_JSON) @ApiOperation(\"Get a single Mobi Group\") public Response getGroup(@PathParam(\"groupTitle\") String groupTitle)", "class_method_signature": "GroupRest.getGroup(@PathParam(\"groupTitle\") String groupTitle)", "testcase": false, "constructor": false}, {"identifier": "updateGroup", "parameters": "(@PathParam(\"groupTitle\") String groupTitle, String newGroupStr)", "modifiers": "@PUT @Path(\"{groupTitle}\") @RolesAllowed(\"admin\") @ApiOperation(\"Update a Mobi Group's information\") @Consumes(MediaType.APPLICATION_JSON) public", "return": "Response", "signature": "Response updateGroup(@PathParam(\"groupTitle\") String groupTitle, String newGroupStr)", "full_signature": "@PUT @Path(\"{groupTitle}\") @RolesAllowed(\"admin\") @ApiOperation(\"Update a Mobi Group's information\") @Consumes(MediaType.APPLICATION_JSON) public Response updateGroup(@PathParam(\"groupTitle\") String groupTitle, String newGroupStr)", "class_method_signature": "GroupRest.updateGroup(@PathParam(\"groupTitle\") String groupTitle, String newGroupStr)", "testcase": false, "constructor": false}, {"identifier": "deleteGroup", "parameters": "(@PathParam(\"groupTitle\") String groupTitle)", "modifiers": "@DELETE @Path(\"{groupTitle}\") @RolesAllowed(\"admin\") @ApiOperation(\"Remove a Mobi Group\") public", "return": "Response", "signature": "Response deleteGroup(@PathParam(\"groupTitle\") String groupTitle)", "full_signature": "@DELETE @Path(\"{groupTitle}\") @RolesAllowed(\"admin\") @ApiOperation(\"Remove a Mobi Group\") public Response deleteGroup(@PathParam(\"groupTitle\") String groupTitle)", "class_method_signature": "GroupRest.deleteGroup(@PathParam(\"groupTitle\") String groupTitle)", "testcase": false, "constructor": false}, {"identifier": "getGroupRoles", "parameters": "(@PathParam(\"groupTitle\") String groupTitle)", "modifiers": "@GET @Path(\"{groupTitle}/roles\") @RolesAllowed(\"user\") @Produces(MediaType.APPLICATION_JSON) @ApiOperation(\"List roles of a Mobi Group\") public", "return": "Response", "signature": "Response getGroupRoles(@PathParam(\"groupTitle\") String groupTitle)", "full_signature": "@GET @Path(\"{groupTitle}/roles\") @RolesAllowed(\"user\") @Produces(MediaType.APPLICATION_JSON) @ApiOperation(\"List roles of a Mobi Group\") public Response getGroupRoles(@PathParam(\"groupTitle\") String groupTitle)", "class_method_signature": "GroupRest.getGroupRoles(@PathParam(\"groupTitle\") String groupTitle)", "testcase": false, "constructor": false}, {"identifier": "addGroupRoles", "parameters": "(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"roles\") List<String> roles)", "modifiers": "@PUT @Path(\"{groupTitle}/roles\") @RolesAllowed(\"admin\") @ApiOperation(\"Add roles to a Mobi Group\") public", "return": "Response", "signature": "Response addGroupRoles(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"roles\") List<String> roles)", "full_signature": "@PUT @Path(\"{groupTitle}/roles\") @RolesAllowed(\"admin\") @ApiOperation(\"Add roles to a Mobi Group\") public Response addGroupRoles(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"roles\") List<String> roles)", "class_method_signature": "GroupRest.addGroupRoles(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"roles\") List<String> roles)", "testcase": false, "constructor": false}, {"identifier": "removeGroupRole", "parameters": "(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"role\") String role)", "modifiers": "@DELETE @Path(\"{groupTitle}/roles\") @RolesAllowed(\"admin\") @ApiOperation(\"Remove role from a Mobi Group\") public", "return": "Response", "signature": "Response removeGroupRole(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"role\") String role)", "full_signature": "@DELETE @Path(\"{groupTitle}/roles\") @RolesAllowed(\"admin\") @ApiOperation(\"Remove role from a Mobi Group\") public Response removeGroupRole(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"role\") String role)", "class_method_signature": "GroupRest.removeGroupRole(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"role\") String role)", "testcase": false, "constructor": false}, {"identifier": "getGroupUsers", "parameters": "(@PathParam(\"groupTitle\") String groupTitle)", "modifiers": "@GET @Path(\"{groupTitle}/users\") @RolesAllowed(\"user\") @Produces(MediaType.APPLICATION_JSON) @ApiOperation(\"List users of a Mobi Group\") public", "return": "Response", "signature": "Response getGroupUsers(@PathParam(\"groupTitle\") String groupTitle)", "full_signature": "@GET @Path(\"{groupTitle}/users\") @RolesAllowed(\"user\") @Produces(MediaType.APPLICATION_JSON) @ApiOperation(\"List users of a Mobi Group\") public Response getGroupUsers(@PathParam(\"groupTitle\") String groupTitle)", "class_method_signature": "GroupRest.getGroupUsers(@PathParam(\"groupTitle\") String groupTitle)", "testcase": false, "constructor": false}, {"identifier": "addGroupUser", "parameters": "(@PathParam(\"groupTitle\") String groupTitle, \n                                 @QueryParam(\"users\") List<String> usernames)", "modifiers": "@PUT @Path(\"{groupTitle}/users\") @RolesAllowed(\"admin\") @ApiOperation(\"Add a Mobi User to a Group\") public", "return": "Response", "signature": "Response addGroupUser(@PathParam(\"groupTitle\") String groupTitle, \n                                 @QueryParam(\"users\") List<String> usernames)", "full_signature": "@PUT @Path(\"{groupTitle}/users\") @RolesAllowed(\"admin\") @ApiOperation(\"Add a Mobi User to a Group\") public Response addGroupUser(@PathParam(\"groupTitle\") String groupTitle, \n                                 @QueryParam(\"users\") List<String> usernames)", "class_method_signature": "GroupRest.addGroupUser(@PathParam(\"groupTitle\") String groupTitle, \n                                 @QueryParam(\"users\") List<String> usernames)", "testcase": false, "constructor": false}, {"identifier": "removeGroupUser", "parameters": "(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"user\") String username)", "modifiers": "@DELETE @Path(\"{groupTitle}/users\") @RolesAllowed(\"admin\") @ApiOperation(\"Remove a Mobi User from a Group\") public", "return": "Response", "signature": "Response removeGroupUser(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"user\") String username)", "full_signature": "@DELETE @Path(\"{groupTitle}/users\") @RolesAllowed(\"admin\") @ApiOperation(\"Remove a Mobi User from a Group\") public Response removeGroupUser(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"user\") String username)", "class_method_signature": "GroupRest.removeGroupUser(@PathParam(\"groupTitle\") String groupTitle, @QueryParam(\"user\") String username)", "testcase": false, "constructor": false}], "file": "com.mobi.jaas.rest/src/main/java/com/mobi/jaas/rest/GroupRest.java"}, "focal_method": {"identifier": "addGroupUser", "parameters": "(@PathParam(\"groupTitle\") String groupTitle, \n                                 @QueryParam(\"users\") List<String> usernames)", "modifiers": "@PUT @Path(\"{groupTitle}/users\") @RolesAllowed(\"admin\") @ApiOperation(\"Add a Mobi User to a Group\") public", "return": "Response", "body": "@PUT\n    @Path(\"{groupTitle}/users\")\n    @RolesAllowed(\"admin\")\n    @ApiOperation(\"Add a Mobi User to a Group\")\n    public Response addGroupUser(@PathParam(\"groupTitle\") String groupTitle, \n                                 @QueryParam(\"users\") List<String> usernames) {\n        if (StringUtils.isEmpty(groupTitle)) {\n            throw ErrorUtils.sendError(\"Group title must be provided\", Response.Status.BAD_REQUEST);\n        }\n\n        try {\n            Group savedGroup = engineManager.retrieveGroup(rdfEngine.getEngineName(), groupTitle).orElseThrow(() ->\n                    ErrorUtils.sendError(\"Group \" + groupTitle + \" not found\", Response.Status.BAD_REQUEST));\n            usernames.stream()\n                    .map(username -> engineManager.retrieveUser(username).orElseThrow(() ->\n                            ErrorUtils.sendError(\"User \" + username + \" not found\", Response.Status.BAD_REQUEST)))\n                    .forEach(savedGroup::addMember);\n            engineManager.updateGroup(rdfEngine.getEngineName(), savedGroup);\n            logger.info(\"Added user(s) \" + String.join(\", \", usernames) + \" to group \" + groupTitle);\n            return Response.ok().build();\n        } catch (IllegalArgumentException ex) {\n            throw ErrorUtils.sendError(ex.getMessage(), Response.Status.BAD_REQUEST);\n        }\n    }", "signature": "Response addGroupUser(@PathParam(\"groupTitle\") String groupTitle, \n                                 @QueryParam(\"users\") List<String> usernames)", "full_signature": "@PUT @Path(\"{groupTitle}/users\") @RolesAllowed(\"admin\") @ApiOperation(\"Add a Mobi User to a Group\") public Response addGroupUser(@PathParam(\"groupTitle\") String groupTitle, \n                                 @QueryParam(\"users\") List<String> usernames)", "class_method_signature": "GroupRest.addGroupUser(@PathParam(\"groupTitle\") String groupTitle, \n                                 @QueryParam(\"users\") List<String> usernames)", "testcase": false, "constructor": false, "invocations": ["isEmpty", "sendError", "orElseThrow", "retrieveGroup", "getEngineName", "sendError", "forEach", "map", "stream", "orElseThrow", "retrieveUser", "sendError", "updateGroup", "getEngineName", "info", "join", "build", "ok", "sendError", "getMessage"]}, "repository": {"repo_id": 62253355, "url": "https://github.com/inovexcorp/mobi", "language": "Java", "is_fork": false, "fork_count": 7, "stargazer_count": 30, "size": 54070, "license": "licensed"}}