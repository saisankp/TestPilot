{"test_class": {"identifier": "FossologyFileHandlerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "final String clearingTeam = \"clearingId\";", "modifier": "final", "type": "String", "declarator": "clearingTeam = \"clearingId\"", "var_name": "clearingTeam"}, {"original_string": "final String releaseId = \"id\";", "modifier": "final", "type": "String", "declarator": "releaseId = \"id\"", "var_name": "releaseId"}, {"original_string": "FossologyFileHandler fossologyFileHandler;", "modifier": "", "type": "FossologyFileHandler", "declarator": "fossologyFileHandler", "var_name": "fossologyFileHandler"}, {"original_string": "@Mock\n    private AttachmentConnector attachmentConnector;", "modifier": "@Mock\n    private", "type": "AttachmentConnector", "declarator": "attachmentConnector", "var_name": "attachmentConnector"}, {"original_string": "@Mock\n    private DatabaseConnector databaseConnector;", "modifier": "@Mock\n    private", "type": "DatabaseConnector", "declarator": "databaseConnector", "var_name": "databaseConnector"}, {"original_string": "@Mock\n    private FossologyUploader fossologyUploader;", "modifier": "@Mock\n    private", "type": "FossologyUploader", "declarator": "fossologyUploader", "var_name": "fossologyUploader"}, {"original_string": "@Mock\n    private ComponentService.Iface componentService;", "modifier": "@Mock\n    private", "type": "ComponentService.Iface", "declarator": "componentService", "var_name": "componentService"}, {"original_string": "private User user;", "modifier": "private", "type": "User", "declarator": "user", "var_name": "user"}], "file": "backend/src/src-fossology/src/test/java/org/eclipse/sw360/fossology/handler/FossologyFileHandlerTest.java"}, "test_case": {"identifier": "testGetStatusInFossology", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testGetStatusInFossology() throws Exception {\n        final String id1 = \"41\";\n        final FilledAttachment filledAttachment = getMockFilledAttachment(id1);\n\n        final Release release = mock(Release.class);\n        final Release updated = mock(Release.class);\n\n        when(componentService.getReleaseById(releaseId, user)).thenReturn(release, updated);\n\n        spyGetFilledSourceAttachment(filledAttachment);\n\n        int fossologyId = 14;\n        when(release.isSetFossologyId()).thenReturn(true);\n        when(release.getFossologyId()).thenReturn(\"\" + fossologyId);\n\n        String clearingTeam2 = \"anotherClearingTeam\";\n\n        when(fossologyUploader.getStatusInFossology(eq(fossologyId), eq(clearingTeam)))\n                .thenReturn(FossologyStatus.IN_PROGRESS);\n        when(fossologyUploader.getStatusInFossology(eq(fossologyId), eq(clearingTeam2)))\n                .thenReturn(FossologyStatus.OPEN);\n\n        doNothing().when(fossologyFileHandler)\n                .setFossologyStatus(eq(release), eq(clearingTeam), eq(FossologyStatus.IN_PROGRESS), eq(\"\" + fossologyId), eq(id1));\n\n        doReturn(ImmutableList.of(clearingTeam, clearingTeam2))\n                .when(fossologyFileHandler).getAllClearingTeams(release, clearingTeam);\n\n        final Release resultRelease = fossologyFileHandler.getStatusInFossology(releaseId, user, clearingTeam);\n\n        assertThat(resultRelease, is(sameInstance(release)));\n\n        verify(fossologyFileHandler).setFossologyStatus(release, clearingTeam, FossologyStatus.IN_PROGRESS);\n        verify(fossologyFileHandler).setFossologyStatus(release, clearingTeam2, FossologyStatus.OPEN);\n\n        verify(fossologyUploader).getStatusInFossology(fossologyId, clearingTeam);\n        verify(fossologyUploader).getStatusInFossology(fossologyId, clearingTeam2);\n\n        verify(componentService, atLeastOnce()).getReleaseById(releaseId, user);\n        verify(componentService).updateReleaseFossology(release, user);\n    }", "signature": "void testGetStatusInFossology()", "full_signature": "@Test public void testGetStatusInFossology()", "class_method_signature": "FossologyFileHandlerTest.testGetStatusInFossology()", "testcase": true, "constructor": false, "invocations": ["getMockFilledAttachment", "mock", "mock", "thenReturn", "when", "getReleaseById", "spyGetFilledSourceAttachment", "thenReturn", "when", "isSetFossologyId", "thenReturn", "when", "getFossologyId", "thenReturn", "when", "getStatusInFossology", "eq", "eq", "thenReturn", "when", "getStatusInFossology", "eq", "eq", "setFossologyStatus", "when", "doNothing", "eq", "eq", "eq", "eq", "eq", "getAllClearingTeams", "when", "doReturn", "of", "getStatusInFossology", "assertThat", "is", "sameInstance", "setFossologyStatus", "verify", "setFossologyStatus", "verify", "getStatusInFossology", "verify", "getStatusInFossology", "verify", "getReleaseById", "verify", "atLeastOnce", "updateReleaseFossology", "verify"]}, "focal_class": {"identifier": "FossologyFileHandler", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final static Logger log = getLogger(FossologyFileHandler.class);", "modifier": "private final static", "type": "Logger", "declarator": "log = getLogger(FossologyFileHandler.class)", "var_name": "log"}, {"original_string": "private final AttachmentConnector attachmentConnector;", "modifier": "private final", "type": "AttachmentConnector", "declarator": "attachmentConnector", "var_name": "attachmentConnector"}, {"original_string": "private final FossologyUploader fossologyUploader;", "modifier": "private final", "type": "FossologyUploader", "declarator": "fossologyUploader", "var_name": "fossologyUploader"}, {"original_string": "private final ThriftClients thriftClients;", "modifier": "private final", "type": "ThriftClients", "declarator": "thriftClients", "var_name": "thriftClients"}], "methods": [{"identifier": "FossologyFileHandler", "parameters": "(AttachmentConnector attachmentConnector, FossologyUploader fossologyUploader, ThriftClients thriftClients)", "modifiers": "@Autowired public", "return": "", "signature": " FossologyFileHandler(AttachmentConnector attachmentConnector, FossologyUploader fossologyUploader, ThriftClients thriftClients)", "full_signature": "@Autowired public  FossologyFileHandler(AttachmentConnector attachmentConnector, FossologyUploader fossologyUploader, ThriftClients thriftClients)", "class_method_signature": "FossologyFileHandler.FossologyFileHandler(AttachmentConnector attachmentConnector, FossologyUploader fossologyUploader, ThriftClients thriftClients)", "testcase": false, "constructor": true}, {"identifier": "sendToFossology", "parameters": "(String releaseId, User user, String clearingTeam)", "modifiers": "public", "return": "RequestStatus", "signature": "RequestStatus sendToFossology(String releaseId, User user, String clearingTeam)", "full_signature": "public RequestStatus sendToFossology(String releaseId, User user, String clearingTeam)", "class_method_signature": "FossologyFileHandler.sendToFossology(String releaseId, User user, String clearingTeam)", "testcase": false, "constructor": false}, {"identifier": "checkSourceAttachment", "parameters": "(Release release, FilledAttachment filledAttachment)", "modifiers": "protected", "return": "boolean", "signature": "boolean checkSourceAttachment(Release release, FilledAttachment filledAttachment)", "full_signature": "protected boolean checkSourceAttachment(Release release, FilledAttachment filledAttachment)", "class_method_signature": "FossologyFileHandler.checkSourceAttachment(Release release, FilledAttachment filledAttachment)", "testcase": false, "constructor": false}, {"identifier": "sendToFossologyNewUpload", "parameters": "(Release release, User user, String clearingTeam, AttachmentContent attachmentContent, ComponentService.Iface componentService)", "modifiers": "private", "return": "RequestStatus", "signature": "RequestStatus sendToFossologyNewUpload(Release release, User user, String clearingTeam, AttachmentContent attachmentContent, ComponentService.Iface componentService)", "full_signature": "private RequestStatus sendToFossologyNewUpload(Release release, User user, String clearingTeam, AttachmentContent attachmentContent, ComponentService.Iface componentService)", "class_method_signature": "FossologyFileHandler.sendToFossologyNewUpload(Release release, User user, String clearingTeam, AttachmentContent attachmentContent, ComponentService.Iface componentService)", "testcase": false, "constructor": false}, {"identifier": "sendToFossologyExistingUpload", "parameters": "(Release release, User user, String clearingTeam, ComponentService.Iface componentClient)", "modifiers": "private", "return": "RequestStatus", "signature": "RequestStatus sendToFossologyExistingUpload(Release release, User user, String clearingTeam, ComponentService.Iface componentClient)", "full_signature": "private RequestStatus sendToFossologyExistingUpload(Release release, User user, String clearingTeam, ComponentService.Iface componentClient)", "class_method_signature": "FossologyFileHandler.sendToFossologyExistingUpload(Release release, User user, String clearingTeam, ComponentService.Iface componentClient)", "testcase": false, "constructor": false}, {"identifier": "duplicateUploadFor", "parameters": "(Release release, User user, String clearingTeam, int fossologyUploadId, ComponentService.Iface componentClient)", "modifiers": "private", "return": "RequestStatus", "signature": "RequestStatus duplicateUploadFor(Release release, User user, String clearingTeam, int fossologyUploadId, ComponentService.Iface componentClient)", "full_signature": "private RequestStatus duplicateUploadFor(Release release, User user, String clearingTeam, int fossologyUploadId, ComponentService.Iface componentClient)", "class_method_signature": "FossologyFileHandler.duplicateUploadFor(Release release, User user, String clearingTeam, int fossologyUploadId, ComponentService.Iface componentClient)", "testcase": false, "constructor": false}, {"identifier": "updateFossologyStatus", "parameters": "(Release release, User user, String clearingTeam, FossologyStatus currentStatus, ComponentService.Iface componentService)", "modifiers": "private", "return": "void", "signature": "void updateFossologyStatus(Release release, User user, String clearingTeam, FossologyStatus currentStatus, ComponentService.Iface componentService)", "full_signature": "private void updateFossologyStatus(Release release, User user, String clearingTeam, FossologyStatus currentStatus, ComponentService.Iface componentService)", "class_method_signature": "FossologyFileHandler.updateFossologyStatus(Release release, User user, String clearingTeam, FossologyStatus currentStatus, ComponentService.Iface componentService)", "testcase": false, "constructor": false}, {"identifier": "isVisible", "parameters": "(FossologyStatus statusInFossology)", "modifiers": "protected static", "return": "boolean", "signature": "boolean isVisible(FossologyStatus statusInFossology)", "full_signature": "protected static boolean isVisible(FossologyStatus statusInFossology)", "class_method_signature": "FossologyFileHandler.isVisible(FossologyStatus statusInFossology)", "testcase": false, "constructor": false}, {"identifier": "isError", "parameters": "(FossologyStatus status)", "modifiers": "protected static", "return": "boolean", "signature": "boolean isError(FossologyStatus status)", "full_signature": "protected static boolean isError(FossologyStatus status)", "class_method_signature": "FossologyFileHandler.isError(FossologyStatus status)", "testcase": false, "constructor": false}, {"identifier": "getStatusInFossology", "parameters": "(String releaseId, User user, String clearingTeam)", "modifiers": "public", "return": "Release", "signature": "Release getStatusInFossology(String releaseId, User user, String clearingTeam)", "full_signature": "public Release getStatusInFossology(String releaseId, User user, String clearingTeam)", "class_method_signature": "FossologyFileHandler.getStatusInFossology(String releaseId, User user, String clearingTeam)", "testcase": false, "constructor": false}, {"identifier": "updateReleaseClearingState", "parameters": "(Release release, FossologyStatus fossologyStatus)", "modifiers": "private", "return": "void", "signature": "void updateReleaseClearingState(Release release, FossologyStatus fossologyStatus)", "full_signature": "private void updateReleaseClearingState(Release release, FossologyStatus fossologyStatus)", "class_method_signature": "FossologyFileHandler.updateReleaseClearingState(Release release, FossologyStatus fossologyStatus)", "testcase": false, "constructor": false}, {"identifier": "updateReleaseClearingState", "parameters": "(Release release, Optional<FossologyStatus> fossologyStatus)", "modifiers": "private", "return": "void", "signature": "void updateReleaseClearingState(Release release, Optional<FossologyStatus> fossologyStatus)", "full_signature": "private void updateReleaseClearingState(Release release, Optional<FossologyStatus> fossologyStatus)", "class_method_signature": "FossologyFileHandler.updateReleaseClearingState(Release release, Optional<FossologyStatus> fossologyStatus)", "testcase": false, "constructor": false}, {"identifier": "mapFossologyStatusToClearingState", "parameters": "(FossologyStatus fossologyStatus)", "modifiers": "private", "return": "Optional<ClearingState>", "signature": "Optional<ClearingState> mapFossologyStatusToClearingState(FossologyStatus fossologyStatus)", "full_signature": "private Optional<ClearingState> mapFossologyStatusToClearingState(FossologyStatus fossologyStatus)", "class_method_signature": "FossologyFileHandler.mapFossologyStatusToClearingState(FossologyStatus fossologyStatus)", "testcase": false, "constructor": false}, {"identifier": "getReleaseAndUnlockIt", "parameters": "(String releaseId, User user, ComponentService.Iface componentClient)", "modifiers": "protected", "return": "Release", "signature": "Release getReleaseAndUnlockIt(String releaseId, User user, ComponentService.Iface componentClient)", "full_signature": "protected Release getReleaseAndUnlockIt(String releaseId, User user, ComponentService.Iface componentClient)", "class_method_signature": "FossologyFileHandler.getReleaseAndUnlockIt(String releaseId, User user, ComponentService.Iface componentClient)", "testcase": false, "constructor": false}, {"identifier": "getAllClearingTeams", "parameters": "(Release release, String clearingTeam)", "modifiers": "protected", "return": "Iterable<? extends String>", "signature": "Iterable<? extends String> getAllClearingTeams(Release release, String clearingTeam)", "full_signature": "protected Iterable<? extends String> getAllClearingTeams(Release release, String clearingTeam)", "class_method_signature": "FossologyFileHandler.getAllClearingTeams(Release release, String clearingTeam)", "testcase": false, "constructor": false}, {"identifier": "setFossologyStatus", "parameters": "(Release release, final String clearingTeam, FossologyStatus status)", "modifiers": "protected", "return": "void", "signature": "void setFossologyStatus(Release release, final String clearingTeam, FossologyStatus status)", "full_signature": "protected void setFossologyStatus(Release release, final String clearingTeam, FossologyStatus status)", "class_method_signature": "FossologyFileHandler.setFossologyStatus(Release release, final String clearingTeam, FossologyStatus status)", "testcase": false, "constructor": false}, {"identifier": "setFossologyStatus", "parameters": "(Release release, final String clearingTeam, FossologyStatus status, String fossologyUploadId, String attachmentId)", "modifiers": "protected", "return": "void", "signature": "void setFossologyStatus(Release release, final String clearingTeam, FossologyStatus status, String fossologyUploadId, String attachmentId)", "full_signature": "protected void setFossologyStatus(Release release, final String clearingTeam, FossologyStatus status, String fossologyUploadId, String attachmentId)", "class_method_signature": "FossologyFileHandler.setFossologyStatus(Release release, final String clearingTeam, FossologyStatus status, String fossologyUploadId, String attachmentId)", "testcase": false, "constructor": false}, {"identifier": "updateRelease", "parameters": "(Release release, User user, ComponentService.Iface componentService)", "modifiers": "protected", "return": "RequestStatus", "signature": "RequestStatus updateRelease(Release release, User user, ComponentService.Iface componentService)", "full_signature": "protected RequestStatus updateRelease(Release release, User user, ComponentService.Iface componentService)", "class_method_signature": "FossologyFileHandler.updateRelease(Release release, User user, ComponentService.Iface componentService)", "testcase": false, "constructor": false}, {"identifier": "getSourceAttachment", "parameters": "(String releaseId, User user, ComponentService.Iface componentClient)", "modifiers": "protected", "return": "Set<Attachment>", "signature": "Set<Attachment> getSourceAttachment(String releaseId, User user, ComponentService.Iface componentClient)", "full_signature": "protected Set<Attachment> getSourceAttachment(String releaseId, User user, ComponentService.Iface componentClient)", "class_method_signature": "FossologyFileHandler.getSourceAttachment(String releaseId, User user, ComponentService.Iface componentClient)", "testcase": false, "constructor": false}, {"identifier": "fillAttachment", "parameters": "(Attachment attachment)", "modifiers": "protected", "return": "FilledAttachment", "signature": "FilledAttachment fillAttachment(Attachment attachment)", "full_signature": "protected FilledAttachment fillAttachment(Attachment attachment)", "class_method_signature": "FossologyFileHandler.fillAttachment(Attachment attachment)", "testcase": false, "constructor": false}], "file": "backend/src/src-fossology/src/main/java/org/eclipse/sw360/fossology/handler/FossologyFileHandler.java"}, "focal_method": {"identifier": "getStatusInFossology", "parameters": "(String releaseId, User user, String clearingTeam)", "modifiers": "public", "return": "Release", "body": "public Release getStatusInFossology(String releaseId, User user, String clearingTeam) throws TException {\n        final Release release;\n        final ComponentService.Iface componentClient;\n\n        try {\n            componentClient = thriftClients.makeComponentClient();\n            release = componentClient.getReleaseById(releaseId, user);\n            assertNotNull(release);\n        } catch (TException e) {\n            log.error(\"cannot get release \" + releaseId, e);\n            throw e;\n        }\n\n        if (release.isSetFossologyId()) {\n            int fossologyId = CommonUtils.toUnsignedInt(release.getFossologyId());\n\n            boolean updateInDb = true;\n            for (String allClearingTeam : getAllClearingTeams(release, clearingTeam)) {\n                final FossologyStatus status = fossologyUploader.getStatusInFossology(fossologyId, allClearingTeam);\n                setFossologyStatus(release, allClearingTeam, status);\n\n                if (isError(status)) {\n                    updateInDb = false;\n                }\n            }\n            Optional<FossologyStatus> maxStatus = nullToEmptyMap(release.getClearingTeamToFossologyStatus())\n                    .values()\n                    .stream()\n                    .max(FossologyStatus::compareTo);\n            updateReleaseClearingState(release, maxStatus);\n\n            if (updateInDb) {\n                updateRelease(release, user, componentClient);\n            }\n        }\n\n        getReleaseAndUnlockIt(releaseId, user, componentClient); // just unlockit\n\n        return release;\n    }", "signature": "Release getStatusInFossology(String releaseId, User user, String clearingTeam)", "full_signature": "public Release getStatusInFossology(String releaseId, User user, String clearingTeam)", "class_method_signature": "FossologyFileHandler.getStatusInFossology(String releaseId, User user, String clearingTeam)", "testcase": false, "constructor": false, "invocations": ["makeComponentClient", "getReleaseById", "assertNotNull", "error", "isSetFossologyId", "toUnsignedInt", "getFossologyId", "getAllClearingTeams", "getStatusInFossology", "setFossologyStatus", "isError", "max", "stream", "values", "nullToEmptyMap", "getClearingTeamToFossologyStatus", "updateReleaseClearingState", "updateRelease", "getReleaseAndUnlockIt"]}, "repository": {"repo_id": 43326581, "url": "https://github.com/sw360/sw360portal", "language": "Java", "is_fork": false, "fork_count": 23, "stargazer_count": 31, "size": 8770, "license": "licensed"}}