{"test_class": {"identifier": "X509RoleCertRequestTest", "superclass": "", "interfaces": "", "fields": [], "file": "servers/zts/src/test/java/com/yahoo/athenz/zts/cert/X509RoleCertRequestTest.java"}, "test_case": {"identifier": "testValidateProxyUserUri", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testValidateProxyUserUri() throws IOException {\n\n        Path path = Paths.get(\"src/test/resources/proxy_role.csr\");\n        String csr = new String(Files.readAllBytes(path));\n\n        X509RoleCertRequest certReq = new X509RoleCertRequest(csr);\n\n        Set<String> roles = new HashSet<>();\n        roles.add(\"api\");\n\n        Set<String> orgValues = new HashSet<>();\n        orgValues.add(\"Athenz\");\n\n        // valid proxy user\n        assertTrue(certReq.validate(roles, \"coretech\", \"sports.api\", \"proxy.user\", orgValues));\n\n        // mismatch proxy user\n        assertFalse(certReq.validate(roles, \"coretech\", \"sports.api\", \"proxy2.user\", orgValues));\n    }", "signature": "void testValidateProxyUserUri()", "full_signature": "@Test public void testValidateProxyUserUri()", "class_method_signature": "X509RoleCertRequestTest.testValidateProxyUserUri()", "testcase": true, "constructor": false, "invocations": ["get", "readAllBytes", "add", "add", "assertTrue", "validate", "assertFalse", "validate"]}, "focal_class": {"identifier": "X509RoleCertRequest", "superclass": "extends X509CertRequest", "interfaces": "", "fields": [{"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(X509RoleCertRequest.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(X509RoleCertRequest.class)", "var_name": "LOGGER"}], "methods": [{"identifier": "X509RoleCertRequest", "parameters": "(String csr)", "modifiers": "public", "return": "", "signature": " X509RoleCertRequest(String csr)", "full_signature": "public  X509RoleCertRequest(String csr)", "class_method_signature": "X509RoleCertRequest.X509RoleCertRequest(String csr)", "testcase": false, "constructor": true}, {"identifier": "getRequestedRoleList", "parameters": "()", "modifiers": "public", "return": "Map<String, String[]>", "signature": "Map<String, String[]> getRequestedRoleList()", "full_signature": "public Map<String, String[]> getRequestedRoleList()", "class_method_signature": "X509RoleCertRequest.getRequestedRoleList()", "testcase": false, "constructor": false}, {"identifier": "validateAndExtractRoleName", "parameters": "(Set<String> roles, final String domainName)", "modifiers": "", "return": "String", "signature": "String validateAndExtractRoleName(Set<String> roles, final String domainName)", "full_signature": " String validateAndExtractRoleName(Set<String> roles, final String domainName)", "class_method_signature": "X509RoleCertRequest.validateAndExtractRoleName(Set<String> roles, final String domainName)", "testcase": false, "constructor": false}, {"identifier": "validateProxyUserUri", "parameters": "(final String proxyUser)", "modifiers": "", "return": "boolean", "signature": "boolean validateProxyUserUri(final String proxyUser)", "full_signature": " boolean validateProxyUserUri(final String proxyUser)", "class_method_signature": "X509RoleCertRequest.validateProxyUserUri(final String proxyUser)", "testcase": false, "constructor": false}, {"identifier": "validateEmail", "parameters": "(final String principal)", "modifiers": "", "return": "boolean", "signature": "boolean validateEmail(final String principal)", "full_signature": " boolean validateEmail(final String principal)", "class_method_signature": "X509RoleCertRequest.validateEmail(final String principal)", "testcase": false, "constructor": false}, {"identifier": "validate", "parameters": "(Set<String> roles, final String domainName, final String principal,\n            final String proxyUser, Set<String> validCertSubjectOrgValues)", "modifiers": "public", "return": "boolean", "signature": "boolean validate(Set<String> roles, final String domainName, final String principal,\n            final String proxyUser, Set<String> validCertSubjectOrgValues)", "full_signature": "public boolean validate(Set<String> roles, final String domainName, final String principal,\n            final String proxyUser, Set<String> validCertSubjectOrgValues)", "class_method_signature": "X509RoleCertRequest.validate(Set<String> roles, final String domainName, final String principal,\n            final String proxyUser, Set<String> validCertSubjectOrgValues)", "testcase": false, "constructor": false}, {"identifier": "validate", "parameters": "(final String principal, final String proxyUser,\n            Set<String> validCertSubjectOrgValues)", "modifiers": "public", "return": "boolean", "signature": "boolean validate(final String principal, final String proxyUser,\n            Set<String> validCertSubjectOrgValues)", "full_signature": "public boolean validate(final String principal, final String proxyUser,\n            Set<String> validCertSubjectOrgValues)", "class_method_signature": "X509RoleCertRequest.validate(final String principal, final String proxyUser,\n            Set<String> validCertSubjectOrgValues)", "testcase": false, "constructor": false}, {"identifier": "validateIPAddress", "parameters": "(X509Certificate cert, final String ip)", "modifiers": "public", "return": "boolean", "signature": "boolean validateIPAddress(X509Certificate cert, final String ip)", "full_signature": "public boolean validateIPAddress(X509Certificate cert, final String ip)", "class_method_signature": "X509RoleCertRequest.validateIPAddress(X509Certificate cert, final String ip)", "testcase": false, "constructor": false}], "file": "servers/zts/src/main/java/com/yahoo/athenz/zts/cert/X509RoleCertRequest.java"}, "focal_method": {"identifier": "validateProxyUserUri", "parameters": "(final String proxyUser)", "modifiers": "", "return": "boolean", "body": "boolean validateProxyUserUri(final String proxyUser) {\n\n        // if we have not URI values then it's failure\n\n        if (uris == null || uris.isEmpty()) {\n            LOGGER.error(\"No URI fields available in the CSR\");\n            return false;\n        }\n\n        // we must only have a single spiffe uri in the list\n\n        String proxyUserUri = null;\n        for (String uri : uris) {\n\n            if (!uri.toLowerCase().startsWith(ZTSConsts.ZTS_CERT_PROXY_USER_URI)) {\n                continue;\n            }\n\n            if (proxyUserUri != null) {\n                LOGGER.error(\"Multiple ProxyUser URIs in the CSR: {}/{}\", uri, proxyUserUri);\n                return false;\n            }\n\n            proxyUserUri = uri;\n        }\n\n        if (proxyUserUri == null) {\n            LOGGER.error(\"No ProxyUserURI fields available in the CSR\");\n            return false;\n        }\n\n        final String uriCheck = ZTSConsts.ZTS_CERT_PROXY_USER_URI + proxyUser;\n        if (!proxyUserUri.equals(uriCheck)) {\n            LOGGER.error(\"ProxyUserURI mismatch: {} vs {}\", proxyUserUri, uriCheck);\n            return false;\n        }\n\n        return true;\n    }", "signature": "boolean validateProxyUserUri(final String proxyUser)", "full_signature": " boolean validateProxyUserUri(final String proxyUser)", "class_method_signature": "X509RoleCertRequest.validateProxyUserUri(final String proxyUser)", "testcase": false, "constructor": false, "invocations": ["isEmpty", "error", "startsWith", "toLowerCase", "error", "error", "equals", "error"]}, "repository": {"repo_id": 73948366, "url": "https://github.com/yahoo/athenz", "stars": 394, "created": "11/16/2016 6:23:08 PM +00:00", "updates": "2020-01-27T15:36:13+00:00", "fork": "False", "license": "licensed"}}