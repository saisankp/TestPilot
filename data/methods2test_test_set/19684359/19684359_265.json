{"test_class": {"identifier": "PerformanceCachingGoogleCloudStorageTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final HashCode EMPTY_OBJECT_MD5 = Hashing.md5().hashBytes(new byte[0]);", "modifier": "private static final", "type": "HashCode", "declarator": "EMPTY_OBJECT_MD5 = Hashing.md5().hashBytes(new byte[0])", "var_name": "EMPTY_OBJECT_MD5"}, {"original_string": "private static final HashCode EMPTY_OBJECT_CRC32C = Hashing.crc32c().hashBytes(new byte[0]);", "modifier": "private static final", "type": "HashCode", "declarator": "EMPTY_OBJECT_CRC32C = Hashing.crc32c().hashBytes(new byte[0])", "var_name": "EMPTY_OBJECT_CRC32C"}, {"original_string": "private static final ImmutableMap<String, byte[]> TEST_METADATA =\n      ImmutableMap.of(\"test_key\", new byte[] {2});", "modifier": "private static final", "type": "ImmutableMap<String, byte[]>", "declarator": "TEST_METADATA =\n      ImmutableMap.of(\"test_key\", new byte[] {2})", "var_name": "TEST_METADATA"}, {"original_string": "private static final CreateBucketOptions CREATE_BUCKET_OPTIONS =\n      CreateBucketOptions.builder()\n          .setLocation(\"test_location\")\n          .setStorageClass(\"test_storage_class\")\n          .build();", "modifier": "private static final", "type": "CreateBucketOptions", "declarator": "CREATE_BUCKET_OPTIONS =\n      CreateBucketOptions.builder()\n          .setLocation(\"test_location\")\n          .setStorageClass(\"test_storage_class\")\n          .build()", "var_name": "CREATE_BUCKET_OPTIONS"}, {"original_string": "private static final CreateObjectOptions CREATE_OBJECT_OPTIONS =\n      CreateObjectOptions.DEFAULT_OVERWRITE.toBuilder()\n          .setContentType(\"test_content_type\")\n          .setMetadata(TEST_METADATA)\n          .build();", "modifier": "private static final", "type": "CreateObjectOptions", "declarator": "CREATE_OBJECT_OPTIONS =\n      CreateObjectOptions.DEFAULT_OVERWRITE.toBuilder()\n          .setContentType(\"test_content_type\")\n          .setMetadata(TEST_METADATA)\n          .build()", "var_name": "CREATE_OBJECT_OPTIONS"}, {"original_string": "private static final String BUCKET_A = \"alpha\";", "modifier": "private static final", "type": "String", "declarator": "BUCKET_A = \"alpha\"", "var_name": "BUCKET_A"}, {"original_string": "private static final String BUCKET_B = \"alph\";", "modifier": "private static final", "type": "String", "declarator": "BUCKET_B = \"alph\"", "var_name": "BUCKET_B"}, {"original_string": "private static final String PREFIX_A = \"bar\";", "modifier": "private static final", "type": "String", "declarator": "PREFIX_A = \"bar\"", "var_name": "PREFIX_A"}, {"original_string": "private static final String PREFIX_AA = \"bar/apple\";", "modifier": "private static final", "type": "String", "declarator": "PREFIX_AA = \"bar/apple\"", "var_name": "PREFIX_AA"}, {"original_string": "private static final String PREFIX_ABA = \"bar/berry/foo\";", "modifier": "private static final", "type": "String", "declarator": "PREFIX_ABA = \"bar/berry/foo\"", "var_name": "PREFIX_ABA"}, {"original_string": "private static final String PREFIX_B = \"baz\";", "modifier": "private static final", "type": "String", "declarator": "PREFIX_B = \"baz\"", "var_name": "PREFIX_B"}, {"original_string": "private static final GoogleCloudStorageItemInfo ITEM_A = createBucketItemInfo(BUCKET_A);", "modifier": "private static final", "type": "GoogleCloudStorageItemInfo", "declarator": "ITEM_A = createBucketItemInfo(BUCKET_A)", "var_name": "ITEM_A"}, {"original_string": "private static final GoogleCloudStorageItemInfo ITEM_B = createBucketItemInfo(BUCKET_B);", "modifier": "private static final", "type": "GoogleCloudStorageItemInfo", "declarator": "ITEM_B = createBucketItemInfo(BUCKET_B)", "var_name": "ITEM_B"}, {"original_string": "private static final GoogleCloudStorageItemInfo ITEM_A_A =\n      createObjectItemInfo(BUCKET_A, PREFIX_A);", "modifier": "private static final", "type": "GoogleCloudStorageItemInfo", "declarator": "ITEM_A_A =\n      createObjectItemInfo(BUCKET_A, PREFIX_A)", "var_name": "ITEM_A_A"}, {"original_string": "private static final GoogleCloudStorageItemInfo ITEM_A_AA =\n      createObjectItemInfo(BUCKET_A, PREFIX_AA);", "modifier": "private static final", "type": "GoogleCloudStorageItemInfo", "declarator": "ITEM_A_AA =\n      createObjectItemInfo(BUCKET_A, PREFIX_AA)", "var_name": "ITEM_A_AA"}, {"original_string": "private static final GoogleCloudStorageItemInfo ITEM_A_ABA =\n      createObjectItemInfo(BUCKET_A, PREFIX_ABA);", "modifier": "private static final", "type": "GoogleCloudStorageItemInfo", "declarator": "ITEM_A_ABA =\n      createObjectItemInfo(BUCKET_A, PREFIX_ABA)", "var_name": "ITEM_A_ABA"}, {"original_string": "private static final GoogleCloudStorageItemInfo ITEM_A_B =\n      createObjectItemInfo(BUCKET_A, PREFIX_B);", "modifier": "private static final", "type": "GoogleCloudStorageItemInfo", "declarator": "ITEM_A_B =\n      createObjectItemInfo(BUCKET_A, PREFIX_B)", "var_name": "ITEM_A_B"}, {"original_string": "private static final GoogleCloudStorageItemInfo ITEM_B_A =\n      createObjectItemInfo(BUCKET_B, PREFIX_A);", "modifier": "private static final", "type": "GoogleCloudStorageItemInfo", "declarator": "ITEM_B_A =\n      createObjectItemInfo(BUCKET_B, PREFIX_A)", "var_name": "ITEM_B_A"}, {"original_string": "private static final GoogleCloudStorageItemInfo ITEM_B_B =\n      createObjectItemInfo(BUCKET_B, PREFIX_B);", "modifier": "private static final", "type": "GoogleCloudStorageItemInfo", "declarator": "ITEM_B_B =\n      createObjectItemInfo(BUCKET_B, PREFIX_B)", "var_name": "ITEM_B_B"}, {"original_string": "private TestClock clock;", "modifier": "private", "type": "TestClock", "declarator": "clock", "var_name": "clock"}, {"original_string": "private PerformanceCachingGoogleCloudStorage gcs;", "modifier": "private", "type": "PerformanceCachingGoogleCloudStorage", "declarator": "gcs", "var_name": "gcs"}, {"original_string": "private PrefixMappedItemCache cache;", "modifier": "private", "type": "PrefixMappedItemCache", "declarator": "cache", "var_name": "cache"}, {"original_string": "private GoogleCloudStorage gcsDelegate;", "modifier": "private", "type": "GoogleCloudStorage", "declarator": "gcsDelegate", "var_name": "gcsDelegate"}], "file": "gcsio/src/test/java/com/google/cloud/hadoop/gcsio/PerformanceCachingGoogleCloudStorageTest.java"}, "test_case": {"identifier": "testGetItemInfosSomeCached", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testGetItemInfosSomeCached() throws IOException {\n    List<StorageResourceId> requestedIds =\n        Lists.newArrayList(\n            ITEM_A_A.getResourceId(), // Not cached\n            ITEM_A_B.getResourceId(), // Cached\n            ITEM_B_A.getResourceId(), // Not cached\n            ITEM_B_B.getResourceId()); // Cached\n    List<StorageResourceId> uncachedIds =\n        Lists.newArrayList(ITEM_A_A.getResourceId(), ITEM_B_A.getResourceId());\n    List<GoogleCloudStorageItemInfo> expected =\n        Lists.newArrayList(ITEM_A_A, ITEM_A_B, ITEM_B_A, ITEM_B_B);\n\n    // Prepare the cache.\n    cache.putItem(ITEM_A_B);\n    cache.putItem(ITEM_B_B);\n\n    List<GoogleCloudStorageItemInfo> result = gcs.getItemInfos(requestedIds);\n\n    // Verify the delegate call.\n    verify(gcsDelegate).getItemInfos(eq(uncachedIds));\n    // Verify the result and its ordering.\n    assertThat(result).containsExactlyElementsIn(expected).inOrder();\n    // Verify the state of the cache.\n    assertThat(cache.getAllItemsRaw()).containsExactlyElementsIn(expected);\n  }", "signature": "void testGetItemInfosSomeCached()", "full_signature": "@Test public void testGetItemInfosSomeCached()", "class_method_signature": "PerformanceCachingGoogleCloudStorageTest.testGetItemInfosSomeCached()", "testcase": true, "constructor": false, "invocations": ["newArrayList", "getResourceId", "getResourceId", "getResourceId", "getResourceId", "newArrayList", "getResourceId", "getResourceId", "newArrayList", "putItem", "putItem", "getItemInfos", "getItemInfos", "verify", "eq", "inOrder", "containsExactlyElementsIn", "assertThat", "containsExactlyElementsIn", "assertThat", "getAllItemsRaw"]}, "focal_class": {"identifier": "PerformanceCachingGoogleCloudStorage", "superclass": "extends ForwardingGoogleCloudStorage", "interfaces": "", "fields": [{"original_string": "private final PrefixMappedItemCache cache;", "modifier": "private final", "type": "PrefixMappedItemCache", "declarator": "cache", "var_name": "cache"}], "methods": [{"identifier": "PerformanceCachingGoogleCloudStorage", "parameters": "(\n      GoogleCloudStorage delegate, PerformanceCachingGoogleCloudStorageOptions options)", "modifiers": "public", "return": "", "signature": " PerformanceCachingGoogleCloudStorage(\n      GoogleCloudStorage delegate, PerformanceCachingGoogleCloudStorageOptions options)", "full_signature": "public  PerformanceCachingGoogleCloudStorage(\n      GoogleCloudStorage delegate, PerformanceCachingGoogleCloudStorageOptions options)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.PerformanceCachingGoogleCloudStorage(\n      GoogleCloudStorage delegate, PerformanceCachingGoogleCloudStorageOptions options)", "testcase": false, "constructor": true}, {"identifier": "PerformanceCachingGoogleCloudStorage", "parameters": "(\n      GoogleCloudStorage delegate,\n      PrefixMappedItemCache cache)", "modifiers": "@VisibleForTesting", "return": "", "signature": " PerformanceCachingGoogleCloudStorage(\n      GoogleCloudStorage delegate,\n      PrefixMappedItemCache cache)", "full_signature": "@VisibleForTesting  PerformanceCachingGoogleCloudStorage(\n      GoogleCloudStorage delegate,\n      PrefixMappedItemCache cache)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.PerformanceCachingGoogleCloudStorage(\n      GoogleCloudStorage delegate,\n      PrefixMappedItemCache cache)", "testcase": false, "constructor": true}, {"identifier": "createCache", "parameters": "(\n      PerformanceCachingGoogleCloudStorageOptions options)", "modifiers": "private static", "return": "PrefixMappedItemCache", "signature": "PrefixMappedItemCache createCache(\n      PerformanceCachingGoogleCloudStorageOptions options)", "full_signature": "private static PrefixMappedItemCache createCache(\n      PerformanceCachingGoogleCloudStorageOptions options)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.createCache(\n      PerformanceCachingGoogleCloudStorageOptions options)", "testcase": false, "constructor": false}, {"identifier": "create", "parameters": "(StorageResourceId resourceId)", "modifiers": "@Override public", "return": "WritableByteChannel", "signature": "WritableByteChannel create(StorageResourceId resourceId)", "full_signature": "@Override public WritableByteChannel create(StorageResourceId resourceId)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.create(StorageResourceId resourceId)", "testcase": false, "constructor": false}, {"identifier": "deleteBuckets", "parameters": "(List<String> bucketNames)", "modifiers": "@Override public", "return": "void", "signature": "void deleteBuckets(List<String> bucketNames)", "full_signature": "@Override public void deleteBuckets(List<String> bucketNames)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.deleteBuckets(List<String> bucketNames)", "testcase": false, "constructor": false}, {"identifier": "deleteObjects", "parameters": "(List<StorageResourceId> resourceIds)", "modifiers": "@Override public", "return": "void", "signature": "void deleteObjects(List<StorageResourceId> resourceIds)", "full_signature": "@Override public void deleteObjects(List<StorageResourceId> resourceIds)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.deleteObjects(List<StorageResourceId> resourceIds)", "testcase": false, "constructor": false}, {"identifier": "listBucketInfo", "parameters": "()", "modifiers": "@Override public", "return": "List<GoogleCloudStorageItemInfo>", "signature": "List<GoogleCloudStorageItemInfo> listBucketInfo()", "full_signature": "@Override public List<GoogleCloudStorageItemInfo> listBucketInfo()", "class_method_signature": "PerformanceCachingGoogleCloudStorage.listBucketInfo()", "testcase": false, "constructor": false}, {"identifier": "listObjectNames", "parameters": "(String bucketName, String objectNamePrefix)", "modifiers": "@Override public", "return": "List<String>", "signature": "List<String> listObjectNames(String bucketName, String objectNamePrefix)", "full_signature": "@Override public List<String> listObjectNames(String bucketName, String objectNamePrefix)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.listObjectNames(String bucketName, String objectNamePrefix)", "testcase": false, "constructor": false}, {"identifier": "listObjectNames", "parameters": "(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions)", "modifiers": "@Override public", "return": "List<String>", "signature": "List<String> listObjectNames(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions)", "full_signature": "@Override public List<String> listObjectNames(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.listObjectNames(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions)", "testcase": false, "constructor": false}, {"identifier": "listObjectInfo", "parameters": "(String bucketName, String objectNamePrefix)", "modifiers": "@Override public", "return": "List<GoogleCloudStorageItemInfo>", "signature": "List<GoogleCloudStorageItemInfo> listObjectInfo(String bucketName, String objectNamePrefix)", "full_signature": "@Override public List<GoogleCloudStorageItemInfo> listObjectInfo(String bucketName, String objectNamePrefix)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.listObjectInfo(String bucketName, String objectNamePrefix)", "testcase": false, "constructor": false}, {"identifier": "listObjectInfo", "parameters": "(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions)", "modifiers": "@Override public", "return": "List<GoogleCloudStorageItemInfo>", "signature": "List<GoogleCloudStorageItemInfo> listObjectInfo(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions)", "full_signature": "@Override public List<GoogleCloudStorageItemInfo> listObjectInfo(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.listObjectInfo(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions)", "testcase": false, "constructor": false}, {"identifier": "listObjectInfoPage", "parameters": "(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions, String pageToken)", "modifiers": "@Override public", "return": "ListPage<GoogleCloudStorageItemInfo>", "signature": "ListPage<GoogleCloudStorageItemInfo> listObjectInfoPage(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions, String pageToken)", "full_signature": "@Override public ListPage<GoogleCloudStorageItemInfo> listObjectInfoPage(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions, String pageToken)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.listObjectInfoPage(\n      String bucketName, String objectNamePrefix, ListObjectOptions listOptions, String pageToken)", "testcase": false, "constructor": false}, {"identifier": "getItemInfo", "parameters": "(StorageResourceId resourceId)", "modifiers": "@Override public", "return": "GoogleCloudStorageItemInfo", "signature": "GoogleCloudStorageItemInfo getItemInfo(StorageResourceId resourceId)", "full_signature": "@Override public GoogleCloudStorageItemInfo getItemInfo(StorageResourceId resourceId)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.getItemInfo(StorageResourceId resourceId)", "testcase": false, "constructor": false}, {"identifier": "getItemInfos", "parameters": "(List<StorageResourceId> resourceIds)", "modifiers": "@Override public", "return": "List<GoogleCloudStorageItemInfo>", "signature": "List<GoogleCloudStorageItemInfo> getItemInfos(List<StorageResourceId> resourceIds)", "full_signature": "@Override public List<GoogleCloudStorageItemInfo> getItemInfos(List<StorageResourceId> resourceIds)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.getItemInfos(List<StorageResourceId> resourceIds)", "testcase": false, "constructor": false}, {"identifier": "updateItems", "parameters": "(List<UpdatableItemInfo> itemInfoList)", "modifiers": "@Override public", "return": "List<GoogleCloudStorageItemInfo>", "signature": "List<GoogleCloudStorageItemInfo> updateItems(List<UpdatableItemInfo> itemInfoList)", "full_signature": "@Override public List<GoogleCloudStorageItemInfo> updateItems(List<UpdatableItemInfo> itemInfoList)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.updateItems(List<UpdatableItemInfo> itemInfoList)", "testcase": false, "constructor": false}, {"identifier": "close", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void close()", "full_signature": "@Override public void close()", "class_method_signature": "PerformanceCachingGoogleCloudStorage.close()", "testcase": false, "constructor": false}, {"identifier": "composeObjects", "parameters": "(\n      List<StorageResourceId> sources, StorageResourceId destination, CreateObjectOptions options)", "modifiers": "@Override public", "return": "GoogleCloudStorageItemInfo", "signature": "GoogleCloudStorageItemInfo composeObjects(\n      List<StorageResourceId> sources, StorageResourceId destination, CreateObjectOptions options)", "full_signature": "@Override public GoogleCloudStorageItemInfo composeObjects(\n      List<StorageResourceId> sources, StorageResourceId destination, CreateObjectOptions options)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.composeObjects(\n      List<StorageResourceId> sources, StorageResourceId destination, CreateObjectOptions options)", "testcase": false, "constructor": false}, {"identifier": "invalidateCache", "parameters": "()", "modifiers": "@VisibleForTesting public", "return": "void", "signature": "void invalidateCache()", "full_signature": "@VisibleForTesting public void invalidateCache()", "class_method_signature": "PerformanceCachingGoogleCloudStorage.invalidateCache()", "testcase": false, "constructor": false}], "file": "gcsio/src/main/java/com/google/cloud/hadoop/gcsio/PerformanceCachingGoogleCloudStorage.java"}, "focal_method": {"identifier": "getItemInfos", "parameters": "(List<StorageResourceId> resourceIds)", "modifiers": "@Override public", "return": "List<GoogleCloudStorageItemInfo>", "body": "@Override\n  public List<GoogleCloudStorageItemInfo> getItemInfos(List<StorageResourceId> resourceIds)\n      throws IOException {\n    List<GoogleCloudStorageItemInfo> result = new ArrayList<>(resourceIds.size());\n    List<StorageResourceId> request = new ArrayList<>(resourceIds.size());\n\n    // Populate the result list with items in the cache, and the request list with resources that\n    // still need to be resolved. Null items are added to the result list to preserve ordering.\n    for (StorageResourceId resourceId : resourceIds) {\n      GoogleCloudStorageItemInfo item = cache.getItem(resourceId);\n      if (item == null) {\n        request.add(resourceId);\n      }\n      result.add(item);\n    }\n\n    // Resolve all the resources which were not cached, cache them, and add them to the result list.\n    // Null entries in the result list are replaced by the fresh entries from the underlying\n    // GoogleCloudStorage.\n    if (!request.isEmpty()) {\n      List<GoogleCloudStorageItemInfo> response = super.getItemInfos(request);\n      Iterator<GoogleCloudStorageItemInfo> responseIterator = response.iterator();\n\n      // Iterate through the result set, replacing the null entries added previously with entries\n      // from the response.\n      for (int i = 0; i < result.size() && responseIterator.hasNext(); i++) {\n        if (result.get(i) == null) {\n          GoogleCloudStorageItemInfo item = responseIterator.next();\n          cache.putItem(item);\n          result.set(i, item);\n        }\n      }\n    }\n\n    return result;\n  }", "signature": "List<GoogleCloudStorageItemInfo> getItemInfos(List<StorageResourceId> resourceIds)", "full_signature": "@Override public List<GoogleCloudStorageItemInfo> getItemInfos(List<StorageResourceId> resourceIds)", "class_method_signature": "PerformanceCachingGoogleCloudStorage.getItemInfos(List<StorageResourceId> resourceIds)", "testcase": false, "constructor": false, "invocations": ["size", "size", "getItem", "add", "add", "isEmpty", "getItemInfos", "iterator", "size", "hasNext", "get", "next", "putItem", "set"]}, "repository": {"repo_id": 19684359, "url": "https://github.com/GoogleCloudDataproc/bigdata-interop", "stars": 178, "created": "5/12/2014 3:11:55 AM +00:00", "updates": "2020-01-23T23:10:40+00:00", "fork": "False", "license": "licensed"}}