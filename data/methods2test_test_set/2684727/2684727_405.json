{"test_class": {"identifier": "CognitoIdentityProviderTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String TOKEN = \"token\";", "modifier": "private static final", "type": "String", "declarator": "TOKEN = \"token\"", "var_name": "TOKEN"}, {"original_string": "private static final String IDENTITY_ID = \"identityId\";", "modifier": "private static final", "type": "String", "declarator": "IDENTITY_ID = \"identityId\"", "var_name": "IDENTITY_ID"}, {"original_string": "private static final Date EXPIRES_AT = new Date(5);", "modifier": "private static final", "type": "Date", "declarator": "EXPIRES_AT = new Date(5)", "var_name": "EXPIRES_AT"}, {"original_string": "CognitoIdentityProvider cognitoIdentityProvider;", "modifier": "", "type": "CognitoIdentityProvider", "declarator": "cognitoIdentityProvider", "var_name": "cognitoIdentityProvider"}, {"original_string": "@Mock\n    IdentityManager identityManager;", "modifier": "@Mock", "type": "IdentityManager", "declarator": "identityManager", "var_name": "identityManager"}, {"original_string": "@Mock\n    LocalCognitoTokenStore localCognitoTokenStore;", "modifier": "@Mock", "type": "LocalCognitoTokenStore", "declarator": "localCognitoTokenStore", "var_name": "localCognitoTokenStore"}, {"original_string": "@Mock\n    MeResponse meResponse;", "modifier": "@Mock", "type": "MeResponse", "declarator": "meResponse", "var_name": "meResponse"}, {"original_string": "@Mock\n    User user;", "modifier": "@Mock", "type": "User", "declarator": "user", "var_name": "user"}], "file": "aws/src/test/java/co/smartreceipts/aws/cognito/CognitoIdentityProviderTest.java"}, "test_case": {"identifier": "refreshCognitoTokenReturnsNullUserResponse", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void refreshCognitoTokenReturnsNullUserResponse() {\n        Mockito.when(meResponse.getUser()).thenReturn(null);\n        Mockito.when(identityManager.getMe()).thenReturn(Observable.just(meResponse));\n\n        TestObserver<Optional<Cognito>> testObserver = cognitoIdentityProvider.refreshCognitoToken().test();\n\n        Mockito.verify(localCognitoTokenStore, Mockito.times(2)).persist(null);\n\n        testObserver.assertValue(Optional.absent())\n                .assertComplete()\n                .assertNoErrors();\n    }", "signature": "void refreshCognitoTokenReturnsNullUserResponse()", "full_signature": "@Test public void refreshCognitoTokenReturnsNullUserResponse()", "class_method_signature": "CognitoIdentityProviderTest.refreshCognitoTokenReturnsNullUserResponse()", "testcase": true, "constructor": false, "invocations": ["thenReturn", "when", "getUser", "thenReturn", "when", "getMe", "just", "test", "refreshCognitoToken", "persist", "verify", "times", "assertNoErrors", "assertComplete", "assertValue", "absent"]}, "focal_class": {"identifier": "CognitoIdentityProvider", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final IdentityManager identityManager;", "modifier": "private final", "type": "IdentityManager", "declarator": "identityManager", "var_name": "identityManager"}, {"original_string": "private final LocalCognitoTokenStore localCognitoTokenStore;", "modifier": "private final", "type": "LocalCognitoTokenStore", "declarator": "localCognitoTokenStore", "var_name": "localCognitoTokenStore"}], "methods": [{"identifier": "CognitoIdentityProvider", "parameters": "(@NonNull IdentityManager identityManager,\n                                   @NonNull LocalCognitoTokenStore localCognitoTokenStore)", "modifiers": "@Inject public", "return": "", "signature": " CognitoIdentityProvider(@NonNull IdentityManager identityManager,\n                                   @NonNull LocalCognitoTokenStore localCognitoTokenStore)", "full_signature": "@Inject public  CognitoIdentityProvider(@NonNull IdentityManager identityManager,\n                                   @NonNull LocalCognitoTokenStore localCognitoTokenStore)", "class_method_signature": "CognitoIdentityProvider.CognitoIdentityProvider(@NonNull IdentityManager identityManager,\n                                   @NonNull LocalCognitoTokenStore localCognitoTokenStore)", "testcase": false, "constructor": true}, {"identifier": "prefetchCognitoTokenIfNeeded", "parameters": "()", "modifiers": "@NonNull public", "return": "Single<Optional<Cognito>>", "signature": "Single<Optional<Cognito>> prefetchCognitoTokenIfNeeded()", "full_signature": "@NonNull public Single<Optional<Cognito>> prefetchCognitoTokenIfNeeded()", "class_method_signature": "CognitoIdentityProvider.prefetchCognitoTokenIfNeeded()", "testcase": false, "constructor": false}, {"identifier": "refreshCognitoToken", "parameters": "()", "modifiers": "@NonNull public", "return": "Single<Optional<Cognito>>", "signature": "Single<Optional<Cognito>> refreshCognitoToken()", "full_signature": "@NonNull public Single<Optional<Cognito>> refreshCognitoToken()", "class_method_signature": "CognitoIdentityProvider.refreshCognitoToken()", "testcase": false, "constructor": false}, {"identifier": "synchronouslyRefreshCognitoToken", "parameters": "()", "modifiers": "@Nullable public", "return": "Cognito", "signature": "Cognito synchronouslyRefreshCognitoToken()", "full_signature": "@Nullable public Cognito synchronouslyRefreshCognitoToken()", "class_method_signature": "CognitoIdentityProvider.synchronouslyRefreshCognitoToken()", "testcase": false, "constructor": false}, {"identifier": "getCachedCognitoToken", "parameters": "()", "modifiers": "@NonNull public", "return": "Optional<Cognito>", "signature": "Optional<Cognito> getCachedCognitoToken()", "full_signature": "@NonNull public Optional<Cognito> getCachedCognitoToken()", "class_method_signature": "CognitoIdentityProvider.getCachedCognitoToken()", "testcase": false, "constructor": false}], "file": "aws/src/main/java/co/smartreceipts/aws/cognito/CognitoIdentityProvider.java"}, "focal_method": {"identifier": "refreshCognitoToken", "parameters": "()", "modifiers": "@NonNull public", "return": "Single<Optional<Cognito>>", "body": "@NonNull\n    public Single<Optional<Cognito>> refreshCognitoToken() {\n        return this.identityManager.getMe()\n                .doOnSubscribe(disposable -> {\n                    Logger.debug(CognitoIdentityProvider.this, \"Clearing the cached cognito token to refresh\");\n                    localCognitoTokenStore.persist(null);\n                })\n                .<Optional<Cognito>>map(meResponse -> {\n                    if (meResponse != null && meResponse.getUser() != null) {\n                        Logger.debug(CognitoIdentityProvider.this, \"Retrieve a valid token response\");\n                        final User user = meResponse.getUser();\n                        return Optional.of(new Cognito(user.getCognitoToken(), user.getIdentityId(), user.getCognitoTokenExpiresAt()));\n                    } else {\n                        Logger.warn(CognitoIdentityProvider.this, \"Failed to fetch a valid token\");\n                        return Optional.absent();\n                    }\n                })\n                .doOnNext(optionalCognito -> {\n                    if (optionalCognito.isPresent()) {\n                        localCognitoTokenStore.persist(optionalCognito.get());\n                    }else {\n                        localCognitoTokenStore.persist(null);\n                    }\n                })\n                .singleOrError();\n    }", "signature": "Single<Optional<Cognito>> refreshCognitoToken()", "full_signature": "@NonNull public Single<Optional<Cognito>> refreshCognitoToken()", "class_method_signature": "CognitoIdentityProvider.refreshCognitoToken()", "testcase": false, "constructor": false, "invocations": ["singleOrError", "doOnNext", "map", "doOnSubscribe", "getMe", "debug", "persist", "getUser", "debug", "getUser", "of", "getCognitoToken", "getIdentityId", "getCognitoTokenExpiresAt", "warn", "absent", "isPresent", "persist", "get", "persist"]}, "repository": {"repo_id": 2684727, "url": "https://github.com/wbaumann/SmartReceiptsLibrary", "stars": 166, "created": "11/1/2011 12:32:39 AM +00:00", "updates": "2020-01-26T22:04:24+00:00", "fork": "False", "license": "licensed"}}