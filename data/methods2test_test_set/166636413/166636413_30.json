{"test_class": {"identifier": "AuditEventLoggerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final File testInstanceFile = new File(\"/storage/emulated/0/odk/INSTANCES/testForm/testForm.xml\");", "modifier": "private final", "type": "File", "declarator": "testInstanceFile = new File(\"/storage/emulated/0/odk/INSTANCES/testForm/testForm.xml\")", "var_name": "testInstanceFile"}, {"original_string": "private final AuditConfig testAuditConfig = new AuditConfig(\"high-priority\", \"10\", \"60\", false);", "modifier": "private final", "type": "AuditConfig", "declarator": "testAuditConfig = new AuditConfig(\"high-priority\", \"10\", \"60\", false)", "var_name": "testAuditConfig"}, {"original_string": "private final AuditConfig testAuditConfigWithNullValues = new AuditConfig(\"high-priority\", \"10\", null, false);", "modifier": "private final", "type": "AuditConfig", "declarator": "testAuditConfigWithNullValues = new AuditConfig(\"high-priority\", \"10\", null, false)", "var_name": "testAuditConfigWithNullValues"}], "file": "collect_app/src/test/java/org/odk/collect/android/utilities/AuditEventLoggerTest.java"}, "test_case": {"identifier": "getMostAccurateLocationTest", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void getMostAccurateLocationTest() {\n        Location location1 = mock(Location.class);\n        when(location1.getLatitude()).thenReturn(54.380746599999995);\n        when(location1.getLongitude()).thenReturn(18.606523);\n        when(location1.getAccuracy()).thenReturn(5f);\n        when(location1.getTime()).thenReturn(1548156641000L);\n\n        AuditEventLogger auditEventLogger = new AuditEventLogger(testInstanceFile, testAuditConfig);\n        auditEventLogger.addLocation(location1);\n        assertEquals(1, auditEventLogger.getLocations().size());\n\n        Location location2 = mock(Location.class);\n        when(location2.getLatitude()).thenReturn(54.37971080550665);\n        when(location2.getLongitude()).thenReturn(18.612874470947304);\n        when(location2.getAccuracy()).thenReturn(10f);\n        when(location2.getTime()).thenReturn(1548156655000L);\n\n        auditEventLogger.addLocation(location2);\n        assertEquals(2, auditEventLogger.getLocations().size());\n\n        Location location3 = mock(Location.class);\n        when(location3.getLatitude()).thenReturn(54.3819102504987);\n        when(location3.getLongitude()).thenReturn(18.62025591015629);\n        when(location3.getAccuracy()).thenReturn(12f);\n        when(location3.getTime()).thenReturn(1548156665000L);\n\n        auditEventLogger.addLocation(location3);\n        assertEquals(3, auditEventLogger.getLocations().size());\n\n        Location location4 = mock(Location.class);\n        when(location4.getLatitude()).thenReturn(54.38620882544086);\n        when(location4.getLongitude()).thenReturn(18.62523409008793);\n        when(location4.getAccuracy()).thenReturn(7f);\n        when(location4.getTime()).thenReturn(1548156688000L);\n\n        auditEventLogger.addLocation(location4);\n        assertEquals(4, auditEventLogger.getLocations().size());\n\n        Location location5 = mock(Location.class);\n        when(location5.getLatitude()).thenReturn(54.39070685202294);\n        when(location5.getLongitude()).thenReturn(18.617166005371132);\n        when(location5.getAccuracy()).thenReturn(20f);\n        when(location5.getTime()).thenReturn(1548156710000L);\n\n        auditEventLogger.addLocation(location5);\n        assertEquals(5, auditEventLogger.getLocations().size());\n\n        Location location = auditEventLogger.getMostAccurateLocation(1548156712000L);\n\n        // The first recorded location has been removed because it's expired\n        // It's time: 1548156641000, current time: 1548156712000, location-max-age: 60s\n        assertEquals(4, auditEventLogger.getLocations().size());\n\n        assertEquals(54.38620882544086, location.getLatitude(), 0);\n        assertEquals(18.62523409008793, location.getLongitude(), 0);\n        assertEquals(7f, location.getAccuracy(), 0);\n    }", "signature": "void getMostAccurateLocationTest()", "full_signature": "@Test public void getMostAccurateLocationTest()", "class_method_signature": "AuditEventLoggerTest.getMostAccurateLocationTest()", "testcase": true, "constructor": false, "invocations": ["mock", "thenReturn", "when", "getLatitude", "thenReturn", "when", "getLongitude", "thenReturn", "when", "getAccuracy", "thenReturn", "when", "getTime", "addLocation", "assertEquals", "size", "getLocations", "mock", "thenReturn", "when", "getLatitude", "thenReturn", "when", "getLongitude", "thenReturn", "when", "getAccuracy", "thenReturn", "when", "getTime", "addLocation", "assertEquals", "size", "getLocations", "mock", "thenReturn", "when", "getLatitude", "thenReturn", "when", "getLongitude", "thenReturn", "when", "getAccuracy", "thenReturn", "when", "getTime", "addLocation", "assertEquals", "size", "getLocations", "mock", "thenReturn", "when", "getLatitude", "thenReturn", "when", "getLongitude", "thenReturn", "when", "getAccuracy", "thenReturn", "when", "getTime", "addLocation", "assertEquals", "size", "getLocations", "mock", "thenReturn", "when", "getLatitude", "thenReturn", "when", "getLongitude", "thenReturn", "when", "getAccuracy", "thenReturn", "when", "getTime", "addLocation", "assertEquals", "size", "getLocations", "getMostAccurateLocation", "assertEquals", "size", "getLocations", "assertEquals", "getLatitude", "assertEquals", "getLongitude", "assertEquals", "getAccuracy"]}, "focal_class": {"identifier": "AuditEventLogger", "superclass": "", "interfaces": "", "fields": [{"original_string": "private List<Location> locations = new ArrayList<>();", "modifier": "private", "type": "List<Location>", "declarator": "locations = new ArrayList<>()", "var_name": "locations"}, {"original_string": "private static AsyncTask saveTask;", "modifier": "private static", "type": "AsyncTask", "declarator": "saveTask", "var_name": "saveTask"}, {"original_string": "private ArrayList<AuditEvent> auditEvents = new ArrayList<>();", "modifier": "private", "type": "ArrayList<AuditEvent>", "declarator": "auditEvents = new ArrayList<>()", "var_name": "auditEvents"}, {"original_string": "private File auditFile;", "modifier": "private", "type": "File", "declarator": "auditFile", "var_name": "auditFile"}, {"original_string": "private long surveyOpenTime;", "modifier": "private", "type": "long", "declarator": "surveyOpenTime", "var_name": "surveyOpenTime"}, {"original_string": "private long surveyOpenElapsedTime;", "modifier": "private", "type": "long", "declarator": "surveyOpenElapsedTime", "var_name": "surveyOpenElapsedTime"}, {"original_string": "private final AuditConfig auditConfig;", "modifier": "private final", "type": "AuditConfig", "declarator": "auditConfig", "var_name": "auditConfig"}], "methods": [{"identifier": "AuditEventLogger", "parameters": "(File instanceFile, AuditConfig auditConfig)", "modifiers": "public", "return": "", "signature": " AuditEventLogger(File instanceFile, AuditConfig auditConfig)", "full_signature": "public  AuditEventLogger(File instanceFile, AuditConfig auditConfig)", "class_method_signature": "AuditEventLogger.AuditEventLogger(File instanceFile, AuditConfig auditConfig)", "testcase": false, "constructor": true}, {"identifier": "logEvent", "parameters": "(AuditEvent.AuditEventType eventType, boolean writeImmediatelyToDisk)", "modifiers": "public", "return": "void", "signature": "void logEvent(AuditEvent.AuditEventType eventType, boolean writeImmediatelyToDisk)", "full_signature": "public void logEvent(AuditEvent.AuditEventType eventType, boolean writeImmediatelyToDisk)", "class_method_signature": "AuditEventLogger.logEvent(AuditEvent.AuditEventType eventType, boolean writeImmediatelyToDisk)", "testcase": false, "constructor": false}, {"identifier": "logEvent", "parameters": "(AuditEvent.AuditEventType eventType, FormIndex formIndex,\n                         boolean writeImmediatelyToDisk, String questionAnswer)", "modifiers": "public", "return": "void", "signature": "void logEvent(AuditEvent.AuditEventType eventType, FormIndex formIndex,\n                         boolean writeImmediatelyToDisk, String questionAnswer)", "full_signature": "public void logEvent(AuditEvent.AuditEventType eventType, FormIndex formIndex,\n                         boolean writeImmediatelyToDisk, String questionAnswer)", "class_method_signature": "AuditEventLogger.logEvent(AuditEvent.AuditEventType eventType, FormIndex formIndex,\n                         boolean writeImmediatelyToDisk, String questionAnswer)", "testcase": false, "constructor": false}, {"identifier": "addLocationCoordinatesToAuditEvent", "parameters": "(AuditEvent auditEvent)", "modifiers": "private", "return": "void", "signature": "void addLocationCoordinatesToAuditEvent(AuditEvent auditEvent)", "full_signature": "private void addLocationCoordinatesToAuditEvent(AuditEvent auditEvent)", "class_method_signature": "AuditEventLogger.addLocationCoordinatesToAuditEvent(AuditEvent auditEvent)", "testcase": false, "constructor": false}, {"identifier": "addNewValueToQuestionAuditEvent", "parameters": "(AuditEvent aev, FormController formController)", "modifiers": "private", "return": "void", "signature": "void addNewValueToQuestionAuditEvent(AuditEvent aev, FormController formController)", "full_signature": "private void addNewValueToQuestionAuditEvent(AuditEvent aev, FormController formController)", "class_method_signature": "AuditEventLogger.addNewValueToQuestionAuditEvent(AuditEvent aev, FormController formController)", "testcase": false, "constructor": false}, {"identifier": "isDuplicateOfLastLocationEvent", "parameters": "(AuditEvent.AuditEventType eventType)", "modifiers": "", "return": "boolean", "signature": "boolean isDuplicateOfLastLocationEvent(AuditEvent.AuditEventType eventType)", "full_signature": " boolean isDuplicateOfLastLocationEvent(AuditEvent.AuditEventType eventType)", "class_method_signature": "AuditEventLogger.isDuplicateOfLastLocationEvent(AuditEvent.AuditEventType eventType)", "testcase": false, "constructor": false}, {"identifier": "isDuplicatedIntervalEvent", "parameters": "(AuditEvent newAuditEvent)", "modifiers": "private", "return": "boolean", "signature": "boolean isDuplicatedIntervalEvent(AuditEvent newAuditEvent)", "full_signature": "private boolean isDuplicatedIntervalEvent(AuditEvent newAuditEvent)", "class_method_signature": "AuditEventLogger.isDuplicatedIntervalEvent(AuditEvent newAuditEvent)", "testcase": false, "constructor": false}, {"identifier": "exitView", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void exitView()", "full_signature": "public void exitView()", "class_method_signature": "AuditEventLogger.exitView()", "testcase": false, "constructor": false}, {"identifier": "manageSavedEvents", "parameters": "()", "modifiers": "private", "return": "void", "signature": "void manageSavedEvents()", "full_signature": "private void manageSavedEvents()", "class_method_signature": "AuditEventLogger.manageSavedEvents()", "testcase": false, "constructor": false}, {"identifier": "setIntervalEventFinalParameters", "parameters": "(AuditEvent aev, long end)", "modifiers": "private", "return": "void", "signature": "void setIntervalEventFinalParameters(AuditEvent aev, long end)", "full_signature": "private void setIntervalEventFinalParameters(AuditEvent aev, long end)", "class_method_signature": "AuditEventLogger.setIntervalEventFinalParameters(AuditEvent aev, long end)", "testcase": false, "constructor": false}, {"identifier": "shouldBeIgnored", "parameters": "(AuditEvent.AuditEventType eventType)", "modifiers": "private", "return": "boolean", "signature": "boolean shouldBeIgnored(AuditEvent.AuditEventType eventType)", "full_signature": "private boolean shouldBeIgnored(AuditEvent.AuditEventType eventType)", "class_method_signature": "AuditEventLogger.shouldBeIgnored(AuditEvent.AuditEventType eventType)", "testcase": false, "constructor": false}, {"identifier": "shouldEventBeLogged", "parameters": "(AuditEvent aev)", "modifiers": "private", "return": "boolean", "signature": "boolean shouldEventBeLogged(AuditEvent aev)", "full_signature": "private boolean shouldEventBeLogged(AuditEvent aev)", "class_method_signature": "AuditEventLogger.shouldEventBeLogged(AuditEvent aev)", "testcase": false, "constructor": false}, {"identifier": "writeEvents", "parameters": "()", "modifiers": "private", "return": "void", "signature": "void writeEvents()", "full_signature": "private void writeEvents()", "class_method_signature": "AuditEventLogger.writeEvents()", "testcase": false, "constructor": false}, {"identifier": "getEventTime", "parameters": "()", "modifiers": "private", "return": "long", "signature": "long getEventTime()", "full_signature": "private long getEventTime()", "class_method_signature": "AuditEventLogger.getEventTime()", "testcase": false, "constructor": false}, {"identifier": "addLocation", "parameters": "(Location location)", "modifiers": "public", "return": "void", "signature": "void addLocation(Location location)", "full_signature": "public void addLocation(Location location)", "class_method_signature": "AuditEventLogger.addLocation(Location location)", "testcase": false, "constructor": false}, {"identifier": "getMostAccurateLocation", "parameters": "(long currentTime)", "modifiers": "@Nullable", "return": "Location", "signature": "Location getMostAccurateLocation(long currentTime)", "full_signature": "@Nullable Location getMostAccurateLocation(long currentTime)", "class_method_signature": "AuditEventLogger.getMostAccurateLocation(long currentTime)", "testcase": false, "constructor": false}, {"identifier": "removeExpiredLocations", "parameters": "(long currentTime)", "modifiers": "private", "return": "void", "signature": "void removeExpiredLocations(long currentTime)", "full_signature": "private void removeExpiredLocations(long currentTime)", "class_method_signature": "AuditEventLogger.removeExpiredLocations(long currentTime)", "testcase": false, "constructor": false}, {"identifier": "isAuditEnabled", "parameters": "()", "modifiers": "", "return": "boolean", "signature": "boolean isAuditEnabled()", "full_signature": " boolean isAuditEnabled()", "class_method_signature": "AuditEventLogger.isAuditEnabled()", "testcase": false, "constructor": false}, {"identifier": "getAuditEvents", "parameters": "()", "modifiers": "", "return": "ArrayList<AuditEvent>", "signature": "ArrayList<AuditEvent> getAuditEvents()", "full_signature": " ArrayList<AuditEvent> getAuditEvents()", "class_method_signature": "AuditEventLogger.getAuditEvents()", "testcase": false, "constructor": false}, {"identifier": "getLocations", "parameters": "()", "modifiers": "", "return": "List<Location>", "signature": "List<Location> getLocations()", "full_signature": " List<Location> getLocations()", "class_method_signature": "AuditEventLogger.getLocations()", "testcase": false, "constructor": false}], "file": "collect_app/src/main/java/org/odk/collect/android/utilities/AuditEventLogger.java"}, "focal_method": {"identifier": "getMostAccurateLocation", "parameters": "(long currentTime)", "modifiers": "@Nullable", "return": "Location", "body": "@Nullable\n    Location getMostAccurateLocation(long currentTime) {\n        removeExpiredLocations(currentTime);\n\n        Location bestLocation = null;\n        if (!locations.isEmpty()) {\n            for (Location location : locations) {\n                if (bestLocation == null || location.getAccuracy() < bestLocation.getAccuracy()) {\n                    bestLocation = location;\n                }\n            }\n        }\n        return bestLocation;\n    }", "signature": "Location getMostAccurateLocation(long currentTime)", "full_signature": "@Nullable Location getMostAccurateLocation(long currentTime)", "class_method_signature": "AuditEventLogger.getMostAccurateLocation(long currentTime)", "testcase": false, "constructor": false, "invocations": ["removeExpiredLocations", "isEmpty", "getAccuracy", "getAccuracy"]}, "repository": {"repo_id": 166636413, "url": "https://github.com/fieldsight/fieldsight-mobile", "language": "Java", "is_fork": false, "fork_count": 4, "stargazer_count": 14, "size": 41030, "license": "licensed"}}