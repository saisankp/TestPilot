{"test_class": {"identifier": "FilteringOutUndeclaredDataElementsProcessorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "public static final String PROGRAMSTAGE = \"programstage\";", "modifier": "public static final", "type": "String", "declarator": "PROGRAMSTAGE = \"programstage\"", "var_name": "PROGRAMSTAGE"}, {"original_string": "public static final String DATA_ELEMENT_1 = \"de1\";", "modifier": "public static final", "type": "String", "declarator": "DATA_ELEMENT_1 = \"de1\"", "var_name": "DATA_ELEMENT_1"}, {"original_string": "public static final String DATA_ELEMENT_2 = \"de2\";", "modifier": "public static final", "type": "String", "declarator": "DATA_ELEMENT_2 = \"de2\"", "var_name": "DATA_ELEMENT_2"}, {"original_string": "public static final String PROGRAM = \"program\";", "modifier": "public static final", "type": "String", "declarator": "PROGRAM = \"program\"", "var_name": "PROGRAM"}, {"original_string": "private static final String DATA_ELEMENT_3 = \"de3\";", "modifier": "private static final", "type": "String", "declarator": "DATA_ELEMENT_3 = \"de3\"", "var_name": "DATA_ELEMENT_3"}, {"original_string": "private FilteringOutUndeclaredDataElementsProcessor preProcessor;", "modifier": "private", "type": "FilteringOutUndeclaredDataElementsProcessor", "declarator": "preProcessor", "var_name": "preProcessor"}], "file": "dhis-2/dhis-services/dhis-service-dxf2/src/test/java/org/hisp/dhis/dxf2/events/importer/shared/preprocess/FilteringOutUndeclaredDataElementsProcessorTest.java"}, "test_case": {"identifier": "testNotLinkedDataElementsAreRemovedFromEvent", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testNotLinkedDataElementsAreRemovedFromEvent()\n    {\n        WorkContext ctx = WorkContext.builder()\n            .importOptions( ImportOptions.getDefaultImportOptions() )\n            .programsMap( getProgramMap() )\n            .build();\n\n        Event event = new Event();\n        event.setProgramStage( PROGRAMSTAGE );\n\n        HashSet<DataValue> dataValues = Sets.newHashSet(\n            new DataValue( DATA_ELEMENT_1, \"whatever\" ),\n            new DataValue( DATA_ELEMENT_2, \"another value\" ) );\n\n        event.setDataValues( dataValues );\n\n        preProcessor.process( event, ctx );\n\n        Set<String> allowedDataValues = ctx\n            .getProgramStage( ctx.getImportOptions().getIdSchemes().getProgramStageIdScheme(), PROGRAMSTAGE )\n            .getDataElements().stream()\n            .map( BaseIdentifiableObject::getUid )\n            .collect( Collectors.toSet() );\n\n        Set<String> filteredEventDataValues = event.getDataValues().stream()\n            .map( DataValue::getDataElement )\n            .collect( Collectors.toSet() );\n\n        assertTrue( allowedDataValues.containsAll( filteredEventDataValues ) );\n\n    }", "signature": "void testNotLinkedDataElementsAreRemovedFromEvent()", "full_signature": "@Test public void testNotLinkedDataElementsAreRemovedFromEvent()", "class_method_signature": "FilteringOutUndeclaredDataElementsProcessorTest.testNotLinkedDataElementsAreRemovedFromEvent()", "testcase": true, "constructor": false, "invocations": ["build", "programsMap", "importOptions", "builder", "getDefaultImportOptions", "getProgramMap", "setProgramStage", "newHashSet", "setDataValues", "process", "collect", "map", "stream", "getDataElements", "getProgramStage", "getProgramStageIdScheme", "getIdSchemes", "getImportOptions", "toSet", "collect", "map", "stream", "getDataValues", "toSet", "assertTrue", "containsAll"]}, "focal_class": {"identifier": "FilteringOutUndeclaredDataElementsProcessor", "superclass": "", "interfaces": "implements Processor", "fields": [], "methods": [{"identifier": "process", "parameters": "( final Event event, final WorkContext ctx )", "modifiers": "@Override public", "return": "void", "signature": "void process( final Event event, final WorkContext ctx )", "full_signature": "@Override public void process( final Event event, final WorkContext ctx )", "class_method_signature": "FilteringOutUndeclaredDataElementsProcessor.process( final Event event, final WorkContext ctx )", "testcase": false, "constructor": false}, {"identifier": "getDataElementUidsFromProgramStage", "parameters": "( String programStageUid, WorkContext ctx )", "modifiers": "private", "return": "Set<String>", "signature": "Set<String> getDataElementUidsFromProgramStage( String programStageUid, WorkContext ctx )", "full_signature": "private Set<String> getDataElementUidsFromProgramStage( String programStageUid, WorkContext ctx )", "class_method_signature": "FilteringOutUndeclaredDataElementsProcessor.getDataElementUidsFromProgramStage( String programStageUid, WorkContext ctx )", "testcase": false, "constructor": false}], "file": "dhis-2/dhis-services/dhis-service-dxf2/src/main/java/org/hisp/dhis/dxf2/events/importer/shared/preprocess/FilteringOutUndeclaredDataElementsProcessor.java"}, "focal_method": {"identifier": "process", "parameters": "( final Event event, final WorkContext ctx )", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void process( final Event event, final WorkContext ctx )\n    {\n        if ( StringUtils.isNotBlank( event.getProgramStage() ) )\n        {\n            Set<String> programStageDataElementUids = getDataElementUidsFromProgramStage( event.getProgramStage(),\n                ctx );\n            event.setDataValues(\n                event.getDataValues().stream()\n                    .filter( dataValue -> programStageDataElementUids.contains( dataValue.getDataElement() ) )\n                    .collect( Collectors.toSet() ) );\n        }\n    }", "signature": "void process( final Event event, final WorkContext ctx )", "full_signature": "@Override public void process( final Event event, final WorkContext ctx )", "class_method_signature": "FilteringOutUndeclaredDataElementsProcessor.process( final Event event, final WorkContext ctx )", "testcase": false, "constructor": false, "invocations": ["isNotBlank", "getProgramStage", "getDataElementUidsFromProgramStage", "getProgramStage", "setDataValues", "collect", "filter", "stream", "getDataValues", "contains", "getDataElement", "toSet"]}, "repository": {"repo_id": 66940520, "url": "https://github.com/dhis2/dhis2-core", "stars": 151, "created": "8/30/2016 12:57:05 PM +00:00", "updates": "2020-01-24T18:06:36+00:00", "fork": "False", "license": "licensed"}}