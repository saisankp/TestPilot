{"test_class": {"identifier": "OcrPurchaseTrackerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final int REMAINING_SCANS = 49;", "modifier": "private static final", "type": "int", "declarator": "REMAINING_SCANS = 49", "var_name": "REMAINING_SCANS"}, {"original_string": "OcrPurchaseTracker ocrPurchaseTracker;", "modifier": "", "type": "OcrPurchaseTracker", "declarator": "ocrPurchaseTracker", "var_name": "ocrPurchaseTracker"}, {"original_string": "@Mock\n    IdentityManager identityManager;", "modifier": "@Mock", "type": "IdentityManager", "declarator": "identityManager", "var_name": "identityManager"}, {"original_string": "@Mock\n    WebServiceManager webServiceManager;", "modifier": "@Mock", "type": "WebServiceManager", "declarator": "webServiceManager", "var_name": "webServiceManager"}, {"original_string": "@Mock\n    PurchaseManager purchaseManager;", "modifier": "@Mock", "type": "PurchaseManager", "declarator": "purchaseManager", "var_name": "purchaseManager"}, {"original_string": "@Mock\n    PurchaseWallet purchaseWallet;", "modifier": "@Mock", "type": "PurchaseWallet", "declarator": "purchaseWallet", "var_name": "purchaseWallet"}, {"original_string": "@Mock\n    DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer;", "modifier": "@Mock", "type": "DefaultInAppPurchaseConsumer", "declarator": "defaultInAppPurchaseConsumer", "var_name": "defaultInAppPurchaseConsumer"}, {"original_string": "@Mock\n    LocalOcrScansTracker localOcrScansTracker;", "modifier": "@Mock", "type": "LocalOcrScansTracker", "declarator": "localOcrScansTracker", "var_name": "localOcrScansTracker"}, {"original_string": "@Mock\n    ManagedProduct managedProduct;", "modifier": "@Mock", "type": "ManagedProduct", "declarator": "managedProduct", "var_name": "managedProduct"}, {"original_string": "@Mock\n    MobileAppPurchasesService mobileAppPurchasesService;", "modifier": "@Mock", "type": "MobileAppPurchasesService", "declarator": "mobileAppPurchasesService", "var_name": "mobileAppPurchasesService"}, {"original_string": "@Mock\n    PurchaseResponse purchaseResponse;", "modifier": "@Mock", "type": "PurchaseResponse", "declarator": "purchaseResponse", "var_name": "purchaseResponse"}, {"original_string": "@Mock\n    MeResponse meResponse;", "modifier": "@Mock", "type": "MeResponse", "declarator": "meResponse", "var_name": "meResponse"}, {"original_string": "@Mock\n    User user;", "modifier": "@Mock", "type": "User", "declarator": "user", "var_name": "user"}, {"original_string": "@Mock\n    ResponseBody retrofitResponseBody;", "modifier": "@Mock", "type": "ResponseBody", "declarator": "retrofitResponseBody", "var_name": "retrofitResponseBody"}], "file": "app/src/test/java/co/smartreceipts/android/ocr/purchases/OcrPurchaseTrackerTest.java"}, "test_case": {"identifier": "onPurchaseSuccessWhenNotLoggedIn", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void onPurchaseSuccessWhenNotLoggedIn() {\n        // Configure\n        when(identityManager.isLoggedInStream()).thenReturn(Observable.just(false));\n\n        // Test\n        ocrPurchaseTracker.onPurchaseSuccess(InAppPurchase.OcrScans50, PurchaseSource.Unknown);\n\n        // Verify\n        verify(defaultInAppPurchaseConsumer, never()).consumePurchase(any(ManagedProduct.class), any(PurchaseFamily.class));\n        verify(localOcrScansTracker, never()).setRemainingScans(REMAINING_SCANS);\n        verifyZeroInteractions(webServiceManager);\n    }", "signature": "void onPurchaseSuccessWhenNotLoggedIn()", "full_signature": "@Test public void onPurchaseSuccessWhenNotLoggedIn()", "class_method_signature": "OcrPurchaseTrackerTest.onPurchaseSuccessWhenNotLoggedIn()", "testcase": true, "constructor": false, "invocations": ["thenReturn", "when", "isLoggedInStream", "just", "onPurchaseSuccess", "consumePurchase", "verify", "never", "any", "any", "setRemainingScans", "verify", "never", "verifyZeroInteractions"]}, "focal_class": {"identifier": "OcrPurchaseTracker", "superclass": "", "interfaces": "implements PurchaseEventsListener", "fields": [{"original_string": "private static final String GOAL = \"Recognition\";", "modifier": "private static final", "type": "String", "declarator": "GOAL = \"Recognition\"", "var_name": "GOAL"}, {"original_string": "private final IdentityManager identityManager;", "modifier": "private final", "type": "IdentityManager", "declarator": "identityManager", "var_name": "identityManager"}, {"original_string": "private final WebServiceManager webServiceManager;", "modifier": "private final", "type": "WebServiceManager", "declarator": "webServiceManager", "var_name": "webServiceManager"}, {"original_string": "private final PurchaseManager purchaseManager;", "modifier": "private final", "type": "PurchaseManager", "declarator": "purchaseManager", "var_name": "purchaseManager"}, {"original_string": "private final PurchaseWallet purchaseWallet;", "modifier": "private final", "type": "PurchaseWallet", "declarator": "purchaseWallet", "var_name": "purchaseWallet"}, {"original_string": "private final DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer;", "modifier": "private final", "type": "DefaultInAppPurchaseConsumer", "declarator": "defaultInAppPurchaseConsumer", "var_name": "defaultInAppPurchaseConsumer"}, {"original_string": "private final LocalOcrScansTracker localOcrScansTracker;", "modifier": "private final", "type": "LocalOcrScansTracker", "declarator": "localOcrScansTracker", "var_name": "localOcrScansTracker"}, {"original_string": "private final Scheduler subscribeOnScheduler;", "modifier": "private final", "type": "Scheduler", "declarator": "subscribeOnScheduler", "var_name": "subscribeOnScheduler"}], "methods": [{"identifier": "OcrPurchaseTracker", "parameters": "(@NonNull IdentityManager identityManager,\n                              @NonNull WebServiceManager webServiceManager,\n                              @NonNull PurchaseManager purchaseManager,\n                              @NonNull PurchaseWallet purchaseWallet,\n                              @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                              @NonNull LocalOcrScansTracker localOcrScansTracker)", "modifiers": "@Inject public", "return": "", "signature": " OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                              @NonNull WebServiceManager webServiceManager,\n                              @NonNull PurchaseManager purchaseManager,\n                              @NonNull PurchaseWallet purchaseWallet,\n                              @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                              @NonNull LocalOcrScansTracker localOcrScansTracker)", "full_signature": "@Inject public  OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                              @NonNull WebServiceManager webServiceManager,\n                              @NonNull PurchaseManager purchaseManager,\n                              @NonNull PurchaseWallet purchaseWallet,\n                              @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                              @NonNull LocalOcrScansTracker localOcrScansTracker)", "class_method_signature": "OcrPurchaseTracker.OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                              @NonNull WebServiceManager webServiceManager,\n                              @NonNull PurchaseManager purchaseManager,\n                              @NonNull PurchaseWallet purchaseWallet,\n                              @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                              @NonNull LocalOcrScansTracker localOcrScansTracker)", "testcase": false, "constructor": true}, {"identifier": "OcrPurchaseTracker", "parameters": "(@NonNull IdentityManager identityManager,\n                       @NonNull WebServiceManager webServiceManager,\n                       @NonNull PurchaseManager purchaseManager,\n                       @NonNull PurchaseWallet purchaseWallet,\n                       @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                       @NonNull LocalOcrScansTracker localOcrScansTracker,\n                       @NonNull Scheduler subscribeOnScheduler)", "modifiers": "@VisibleForTesting", "return": "", "signature": " OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                       @NonNull WebServiceManager webServiceManager,\n                       @NonNull PurchaseManager purchaseManager,\n                       @NonNull PurchaseWallet purchaseWallet,\n                       @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                       @NonNull LocalOcrScansTracker localOcrScansTracker,\n                       @NonNull Scheduler subscribeOnScheduler)", "full_signature": "@VisibleForTesting  OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                       @NonNull WebServiceManager webServiceManager,\n                       @NonNull PurchaseManager purchaseManager,\n                       @NonNull PurchaseWallet purchaseWallet,\n                       @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                       @NonNull LocalOcrScansTracker localOcrScansTracker,\n                       @NonNull Scheduler subscribeOnScheduler)", "class_method_signature": "OcrPurchaseTracker.OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                       @NonNull WebServiceManager webServiceManager,\n                       @NonNull PurchaseManager purchaseManager,\n                       @NonNull PurchaseWallet purchaseWallet,\n                       @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                       @NonNull LocalOcrScansTracker localOcrScansTracker,\n                       @NonNull Scheduler subscribeOnScheduler)", "testcase": false, "constructor": true}, {"identifier": "initialize", "parameters": "()", "modifiers": "@SuppressLint(\"CheckResult\") public", "return": "void", "signature": "void initialize()", "full_signature": "@SuppressLint(\"CheckResult\") public void initialize()", "class_method_signature": "OcrPurchaseTracker.initialize()", "testcase": false, "constructor": false}, {"identifier": "onPurchaseSuccess", "parameters": "(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "modifiers": "@Override public", "return": "void", "signature": "void onPurchaseSuccess(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "full_signature": "@Override public void onPurchaseSuccess(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "class_method_signature": "OcrPurchaseTracker.onPurchaseSuccess(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "testcase": false, "constructor": false}, {"identifier": "onPurchaseFailed", "parameters": "(@NonNull PurchaseSource purchaseSource)", "modifiers": "@Override public", "return": "void", "signature": "void onPurchaseFailed(@NonNull PurchaseSource purchaseSource)", "full_signature": "@Override public void onPurchaseFailed(@NonNull PurchaseSource purchaseSource)", "class_method_signature": "OcrPurchaseTracker.onPurchaseFailed(@NonNull PurchaseSource purchaseSource)", "testcase": false, "constructor": false}, {"identifier": "getRemainingScans", "parameters": "()", "modifiers": "public", "return": "int", "signature": "int getRemainingScans()", "full_signature": "public int getRemainingScans()", "class_method_signature": "OcrPurchaseTracker.getRemainingScans()", "testcase": false, "constructor": false}, {"identifier": "getRemainingScansStream", "parameters": "()", "modifiers": "public", "return": "Observable<Integer>", "signature": "Observable<Integer> getRemainingScansStream()", "full_signature": "public Observable<Integer> getRemainingScansStream()", "class_method_signature": "OcrPurchaseTracker.getRemainingScansStream()", "testcase": false, "constructor": false}, {"identifier": "hasAvailableScans", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean hasAvailableScans()", "full_signature": "public boolean hasAvailableScans()", "class_method_signature": "OcrPurchaseTracker.hasAvailableScans()", "testcase": false, "constructor": false}, {"identifier": "decrementRemainingScans", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void decrementRemainingScans()", "full_signature": "public void decrementRemainingScans()", "class_method_signature": "OcrPurchaseTracker.decrementRemainingScans()", "testcase": false, "constructor": false}, {"identifier": "uploadOcrPurchase", "parameters": "(@NonNull final ManagedProduct managedProduct)", "modifiers": "@NonNull private", "return": "Observable<Object>", "signature": "Observable<Object> uploadOcrPurchase(@NonNull final ManagedProduct managedProduct)", "full_signature": "@NonNull private Observable<Object> uploadOcrPurchase(@NonNull final ManagedProduct managedProduct)", "class_method_signature": "OcrPurchaseTracker.uploadOcrPurchase(@NonNull final ManagedProduct managedProduct)", "testcase": false, "constructor": false}, {"identifier": "fetchAndPersistAvailableRecognitions", "parameters": "()", "modifiers": "@NonNull private", "return": "Observable<Integer>", "signature": "Observable<Integer> fetchAndPersistAvailableRecognitions()", "full_signature": "@NonNull private Observable<Integer> fetchAndPersistAvailableRecognitions()", "class_method_signature": "OcrPurchaseTracker.fetchAndPersistAvailableRecognitions()", "testcase": false, "constructor": false}], "file": "app/src/main/java/co/smartreceipts/android/ocr/purchases/OcrPurchaseTracker.java"}, "focal_method": {"identifier": "onPurchaseSuccess", "parameters": "(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void onPurchaseSuccess(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource) {\n        if (inAppPurchase.getPurchaseFamilies().contains(PurchaseFamily.Ocr)) {\n            final ManagedProduct managedProduct = purchaseWallet.getLocalInAppManagedProduct(inAppPurchase);\n            if (managedProduct != null) {\n                this.identityManager.isLoggedInStream()\n                        .subscribeOn(subscribeOnScheduler)\n                        .filter(isLoggedIn -> isLoggedIn)\n                        .flatMap(aBoolean -> uploadOcrPurchase(managedProduct))\n                        .subscribe(o -> { /*onNext*/ },\n                                throwable -> Logger.error(OcrPurchaseTracker.this, \"Failed to upload purchase of \" + managedProduct.getInAppPurchase(), throwable),\n                                () -> Logger.info(OcrPurchaseTracker.this, \"Successfully uploaded and consumed purchase of {}.\", managedProduct.getInAppPurchase())\n                        );\n            }\n        }\n    }", "signature": "void onPurchaseSuccess(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "full_signature": "@Override public void onPurchaseSuccess(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "class_method_signature": "OcrPurchaseTracker.onPurchaseSuccess(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "testcase": false, "constructor": false, "invocations": ["contains", "getPurchaseFamilies", "getLocalInAppManagedProduct", "subscribe", "flatMap", "filter", "subscribeOn", "isLoggedInStream", "uploadOcrPurchase", "error", "getInAppPurchase", "info", "getInAppPurchase"]}, "repository": {"repo_id": 2684727, "url": "https://github.com/wbaumann/SmartReceiptsLibrary", "stars": 166, "created": "11/1/2011 12:32:39 AM +00:00", "updates": "2020-01-26T22:04:24+00:00", "fork": "False", "license": "licensed"}}