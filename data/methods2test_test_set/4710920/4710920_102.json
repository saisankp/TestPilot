{"test_class": {"identifier": "AbstractClusterInvokerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "List<Invoker<IHelloService>> invokers = new ArrayList<Invoker<IHelloService>>();", "modifier": "", "type": "List<Invoker<IHelloService>>", "declarator": "invokers = new ArrayList<Invoker<IHelloService>>()", "var_name": "invokers"}, {"original_string": "List<Invoker<IHelloService>> selectedInvokers = new ArrayList<Invoker<IHelloService>>();", "modifier": "", "type": "List<Invoker<IHelloService>>", "declarator": "selectedInvokers = new ArrayList<Invoker<IHelloService>>()", "var_name": "selectedInvokers"}, {"original_string": "AbstractClusterInvoker<IHelloService> cluster;", "modifier": "", "type": "AbstractClusterInvoker<IHelloService>", "declarator": "cluster", "var_name": "cluster"}, {"original_string": "AbstractClusterInvoker<IHelloService> cluster_nocheck;", "modifier": "", "type": "AbstractClusterInvoker<IHelloService>", "declarator": "cluster_nocheck", "var_name": "cluster_nocheck"}, {"original_string": "StaticDirectory<IHelloService> dic;", "modifier": "", "type": "StaticDirectory<IHelloService>", "declarator": "dic", "var_name": "dic"}, {"original_string": "RpcInvocation invocation = new RpcInvocation();", "modifier": "", "type": "RpcInvocation", "declarator": "invocation = new RpcInvocation()", "var_name": "invocation"}, {"original_string": "URL url = URL.valueOf(\"registry://localhost:9090/org.apache.dubbo.rpc.cluster.support.AbstractClusterInvokerTest.IHelloService?refer=\" + URL.encode(\"application=abstractClusterInvokerTest\"));", "modifier": "", "type": "URL", "declarator": "url = URL.valueOf(\"registry://localhost:9090/org.apache.dubbo.rpc.cluster.support.AbstractClusterInvokerTest.IHelloService?refer=\" + URL.encode(\"application=abstractClusterInvokerTest\"))", "var_name": "url"}, {"original_string": "URL consumerUrl = URL.valueOf(\"dubbo://localhost:9090?application=abstractClusterInvokerTest\");", "modifier": "", "type": "URL", "declarator": "consumerUrl = URL.valueOf(\"dubbo://localhost:9090?application=abstractClusterInvokerTest\")", "var_name": "consumerUrl"}, {"original_string": "Invoker<IHelloService> invoker1;", "modifier": "", "type": "Invoker<IHelloService>", "declarator": "invoker1", "var_name": "invoker1"}, {"original_string": "Invoker<IHelloService> invoker2;", "modifier": "", "type": "Invoker<IHelloService>", "declarator": "invoker2", "var_name": "invoker2"}, {"original_string": "Invoker<IHelloService> invoker3;", "modifier": "", "type": "Invoker<IHelloService>", "declarator": "invoker3", "var_name": "invoker3"}, {"original_string": "Invoker<IHelloService> invoker4;", "modifier": "", "type": "Invoker<IHelloService>", "declarator": "invoker4", "var_name": "invoker4"}, {"original_string": "Invoker<IHelloService> invoker5;", "modifier": "", "type": "Invoker<IHelloService>", "declarator": "invoker5", "var_name": "invoker5"}, {"original_string": "Invoker<IHelloService> mockedInvoker1;", "modifier": "", "type": "Invoker<IHelloService>", "declarator": "mockedInvoker1", "var_name": "mockedInvoker1"}], "file": "dubbo-cluster/src/test/java/org/apache/dubbo/rpc/cluster/support/AbstractClusterInvokerTest.java"}, "test_case": {"identifier": "testSelectAgainAndCheckAvailable", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testSelectAgainAndCheckAvailable() {\n\n        LoadBalance lb = ExtensionLoader.getExtensionLoader(LoadBalance.class).getExtension(RoundRobinLoadBalance.NAME);\n        initlistsize5();\n        {\n            //Boundary condition test .\n            selectedInvokers.clear();\n            selectedInvokers.add(invoker1);\n            selectedInvokers.add(invoker2);\n            selectedInvokers.add(invoker3);\n            selectedInvokers.add(invoker5);\n            Invoker sinvoker = cluster.select(lb, invocation, invokers, selectedInvokers);\n            Assertions.assertSame(sinvoker, invoker4);\n        }\n        {\n            //Boundary condition test .\n            selectedInvokers.clear();\n            selectedInvokers.add(invoker2);\n            selectedInvokers.add(invoker3);\n            selectedInvokers.add(invoker4);\n            selectedInvokers.add(invoker5);\n            Invoker sinvoker = cluster.select(lb, invocation, invokers, selectedInvokers);\n            Assertions.assertTrue(sinvoker == invoker2 || sinvoker == invoker4);\n        }\n        {\n            //Boundary condition test .\n            for (int i = 0; i < 100; i++) {\n                selectedInvokers.clear();\n                Invoker sinvoker = cluster.select(lb, invocation, invokers, selectedInvokers);\n                Assertions.assertTrue(sinvoker == invoker2 || sinvoker == invoker4);\n            }\n        }\n        {\n            //Boundary condition test .\n            for (int i = 0; i < 100; i++) {\n                selectedInvokers.clear();\n                selectedInvokers.add(invoker1);\n                selectedInvokers.add(invoker3);\n                selectedInvokers.add(invoker5);\n                Invoker sinvoker = cluster.select(lb, invocation, invokers, selectedInvokers);\n                Assertions.assertTrue(sinvoker == invoker2 || sinvoker == invoker4);\n            }\n        }\n        {\n            //Boundary condition test .\n            for (int i = 0; i < 100; i++) {\n                selectedInvokers.clear();\n                selectedInvokers.add(invoker1);\n                selectedInvokers.add(invoker3);\n                selectedInvokers.add(invoker2);\n                selectedInvokers.add(invoker4);\n                selectedInvokers.add(invoker5);\n                Invoker sinvoker = cluster.select(lb, invocation, invokers, selectedInvokers);\n                Assertions.assertTrue(sinvoker == invoker2 || sinvoker == invoker4);\n            }\n        }\n    }", "signature": "void testSelectAgainAndCheckAvailable()", "full_signature": "@Test public void testSelectAgainAndCheckAvailable()", "class_method_signature": "AbstractClusterInvokerTest.testSelectAgainAndCheckAvailable()", "testcase": true, "constructor": false, "invocations": ["getExtension", "getExtensionLoader", "initlistsize5", "clear", "add", "add", "add", "add", "select", "assertSame", "clear", "add", "add", "add", "add", "select", "assertTrue", "clear", "select", "assertTrue", "clear", "add", "add", "add", "select", "assertTrue", "clear", "add", "add", "add", "add", "add", "select", "assertTrue"]}, "focal_class": {"identifier": "AbstractClusterInvoker", "superclass": "", "interfaces": "implements ClusterInvoker<T>", "fields": [{"original_string": "private static final Logger logger = LoggerFactory.getLogger(AbstractClusterInvoker.class);", "modifier": "private static final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(AbstractClusterInvoker.class)", "var_name": "logger"}, {"original_string": "protected Directory<T> directory;", "modifier": "protected", "type": "Directory<T>", "declarator": "directory", "var_name": "directory"}, {"original_string": "protected boolean availablecheck;", "modifier": "protected", "type": "boolean", "declarator": "availablecheck", "var_name": "availablecheck"}, {"original_string": "private AtomicBoolean destroyed = new AtomicBoolean(false);", "modifier": "private", "type": "AtomicBoolean", "declarator": "destroyed = new AtomicBoolean(false)", "var_name": "destroyed"}, {"original_string": "private volatile Invoker<T> stickyInvoker = null;", "modifier": "private volatile", "type": "Invoker<T>", "declarator": "stickyInvoker = null", "var_name": "stickyInvoker"}], "methods": [{"identifier": "AbstractClusterInvoker", "parameters": "()", "modifiers": "public", "return": "", "signature": " AbstractClusterInvoker()", "full_signature": "public  AbstractClusterInvoker()", "class_method_signature": "AbstractClusterInvoker.AbstractClusterInvoker()", "testcase": false, "constructor": true}, {"identifier": "AbstractClusterInvoker", "parameters": "(Directory<T> directory)", "modifiers": "public", "return": "", "signature": " AbstractClusterInvoker(Directory<T> directory)", "full_signature": "public  AbstractClusterInvoker(Directory<T> directory)", "class_method_signature": "AbstractClusterInvoker.AbstractClusterInvoker(Directory<T> directory)", "testcase": false, "constructor": true}, {"identifier": "AbstractClusterInvoker", "parameters": "(Directory<T> directory, URL url)", "modifiers": "public", "return": "", "signature": " AbstractClusterInvoker(Directory<T> directory, URL url)", "full_signature": "public  AbstractClusterInvoker(Directory<T> directory, URL url)", "class_method_signature": "AbstractClusterInvoker.AbstractClusterInvoker(Directory<T> directory, URL url)", "testcase": false, "constructor": true}, {"identifier": "getInterface", "parameters": "()", "modifiers": "@Override public", "return": "Class<T>", "signature": "Class<T> getInterface()", "full_signature": "@Override public Class<T> getInterface()", "class_method_signature": "AbstractClusterInvoker.getInterface()", "testcase": false, "constructor": false}, {"identifier": "getUrl", "parameters": "()", "modifiers": "@Override public", "return": "URL", "signature": "URL getUrl()", "full_signature": "@Override public URL getUrl()", "class_method_signature": "AbstractClusterInvoker.getUrl()", "testcase": false, "constructor": false}, {"identifier": "getRegistryUrl", "parameters": "()", "modifiers": "public", "return": "URL", "signature": "URL getRegistryUrl()", "full_signature": "public URL getRegistryUrl()", "class_method_signature": "AbstractClusterInvoker.getRegistryUrl()", "testcase": false, "constructor": false}, {"identifier": "isAvailable", "parameters": "()", "modifiers": "@Override public", "return": "boolean", "signature": "boolean isAvailable()", "full_signature": "@Override public boolean isAvailable()", "class_method_signature": "AbstractClusterInvoker.isAvailable()", "testcase": false, "constructor": false}, {"identifier": "getDirectory", "parameters": "()", "modifiers": "public", "return": "Directory<T>", "signature": "Directory<T> getDirectory()", "full_signature": "public Directory<T> getDirectory()", "class_method_signature": "AbstractClusterInvoker.getDirectory()", "testcase": false, "constructor": false}, {"identifier": "destroy", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void destroy()", "full_signature": "@Override public void destroy()", "class_method_signature": "AbstractClusterInvoker.destroy()", "testcase": false, "constructor": false}, {"identifier": "isDestroyed", "parameters": "()", "modifiers": "@Override public", "return": "boolean", "signature": "boolean isDestroyed()", "full_signature": "@Override public boolean isDestroyed()", "class_method_signature": "AbstractClusterInvoker.isDestroyed()", "testcase": false, "constructor": false}, {"identifier": "select", "parameters": "(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "modifiers": "protected", "return": "Invoker<T>", "signature": "Invoker<T> select(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "full_signature": "protected Invoker<T> select(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "class_method_signature": "AbstractClusterInvoker.select(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "testcase": false, "constructor": false}, {"identifier": "doSelect", "parameters": "(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "modifiers": "private", "return": "Invoker<T>", "signature": "Invoker<T> doSelect(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "full_signature": "private Invoker<T> doSelect(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "class_method_signature": "AbstractClusterInvoker.doSelect(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "testcase": false, "constructor": false}, {"identifier": "reselect", "parameters": "(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected, boolean availablecheck)", "modifiers": "private", "return": "Invoker<T>", "signature": "Invoker<T> reselect(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected, boolean availablecheck)", "full_signature": "private Invoker<T> reselect(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected, boolean availablecheck)", "class_method_signature": "AbstractClusterInvoker.reselect(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected, boolean availablecheck)", "testcase": false, "constructor": false}, {"identifier": "invoke", "parameters": "(final Invocation invocation)", "modifiers": "@Override public", "return": "Result", "signature": "Result invoke(final Invocation invocation)", "full_signature": "@Override public Result invoke(final Invocation invocation)", "class_method_signature": "AbstractClusterInvoker.invoke(final Invocation invocation)", "testcase": false, "constructor": false}, {"identifier": "checkWhetherDestroyed", "parameters": "()", "modifiers": "protected", "return": "void", "signature": "void checkWhetherDestroyed()", "full_signature": "protected void checkWhetherDestroyed()", "class_method_signature": "AbstractClusterInvoker.checkWhetherDestroyed()", "testcase": false, "constructor": false}, {"identifier": "toString", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String toString()", "full_signature": "@Override public String toString()", "class_method_signature": "AbstractClusterInvoker.toString()", "testcase": false, "constructor": false}, {"identifier": "checkInvokers", "parameters": "(List<Invoker<T>> invokers, Invocation invocation)", "modifiers": "protected", "return": "void", "signature": "void checkInvokers(List<Invoker<T>> invokers, Invocation invocation)", "full_signature": "protected void checkInvokers(List<Invoker<T>> invokers, Invocation invocation)", "class_method_signature": "AbstractClusterInvoker.checkInvokers(List<Invoker<T>> invokers, Invocation invocation)", "testcase": false, "constructor": false}, {"identifier": "doInvoke", "parameters": "(Invocation invocation, List<Invoker<T>> invokers,\n                                       LoadBalance loadbalance)", "modifiers": "protected abstract", "return": "Result", "signature": "Result doInvoke(Invocation invocation, List<Invoker<T>> invokers,\n                                       LoadBalance loadbalance)", "full_signature": "protected abstract Result doInvoke(Invocation invocation, List<Invoker<T>> invokers,\n                                       LoadBalance loadbalance)", "class_method_signature": "AbstractClusterInvoker.doInvoke(Invocation invocation, List<Invoker<T>> invokers,\n                                       LoadBalance loadbalance)", "testcase": false, "constructor": false}, {"identifier": "list", "parameters": "(Invocation invocation)", "modifiers": "protected", "return": "List<Invoker<T>>", "signature": "List<Invoker<T>> list(Invocation invocation)", "full_signature": "protected List<Invoker<T>> list(Invocation invocation)", "class_method_signature": "AbstractClusterInvoker.list(Invocation invocation)", "testcase": false, "constructor": false}, {"identifier": "initLoadBalance", "parameters": "(List<Invoker<T>> invokers, Invocation invocation)", "modifiers": "protected", "return": "LoadBalance", "signature": "LoadBalance initLoadBalance(List<Invoker<T>> invokers, Invocation invocation)", "full_signature": "protected LoadBalance initLoadBalance(List<Invoker<T>> invokers, Invocation invocation)", "class_method_signature": "AbstractClusterInvoker.initLoadBalance(List<Invoker<T>> invokers, Invocation invocation)", "testcase": false, "constructor": false}], "file": "dubbo-cluster/src/main/java/org/apache/dubbo/rpc/cluster/support/AbstractClusterInvoker.java"}, "focal_method": {"identifier": "select", "parameters": "(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "modifiers": "protected", "return": "Invoker<T>", "body": "protected Invoker<T> select(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected) throws RpcException {\n\n        if (CollectionUtils.isEmpty(invokers)) {\n            return null;\n        }\n        String methodName = invocation == null ? StringUtils.EMPTY_STRING : invocation.getMethodName();\n\n        boolean sticky = invokers.get(0).getUrl()\n                .getMethodParameter(methodName, CLUSTER_STICKY_KEY, DEFAULT_CLUSTER_STICKY);\n\n        //ignore overloaded method\n        if (stickyInvoker != null && !invokers.contains(stickyInvoker)) {\n            stickyInvoker = null;\n        }\n        //ignore concurrency problem\n        if (sticky && stickyInvoker != null && (selected == null || !selected.contains(stickyInvoker))) {\n            if (availablecheck && stickyInvoker.isAvailable()) {\n                return stickyInvoker;\n            }\n        }\n\n        Invoker<T> invoker = doSelect(loadbalance, invocation, invokers, selected);\n\n        if (sticky) {\n            stickyInvoker = invoker;\n        }\n        return invoker;\n    }", "signature": "Invoker<T> select(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "full_signature": "protected Invoker<T> select(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "class_method_signature": "AbstractClusterInvoker.select(LoadBalance loadbalance, Invocation invocation,\n                                List<Invoker<T>> invokers, List<Invoker<T>> selected)", "testcase": false, "constructor": false, "invocations": ["isEmpty", "getMethodName", "getMethodParameter", "getUrl", "get", "contains", "contains", "isAvailable", "doSelect"]}, "repository": {"repo_id": 4710920, "url": "https://github.com/apache/dubbo", "stars": 30960, "created": "6/19/2012 7:56:02 AM +00:00", "updates": "2020-01-27T14:21:03+00:00", "fork": "False", "license": "licensed"}}