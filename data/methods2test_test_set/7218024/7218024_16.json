{"test_class": {"identifier": "TestDistCpUtils", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Log LOG = LogFactory.getLog(TestDistCpUtils.class);", "modifier": "private static final", "type": "Log", "declarator": "LOG = LogFactory.getLog(TestDistCpUtils.class)", "var_name": "LOG"}, {"original_string": "private static final Configuration config = new Configuration();", "modifier": "private static final", "type": "Configuration", "declarator": "config = new Configuration()", "var_name": "config"}, {"original_string": "private static MiniDFSCluster cluster;", "modifier": "private static", "type": "MiniDFSCluster", "declarator": "cluster", "var_name": "cluster"}, {"original_string": "private static Random rand = new Random();", "modifier": "private static", "type": "Random", "declarator": "rand = new Random()", "var_name": "rand"}], "file": "conduit-distcp/src/test/java/com/inmobi/conduit/distcp/tools/util/TestDistCpUtils.java"}, "test_case": {"identifier": "testPreserve", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testPreserve() {\n    try {\n      FileSystem fs = FileSystem.get(config);\n      EnumSet<FileAttribute> attributes = EnumSet.noneOf(FileAttribute.class);\n\n\n      Path path = new Path(\"/tmp/abc\");\n      Path src = new Path(\"/tmp/src\");\n      fs.mkdirs(path);\n      fs.mkdirs(src);\n      FileStatus srcStatus = fs.getFileStatus(src);\n\n      FsPermission noPerm = new FsPermission((short) 0);\n      fs.setPermission(path, noPerm);\n      fs.setOwner(path, \"nobody\", \"nobody\");\n\n      DistCpUtils.preserve(fs, path, srcStatus, attributes);\n      FileStatus target = fs.getFileStatus(path);\n      Assert.assertEquals(target.getPermission(), noPerm);\n      Assert.assertEquals(target.getOwner(), \"nobody\");\n      Assert.assertEquals(target.getGroup(), \"nobody\");\n\n      attributes.add(FileAttribute.PERMISSION);\n      DistCpUtils.preserve(fs, path, srcStatus, attributes);\n      target = fs.getFileStatus(path);\n      Assert.assertEquals(target.getPermission(), srcStatus.getPermission());\n      Assert.assertEquals(target.getOwner(), \"nobody\");\n      Assert.assertEquals(target.getGroup(), \"nobody\");\n\n      attributes.add(FileAttribute.GROUP);\n      attributes.add(FileAttribute.USER);\n      DistCpUtils.preserve(fs, path, srcStatus, attributes);\n      target = fs.getFileStatus(path);\n      Assert.assertEquals(target.getPermission(), srcStatus.getPermission());\n      Assert.assertEquals(target.getOwner(), srcStatus.getOwner());\n      Assert.assertEquals(target.getGroup(), srcStatus.getGroup());\n\n      fs.delete(path, true);\n      fs.delete(src, true);\n    } catch (IOException e) {\n      LOG.error(\"Exception encountered \", e);\n      Assert.fail(\"Preserve test failure\");\n    }\n  }", "signature": "void testPreserve()", "full_signature": "@Test public void testPreserve()", "class_method_signature": "TestDistCpUtils.testPreserve()", "testcase": true, "constructor": false, "invocations": ["get", "noneOf", "mkdirs", "mkdirs", "getFileStatus", "setPermission", "setOwner", "preserve", "getFileStatus", "assertEquals", "getPermission", "assertEquals", "getOwner", "assertEquals", "getGroup", "add", "preserve", "getFileStatus", "assertEquals", "getPermission", "getPermission", "assertEquals", "getOwner", "assertEquals", "getGroup", "add", "add", "preserve", "getFileStatus", "assertEquals", "getPermission", "getPermission", "assertEquals", "getOwner", "getOwner", "assertEquals", "getGroup", "getGroup", "delete", "delete", "error", "fail"]}, "focal_class": {"identifier": "DistCpUtils", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Log LOG = LogFactory.getLog(DistCpUtils.class);", "modifier": "private static final", "type": "Log", "declarator": "LOG = LogFactory.getLog(DistCpUtils.class)", "var_name": "LOG"}, {"original_string": "private static ThreadLocal<DecimalFormat> FORMATTER\n                        = new ThreadLocal<DecimalFormat>() {\n    @Override\n    protected DecimalFormat initialValue() {\n      return new DecimalFormat(\"0.0\");\n    }\n  };", "modifier": "private static", "type": "ThreadLocal<DecimalFormat>", "declarator": "FORMATTER\n                        = new ThreadLocal<DecimalFormat>() {\n    @Override\n    protected DecimalFormat initialValue() {\n      return new DecimalFormat(\"0.0\");\n    }\n  }", "var_name": "FORMATTER"}], "methods": [{"identifier": "getFileSize", "parameters": "(Path path, Configuration configuration)", "modifiers": "public static", "return": "long", "signature": "long getFileSize(Path path, Configuration configuration)", "full_signature": "public static long getFileSize(Path path, Configuration configuration)", "class_method_signature": "DistCpUtils.getFileSize(Path path, Configuration configuration)", "testcase": false, "constructor": false}, {"identifier": "publish", "parameters": "(Configuration configuration,\n                                 String label, T value)", "modifiers": "public static", "return": "void", "signature": "void publish(Configuration configuration,\n                                 String label, T value)", "full_signature": "public static void publish(Configuration configuration,\n                                 String label, T value)", "class_method_signature": "DistCpUtils.publish(Configuration configuration,\n                                 String label, T value)", "testcase": false, "constructor": false}, {"identifier": "getInt", "parameters": "(Configuration configuration, String label)", "modifiers": "public static", "return": "int", "signature": "int getInt(Configuration configuration, String label)", "full_signature": "public static int getInt(Configuration configuration, String label)", "class_method_signature": "DistCpUtils.getInt(Configuration configuration, String label)", "testcase": false, "constructor": false}, {"identifier": "getLong", "parameters": "(Configuration configuration, String label)", "modifiers": "public static", "return": "long", "signature": "long getLong(Configuration configuration, String label)", "full_signature": "public static long getLong(Configuration configuration, String label)", "class_method_signature": "DistCpUtils.getLong(Configuration configuration, String label)", "testcase": false, "constructor": false}, {"identifier": "getStrategy", "parameters": "(Configuration conf,\n                                                                 DistCpOptions options)", "modifiers": "public static", "return": "Class<? extends InputFormat>", "signature": "Class<? extends InputFormat> getStrategy(Configuration conf,\n                                                                 DistCpOptions options)", "full_signature": "public static Class<? extends InputFormat> getStrategy(Configuration conf,\n                                                                 DistCpOptions options)", "class_method_signature": "DistCpUtils.getStrategy(Configuration conf,\n                                                                 DistCpOptions options)", "testcase": false, "constructor": false}, {"identifier": "getRelativePath", "parameters": "(Path sourceRootPath, Path childPath)", "modifiers": "public static", "return": "String", "signature": "String getRelativePath(Path sourceRootPath, Path childPath)", "full_signature": "public static String getRelativePath(Path sourceRootPath, Path childPath)", "class_method_signature": "DistCpUtils.getRelativePath(Path sourceRootPath, Path childPath)", "testcase": false, "constructor": false}, {"identifier": "packAttributes", "parameters": "(EnumSet<FileAttribute> attributes)", "modifiers": "public static", "return": "String", "signature": "String packAttributes(EnumSet<FileAttribute> attributes)", "full_signature": "public static String packAttributes(EnumSet<FileAttribute> attributes)", "class_method_signature": "DistCpUtils.packAttributes(EnumSet<FileAttribute> attributes)", "testcase": false, "constructor": false}, {"identifier": "unpackAttributes", "parameters": "(String attributes)", "modifiers": "public static", "return": "EnumSet<FileAttribute>", "signature": "EnumSet<FileAttribute> unpackAttributes(String attributes)", "full_signature": "public static EnumSet<FileAttribute> unpackAttributes(String attributes)", "class_method_signature": "DistCpUtils.unpackAttributes(String attributes)", "testcase": false, "constructor": false}, {"identifier": "preserve", "parameters": "(FileSystem targetFS, Path path,\n                              FileStatus srcFileStatus,\n                              EnumSet<FileAttribute> attributes)", "modifiers": "public static", "return": "void", "signature": "void preserve(FileSystem targetFS, Path path,\n                              FileStatus srcFileStatus,\n                              EnumSet<FileAttribute> attributes)", "full_signature": "public static void preserve(FileSystem targetFS, Path path,\n                              FileStatus srcFileStatus,\n                              EnumSet<FileAttribute> attributes)", "class_method_signature": "DistCpUtils.preserve(FileSystem targetFS, Path path,\n                              FileStatus srcFileStatus,\n                              EnumSet<FileAttribute> attributes)", "testcase": false, "constructor": false}, {"identifier": "sortListing", "parameters": "(FileSystem fs, Configuration conf, Path sourceListing)", "modifiers": "public static", "return": "Path", "signature": "Path sortListing(FileSystem fs, Configuration conf, Path sourceListing)", "full_signature": "public static Path sortListing(FileSystem fs, Configuration conf, Path sourceListing)", "class_method_signature": "DistCpUtils.sortListing(FileSystem fs, Configuration conf, Path sourceListing)", "testcase": false, "constructor": false}, {"identifier": "getFormatter", "parameters": "()", "modifiers": "public static", "return": "DecimalFormat", "signature": "DecimalFormat getFormatter()", "full_signature": "public static DecimalFormat getFormatter()", "class_method_signature": "DistCpUtils.getFormatter()", "testcase": false, "constructor": false}, {"identifier": "getStringDescriptionFor", "parameters": "(long nBytes)", "modifiers": "public static", "return": "String", "signature": "String getStringDescriptionFor(long nBytes)", "full_signature": "public static String getStringDescriptionFor(long nBytes)", "class_method_signature": "DistCpUtils.getStringDescriptionFor(long nBytes)", "testcase": false, "constructor": false}, {"identifier": "checksumsAreEqual", "parameters": "(FileSystem sourceFS, Path source,\n                                   FileSystem targetFS, Path target)", "modifiers": "public static", "return": "boolean", "signature": "boolean checksumsAreEqual(FileSystem sourceFS, Path source,\n                                   FileSystem targetFS, Path target)", "full_signature": "public static boolean checksumsAreEqual(FileSystem sourceFS, Path source,\n                                   FileSystem targetFS, Path target)", "class_method_signature": "DistCpUtils.checksumsAreEqual(FileSystem sourceFS, Path source,\n                                   FileSystem targetFS, Path target)", "testcase": false, "constructor": false}, {"identifier": "compareFs", "parameters": "(FileSystem srcFs, FileSystem destFs)", "modifiers": "public static", "return": "boolean", "signature": "boolean compareFs(FileSystem srcFs, FileSystem destFs)", "full_signature": "public static boolean compareFs(FileSystem srcFs, FileSystem destFs)", "class_method_signature": "DistCpUtils.compareFs(FileSystem srcFs, FileSystem destFs)", "testcase": false, "constructor": false}], "file": "conduit-distcp/src/main/java/com/inmobi/conduit/distcp/tools/util/DistCpUtils.java"}, "focal_method": {"identifier": "preserve", "parameters": "(FileSystem targetFS, Path path,\n                              FileStatus srcFileStatus,\n                              EnumSet<FileAttribute> attributes)", "modifiers": "public static", "return": "void", "body": "public static void preserve(FileSystem targetFS, Path path,\n                              FileStatus srcFileStatus,\n                              EnumSet<FileAttribute> attributes) throws IOException {\n\n    FileStatus targetFileStatus = targetFS.getFileStatus(path);\n    String group = targetFileStatus.getGroup();\n    String user = targetFileStatus.getOwner();\n    boolean chown = false;\n\n    if (attributes.contains(FileAttribute.PERMISSION) &&\n      !srcFileStatus.getPermission().equals(targetFileStatus.getPermission())) {\n      targetFS.setPermission(path, srcFileStatus.getPermission());\n    }\n\n    if (attributes.contains(FileAttribute.REPLICATION) && ! targetFileStatus.isDir() &&\n        srcFileStatus.getReplication() != targetFileStatus.getReplication()) {\n      targetFS.setReplication(path, srcFileStatus.getReplication());\n    }\n\n    if (attributes.contains(FileAttribute.GROUP) &&\n            !group.equals(srcFileStatus.getGroup())) {\n      group = srcFileStatus.getGroup();\n      chown = true;\n    }\n\n    if (attributes.contains(FileAttribute.USER) &&\n            !user.equals(srcFileStatus.getOwner())) {\n      user = srcFileStatus.getOwner();\n      chown = true;\n    }\n\n    if (chown) {\n      targetFS.setOwner(path, user, group);\n    }\n  }", "signature": "void preserve(FileSystem targetFS, Path path,\n                              FileStatus srcFileStatus,\n                              EnumSet<FileAttribute> attributes)", "full_signature": "public static void preserve(FileSystem targetFS, Path path,\n                              FileStatus srcFileStatus,\n                              EnumSet<FileAttribute> attributes)", "class_method_signature": "DistCpUtils.preserve(FileSystem targetFS, Path path,\n                              FileStatus srcFileStatus,\n                              EnumSet<FileAttribute> attributes)", "testcase": false, "constructor": false, "invocations": ["getFileStatus", "getGroup", "getOwner", "contains", "equals", "getPermission", "getPermission", "setPermission", "getPermission", "contains", "isDir", "getReplication", "getReplication", "setReplication", "getReplication", "contains", "equals", "getGroup", "getGroup", "contains", "equals", "getOwner", "getOwner", "setOwner"]}, "repository": {"repo_id": 7218024, "url": "https://github.com/InMobi/conduit", "language": "Java", "is_fork": false, "fork_count": 11, "stargazer_count": 9, "size": 49400, "license": "licensed"}}