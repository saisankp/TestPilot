{"test_class": {"identifier": "DefaultKubeMembershipExecutorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@ClassRule\n    public static final KubeExternalResource KUBE_RESOURCE = new KubeExternalResource();", "modifier": "@ClassRule\n    public static final", "type": "KubeExternalResource", "declarator": "KUBE_RESOURCE = new KubeExternalResource()", "var_name": "KUBE_RESOURCE"}, {"original_string": "private final DefaultKubeMembershipExecutor executor = new DefaultKubeMembershipExecutor(KUBE_RESOURCE.getClient(), \"default\");", "modifier": "private final", "type": "DefaultKubeMembershipExecutor", "declarator": "executor = new DefaultKubeMembershipExecutor(KUBE_RESOURCE.getClient(), \"default\")", "var_name": "executor"}, {"original_string": "private final TitusRxSubscriber<ClusterMembershipEvent> eventSubscriber = new TitusRxSubscriber<>();", "modifier": "private final", "type": "TitusRxSubscriber<ClusterMembershipEvent>", "declarator": "eventSubscriber = new TitusRxSubscriber<>()", "var_name": "eventSubscriber"}, {"original_string": "private final List<String> createdMemberIds = new ArrayList<>();", "modifier": "private final", "type": "List<String>", "declarator": "createdMemberIds = new ArrayList<>()", "var_name": "createdMemberIds"}], "file": "titus-common-ext/kube/src/test/java/com/netflix/titus/ext/kube/clustermembership/connector/DefaultKubeMembershipExecutorTest.java"}, "test_case": {"identifier": "testRemoveMember", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testRemoveMember() throws InterruptedException {\n        ClusterMembershipRevision<ClusterMember> revision = newMemberRevision();\n        String memberId = revision.getCurrent().getMemberId();\n\n        ClusterMembershipRevision<ClusterMember> result = executor.createLocal(revision).block();\n        executor.removeMember(memberId).block();\n        try {\n            executor.getMemberById(memberId).block();\n            fail(\"Found removed member\");\n        } catch (Exception e) {\n            assertThat(KubeUtils.is4xx(e)).isTrue();\n        }\n\n        expectClusterMembershipChangeEvent(result, ClusterMembershipChangeEvent.ChangeType.Added);\n        assertThat(findNextMemberEvent(memberId)).isNotNull();\n    }", "signature": "void testRemoveMember()", "full_signature": "@Test public void testRemoveMember()", "class_method_signature": "DefaultKubeMembershipExecutorTest.testRemoveMember()", "testcase": true, "constructor": false, "invocations": ["newMemberRevision", "getMemberId", "getCurrent", "block", "createLocal", "block", "removeMember", "block", "getMemberById", "fail", "isTrue", "assertThat", "is4xx", "expectClusterMembershipChangeEvent", "isNotNull", "assertThat", "findNextMemberEvent"]}, "focal_class": {"identifier": "DefaultKubeMembershipExecutor", "superclass": "", "interfaces": "implements KubeMembershipExecutor", "fields": [{"original_string": "private final String namespace;", "modifier": "private final", "type": "String", "declarator": "namespace", "var_name": "namespace"}, {"original_string": "private final ApiClient kubeApiClient;", "modifier": "private final", "type": "ApiClient", "declarator": "kubeApiClient", "var_name": "kubeApiClient"}, {"original_string": "private final CustomObjectsApi kubeCustomObjectClient;", "modifier": "private final", "type": "CustomObjectsApi", "declarator": "kubeCustomObjectClient", "var_name": "kubeCustomObjectClient"}], "methods": [{"identifier": "DefaultKubeMembershipExecutor", "parameters": "(ApiClient kubeApiClient,\n                                         String namespace)", "modifiers": "public", "return": "", "signature": " DefaultKubeMembershipExecutor(ApiClient kubeApiClient,\n                                         String namespace)", "full_signature": "public  DefaultKubeMembershipExecutor(ApiClient kubeApiClient,\n                                         String namespace)", "class_method_signature": "DefaultKubeMembershipExecutor.DefaultKubeMembershipExecutor(ApiClient kubeApiClient,\n                                         String namespace)", "testcase": false, "constructor": true}, {"identifier": "getMemberById", "parameters": "(String memberId)", "modifiers": "@Override public", "return": "Mono<ClusterMembershipRevision<ClusterMember>>", "signature": "Mono<ClusterMembershipRevision<ClusterMember>> getMemberById(String memberId)", "full_signature": "@Override public Mono<ClusterMembershipRevision<ClusterMember>> getMemberById(String memberId)", "class_method_signature": "DefaultKubeMembershipExecutor.getMemberById(String memberId)", "testcase": false, "constructor": false}, {"identifier": "createLocal", "parameters": "(ClusterMembershipRevision<ClusterMember> localMemberRevision)", "modifiers": "@Override public", "return": "Mono<ClusterMembershipRevision<ClusterMember>>", "signature": "Mono<ClusterMembershipRevision<ClusterMember>> createLocal(ClusterMembershipRevision<ClusterMember> localMemberRevision)", "full_signature": "@Override public Mono<ClusterMembershipRevision<ClusterMember>> createLocal(ClusterMembershipRevision<ClusterMember> localMemberRevision)", "class_method_signature": "DefaultKubeMembershipExecutor.createLocal(ClusterMembershipRevision<ClusterMember> localMemberRevision)", "testcase": false, "constructor": false}, {"identifier": "updateLocal", "parameters": "(ClusterMembershipRevision<ClusterMember> localMemberRevision)", "modifiers": "@Override public", "return": "Mono<ClusterMembershipRevision<ClusterMember>>", "signature": "Mono<ClusterMembershipRevision<ClusterMember>> updateLocal(ClusterMembershipRevision<ClusterMember> localMemberRevision)", "full_signature": "@Override public Mono<ClusterMembershipRevision<ClusterMember>> updateLocal(ClusterMembershipRevision<ClusterMember> localMemberRevision)", "class_method_signature": "DefaultKubeMembershipExecutor.updateLocal(ClusterMembershipRevision<ClusterMember> localMemberRevision)", "testcase": false, "constructor": false}, {"identifier": "removeMember", "parameters": "(String memberId)", "modifiers": "@Override public", "return": "Mono<Void>", "signature": "Mono<Void> removeMember(String memberId)", "full_signature": "@Override public Mono<Void> removeMember(String memberId)", "class_method_signature": "DefaultKubeMembershipExecutor.removeMember(String memberId)", "testcase": false, "constructor": false}, {"identifier": "watchMembershipEvents", "parameters": "()", "modifiers": "@Override public", "return": "Flux<ClusterMembershipEvent>", "signature": "Flux<ClusterMembershipEvent> watchMembershipEvents()", "full_signature": "@Override public Flux<ClusterMembershipEvent> watchMembershipEvents()", "class_method_signature": "DefaultKubeMembershipExecutor.watchMembershipEvents()", "testcase": false, "constructor": false}, {"identifier": "applyNewRevisionNumber", "parameters": "(ClusterMembershipRevision<ClusterMember> localMemberRevision, V1ObjectMeta metadata)", "modifiers": "private", "return": "ClusterMembershipRevision<ClusterMember>", "signature": "ClusterMembershipRevision<ClusterMember> applyNewRevisionNumber(ClusterMembershipRevision<ClusterMember> localMemberRevision, V1ObjectMeta metadata)", "full_signature": "private ClusterMembershipRevision<ClusterMember> applyNewRevisionNumber(ClusterMembershipRevision<ClusterMember> localMemberRevision, V1ObjectMeta metadata)", "class_method_signature": "DefaultKubeMembershipExecutor.applyNewRevisionNumber(ClusterMembershipRevision<ClusterMember> localMemberRevision, V1ObjectMeta metadata)", "testcase": false, "constructor": false}], "file": "titus-common-ext/kube/src/main/java/com/netflix/titus/ext/kube/clustermembership/connector/DefaultKubeMembershipExecutor.java"}, "focal_method": {"identifier": "removeMember", "parameters": "(String memberId)", "modifiers": "@Override public", "return": "Mono<Void>", "body": "@Override\n    public Mono<Void> removeMember(String memberId) {\n        return KubeClientReactorAdapters.doUpdate(callbackHandler ->\n                kubeCustomObjectClient.deleteNamespacedCustomObjectAsync(\n                        KubeClusterMembershipModelConverters.CRD_GROUP,\n                        KubeClusterMembershipModelConverters.CRD_VERSION,\n                        namespace,\n                        KubeClusterMembershipModelConverters.CRD_PLURAL_MEMBERS,\n                        memberId,\n                        0,\n                        false,\n                        null,\n                        new V1DeleteOptionsBuilder().build(),\n                        callbackHandler\n                )\n        ).ignoreElement().cast(Void.class);\n    }", "signature": "Mono<Void> removeMember(String memberId)", "full_signature": "@Override public Mono<Void> removeMember(String memberId)", "class_method_signature": "DefaultKubeMembershipExecutor.removeMember(String memberId)", "testcase": false, "constructor": false, "invocations": ["cast", "ignoreElement", "doUpdate", "deleteNamespacedCustomObjectAsync", "build"]}, "repository": {"repo_id": 107330274, "url": "https://github.com/Netflix/titus-control-plane", "stars": 241, "created": "10/17/2017 10:20:55 PM +00:00", "updates": "2020-01-25T13:01:05+00:00", "fork": "False", "license": "licensed"}}