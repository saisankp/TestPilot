{"test_class": {"identifier": "FileServiceTest", "superclass": "extends PrimeTimeTest", "interfaces": "", "fields": [{"original_string": "private FileService fileService;", "modifier": "private", "type": "FileService", "declarator": "fileService", "var_name": "fileService"}, {"original_string": "private ScreenService screenService;", "modifier": "private", "type": "ScreenService", "declarator": "screenService", "var_name": "screenService"}, {"original_string": "private PageService pageService;", "modifier": "private", "type": "PageService", "declarator": "pageService", "var_name": "pageService"}], "file": "common/app/src/test/java/com/sap/primetime/api/FileServiceTest.java"}, "test_case": {"identifier": "testUploadFile", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n\tpublic void testUploadFile() throws Exception {\n\t\tassertEquals(0, getFiles().size());\n\t\tUploadHelper.simulateFileUpload(requestMock, \"600x400.png\", \"image/png\");\n\t\tfileService.uploadFile();\n\t\tassertEquals(1, getFiles().size());\n\t\tFile file = getFiles().get(0);\n\t\tassertEquals(simpleUser.getUserId(), file.getOwners().get(0).getUser().getUserId());\n\t\tassertEquals(\"png\", file.getFileType());\n\t\tassertEquals(600, file.getWidth());\n\t\tassertEquals(400, file.getHeight());\n\t\tassertTrue(file.getName().endsWith(\"600x400\"));\n\t\tassertTrue(file.getSize() > 0);\n\t}", "signature": "void testUploadFile()", "full_signature": "@Test public void testUploadFile()", "class_method_signature": "FileServiceTest.testUploadFile()", "testcase": true, "constructor": false, "invocations": ["assertEquals", "size", "getFiles", "simulateFileUpload", "uploadFile", "assertEquals", "size", "getFiles", "get", "getFiles", "assertEquals", "getUserId", "getUserId", "getUser", "get", "getOwners", "assertEquals", "getFileType", "assertEquals", "getWidth", "assertEquals", "getHeight", "assertTrue", "endsWith", "getName", "assertTrue", "getSize"]}, "focal_class": {"identifier": "FileService", "superclass": "extends BasicService", "interfaces": "implements OwnerAPISupport<File>", "fields": [{"original_string": "private static final Logger logger = LoggerFactory.getLogger(FileService.class);", "modifier": "private static final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(FileService.class)", "var_name": "logger"}], "methods": [{"identifier": "getFiles", "parameters": "(@QueryParam(\"userId\") String userId)", "modifiers": "@GET @Path(\"/files\") @Produces(MediaType.APPLICATION_JSON) public", "return": "List<File>", "signature": "List<File> getFiles(@QueryParam(\"userId\") String userId)", "full_signature": "@GET @Path(\"/files\") @Produces(MediaType.APPLICATION_JSON) public List<File> getFiles(@QueryParam(\"userId\") String userId)", "class_method_signature": "FileService.getFiles(@QueryParam(\"userId\") String userId)", "testcase": false, "constructor": false}, {"identifier": "getFile", "parameters": "(@PathParam(\"fileId\") long id)", "modifiers": "@GET @Path(\"/files/{fileId}\") @Produces(MediaType.APPLICATION_JSON) public", "return": "File", "signature": "File getFile(@PathParam(\"fileId\") long id)", "full_signature": "@GET @Path(\"/files/{fileId}\") @Produces(MediaType.APPLICATION_JSON) public File getFile(@PathParam(\"fileId\") long id)", "class_method_signature": "FileService.getFile(@PathParam(\"fileId\") long id)", "testcase": false, "constructor": false}, {"identifier": "updateFile", "parameters": "(@PathParam(\"fileId\") long fileId, File fileData)", "modifiers": "@PUT @Path(\"/files/{fileId}\") @Produces(MediaType.APPLICATION_JSON) public", "return": "File", "signature": "File updateFile(@PathParam(\"fileId\") long fileId, File fileData)", "full_signature": "@PUT @Path(\"/files/{fileId}\") @Produces(MediaType.APPLICATION_JSON) public File updateFile(@PathParam(\"fileId\") long fileId, File fileData)", "class_method_signature": "FileService.updateFile(@PathParam(\"fileId\") long fileId, File fileData)", "testcase": false, "constructor": false}, {"identifier": "uploadFile", "parameters": "()", "modifiers": "@POST @Path(\"/files\") public", "return": "Response", "signature": "Response uploadFile()", "full_signature": "@POST @Path(\"/files\") public Response uploadFile()", "class_method_signature": "FileService.uploadFile()", "testcase": false, "constructor": false}, {"identifier": "rotateImage", "parameters": "(@PathParam(\"fileId\") long fileId)", "modifiers": "@POST @Path(\"/files/{fileId}/rotate\") public", "return": "Response", "signature": "Response rotateImage(@PathParam(\"fileId\") long fileId)", "full_signature": "@POST @Path(\"/files/{fileId}/rotate\") public Response rotateImage(@PathParam(\"fileId\") long fileId)", "class_method_signature": "FileService.rotateImage(@PathParam(\"fileId\") long fileId)", "testcase": false, "constructor": false}, {"identifier": "updateFileContent", "parameters": "(@PathParam(\"fileId\") long fileId)", "modifiers": "@POST @Path(\"/files/{fileId}/content\") public", "return": "Response", "signature": "Response updateFileContent(@PathParam(\"fileId\") long fileId)", "full_signature": "@POST @Path(\"/files/{fileId}/content\") public Response updateFileContent(@PathParam(\"fileId\") long fileId)", "class_method_signature": "FileService.updateFileContent(@PathParam(\"fileId\") long fileId)", "testcase": false, "constructor": false}, {"identifier": "addContentMetadata", "parameters": "(File existingFile, InputStream stream)", "modifiers": "private", "return": "boolean", "signature": "boolean addContentMetadata(File existingFile, InputStream stream)", "full_signature": "private boolean addContentMetadata(File existingFile, InputStream stream)", "class_method_signature": "FileService.addContentMetadata(File existingFile, InputStream stream)", "testcase": false, "constructor": false}, {"identifier": "parseTemplate", "parameters": "(File existingFile, InputStream stream)", "modifiers": "private", "return": "boolean", "signature": "boolean parseTemplate(File existingFile, InputStream stream)", "full_signature": "private boolean parseTemplate(File existingFile, InputStream stream)", "class_method_signature": "FileService.parseTemplate(File existingFile, InputStream stream)", "testcase": false, "constructor": false}, {"identifier": "deleteFile", "parameters": "(@PathParam(\"fileId\") long fileId)", "modifiers": "@DELETE @Path(\"/files/{fileId}\") public", "return": "Response", "signature": "Response deleteFile(@PathParam(\"fileId\") long fileId)", "full_signature": "@DELETE @Path(\"/files/{fileId}\") public Response deleteFile(@PathParam(\"fileId\") long fileId)", "class_method_signature": "FileService.deleteFile(@PathParam(\"fileId\") long fileId)", "testcase": false, "constructor": false}, {"identifier": "getReferences", "parameters": "(@PathParam(\"fileId\") long fileId)", "modifiers": "@GET @Path(\"/files/{fileId}/references\") @Produces(MediaType.APPLICATION_JSON) public", "return": "FileReferences", "signature": "FileReferences getReferences(@PathParam(\"fileId\") long fileId)", "full_signature": "@GET @Path(\"/files/{fileId}/references\") @Produces(MediaType.APPLICATION_JSON) public FileReferences getReferences(@PathParam(\"fileId\") long fileId)", "class_method_signature": "FileService.getReferences(@PathParam(\"fileId\") long fileId)", "testcase": false, "constructor": false}, {"identifier": "getFileContent", "parameters": "(@PathParam(\"fileId\") long fileId,\n\t\t\t@DefaultValue(\"false\") @QueryParam(\"thumbnail\") boolean thumbnail,\n\t\t\t@DefaultValue(\"0\") @QueryParam(\"page\") int page,\n\t\t\t@DefaultValue(\"false\") @QueryParam(\"download\") boolean download)", "modifiers": "@GET @Path(\"/files/{fileId}/content\") @Produces({ \"image/jpeg,image/png,image/gif,image/bmp,application/pdf,image/svg+xml,image/x-icon,video/mp4\" }) public", "return": "Response", "signature": "Response getFileContent(@PathParam(\"fileId\") long fileId,\n\t\t\t@DefaultValue(\"false\") @QueryParam(\"thumbnail\") boolean thumbnail,\n\t\t\t@DefaultValue(\"0\") @QueryParam(\"page\") int page,\n\t\t\t@DefaultValue(\"false\") @QueryParam(\"download\") boolean download)", "full_signature": "@GET @Path(\"/files/{fileId}/content\") @Produces({ \"image/jpeg,image/png,image/gif,image/bmp,application/pdf,image/svg+xml,image/x-icon,video/mp4\" }) public Response getFileContent(@PathParam(\"fileId\") long fileId,\n\t\t\t@DefaultValue(\"false\") @QueryParam(\"thumbnail\") boolean thumbnail,\n\t\t\t@DefaultValue(\"0\") @QueryParam(\"page\") int page,\n\t\t\t@DefaultValue(\"false\") @QueryParam(\"download\") boolean download)", "class_method_signature": "FileService.getFileContent(@PathParam(\"fileId\") long fileId,\n\t\t\t@DefaultValue(\"false\") @QueryParam(\"thumbnail\") boolean thumbnail,\n\t\t\t@DefaultValue(\"0\") @QueryParam(\"page\") int page,\n\t\t\t@DefaultValue(\"false\") @QueryParam(\"download\") boolean download)", "testcase": false, "constructor": false}, {"identifier": "getLong", "parameters": "(String value, int beginIndex, int endIndex)", "modifiers": "private", "return": "long", "signature": "long getLong(String value, int beginIndex, int endIndex)", "full_signature": "private long getLong(String value, int beginIndex, int endIndex)", "class_method_signature": "FileService.getLong(String value, int beginIndex, int endIndex)", "testcase": false, "constructor": false}, {"identifier": "createThumbnail", "parameters": "(File file, int page)", "modifiers": "private", "return": "boolean", "signature": "boolean createThumbnail(File file, int page)", "full_signature": "private boolean createThumbnail(File file, int page)", "class_method_signature": "FileService.createThumbnail(File file, int page)", "testcase": false, "constructor": false}, {"identifier": "getFileContent", "parameters": "(@PathParam(\"fileId\") long fileId, @PathParam(\"path\") String path,\n\t\t\t@DefaultValue(\"0\") @QueryParam(\"page\") long pageId)", "modifiers": "@GET @Path(\"/files/{fileId}/content/{path}\") @Produces({ \"text/html,image/jpeg,image/png,image/gif,image/bmp,application/pdf,image/svg+xml,image/x-icon,video/mp4\" }) public", "return": "Response", "signature": "Response getFileContent(@PathParam(\"fileId\") long fileId, @PathParam(\"path\") String path,\n\t\t\t@DefaultValue(\"0\") @QueryParam(\"page\") long pageId)", "full_signature": "@GET @Path(\"/files/{fileId}/content/{path}\") @Produces({ \"text/html,image/jpeg,image/png,image/gif,image/bmp,application/pdf,image/svg+xml,image/x-icon,video/mp4\" }) public Response getFileContent(@PathParam(\"fileId\") long fileId, @PathParam(\"path\") String path,\n\t\t\t@DefaultValue(\"0\") @QueryParam(\"page\") long pageId)", "class_method_signature": "FileService.getFileContent(@PathParam(\"fileId\") long fileId, @PathParam(\"path\") String path,\n\t\t\t@DefaultValue(\"0\") @QueryParam(\"page\") long pageId)", "testcase": false, "constructor": false}, {"identifier": "addOwners", "parameters": "(@PathParam(\"fileId\") long fileId, Owner[] ownerData)", "modifiers": "@Override @POST @Path(\"/files/{fileId}/owners\") @Consumes(MediaType.APPLICATION_JSON) public", "return": "File", "signature": "File addOwners(@PathParam(\"fileId\") long fileId, Owner[] ownerData)", "full_signature": "@Override @POST @Path(\"/files/{fileId}/owners\") @Consumes(MediaType.APPLICATION_JSON) public File addOwners(@PathParam(\"fileId\") long fileId, Owner[] ownerData)", "class_method_signature": "FileService.addOwners(@PathParam(\"fileId\") long fileId, Owner[] ownerData)", "testcase": false, "constructor": false}, {"identifier": "deleteOwner", "parameters": "(@PathParam(\"fileId\") long fileId, @PathParam(\"ownerId\") long ownerId)", "modifiers": "@Override @DELETE @Path(\"/files/{fileId}/owners/{ownerId}\") @Produces(MediaType.APPLICATION_JSON) public", "return": "File", "signature": "File deleteOwner(@PathParam(\"fileId\") long fileId, @PathParam(\"ownerId\") long ownerId)", "full_signature": "@Override @DELETE @Path(\"/files/{fileId}/owners/{ownerId}\") @Produces(MediaType.APPLICATION_JSON) public File deleteOwner(@PathParam(\"fileId\") long fileId, @PathParam(\"ownerId\") long ownerId)", "class_method_signature": "FileService.deleteOwner(@PathParam(\"fileId\") long fileId, @PathParam(\"ownerId\") long ownerId)", "testcase": false, "constructor": false}, {"identifier": "getScreenshotContent", "parameters": "(@PathParam(\"key\") String key)", "modifiers": "@GET @Path(\"/screenkey/{key}\") @Produces({ \"image/jpeg,image/png,image/gif,image/bmp,application/pdf,image/svg+xml,image/x-icon,video/mp4\" }) public", "return": "Response", "signature": "Response getScreenshotContent(@PathParam(\"key\") String key)", "full_signature": "@GET @Path(\"/screenkey/{key}\") @Produces({ \"image/jpeg,image/png,image/gif,image/bmp,application/pdf,image/svg+xml,image/x-icon,video/mp4\" }) public Response getScreenshotContent(@PathParam(\"key\") String key)", "class_method_signature": "FileService.getScreenshotContent(@PathParam(\"key\") String key)", "testcase": false, "constructor": false}, {"identifier": "uploadScreenshot", "parameters": "(@PathParam(\"key\") String key)", "modifiers": "@POST @Path(\"/screenkey/{key}\") public", "return": "Response", "signature": "Response uploadScreenshot(@PathParam(\"key\") String key)", "full_signature": "@POST @Path(\"/screenkey/{key}\") public Response uploadScreenshot(@PathParam(\"key\") String key)", "class_method_signature": "FileService.uploadScreenshot(@PathParam(\"key\") String key)", "testcase": false, "constructor": false}, {"identifier": "getRawECM", "parameters": "()", "modifiers": "@GET @Path(\"/ecm\") @Produces(MediaType.APPLICATION_JSON) public", "return": "List<File>", "signature": "List<File> getRawECM()", "full_signature": "@GET @Path(\"/ecm\") @Produces(MediaType.APPLICATION_JSON) public List<File> getRawECM()", "class_method_signature": "FileService.getRawECM()", "testcase": false, "constructor": false}, {"identifier": "deleteECMFile", "parameters": "(@PathParam(\"key\") String ecmKey)", "modifiers": "@DELETE @Path(\"/ecm/{key}\") @Produces(MediaType.APPLICATION_JSON) public", "return": "Response", "signature": "Response deleteECMFile(@PathParam(\"key\") String ecmKey)", "full_signature": "@DELETE @Path(\"/ecm/{key}\") @Produces(MediaType.APPLICATION_JSON) public Response deleteECMFile(@PathParam(\"key\") String ecmKey)", "class_method_signature": "FileService.deleteECMFile(@PathParam(\"key\") String ecmKey)", "testcase": false, "constructor": false}, {"identifier": "deleteThumbnails", "parameters": "()", "modifiers": "@POST @Path(\"/deletethumbnails\") public", "return": "Response", "signature": "Response deleteThumbnails()", "full_signature": "@POST @Path(\"/deletethumbnails\") public Response deleteThumbnails()", "class_method_signature": "FileService.deleteThumbnails()", "testcase": false, "constructor": false}, {"identifier": "deleteThumbnails", "parameters": "(String fileKey)", "modifiers": "private", "return": "void", "signature": "void deleteThumbnails(String fileKey)", "full_signature": "private void deleteThumbnails(String fileKey)", "class_method_signature": "FileService.deleteThumbnails(String fileKey)", "testcase": false, "constructor": false}, {"identifier": "copyPartialStream", "parameters": "(InputStream in, OutputStream out, long startIdx, long length)", "modifiers": "private", "return": "void", "signature": "void copyPartialStream(InputStream in, OutputStream out, long startIdx, long length)", "full_signature": "private void copyPartialStream(InputStream in, OutputStream out, long startIdx, long length)", "class_method_signature": "FileService.copyPartialStream(InputStream in, OutputStream out, long startIdx, long length)", "testcase": false, "constructor": false}], "file": "common/app/src/main/java/com/sap/primetime/api/FileService.java"}, "focal_method": {"identifier": "uploadFile", "parameters": "()", "modifiers": "@POST @Path(\"/files\") public", "return": "Response", "body": "@POST\n\t@Path(\"/files\")\n\tpublic Response uploadFile() {\n\t\tString fileName = null;\n\t\tlong fileSize = 0;\n\t\tFileItem document = null;\n\t\tbyte[] content = null; // FIXME: this will kill the server for huge files, switch to streaming\n\n\t\tif (!ServletFileUpload.isMultipartContent(request)) {\n\t\t\t// plain upload\n\t\t\tfileSize = request.getContentLength();\n\t\t\tfileName = request.getHeader(\"filename\");\n\t\t\tif (fileName == null) {\n\t\t\t\tthrowBadRequest(\"Header 'filename' is missing in request.\");\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tcontent = IOUtils.readFully(request.getInputStream(), request.getContentLength());\n\t\t\t} catch (IOException e) {\n\t\t\t\tlogger.error(\"File could not be read.\", e);\n\t\t\t\treturn RESPONSE_BAD;\n\t\t\t}\n\t\t} else {\n\t\t\t// multipart/form encoded\n\t\t\ttry {\n\t\t\t\tdocument = UploadHandler.getUploadedDocument(request);\n\t\t\t} catch (FileUploadException e) {\n\t\t\t\tlogger.error(\"File could not be uploaded.\", e);\n\t\t\t\treturn RESPONSE_BAD;\n\t\t\t}\n\t\t\tfileName = document.getName();\n\t\t\tfileSize = document.getSize();\n\t\t\tcontent = document.get();\n\t\t}\n\n\t\tfileName = org.apache.commons.io.FilenameUtils.getName(fileName);\n\t\tString key = Math.abs(new Random().nextInt()) + \"_\" + fileName;\n\t\tif (!fileName.contains(\".\")) {\n\t\t\tif (document != null) {\n\t\t\t\tdocument.delete();\n\t\t\t}\n\t\t\tthrowBadRequest(\"File type could not be determined.\");\n\t\t}\n\t\tString fileType = FilenameUtils.getExtension(fileName).toLowerCase();\n\t\tif (!mimeTypes.containsKey(fileType)) {\n\t\t\tif (document != null) {\n\t\t\t\tdocument.delete();\n\t\t\t}\n\t\t\tthrowBadRequest(\"Unsupported file type.\");\n\t\t}\n\t\ttry {\n\t\t\tgetECM().uploadDocument(key, content, mimeTypes.get(fileType));\n\t\t\tfileName = FilenameUtils.getBaseName(fileName);\n\t\t\tFile file = createFile(fileName, fileType, key, fileSize);\n\n\t\t\taddContentMetadata(file, new ByteArrayInputStream(content));\n\n\t\t\tif (document != null) {\n\t\t\t\tdocument.delete();\n\t\t\t}\n\t\t} catch (CmisNameConstraintViolationException e) {\n\t\t\tlogger.error(\"Filename exception.\", e);\n\t\t\treturn RESPONSE_BAD;\n\t\t}\n\t\tdeleteThumbnails(key);\n\n\t\treturn RESPONSE_OK;\n\t}", "signature": "Response uploadFile()", "full_signature": "@POST @Path(\"/files\") public Response uploadFile()", "class_method_signature": "FileService.uploadFile()", "testcase": false, "constructor": false, "invocations": ["isMultipartContent", "getContentLength", "getHeader", "throwBadRequest", "readFully", "getInputStream", "getContentLength", "error", "getUploadedDocument", "error", "getName", "getSize", "get", "getName", "abs", "nextInt", "contains", "delete", "throwBadRequest", "toLowerCase", "getExtension", "containsKey", "delete", "throwBadRequest", "uploadDocument", "getECM", "get", "getBaseName", "createFile", "addContentMetadata", "delete", "error", "deleteThumbnails"]}, "repository": {"repo_id": 172529766, "url": "https://github.com/SAP/cloud-primetime", "language": "Java", "is_fork": false, "fork_count": 2, "stargazer_count": 25, "size": 7529, "license": "licensed"}}