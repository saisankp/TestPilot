{"test_class": {"identifier": "AthenzJettyContainerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String DEFAULT_EXCLUDED_CIPHERS = \"^_(MD5|SHA|SHA1)$\";", "modifier": "private static final", "type": "String", "declarator": "DEFAULT_EXCLUDED_CIPHERS = \"^_(MD5|SHA|SHA1)$\"", "var_name": "DEFAULT_EXCLUDED_CIPHERS"}, {"original_string": "private static final String DEFAULT_INCLUDED_CIPHERS = \"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\";", "modifier": "private static final", "type": "String", "declarator": "DEFAULT_INCLUDED_CIPHERS = \"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\"", "var_name": "DEFAULT_INCLUDED_CIPHERS"}], "file": "containers/jetty/src/test/java/com/yahoo/athenz/container/AthenzJettyContainerTest.java"}, "test_case": {"identifier": "testCreateSSLContextObject", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testCreateSSLContextObject() {\n        \n        AthenzJettyContainer container = new AthenzJettyContainer();\n        \n        System.setProperty(AthenzConsts.ATHENZ_PROP_KEYSTORE_PATH, \"file:///tmp/keystore\");\n        System.setProperty(AthenzConsts.ATHENZ_PROP_KEYSTORE_TYPE, \"PKCS12\");\n        System.setProperty(AthenzConsts.ATHENZ_PROP_KEYSTORE_PASSWORD, \"pass123\");\n        System.setProperty(AthenzConsts.ATHENZ_PROP_TRUSTSTORE_PATH, \"file:///tmp/truststore\");\n        System.setProperty(AthenzConsts.ATHENZ_PROP_TRUSTSTORE_TYPE, \"PKCS12\");\n        System.setProperty(AthenzConsts.ATHENZ_PROP_TRUSTSTORE_PASSWORD, \"pass123\");\n        System.setProperty(AthenzConsts.ATHENZ_PROP_KEYMANAGER_PASSWORD, \"pass123\");\n        System.setProperty(AthenzConsts.ATHENZ_PROP_EXCLUDED_CIPHER_SUITES, DEFAULT_EXCLUDED_CIPHERS);\n        System.setProperty(AthenzConsts.ATHENZ_PROP_INCLUDED_CIPHER_SUITES, DEFAULT_INCLUDED_CIPHERS);\n        System.setProperty(AthenzConsts.ATHENZ_PROP_EXCLUDED_PROTOCOLS, AthenzJettyContainer.ATHENZ_DEFAULT_EXCLUDED_PROTOCOLS);\n        \n        SslContextFactory.Server sslContextFactory = container.createSSLContextObject(true);\n        assertNotNull(sslContextFactory);\n        assertEquals(sslContextFactory.getKeyStorePath(), \"file:///tmp/keystore\");\n        assertEquals(sslContextFactory.getKeyStoreType(), \"PKCS12\");\n        assertEquals(sslContextFactory.getTrustStoreResource().toString(), \"file:///tmp/truststore\");\n        assertEquals(sslContextFactory.getTrustStoreType(), \"PKCS12\");\n        assertEquals(sslContextFactory.getExcludeCipherSuites(), DEFAULT_EXCLUDED_CIPHERS.split(\",\"));\n        assertEquals(sslContextFactory.getIncludeCipherSuites(), DEFAULT_INCLUDED_CIPHERS.split(\",\"));\n        assertEquals(sslContextFactory.getExcludeProtocols(), AthenzJettyContainer.ATHENZ_DEFAULT_EXCLUDED_PROTOCOLS.split(\",\"));\n        assertTrue(sslContextFactory.getNeedClientAuth());\n    }", "signature": "void testCreateSSLContextObject()", "full_signature": "@Test public void testCreateSSLContextObject()", "class_method_signature": "AthenzJettyContainerTest.testCreateSSLContextObject()", "testcase": true, "constructor": false, "invocations": ["setProperty", "setProperty", "setProperty", "setProperty", "setProperty", "setProperty", "setProperty", "setProperty", "setProperty", "setProperty", "createSSLContextObject", "assertNotNull", "assertEquals", "getKeyStorePath", "assertEquals", "getKeyStoreType", "assertEquals", "toString", "getTrustStoreResource", "assertEquals", "getTrustStoreType", "assertEquals", "getExcludeCipherSuites", "split", "assertEquals", "getIncludeCipherSuites", "split", "assertEquals", "getExcludeProtocols", "split", "assertTrue", "getNeedClientAuth"]}, "focal_class": {"identifier": "AthenzJettyContainer", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger LOG = LoggerFactory.getLogger(AthenzJettyContainer.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOG = LoggerFactory.getLogger(AthenzJettyContainer.class)", "var_name": "LOG"}, {"original_string": "private static String ROOT_DIR;", "modifier": "private static", "type": "String", "declarator": "ROOT_DIR", "var_name": "ROOT_DIR"}, {"original_string": "private static final String DEFAULT_WEBAPP_DESCRIPTOR = \"/etc/webdefault.xml\";", "modifier": "private static final", "type": "String", "declarator": "DEFAULT_WEBAPP_DESCRIPTOR = \"/etc/webdefault.xml\"", "var_name": "DEFAULT_WEBAPP_DESCRIPTOR"}, {"original_string": "static final String ATHENZ_DEFAULT_EXCLUDED_PROTOCOLS = \"SSLv2,SSLv3\";", "modifier": "static final", "type": "String", "declarator": "ATHENZ_DEFAULT_EXCLUDED_PROTOCOLS = \"SSLv2,SSLv3\"", "var_name": "ATHENZ_DEFAULT_EXCLUDED_PROTOCOLS"}, {"original_string": "private Server server = null;", "modifier": "private", "type": "Server", "declarator": "server = null", "var_name": "server"}, {"original_string": "private String banner = null;", "modifier": "private", "type": "String", "declarator": "banner = null", "var_name": "banner"}, {"original_string": "private HandlerCollection handlers = null;", "modifier": "private", "type": "HandlerCollection", "declarator": "handlers = null", "var_name": "handlers"}, {"original_string": "private PrivateKeyStore privateKeyStore;", "modifier": "private", "type": "PrivateKeyStore", "declarator": "privateKeyStore", "var_name": "privateKeyStore"}], "methods": [{"identifier": "AthenzJettyContainer", "parameters": "()", "modifiers": "public", "return": "", "signature": " AthenzJettyContainer()", "full_signature": "public  AthenzJettyContainer()", "class_method_signature": "AthenzJettyContainer.AthenzJettyContainer()", "testcase": false, "constructor": true}, {"identifier": "getServer", "parameters": "()", "modifiers": "", "return": "Server", "signature": "Server getServer()", "full_signature": " Server getServer()", "class_method_signature": "AthenzJettyContainer.getServer()", "testcase": false, "constructor": false}, {"identifier": "getHandlers", "parameters": "()", "modifiers": "", "return": "HandlerCollection", "signature": "HandlerCollection getHandlers()", "full_signature": " HandlerCollection getHandlers()", "class_method_signature": "AthenzJettyContainer.getHandlers()", "testcase": false, "constructor": false}, {"identifier": "getServerHostName", "parameters": "()", "modifiers": "static", "return": "String", "signature": "String getServerHostName()", "full_signature": "static String getServerHostName()", "class_method_signature": "AthenzJettyContainer.getServerHostName()", "testcase": false, "constructor": false}, {"identifier": "getRootDir", "parameters": "()", "modifiers": "public static", "return": "String", "signature": "String getRootDir()", "full_signature": "public static String getRootDir()", "class_method_signature": "AthenzJettyContainer.getRootDir()", "testcase": false, "constructor": false}, {"identifier": "addRequestLogHandler", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void addRequestLogHandler()", "full_signature": "public void addRequestLogHandler()", "class_method_signature": "AthenzJettyContainer.addRequestLogHandler()", "testcase": false, "constructor": false}, {"identifier": "addServletHandlers", "parameters": "(String serverHostName)", "modifiers": "public", "return": "void", "signature": "void addServletHandlers(String serverHostName)", "full_signature": "public void addServletHandlers(String serverHostName)", "class_method_signature": "AthenzJettyContainer.addServletHandlers(String serverHostName)", "testcase": false, "constructor": false}, {"identifier": "setDefaultsDescriptor", "parameters": "(WebAppProvider webappProvider, String jettyHome)", "modifiers": "private", "return": "void", "signature": "void setDefaultsDescriptor(WebAppProvider webappProvider, String jettyHome)", "full_signature": "private void setDefaultsDescriptor(WebAppProvider webappProvider, String jettyHome)", "class_method_signature": "AthenzJettyContainer.setDefaultsDescriptor(WebAppProvider webappProvider, String jettyHome)", "testcase": false, "constructor": false}, {"identifier": "newHttpConfiguration", "parameters": "()", "modifiers": "public", "return": "HttpConfiguration", "signature": "HttpConfiguration newHttpConfiguration()", "full_signature": "public HttpConfiguration newHttpConfiguration()", "class_method_signature": "AthenzJettyContainer.newHttpConfiguration()", "testcase": false, "constructor": false}, {"identifier": "loadServicePrivateKey", "parameters": "()", "modifiers": "", "return": "void", "signature": "void loadServicePrivateKey()", "full_signature": " void loadServicePrivateKey()", "class_method_signature": "AthenzJettyContainer.loadServicePrivateKey()", "testcase": false, "constructor": false}, {"identifier": "createSSLContextObject", "parameters": "(boolean needClientAuth)", "modifiers": "", "return": "SslContextFactory.Server", "signature": "SslContextFactory.Server createSSLContextObject(boolean needClientAuth)", "full_signature": " SslContextFactory.Server createSSLContextObject(boolean needClientAuth)", "class_method_signature": "AthenzJettyContainer.createSSLContextObject(boolean needClientAuth)", "testcase": false, "constructor": false}, {"identifier": "addHTTPConnector", "parameters": "(HttpConfiguration httpConfig, int httpPort, boolean proxyProtocol,\n            String listenHost, int idleTimeout)", "modifiers": "", "return": "void", "signature": "void addHTTPConnector(HttpConfiguration httpConfig, int httpPort, boolean proxyProtocol,\n            String listenHost, int idleTimeout)", "full_signature": " void addHTTPConnector(HttpConfiguration httpConfig, int httpPort, boolean proxyProtocol,\n            String listenHost, int idleTimeout)", "class_method_signature": "AthenzJettyContainer.addHTTPConnector(HttpConfiguration httpConfig, int httpPort, boolean proxyProtocol,\n            String listenHost, int idleTimeout)", "testcase": false, "constructor": false}, {"identifier": "addHTTPSConnector", "parameters": "(HttpConfiguration httpConfig, int httpsPort, boolean proxyProtocol,\n            String listenHost, int idleTimeout, boolean needClientAuth)", "modifiers": "", "return": "void", "signature": "void addHTTPSConnector(HttpConfiguration httpConfig, int httpsPort, boolean proxyProtocol,\n            String listenHost, int idleTimeout, boolean needClientAuth)", "full_signature": " void addHTTPSConnector(HttpConfiguration httpConfig, int httpsPort, boolean proxyProtocol,\n            String listenHost, int idleTimeout, boolean needClientAuth)", "class_method_signature": "AthenzJettyContainer.addHTTPSConnector(HttpConfiguration httpConfig, int httpsPort, boolean proxyProtocol,\n            String listenHost, int idleTimeout, boolean needClientAuth)", "testcase": false, "constructor": false}, {"identifier": "addHTTPConnectors", "parameters": "(HttpConfiguration httpConfig, int httpPort, int httpsPort,\n            int statusPort)", "modifiers": "public", "return": "void", "signature": "void addHTTPConnectors(HttpConfiguration httpConfig, int httpPort, int httpsPort,\n            int statusPort)", "full_signature": "public void addHTTPConnectors(HttpConfiguration httpConfig, int httpPort, int httpsPort,\n            int statusPort)", "class_method_signature": "AthenzJettyContainer.addHTTPConnectors(HttpConfiguration httpConfig, int httpPort, int httpsPort,\n            int statusPort)", "testcase": false, "constructor": false}, {"identifier": "setBanner", "parameters": "(String banner)", "modifiers": "public", "return": "void", "signature": "void setBanner(String banner)", "full_signature": "public void setBanner(String banner)", "class_method_signature": "AthenzJettyContainer.setBanner(String banner)", "testcase": false, "constructor": false}, {"identifier": "createServer", "parameters": "(int maxThreads)", "modifiers": "public", "return": "void", "signature": "void createServer(int maxThreads)", "full_signature": "public void createServer(int maxThreads)", "class_method_signature": "AthenzJettyContainer.createServer(int maxThreads)", "testcase": false, "constructor": false}, {"identifier": "createJettyContainer", "parameters": "()", "modifiers": "public static", "return": "AthenzJettyContainer", "signature": "AthenzJettyContainer createJettyContainer()", "full_signature": "public static AthenzJettyContainer createJettyContainer()", "class_method_signature": "AthenzJettyContainer.createJettyContainer()", "testcase": false, "constructor": false}, {"identifier": "run", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void run()", "full_signature": "public void run()", "class_method_signature": "AthenzJettyContainer.run()", "testcase": false, "constructor": false}, {"identifier": "stop", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void stop()", "full_signature": "public void stop()", "class_method_signature": "AthenzJettyContainer.stop()", "testcase": false, "constructor": false}, {"identifier": "main", "parameters": "(String [] args)", "modifiers": "public static", "return": "void", "signature": "void main(String [] args)", "full_signature": "public static void main(String [] args)", "class_method_signature": "AthenzJettyContainer.main(String [] args)", "testcase": false, "constructor": false}], "file": "containers/jetty/src/main/java/com/yahoo/athenz/container/AthenzJettyContainer.java"}, "focal_method": {"identifier": "createSSLContextObject", "parameters": "(boolean needClientAuth)", "modifiers": "", "return": "SslContextFactory.Server", "body": "SslContextFactory.Server createSSLContextObject(boolean needClientAuth) {\n        \n        final String keyStorePath = System.getProperty(AthenzConsts.ATHENZ_PROP_KEYSTORE_PATH);\n        final String keyStorePasswordAppName = System.getProperty(AthenzConsts.ATHENZ_PROP_KEYSTORE_PASSWORD_APPNAME);\n        final String keyStorePassword = System.getProperty(AthenzConsts.ATHENZ_PROP_KEYSTORE_PASSWORD);\n        final String keyStoreType = System.getProperty(AthenzConsts.ATHENZ_PROP_KEYSTORE_TYPE, \"PKCS12\");\n        final String keyManagerPassword = System.getProperty(AthenzConsts.ATHENZ_PROP_KEYMANAGER_PASSWORD);\n        final String keyManagerPasswordAppName = System.getProperty(AthenzConsts.ATHENZ_PROP_KEYMANAGER_PASSWORD_APPNAME);\n        final String trustStorePath = System.getProperty(AthenzConsts.ATHENZ_PROP_TRUSTSTORE_PATH);\n        final String trustStorePassword = System.getProperty(AthenzConsts.ATHENZ_PROP_TRUSTSTORE_PASSWORD);\n        final String trustStorePasswordAppName = System.getProperty(AthenzConsts.ATHENZ_PROP_TRUSTSTORE_PASSWORD_APPNAME);\n        final String trustStoreType = System.getProperty(AthenzConsts.ATHENZ_PROP_TRUSTSTORE_TYPE, \"PKCS12\");\n        final String includedCipherSuites = System.getProperty(AthenzConsts.ATHENZ_PROP_INCLUDED_CIPHER_SUITES);\n        final String excludedCipherSuites = System.getProperty(AthenzConsts.ATHENZ_PROP_EXCLUDED_CIPHER_SUITES);\n        final String excludedProtocols = System.getProperty(AthenzConsts.ATHENZ_PROP_EXCLUDED_PROTOCOLS,\n                ATHENZ_DEFAULT_EXCLUDED_PROTOCOLS);\n        boolean enableOCSP = Boolean.parseBoolean(System.getProperty(AthenzConsts.ATHENZ_PROP_ENABLE_OCSP, \"false\"));\n        boolean renegotiationAllowed = Boolean.parseBoolean(System.getProperty(AthenzConsts.ATHENZ_PROP_RENEGOTIATION_ALLOWED, \"true\"));\n\n        SslContextFactory.Server sslContextFactory = new SslContextFactory.Server();\n        sslContextFactory.setEndpointIdentificationAlgorithm(null);\n\n        if (keyStorePath != null) {\n            LOG.info(\"Using SSL KeyStore path: {}\", keyStorePath);\n            sslContextFactory.setKeyStorePath(keyStorePath);\n        }\n        if (keyStorePassword != null) {\n            //default implementation should just return the same\n            sslContextFactory.setKeyStorePassword(this.privateKeyStore.getApplicationSecret(keyStorePasswordAppName, keyStorePassword));\n        }\n        sslContextFactory.setKeyStoreType(keyStoreType);\n\n        if (keyManagerPassword != null) {\n            sslContextFactory.setKeyManagerPassword(this.privateKeyStore.getApplicationSecret(keyManagerPasswordAppName, keyManagerPassword));\n        }\n        if (trustStorePath != null) {\n            LOG.info(\"Using SSL TrustStore path: {}\", trustStorePath);\n            sslContextFactory.setTrustStorePath(trustStorePath);\n        }\n        if (trustStorePassword != null) {\n            sslContextFactory.setTrustStorePassword(this.privateKeyStore.getApplicationSecret(trustStorePasswordAppName, trustStorePassword));\n        }\n        sslContextFactory.setTrustStoreType(trustStoreType);\n\n        if (includedCipherSuites != null && !includedCipherSuites.isEmpty()) {\n            sslContextFactory.setIncludeCipherSuites(includedCipherSuites.split(\",\"));\n        }\n        \n        if (excludedCipherSuites != null && !excludedCipherSuites.isEmpty()) {\n            sslContextFactory.setExcludeCipherSuites(excludedCipherSuites.split(\",\"));\n        }\n        \n        if (!excludedProtocols.isEmpty()) {\n            sslContextFactory.setExcludeProtocols(excludedProtocols.split(\",\"));\n        }\n        \n        if (needClientAuth) {\n            sslContextFactory.setNeedClientAuth(true);\n        } else {\n            sslContextFactory.setWantClientAuth(true);\n        }\n\n        sslContextFactory.setEnableOCSP(enableOCSP);\n        sslContextFactory.setRenegotiationAllowed(renegotiationAllowed);\n\n        return sslContextFactory;\n    }", "signature": "SslContextFactory.Server createSSLContextObject(boolean needClientAuth)", "full_signature": " SslContextFactory.Server createSSLContextObject(boolean needClientAuth)", "class_method_signature": "AthenzJettyContainer.createSSLContextObject(boolean needClientAuth)", "testcase": false, "constructor": false, "invocations": ["getProperty", "getProperty", "getProperty", "getProperty", "getProperty", "getProperty", "getProperty", "getProperty", "getProperty", "getProperty", "getProperty", "getProperty", "getProperty", "parseBoolean", "getProperty", "parseBoolean", "getProperty", "setEndpointIdentificationAlgorithm", "info", "setKeyStorePath", "setKeyStorePassword", "getApplicationSecret", "setKeyStoreType", "setKeyManagerPassword", "getApplicationSecret", "info", "setTrustStorePath", "setTrustStorePassword", "getApplicationSecret", "setTrustStoreType", "isEmpty", "setIncludeCipherSuites", "split", "isEmpty", "setExcludeCipherSuites", "split", "isEmpty", "setExcludeProtocols", "split", "setNeedClientAuth", "setWantClientAuth", "setEnableOCSP", "setRenegotiationAllowed"]}, "repository": {"repo_id": 73948366, "url": "https://github.com/yahoo/athenz", "stars": 394, "created": "11/16/2016 6:23:08 PM +00:00", "updates": "2020-01-27T15:36:13+00:00", "fork": "False", "license": "licensed"}}