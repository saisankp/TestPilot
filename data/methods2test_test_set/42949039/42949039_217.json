{"test_class": {"identifier": "Hive13DdlGeneratorTest", "superclass": "extends AbstractServiceTest", "interfaces": "", "fields": [], "file": "herd-code/herd-service/src/test/java/org/finra/herd/service/helper/Hive13DdlGeneratorTest.java"}, "test_case": {"identifier": "testGenerateReplaceColumnsStatementErrorNotValidSchemaColumnDataType", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testGenerateReplaceColumnsStatementErrorNotValidSchemaColumnDataType()\n    {\n        BusinessObjectFormatDdlRequest businessObjectFormatDdlRequest = new BusinessObjectFormatDdlRequest();\n        businessObjectFormatDdlRequest.setTableName(TABLE_NAME);\n        BusinessObjectFormatEntity businessObjectFormatEntity = businessObjectFormatDaoTestHelper\n            .createBusinessObjectFormatEntity(NAMESPACE, BDEF_NAME, FORMAT_USAGE_CODE, FORMAT_FILE_TYPE_CODE, FORMAT_VERSION, FORMAT_DESCRIPTION,\n                FORMAT_DOCUMENT_SCHEMA, FORMAT_DOCUMENT_SCHEMA_URL, true, PARTITION_KEY);\n        {\n            SchemaColumnEntity schemaColumnEntity = new SchemaColumnEntity();\n            schemaColumnEntity.setPosition(0);\n            schemaColumnEntity.setName(\"col1\");\n            schemaColumnEntity.setType(\"fooobaar\");\n            schemaColumnEntity.setSize(\"255\");\n            schemaColumnEntity.setDescription(\"lorem ipsum\");\n            businessObjectFormatEntity.getSchemaColumns().add(schemaColumnEntity);\n        }\n        try\n        {\n            String actual = hive13DdlGenerator.generateReplaceColumnsStatement(businessObjectFormatDdlRequest, businessObjectFormatEntity);\n            Assert.fail(\"expected IllegalArgumentException, but no exception was thrown\");\n        }\n        catch (Exception e)\n        {\n            Assert.assertEquals(\"thrown exception type\", IllegalArgumentException.class, e.getClass());\n            Assert.assertEquals(\"thrown exception message\",\n                \"Column \\\"col1\\\" has an unsupported data type \\\"fooobaar\\\" in the schema for business object format {namespace: \\\"\" + NAMESPACE +\n                    \"\\\", businessObjectDefinitionName: \\\"\" + BDEF_NAME + \"\\\", businessObjectFormatUsage: \\\"\" + FORMAT_USAGE_CODE +\n                    \"\\\", businessObjectFormatFileType: \\\"\" + FORMAT_FILE_TYPE_CODE + \"\\\", businessObjectFormatVersion: \" + FORMAT_VERSION +\n                    \"}. Exception : \\\"Error: type expected at the position 0 of 'fooobaar' but 'fooobaar' is found.\\\"\", e.getMessage());\n        }\n    }", "signature": "void testGenerateReplaceColumnsStatementErrorNotValidSchemaColumnDataType()", "full_signature": "@Test public void testGenerateReplaceColumnsStatementErrorNotValidSchemaColumnDataType()", "class_method_signature": "Hive13DdlGeneratorTest.testGenerateReplaceColumnsStatementErrorNotValidSchemaColumnDataType()", "testcase": true, "constructor": false, "invocations": ["setTableName", "createBusinessObjectFormatEntity", "setPosition", "setName", "setType", "setSize", "setDescription", "add", "getSchemaColumns", "generateReplaceColumnsStatement", "fail", "assertEquals", "getClass", "assertEquals", "getMessage"]}, "focal_class": {"identifier": "Hive13DdlGenerator", "superclass": "extends DdlGenerator", "interfaces": "", "fields": [{"original_string": "public static final String NO_PARTITIONING_PARTITION_KEY = \"partition\";", "modifier": "public static final", "type": "String", "declarator": "NO_PARTITIONING_PARTITION_KEY = \"partition\"", "var_name": "NO_PARTITIONING_PARTITION_KEY"}, {"original_string": "public static final String NO_PARTITIONING_PARTITION_VALUE = \"none\";", "modifier": "public static final", "type": "String", "declarator": "NO_PARTITIONING_PARTITION_VALUE = \"none\"", "var_name": "NO_PARTITIONING_PARTITION_VALUE"}, {"original_string": "public static final String ORC_HIVE_FILE_FORMAT = \"ORC\";", "modifier": "public static final", "type": "String", "declarator": "ORC_HIVE_FILE_FORMAT = \"ORC\"", "var_name": "ORC_HIVE_FILE_FORMAT"}, {"original_string": "public static final String PARQUET_HIVE_FILE_FORMAT = \"PARQUET\";", "modifier": "public static final", "type": "String", "declarator": "PARQUET_HIVE_FILE_FORMAT = \"PARQUET\"", "var_name": "PARQUET_HIVE_FILE_FORMAT"}, {"original_string": "public static final String TEXT_HIVE_FILE_FORMAT = \"TEXTFILE\";", "modifier": "public static final", "type": "String", "declarator": "TEXT_HIVE_FILE_FORMAT = \"TEXTFILE\"", "var_name": "TEXT_HIVE_FILE_FORMAT"}, {"original_string": "public static final String JSON_HIVE_FILE_FORMAT = \"JSONFILE\";", "modifier": "public static final", "type": "String", "declarator": "JSON_HIVE_FILE_FORMAT = \"JSONFILE\"", "var_name": "JSON_HIVE_FILE_FORMAT"}, {"original_string": "public static final String REGEX_S3_EMPTY_PARTITION = \"_\\\\$folder\\\\$\";", "modifier": "public static final", "type": "String", "declarator": "REGEX_S3_EMPTY_PARTITION = \"_\\\\$folder\\\\$\"", "var_name": "REGEX_S3_EMPTY_PARTITION"}, {"original_string": "private static final List<String> HIVE_COMPLEX_DATA_TYPES =\n        Arrays.asList(Category.LIST.toString(), Category.MAP.toString(), Category.UNION.toString(), Category.STRUCT.toString());", "modifier": "private static final", "type": "List<String>", "declarator": "HIVE_COMPLEX_DATA_TYPES =\n        Arrays.asList(Category.LIST.toString(), Category.MAP.toString(), Category.UNION.toString(), Category.STRUCT.toString())", "var_name": "HIVE_COMPLEX_DATA_TYPES"}, {"original_string": "@Autowired\n    private BusinessObjectDataDdlPartitionsHelper businessObjectDataDdlPartitionsHelper;", "modifier": "@Autowired\n    private", "type": "BusinessObjectDataDdlPartitionsHelper", "declarator": "businessObjectDataDdlPartitionsHelper", "var_name": "businessObjectDataDdlPartitionsHelper"}, {"original_string": "@Autowired\n    private BusinessObjectDataHelper businessObjectDataHelper;", "modifier": "@Autowired\n    private", "type": "BusinessObjectDataHelper", "declarator": "businessObjectDataHelper", "var_name": "businessObjectDataHelper"}, {"original_string": "@Autowired\n    private BusinessObjectFormatHelper businessObjectFormatHelper;", "modifier": "@Autowired\n    private", "type": "BusinessObjectFormatHelper", "declarator": "businessObjectFormatHelper", "var_name": "businessObjectFormatHelper"}], "methods": [{"identifier": "escapeSingleQuotes", "parameters": "(String string)", "modifiers": "public", "return": "String", "signature": "String escapeSingleQuotes(String string)", "full_signature": "public String escapeSingleQuotes(String string)", "class_method_signature": "Hive13DdlGenerator.escapeSingleQuotes(String string)", "testcase": false, "constructor": false}, {"identifier": "generateCreateTableDdl", "parameters": "(BusinessObjectDataDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity,\n        CustomDdlEntity customDdlEntity, List<String> storageNames, List<StorageEntity> requestedStorageEntities,\n        Map<String, StorageEntity> cachedStorageEntities, Map<String, String> cachedS3BucketNames)", "modifiers": "@Override public", "return": "String", "signature": "String generateCreateTableDdl(BusinessObjectDataDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity,\n        CustomDdlEntity customDdlEntity, List<String> storageNames, List<StorageEntity> requestedStorageEntities,\n        Map<String, StorageEntity> cachedStorageEntities, Map<String, String> cachedS3BucketNames)", "full_signature": "@Override public String generateCreateTableDdl(BusinessObjectDataDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity,\n        CustomDdlEntity customDdlEntity, List<String> storageNames, List<StorageEntity> requestedStorageEntities,\n        Map<String, StorageEntity> cachedStorageEntities, Map<String, String> cachedS3BucketNames)", "class_method_signature": "Hive13DdlGenerator.generateCreateTableDdl(BusinessObjectDataDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity,\n        CustomDdlEntity customDdlEntity, List<String> storageNames, List<StorageEntity> requestedStorageEntities,\n        Map<String, StorageEntity> cachedStorageEntities, Map<String, String> cachedS3BucketNames)", "testcase": false, "constructor": false}, {"identifier": "generateCreateTableDdl", "parameters": "(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity,\n        CustomDdlEntity customDdlEntity)", "modifiers": "@Override public", "return": "String", "signature": "String generateCreateTableDdl(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity,\n        CustomDdlEntity customDdlEntity)", "full_signature": "@Override public String generateCreateTableDdl(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity,\n        CustomDdlEntity customDdlEntity)", "class_method_signature": "Hive13DdlGenerator.generateCreateTableDdl(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity,\n        CustomDdlEntity customDdlEntity)", "testcase": false, "constructor": false}, {"identifier": "generateReplaceColumnsStatement", "parameters": "(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity)", "modifiers": "@Override public", "return": "String", "signature": "String generateReplaceColumnsStatement(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity)", "full_signature": "@Override public String generateReplaceColumnsStatement(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity)", "class_method_signature": "Hive13DdlGenerator.generateReplaceColumnsStatement(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity)", "testcase": false, "constructor": false}, {"identifier": "getDdlCharacterValue", "parameters": "(String string)", "modifiers": "public", "return": "String", "signature": "String getDdlCharacterValue(String string)", "full_signature": "public String getDdlCharacterValue(String string)", "class_method_signature": "Hive13DdlGenerator.getDdlCharacterValue(String string)", "testcase": false, "constructor": false}, {"identifier": "getDdlCharacterValue", "parameters": "(String string, boolean escapeSingleBackslash)", "modifiers": "public", "return": "String", "signature": "String getDdlCharacterValue(String string, boolean escapeSingleBackslash)", "full_signature": "public String getDdlCharacterValue(String string, boolean escapeSingleBackslash)", "class_method_signature": "Hive13DdlGenerator.getDdlCharacterValue(String string, boolean escapeSingleBackslash)", "testcase": false, "constructor": false}, {"identifier": "getDdlOutputFormat", "parameters": "()", "modifiers": "@Override public", "return": "BusinessObjectDataDdlOutputFormatEnum", "signature": "BusinessObjectDataDdlOutputFormatEnum getDdlOutputFormat()", "full_signature": "@Override public BusinessObjectDataDdlOutputFormatEnum getDdlOutputFormat()", "class_method_signature": "Hive13DdlGenerator.getDdlOutputFormat()", "testcase": false, "constructor": false}, {"identifier": "getHivePartitions", "parameters": "(BusinessObjectDataKey businessObjectDataKey, List<SchemaColumn> autoDiscoverableSubPartitionColumns,\n        String s3KeyPrefix, Collection<String> storageFiles, String storageName)", "modifiers": "public", "return": "List<HivePartitionDto>", "signature": "List<HivePartitionDto> getHivePartitions(BusinessObjectDataKey businessObjectDataKey, List<SchemaColumn> autoDiscoverableSubPartitionColumns,\n        String s3KeyPrefix, Collection<String> storageFiles, String storageName)", "full_signature": "public List<HivePartitionDto> getHivePartitions(BusinessObjectDataKey businessObjectDataKey, List<SchemaColumn> autoDiscoverableSubPartitionColumns,\n        String s3KeyPrefix, Collection<String> storageFiles, String storageName)", "class_method_signature": "Hive13DdlGenerator.getHivePartitions(BusinessObjectDataKey businessObjectDataKey, List<SchemaColumn> autoDiscoverableSubPartitionColumns,\n        String s3KeyPrefix, Collection<String> storageFiles, String storageName)", "testcase": false, "constructor": false}, {"identifier": "getHivePathPattern", "parameters": "(List<SchemaColumn> partitionColumns)", "modifiers": "public", "return": "Pattern", "signature": "Pattern getHivePathPattern(List<SchemaColumn> partitionColumns)", "full_signature": "public Pattern getHivePathPattern(List<SchemaColumn> partitionColumns)", "class_method_signature": "Hive13DdlGenerator.getHivePathPattern(List<SchemaColumn> partitionColumns)", "testcase": false, "constructor": false}, {"identifier": "getHivePathRegex", "parameters": "(List<SchemaColumn> partitionColumns)", "modifiers": "public", "return": "String", "signature": "String getHivePathRegex(List<SchemaColumn> partitionColumns)", "full_signature": "public String getHivePathRegex(List<SchemaColumn> partitionColumns)", "class_method_signature": "Hive13DdlGenerator.getHivePathRegex(List<SchemaColumn> partitionColumns)", "testcase": false, "constructor": false}, {"identifier": "assertSchemaColumnsNotEmpty", "parameters": "(BusinessObjectFormat businessObjectFormat, BusinessObjectFormatEntity businessObjectFormatEntity)", "modifiers": "private", "return": "void", "signature": "void assertSchemaColumnsNotEmpty(BusinessObjectFormat businessObjectFormat, BusinessObjectFormatEntity businessObjectFormatEntity)", "full_signature": "private void assertSchemaColumnsNotEmpty(BusinessObjectFormat businessObjectFormat, BusinessObjectFormatEntity businessObjectFormatEntity)", "class_method_signature": "Hive13DdlGenerator.assertSchemaColumnsNotEmpty(BusinessObjectFormat businessObjectFormat, BusinessObjectFormatEntity businessObjectFormatEntity)", "testcase": false, "constructor": false}, {"identifier": "generateCreateTableDdlHelper", "parameters": "(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest)", "modifiers": "private", "return": "String", "signature": "String generateCreateTableDdlHelper(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest)", "full_signature": "private String generateCreateTableDdlHelper(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest)", "class_method_signature": "Hive13DdlGenerator.generateCreateTableDdlHelper(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest)", "testcase": false, "constructor": false}, {"identifier": "generateDdlColumns", "parameters": "(BusinessObjectFormatEntity businessObjectFormatEntity, BusinessObjectFormat businessObjectFormat)", "modifiers": "private", "return": "String", "signature": "String generateDdlColumns(BusinessObjectFormatEntity businessObjectFormatEntity, BusinessObjectFormat businessObjectFormat)", "full_signature": "private String generateDdlColumns(BusinessObjectFormatEntity businessObjectFormatEntity, BusinessObjectFormat businessObjectFormat)", "class_method_signature": "Hive13DdlGenerator.generateDdlColumns(BusinessObjectFormatEntity businessObjectFormatEntity, BusinessObjectFormat businessObjectFormat)", "testcase": false, "constructor": false}, {"identifier": "generateStandardBaseDdl", "parameters": "(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest, StringBuilder sb,\n        BusinessObjectFormat businessObjectFormat, String ifNotExistsOption)", "modifiers": "private", "return": "void", "signature": "void generateStandardBaseDdl(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest, StringBuilder sb,\n        BusinessObjectFormat businessObjectFormat, String ifNotExistsOption)", "full_signature": "private void generateStandardBaseDdl(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest, StringBuilder sb,\n        BusinessObjectFormat businessObjectFormat, String ifNotExistsOption)", "class_method_signature": "Hive13DdlGenerator.generateStandardBaseDdl(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest, StringBuilder sb,\n        BusinessObjectFormat businessObjectFormat, String ifNotExistsOption)", "testcase": false, "constructor": false}, {"identifier": "getHiveDataType", "parameters": "(SchemaColumn schemaColumn, BusinessObjectFormatEntity businessObjectFormatEntity)", "modifiers": "private", "return": "String", "signature": "String getHiveDataType(SchemaColumn schemaColumn, BusinessObjectFormatEntity businessObjectFormatEntity)", "full_signature": "private String getHiveDataType(SchemaColumn schemaColumn, BusinessObjectFormatEntity businessObjectFormatEntity)", "class_method_signature": "Hive13DdlGenerator.getHiveDataType(SchemaColumn schemaColumn, BusinessObjectFormatEntity businessObjectFormatEntity)", "testcase": false, "constructor": false}, {"identifier": "isHiveComplexDataType", "parameters": "(String inputString)", "modifiers": "private", "return": "boolean", "signature": "boolean isHiveComplexDataType(String inputString)", "full_signature": "private boolean isHiveComplexDataType(String inputString)", "class_method_signature": "Hive13DdlGenerator.isHiveComplexDataType(String inputString)", "testcase": false, "constructor": false}, {"identifier": "getHiveFileFormat", "parameters": "(BusinessObjectFormatEntity businessObjectFormatEntity)", "modifiers": "private", "return": "String", "signature": "String getHiveFileFormat(BusinessObjectFormatEntity businessObjectFormatEntity)", "full_signature": "private String getHiveFileFormat(BusinessObjectFormatEntity businessObjectFormatEntity)", "class_method_signature": "Hive13DdlGenerator.getHiveFileFormat(BusinessObjectFormatEntity businessObjectFormatEntity)", "testcase": false, "constructor": false}, {"identifier": "processPartitionFiltersForGenerateDdl", "parameters": "(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest, StringBuilder sb,\n        HashMap<String, String> replacements, BusinessObjectFormat businessObjectFormat, String ifNotExistsOption)", "modifiers": "private", "return": "void", "signature": "void processPartitionFiltersForGenerateDdl(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest, StringBuilder sb,\n        HashMap<String, String> replacements, BusinessObjectFormat businessObjectFormat, String ifNotExistsOption)", "full_signature": "private void processPartitionFiltersForGenerateDdl(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest, StringBuilder sb,\n        HashMap<String, String> replacements, BusinessObjectFormat businessObjectFormat, String ifNotExistsOption)", "class_method_signature": "Hive13DdlGenerator.processPartitionFiltersForGenerateDdl(BusinessObjectDataDdlPartitionsHelper.GenerateDdlRequestWrapper generateDdlRequest, StringBuilder sb,\n        HashMap<String, String> replacements, BusinessObjectFormat businessObjectFormat, String ifNotExistsOption)", "testcase": false, "constructor": false}], "file": "herd-code/herd-service/src/main/java/org/finra/herd/service/helper/Hive13DdlGenerator.java"}, "focal_method": {"identifier": "generateReplaceColumnsStatement", "parameters": "(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity)", "modifiers": "@Override public", "return": "String", "body": "@Override\n    public String generateReplaceColumnsStatement(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity)\n    {\n        BusinessObjectFormat businessObjectFormat = businessObjectFormatHelper.createBusinessObjectFormatFromEntity(businessObjectFormatEntity);\n\n        assertSchemaColumnsNotEmpty(businessObjectFormat, businessObjectFormatEntity);\n\n        StringBuilder builder = new StringBuilder(34);\n        builder.append(\"ALTER TABLE `\");\n        builder.append(request.getTableName());\n        builder.append(\"` REPLACE COLUMNS (\\n\");\n        builder.append(generateDdlColumns(businessObjectFormatEntity, businessObjectFormat));\n        return builder.toString().trim() + ';';\n    }", "signature": "String generateReplaceColumnsStatement(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity)", "full_signature": "@Override public String generateReplaceColumnsStatement(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity)", "class_method_signature": "Hive13DdlGenerator.generateReplaceColumnsStatement(BusinessObjectFormatDdlRequest request, BusinessObjectFormatEntity businessObjectFormatEntity)", "testcase": false, "constructor": false, "invocations": ["createBusinessObjectFormatFromEntity", "assertSchemaColumnsNotEmpty", "append", "append", "getTableName", "append", "append", "generateDdlColumns", "trim", "toString"]}, "repository": {"repo_id": 42949039, "url": "https://github.com/FINRAOS/herd", "language": "Java", "is_fork": false, "fork_count": 36, "stargazer_count": 120, "size": 205797, "license": "licensed"}}