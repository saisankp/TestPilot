{"test_class": {"identifier": "OSGIServiceLoaderTest", "superclass": "", "interfaces": "", "fields": [], "file": "code/core/src/test/java/org/apache/tamaya/core/internal/OSGIServiceLoaderTest.java"}, "test_case": {"identifier": "testBundleChanged", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testBundleChanged() throws Exception {\n        //Set up mocks\n        Set<Bundle> resultBundles;\n        MockBundleContext mockBundleContext = new MockBundleContext();\n        MockBundle startedBundle = new MockBundle();\n        startedBundle.setState(Bundle.ACTIVE);\n        startedBundle.setBundleId(1);\n        startedBundle.setBundleContext(mockBundleContext);\n        MockBundle stoppedBundle = new MockBundle();\n        stoppedBundle.setState(Bundle.INSTALLED);\n        stoppedBundle.setBundleId(2);\n        stoppedBundle.setBundleContext(mockBundleContext);\n        MockBundle flipBundle = new MockBundle();\n        flipBundle.setState(Bundle.INSTALLED);\n        flipBundle.setBundleId(3);\n        flipBundle.setBundleContext(mockBundleContext);\n        mockBundleContext.installBundle(startedBundle);\n        mockBundleContext.installBundle(stoppedBundle);\n        mockBundleContext.installBundle(flipBundle);\n\n        //Default case\n        mockBundleContext.setServiceCount(0);\n        OSGIServiceLoader instance = new OSGIServiceLoader(mockBundleContext);\n        resultBundles = instance.getResourceBundles();\n        assertThat(resultBundles).hasSize(1);\n        assertThat(mockBundleContext.getServiceCount()).isEqualTo(2);\n\n        //After start\n        mockBundleContext.setServiceCount(0);\n        BundleEvent startedEvent = new BundleEvent(BundleEvent.STARTED, flipBundle);\n        instance.bundleChanged(startedEvent);\n        resultBundles = instance.getResourceBundles();\n        assertThat(resultBundles).hasSize(2);\n        assertThat(mockBundleContext.getServiceCount()).isEqualTo(2);\n\n        //After stop\n        mockBundleContext.setServiceCount(0);\n        BundleEvent stoppedEvent = new BundleEvent(BundleEvent.STOPPED, flipBundle);\n        instance.bundleChanged(stoppedEvent);\n        resultBundles = instance.getResourceBundles();\n        assertThat(resultBundles).hasSize(1);\n        assertThat(mockBundleContext.getServiceCount()).isEqualTo(0);\n    }", "signature": "void testBundleChanged()", "full_signature": "@Test public void testBundleChanged()", "class_method_signature": "OSGIServiceLoaderTest.testBundleChanged()", "testcase": true, "constructor": false, "invocations": ["setState", "setBundleId", "setBundleContext", "setState", "setBundleId", "setBundleContext", "setState", "setBundleId", "setBundleContext", "installBundle", "installBundle", "installBundle", "setServiceCount", "getResourceBundles", "hasSize", "assertThat", "isEqualTo", "assertThat", "getServiceCount", "setServiceCount", "bundleChanged", "getResourceBundles", "hasSize", "assertThat", "isEqualTo", "assertThat", "getServiceCount", "setServiceCount", "bundleChanged", "getResourceBundles", "hasSize", "assertThat", "isEqualTo", "assertThat", "getServiceCount"]}, "focal_class": {"identifier": "OSGIServiceLoader", "superclass": "", "interfaces": "implements BundleListener", "fields": [{"original_string": "private static final Logger LOG = Logger.getLogger(OSGIServiceLoader.class.getName());", "modifier": "private static final", "type": "Logger", "declarator": "LOG = Logger.getLogger(OSGIServiceLoader.class.getName())", "var_name": "LOG"}, {"original_string": "private static final String META_INF_SERVICES = \"META-INF/services/\";", "modifier": "private static final", "type": "String", "declarator": "META_INF_SERVICES = \"META-INF/services/\"", "var_name": "META_INF_SERVICES"}, {"original_string": "private final BundleContext context;", "modifier": "private final", "type": "BundleContext", "declarator": "context", "var_name": "context"}, {"original_string": "private final Set<Bundle> resourceBundles = Collections.synchronizedSet(new HashSet<>());", "modifier": "private final", "type": "Set<Bundle>", "declarator": "resourceBundles = Collections.synchronizedSet(new HashSet<>())", "var_name": "resourceBundles"}], "methods": [{"identifier": "OSGIServiceLoader", "parameters": "(BundleContext context)", "modifiers": "public", "return": "", "signature": " OSGIServiceLoader(BundleContext context)", "full_signature": "public  OSGIServiceLoader(BundleContext context)", "class_method_signature": "OSGIServiceLoader.OSGIServiceLoader(BundleContext context)", "testcase": false, "constructor": true}, {"identifier": "getBundleContext", "parameters": "()", "modifiers": "public", "return": "BundleContext", "signature": "BundleContext getBundleContext()", "full_signature": "public BundleContext getBundleContext()", "class_method_signature": "OSGIServiceLoader.getBundleContext()", "testcase": false, "constructor": false}, {"identifier": "getResourceBundles", "parameters": "()", "modifiers": "public", "return": "Set<Bundle>", "signature": "Set<Bundle> getResourceBundles()", "full_signature": "public Set<Bundle> getResourceBundles()", "class_method_signature": "OSGIServiceLoader.getResourceBundles()", "testcase": false, "constructor": false}, {"identifier": "bundleChanged", "parameters": "(BundleEvent bundleEvent)", "modifiers": "@Override public", "return": "void", "signature": "void bundleChanged(BundleEvent bundleEvent)", "full_signature": "@Override public void bundleChanged(BundleEvent bundleEvent)", "class_method_signature": "OSGIServiceLoader.bundleChanged(BundleEvent bundleEvent)", "testcase": false, "constructor": false}, {"identifier": "checkAndUnloadBundle", "parameters": "(Bundle bundle)", "modifiers": "private", "return": "void", "signature": "void checkAndUnloadBundle(Bundle bundle)", "full_signature": "private void checkAndUnloadBundle(Bundle bundle)", "class_method_signature": "OSGIServiceLoader.checkAndUnloadBundle(Bundle bundle)", "testcase": false, "constructor": false}, {"identifier": "checkAndLoadBundle", "parameters": "(Bundle bundle)", "modifiers": "private", "return": "void", "signature": "void checkAndLoadBundle(Bundle bundle)", "full_signature": "private void checkAndLoadBundle(Bundle bundle)", "class_method_signature": "OSGIServiceLoader.checkAndLoadBundle(Bundle bundle)", "testcase": false, "constructor": false}, {"identifier": "processEntryPath", "parameters": "(Bundle bundle, String entryPath)", "modifiers": "private", "return": "void", "signature": "void processEntryPath(Bundle bundle, String entryPath)", "full_signature": "private void processEntryPath(Bundle bundle, String entryPath)", "class_method_signature": "OSGIServiceLoader.processEntryPath(Bundle bundle, String entryPath)", "testcase": false, "constructor": false}, {"identifier": "removeEntryPath", "parameters": "(Bundle bundle, String entryPath)", "modifiers": "private", "return": "void", "signature": "void removeEntryPath(Bundle bundle, String entryPath)", "full_signature": "private void removeEntryPath(Bundle bundle, String entryPath)", "class_method_signature": "OSGIServiceLoader.removeEntryPath(Bundle bundle, String entryPath)", "testcase": false, "constructor": false}, {"identifier": "getImplClassName", "parameters": "(String line)", "modifiers": "private", "return": "String", "signature": "String getImplClassName(String line)", "full_signature": "private String getImplClassName(String line)", "class_method_signature": "OSGIServiceLoader.getImplClassName(String line)", "testcase": false, "constructor": false}], "file": "code/core/src/main/java/org/apache/tamaya/core/internal/OSGIServiceLoader.java"}, "focal_method": {"identifier": "bundleChanged", "parameters": "(BundleEvent bundleEvent)", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void bundleChanged(BundleEvent bundleEvent) {\n        // Parse and createObject metadata when installed\n        Bundle bundle = bundleEvent.getBundle();\n        if (bundleEvent.getType() == BundleEvent.STARTED) {\n            checkAndLoadBundle(bundle);\n        } else if (bundleEvent.getType() == BundleEvent.STOPPED) {\n            checkAndUnloadBundle(bundle);\n        }\n    }", "signature": "void bundleChanged(BundleEvent bundleEvent)", "full_signature": "@Override public void bundleChanged(BundleEvent bundleEvent)", "class_method_signature": "OSGIServiceLoader.bundleChanged(BundleEvent bundleEvent)", "testcase": false, "constructor": false, "invocations": ["getBundle", "getType", "checkAndLoadBundle", "getType", "checkAndUnloadBundle"]}, "repository": {"repo_id": 26951044, "url": "https://github.com/apache/incubator-tamaya", "language": "Java", "is_fork": false, "fork_count": 33, "stargazer_count": 44, "size": 7630, "license": "licensed"}}