{"test_class": {"identifier": "DeviceRequestMessageListenerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@InjectMocks\n    private DeviceRequestMessageListener deviceRequestMessageListener;", "modifier": "@InjectMocks\n    private", "type": "DeviceRequestMessageListener", "declarator": "deviceRequestMessageListener", "var_name": "deviceRequestMessageListener"}, {"original_string": "@Mock\n    private MessageProcessorMap iec60870RequestMessageProcessorMap;", "modifier": "@Mock\n    private", "type": "MessageProcessorMap", "declarator": "iec60870RequestMessageProcessorMap", "var_name": "iec60870RequestMessageProcessorMap"}, {"original_string": "@Mock\n    private DeviceResponseMessageSender deviceResponseMessageSender;", "modifier": "@Mock\n    private", "type": "DeviceResponseMessageSender", "declarator": "deviceResponseMessageSender", "var_name": "deviceResponseMessageSender"}], "file": "osgp/protocol-adapter-iec60870/osgp-protocol-adapter-iec60870/src/test/java/org/opensmartgridplatform/adapter/protocol/iec60870/infra/messaging/DeviceRequestMessageListenerTest.java"}, "test_case": {"identifier": "shouldSendErrorMessageWhenMessageTypeIsNotSupported", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void shouldSendErrorMessageWhenMessageTypeIsNotSupported() throws JMSException {\n        // Arrange\n        final ObjectMessage message = new ObjectMessageBuilder().withDeviceIdentification(DEFAULT_DEVICE_IDENTIFICATION)\n                .withMessageType(DEFAULT_MESSAGE_TYPE)\n                .withObject(new GetHealthStatusRequestDto())\n                .build();\n\n        when(this.iec60870RequestMessageProcessorMap.getMessageProcessor(message)).thenThrow(JMSException.class);\n\n        // Act\n        this.deviceRequestMessageListener.onMessage(message);\n\n        // Assert\n        verify(this.deviceResponseMessageSender).send(argThat(new ErrorResponseMessageMatcher()));\n    }", "signature": "void shouldSendErrorMessageWhenMessageTypeIsNotSupported()", "full_signature": "@Test public void shouldSendErrorMessageWhenMessageTypeIsNotSupported()", "class_method_signature": "DeviceRequestMessageListenerTest.shouldSendErrorMessageWhenMessageTypeIsNotSupported()", "testcase": true, "constructor": false, "invocations": ["build", "withObject", "withMessageType", "withDeviceIdentification", "thenThrow", "when", "getMessageProcessor", "onMessage", "send", "verify", "argThat"]}, "focal_class": {"identifier": "DeviceRequestMessageListener", "superclass": "", "interfaces": "implements MessageListener", "fields": [{"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(DeviceRequestMessageListener.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(DeviceRequestMessageListener.class)", "var_name": "LOGGER"}, {"original_string": "@Autowired\n    @Qualifier(\"protocolIec60870InboundOsgpCoreRequestsMessageProcessorMap\")\n    private MessageProcessorMap messageProcessorMap;", "modifier": "@Autowired\n    @Qualifier(\"protocolIec60870InboundOsgpCoreRequestsMessageProcessorMap\")\n    private", "type": "MessageProcessorMap", "declarator": "messageProcessorMap", "var_name": "messageProcessorMap"}, {"original_string": "@Autowired\n    @Qualifier(\"protocolIec60870OutboundOsgpCoreResponsesMessageSender\")\n    private DeviceResponseMessageSender deviceResponseMessageSender;", "modifier": "@Autowired\n    @Qualifier(\"protocolIec60870OutboundOsgpCoreResponsesMessageSender\")\n    private", "type": "DeviceResponseMessageSender", "declarator": "deviceResponseMessageSender", "var_name": "deviceResponseMessageSender"}], "methods": [{"identifier": "onMessage", "parameters": "(final Message message)", "modifiers": "@Override public", "return": "void", "signature": "void onMessage(final Message message)", "full_signature": "@Override public void onMessage(final Message message)", "class_method_signature": "DeviceRequestMessageListener.onMessage(final Message message)", "testcase": false, "constructor": false}, {"identifier": "sendNotSupportedException", "parameters": "(final ObjectMessage objectMessage, final MessageMetadata messageMetadata)", "modifiers": "private", "return": "void", "signature": "void sendNotSupportedException(final ObjectMessage objectMessage, final MessageMetadata messageMetadata)", "full_signature": "private void sendNotSupportedException(final ObjectMessage objectMessage, final MessageMetadata messageMetadata)", "class_method_signature": "DeviceRequestMessageListener.sendNotSupportedException(final ObjectMessage objectMessage, final MessageMetadata messageMetadata)", "testcase": false, "constructor": false}], "file": "osgp/protocol-adapter-iec60870/osgp-protocol-adapter-iec60870/src/main/java/org/opensmartgridplatform/adapter/protocol/iec60870/infra/messaging/DeviceRequestMessageListener.java"}, "focal_method": {"identifier": "onMessage", "parameters": "(final Message message)", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void onMessage(final Message message) {\n\n        ObjectMessage objectMessage = null;\n        MessageMetadata messageMetadata = null;\n        try {\n            objectMessage = (ObjectMessage) message;\n            messageMetadata = MessageMetadata.fromMessage(objectMessage);\n        } catch (final Exception e) {\n            LOGGER.error(\"UNRECOVERABLE ERROR, unable to read JMS message instance, giving up.\", e);\n            return;\n        }\n\n        try {\n            LOGGER.info(\"Received message [correlationUid={}, messageType={}, messagePriority={}]\",\n                    messageMetadata.getCorrelationUid(), messageMetadata.getMessageType(),\n                    messageMetadata.getMessagePriority());\n\n            final MessageProcessor processor = this.messageProcessorMap.getMessageProcessor(objectMessage);\n\n            processor.processMessage(objectMessage);\n\n        } catch (final IllegalArgumentException | JMSException e) {\n            LOGGER.error(\"Unexpected exception for message [correlationUid={}]\", messageMetadata.getCorrelationUid(),\n                    e);\n            this.sendNotSupportedException(objectMessage, messageMetadata);\n        }\n    }", "signature": "void onMessage(final Message message)", "full_signature": "@Override public void onMessage(final Message message)", "class_method_signature": "DeviceRequestMessageListener.onMessage(final Message message)", "testcase": false, "constructor": false, "invocations": ["fromMessage", "error", "info", "getCorrelationUid", "getMessageType", "getMessagePriority", "getMessageProcessor", "processMessage", "error", "getCorrelationUid", "sendNotSupportedException"]}, "repository": {"repo_id": 154302277, "url": "https://github.com/OSGP/open-smart-grid-platform", "stars": 30, "created": "10/23/2018 9:41:12 AM +00:00", "updates": "2020-01-26T20:15:09+00:00", "fork": "False", "license": "licensed"}}