{"test_class": {"identifier": "MessageDispatcherTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Instant NOW = Instant.now();", "modifier": "private static final", "type": "Instant", "declarator": "NOW = Instant.now()", "var_name": "NOW"}, {"original_string": "@Mock\n    private SQSProxy sqsProxy;", "modifier": "@Mock\n    private", "type": "SQSProxy", "declarator": "sqsProxy", "var_name": "sqsProxy"}, {"original_string": "@Mock\n    private MessageProcessorProxy messageProcessorProxy;", "modifier": "@Mock\n    private", "type": "MessageProcessorProxy", "declarator": "messageProcessorProxy", "var_name": "messageProcessorProxy"}, {"original_string": "private MessageDispatcher dispatcher;", "modifier": "private", "type": "MessageDispatcher", "declarator": "dispatcher", "var_name": "dispatcher"}], "file": "aws-serverless-sqs-event-source-app/src/test/java/com/amazonaws/serverless/sqseventsource/MessageDispatcherTest.java"}, "test_case": {"identifier": "dispatch_errorResults", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void dispatch_errorResults() throws Exception {\n        Message m1 = mockMessage(\"1\");\n        Message m2 = mockMessage(\"2\");\n        List<Message> messages = Lists.newArrayList(m1, m2);\n        mockProcessorResults(\n                messageResult(\"1\", SQSMessageResult.Status.ERROR),\n                messageResult(\"2\", SQSMessageResult.Status.ERROR)\n        );\n\n        dispatcher.dispatch(messages);\n\n        verify(messageProcessorProxy).invoke(new SQSMessageProcessorRequest(messages));\n        verifyNoMoreInteractions(messageProcessorProxy, sqsProxy);\n    }", "signature": "void dispatch_errorResults()", "full_signature": "@Test public void dispatch_errorResults()", "class_method_signature": "MessageDispatcherTest.dispatch_errorResults()", "testcase": true, "constructor": false, "invocations": ["mockMessage", "mockMessage", "newArrayList", "mockProcessorResults", "messageResult", "messageResult", "dispatch", "invoke", "verify", "verifyNoMoreInteractions"]}, "focal_class": {"identifier": "MessageDispatcher", "superclass": "", "interfaces": "", "fields": [{"original_string": "static final int DEFAULT_RETRY_DELAY_IN_SECONDS = 10;", "modifier": "static final", "type": "int", "declarator": "DEFAULT_RETRY_DELAY_IN_SECONDS = 10", "var_name": "DEFAULT_RETRY_DELAY_IN_SECONDS"}, {"original_string": "@NonNull\n    private final SQSProxy sqsProxy;", "modifier": "@NonNull\n    private final", "type": "SQSProxy", "declarator": "sqsProxy", "var_name": "sqsProxy"}, {"original_string": "@NonNull\n    private final MessageProcessorProxy messageProcessorProxy;", "modifier": "@NonNull\n    private final", "type": "MessageProcessorProxy", "declarator": "messageProcessorProxy", "var_name": "messageProcessorProxy"}, {"original_string": "@NonNull\n    private final Clock clock;", "modifier": "@NonNull\n    private final", "type": "Clock", "declarator": "clock", "var_name": "clock"}, {"original_string": "private MessageProcessingStats stats = new MessageProcessingStats();", "modifier": "private", "type": "MessageProcessingStats", "declarator": "stats = new MessageProcessingStats()", "var_name": "stats"}], "methods": [{"identifier": "MessageDispatcher", "parameters": "(final SQSProxy sqsProxy, final MessageProcessorProxy messageProcessorProxy)", "modifiers": "public", "return": "", "signature": " MessageDispatcher(final SQSProxy sqsProxy, final MessageProcessorProxy messageProcessorProxy)", "full_signature": "public  MessageDispatcher(final SQSProxy sqsProxy, final MessageProcessorProxy messageProcessorProxy)", "class_method_signature": "MessageDispatcher.MessageDispatcher(final SQSProxy sqsProxy, final MessageProcessorProxy messageProcessorProxy)", "testcase": false, "constructor": true}, {"identifier": "dispatch", "parameters": "(final List<Message> messages)", "modifiers": "public", "return": "void", "signature": "void dispatch(final List<Message> messages)", "full_signature": "public void dispatch(final List<Message> messages)", "class_method_signature": "MessageDispatcher.dispatch(final List<Message> messages)", "testcase": false, "constructor": false}, {"identifier": "logFailedMessageResults", "parameters": "(List<SQSMessageResult> results)", "modifiers": "private", "return": "void", "signature": "void logFailedMessageResults(List<SQSMessageResult> results)", "full_signature": "private void logFailedMessageResults(List<SQSMessageResult> results)", "class_method_signature": "MessageDispatcher.logFailedMessageResults(List<SQSMessageResult> results)", "testcase": false, "constructor": false}, {"identifier": "deleteMessages", "parameters": "(final List<Message> messages, final List<SQSMessageResult> results)", "modifiers": "private", "return": "void", "signature": "void deleteMessages(final List<Message> messages, final List<SQSMessageResult> results)", "full_signature": "private void deleteMessages(final List<Message> messages, final List<SQSMessageResult> results)", "class_method_signature": "MessageDispatcher.deleteMessages(final List<Message> messages, final List<SQSMessageResult> results)", "testcase": false, "constructor": false}, {"identifier": "retryMessages", "parameters": "(final List<Message> messages, final List<SQSMessageResult> results)", "modifiers": "private", "return": "void", "signature": "void retryMessages(final List<Message> messages, final List<SQSMessageResult> results)", "full_signature": "private void retryMessages(final List<Message> messages, final List<SQSMessageResult> results)", "class_method_signature": "MessageDispatcher.retryMessages(final List<Message> messages, final List<SQSMessageResult> results)", "testcase": false, "constructor": false}, {"identifier": "getRetryDelay", "parameters": "(final SQSMessageResult result)", "modifiers": "private", "return": "int", "signature": "int getRetryDelay(final SQSMessageResult result)", "full_signature": "private int getRetryDelay(final SQSMessageResult result)", "class_method_signature": "MessageDispatcher.getRetryDelay(final SQSMessageResult result)", "testcase": false, "constructor": false}, {"identifier": "reset", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void reset()", "full_signature": "public void reset()", "class_method_signature": "MessageDispatcher.reset()", "testcase": false, "constructor": false}, {"identifier": "getEstimatedCapacity", "parameters": "(Instant cutoff)", "modifiers": "public", "return": "int", "signature": "int getEstimatedCapacity(Instant cutoff)", "full_signature": "public int getEstimatedCapacity(Instant cutoff)", "class_method_signature": "MessageDispatcher.getEstimatedCapacity(Instant cutoff)", "testcase": false, "constructor": false}], "file": "aws-serverless-sqs-event-source-app/src/main/java/com/amazonaws/serverless/sqseventsource/MessageDispatcher.java"}, "focal_method": {"identifier": "dispatch", "parameters": "(final List<Message> messages)", "modifiers": "public", "return": "void", "body": "public void dispatch(final List<Message> messages) {\n        Preconditions.checkArgument(!messages.isEmpty(), \"messages cannot be empty\");\n\n        Instant start = Instant.now(clock);\n        SQSMessageProcessorResponse response;\n        try {\n            response = messageProcessorProxy.invoke(new SQSMessageProcessorRequest(messages));\n            stats.record(Duration.between(start, Instant.now(clock)), messages.size());\n        } catch (MessageProcessorException e) {\n            log.warn(\"MessageProcessor encountered an error\", e);\n            return;\n        }\n\n        Map<SQSMessageResult.Status, List<SQSMessageResult>> resultsByStatus = response.getMessageResults()\n                .stream()\n                .collect(Collectors.groupingBy(SQSMessageResult::getStatus));\n\n        deleteMessages(messages, resultsByStatus.getOrDefault(SQSMessageResult.Status.SUCCESS, Collections.emptyList()));\n        retryMessages(messages, resultsByStatus.getOrDefault(SQSMessageResult.Status.RETRY, Collections.emptyList()));\n\n        // Just log failed messages, but do not do anything to the queue. Let user control this behavior through SQS queue's visibility timeout setting\n        logFailedMessageResults(resultsByStatus.getOrDefault(SQSMessageResult.Status.ERROR, Collections.emptyList()));\n    }", "signature": "void dispatch(final List<Message> messages)", "full_signature": "public void dispatch(final List<Message> messages)", "class_method_signature": "MessageDispatcher.dispatch(final List<Message> messages)", "testcase": false, "constructor": false, "invocations": ["checkArgument", "isEmpty", "now", "invoke", "record", "between", "now", "size", "warn", "collect", "stream", "getMessageResults", "groupingBy", "deleteMessages", "getOrDefault", "emptyList", "retryMessages", "getOrDefault", "emptyList", "logFailedMessageResults", "getOrDefault", "emptyList"]}, "repository": {"repo_id": 123649054, "url": "https://github.com/awslabs/aws-serverless-sqs-event-source", "language": "Java", "is_fork": false, "fork_count": 13, "stargazer_count": 33, "size": 79, "license": "licensed"}}