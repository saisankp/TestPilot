{"test_class": {"identifier": "DataBridgeWebClientTest", "superclass": "extends AbstractDataBridgeTest", "interfaces": "", "fields": [{"original_string": "private DataBridgeWebClient dataBridgeWebClient;", "modifier": "private", "type": "DataBridgeWebClient", "declarator": "dataBridgeWebClient", "var_name": "dataBridgeWebClient"}, {"original_string": "@Autowired\n    private HerdStringHelper herdStringHelper;", "modifier": "@Autowired\n    private", "type": "HerdStringHelper", "declarator": "herdStringHelper", "var_name": "herdStringHelper"}, {"original_string": "@Autowired\n    private HttpClientHelper httpClientHelper;", "modifier": "@Autowired\n    private", "type": "HttpClientHelper", "declarator": "httpClientHelper", "var_name": "httpClientHelper"}, {"original_string": "@Autowired\n    private HttpClientOperations httpClientOperations;", "modifier": "@Autowired\n    private", "type": "HttpClientOperations", "declarator": "httpClientOperations", "var_name": "httpClientOperations"}, {"original_string": "@Autowired\n    private XmlHelper xmlHelper;", "modifier": "@Autowired\n    private", "type": "XmlHelper", "declarator": "xmlHelper", "var_name": "xmlHelper"}], "file": "herd-code/herd-tools/herd-tools-common/src/test/java/org/finra/herd/tools/common/databridge/DataBridgeWebClientTest.java"}, "test_case": {"identifier": "testAddStorageFiles", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testAddStorageFiles() throws Exception\n    {\n        testAddStorageFiles(false);\n    }", "signature": "void testAddStorageFiles()", "full_signature": "@Test public void testAddStorageFiles()", "class_method_signature": "DataBridgeWebClientTest.testAddStorageFiles()", "testcase": true, "constructor": false, "invocations": ["testAddStorageFiles"]}, "focal_class": {"identifier": "DataBridgeWebClient", "superclass": "", "interfaces": "", "fields": [{"original_string": "protected static final String DEFAULT_ACCEPT = ContentType.APPLICATION_XML.withCharset(StandardCharsets.UTF_8).toString();", "modifier": "protected static final", "type": "String", "declarator": "DEFAULT_ACCEPT = ContentType.APPLICATION_XML.withCharset(StandardCharsets.UTF_8).toString()", "var_name": "DEFAULT_ACCEPT"}, {"original_string": "protected static final String DEFAULT_CONTENT_TYPE = ContentType.APPLICATION_XML.withCharset(StandardCharsets.UTF_8).toString();", "modifier": "protected static final", "type": "String", "declarator": "DEFAULT_CONTENT_TYPE = ContentType.APPLICATION_XML.withCharset(StandardCharsets.UTF_8).toString()", "var_name": "DEFAULT_CONTENT_TYPE"}, {"original_string": "protected static final String HERD_APP_REST_URI_PREFIX = \"/herd-app/rest\";", "modifier": "protected static final", "type": "String", "declarator": "HERD_APP_REST_URI_PREFIX = \"/herd-app/rest\"", "var_name": "HERD_APP_REST_URI_PREFIX"}, {"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(DataBridgeWebClient.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(DataBridgeWebClient.class)", "var_name": "LOGGER"}, {"original_string": "@Autowired\n    protected HerdStringHelper herdStringHelper;", "modifier": "@Autowired\n    protected", "type": "HerdStringHelper", "declarator": "herdStringHelper", "var_name": "herdStringHelper"}, {"original_string": "@Autowired\n    protected HttpClientHelper httpClientHelper;", "modifier": "@Autowired\n    protected", "type": "HttpClientHelper", "declarator": "httpClientHelper", "var_name": "httpClientHelper"}, {"original_string": "@Autowired\n    protected HttpClientOperations httpClientOperations;", "modifier": "@Autowired\n    protected", "type": "HttpClientOperations", "declarator": "httpClientOperations", "var_name": "httpClientOperations"}, {"original_string": "protected RegServerAccessParamsDto regServerAccessParamsDto;", "modifier": "protected", "type": "RegServerAccessParamsDto", "declarator": "regServerAccessParamsDto", "var_name": "regServerAccessParamsDto"}], "methods": [{"identifier": "addStorageFiles", "parameters": "(BusinessObjectDataKey businessObjectDataKey, UploaderInputManifestDto manifest,\n        S3FileTransferRequestParamsDto s3FileTransferRequestParamsDto, String storageName)", "modifiers": "@SuppressFBWarnings(value = \"VA_FORMAT_STRING_USES_NEWLINE\", justification = \"We will use the standard carriage return character.\") public", "return": "BusinessObjectDataStorageFilesCreateResponse", "signature": "BusinessObjectDataStorageFilesCreateResponse addStorageFiles(BusinessObjectDataKey businessObjectDataKey, UploaderInputManifestDto manifest,\n        S3FileTransferRequestParamsDto s3FileTransferRequestParamsDto, String storageName)", "full_signature": "@SuppressFBWarnings(value = \"VA_FORMAT_STRING_USES_NEWLINE\", justification = \"We will use the standard carriage return character.\") public BusinessObjectDataStorageFilesCreateResponse addStorageFiles(BusinessObjectDataKey businessObjectDataKey, UploaderInputManifestDto manifest,\n        S3FileTransferRequestParamsDto s3FileTransferRequestParamsDto, String storageName)", "class_method_signature": "DataBridgeWebClient.addStorageFiles(BusinessObjectDataKey businessObjectDataKey, UploaderInputManifestDto manifest,\n        S3FileTransferRequestParamsDto s3FileTransferRequestParamsDto, String storageName)", "testcase": false, "constructor": false}, {"identifier": "getRegServerAccessParamsDto", "parameters": "()", "modifiers": "public", "return": "RegServerAccessParamsDto", "signature": "RegServerAccessParamsDto getRegServerAccessParamsDto()", "full_signature": "public RegServerAccessParamsDto getRegServerAccessParamsDto()", "class_method_signature": "DataBridgeWebClient.getRegServerAccessParamsDto()", "testcase": false, "constructor": false}, {"identifier": "setRegServerAccessParamsDto", "parameters": "(RegServerAccessParamsDto regServerAccessParamsDto)", "modifiers": "public", "return": "void", "signature": "void setRegServerAccessParamsDto(RegServerAccessParamsDto regServerAccessParamsDto)", "full_signature": "public void setRegServerAccessParamsDto(RegServerAccessParamsDto regServerAccessParamsDto)", "class_method_signature": "DataBridgeWebClient.setRegServerAccessParamsDto(RegServerAccessParamsDto regServerAccessParamsDto)", "testcase": false, "constructor": false}, {"identifier": "getStorage", "parameters": "(String storageName)", "modifiers": "public", "return": "Storage", "signature": "Storage getStorage(String storageName)", "full_signature": "public Storage getStorage(String storageName)", "class_method_signature": "DataBridgeWebClient.getStorage(String storageName)", "testcase": false, "constructor": false}, {"identifier": "preRegisterBusinessObjectData", "parameters": "(UploaderInputManifestDto manifest, String storageName, Boolean createNewVersion)", "modifiers": "@SuppressFBWarnings(value = \"VA_FORMAT_STRING_USES_NEWLINE\", justification = \"We will use the standard carriage return character.\") public", "return": "BusinessObjectData", "signature": "BusinessObjectData preRegisterBusinessObjectData(UploaderInputManifestDto manifest, String storageName, Boolean createNewVersion)", "full_signature": "@SuppressFBWarnings(value = \"VA_FORMAT_STRING_USES_NEWLINE\", justification = \"We will use the standard carriage return character.\") public BusinessObjectData preRegisterBusinessObjectData(UploaderInputManifestDto manifest, String storageName, Boolean createNewVersion)", "class_method_signature": "DataBridgeWebClient.preRegisterBusinessObjectData(UploaderInputManifestDto manifest, String storageName, Boolean createNewVersion)", "testcase": false, "constructor": false}, {"identifier": "updateBusinessObjectDataStatus", "parameters": "(BusinessObjectDataKey businessObjectDataKey, String businessObjectDataStatus)", "modifiers": "public", "return": "BusinessObjectDataStatusUpdateResponse", "signature": "BusinessObjectDataStatusUpdateResponse updateBusinessObjectDataStatus(BusinessObjectDataKey businessObjectDataKey, String businessObjectDataStatus)", "full_signature": "public BusinessObjectDataStatusUpdateResponse updateBusinessObjectDataStatus(BusinessObjectDataKey businessObjectDataKey, String businessObjectDataStatus)", "class_method_signature": "DataBridgeWebClient.updateBusinessObjectDataStatus(BusinessObjectDataKey businessObjectDataKey, String businessObjectDataStatus)", "testcase": false, "constructor": false}, {"identifier": "getAuthorizationHeader", "parameters": "()", "modifiers": "protected", "return": "BasicHeader", "signature": "BasicHeader getAuthorizationHeader()", "full_signature": "protected BasicHeader getAuthorizationHeader()", "class_method_signature": "DataBridgeWebClient.getAuthorizationHeader()", "testcase": false, "constructor": false}, {"identifier": "getBusinessObjectData", "parameters": "(CloseableHttpResponse httpResponse, String actionDescription)", "modifiers": "protected", "return": "BusinessObjectData", "signature": "BusinessObjectData getBusinessObjectData(CloseableHttpResponse httpResponse, String actionDescription)", "full_signature": "protected BusinessObjectData getBusinessObjectData(CloseableHttpResponse httpResponse, String actionDescription)", "class_method_signature": "DataBridgeWebClient.getBusinessObjectData(CloseableHttpResponse httpResponse, String actionDescription)", "testcase": false, "constructor": false}, {"identifier": "getBusinessObjectDataStorageFilesCreateResponse", "parameters": "(CloseableHttpResponse httpResponse)", "modifiers": "protected", "return": "BusinessObjectDataStorageFilesCreateResponse", "signature": "BusinessObjectDataStorageFilesCreateResponse getBusinessObjectDataStorageFilesCreateResponse(CloseableHttpResponse httpResponse)", "full_signature": "protected BusinessObjectDataStorageFilesCreateResponse getBusinessObjectDataStorageFilesCreateResponse(CloseableHttpResponse httpResponse)", "class_method_signature": "DataBridgeWebClient.getBusinessObjectDataStorageFilesCreateResponse(CloseableHttpResponse httpResponse)", "testcase": false, "constructor": false}, {"identifier": "getS3KeyPrefix", "parameters": "(DataBridgeBaseManifestDto manifest, Integer businessObjectDataVersion, Boolean createNewVersion)", "modifiers": "protected", "return": "S3KeyPrefixInformation", "signature": "S3KeyPrefixInformation getS3KeyPrefix(DataBridgeBaseManifestDto manifest, Integer businessObjectDataVersion, Boolean createNewVersion)", "full_signature": "protected S3KeyPrefixInformation getS3KeyPrefix(DataBridgeBaseManifestDto manifest, Integer businessObjectDataVersion, Boolean createNewVersion)", "class_method_signature": "DataBridgeWebClient.getS3KeyPrefix(DataBridgeBaseManifestDto manifest, Integer businessObjectDataVersion, Boolean createNewVersion)", "testcase": false, "constructor": false}, {"identifier": "getUriScheme", "parameters": "()", "modifiers": "protected", "return": "String", "signature": "String getUriScheme()", "full_signature": "protected String getUriScheme()", "class_method_signature": "DataBridgeWebClient.getUriScheme()", "testcase": false, "constructor": false}, {"identifier": "processXmlHttpResponse", "parameters": "(CloseableHttpResponse response, String actionDescription, Class<?>... responseClass)", "modifiers": "protected", "return": "Object", "signature": "Object processXmlHttpResponse(CloseableHttpResponse response, String actionDescription, Class<?>... responseClass)", "full_signature": "protected Object processXmlHttpResponse(CloseableHttpResponse response, String actionDescription, Class<?>... responseClass)", "class_method_signature": "DataBridgeWebClient.processXmlHttpResponse(CloseableHttpResponse response, String actionDescription, Class<?>... responseClass)", "testcase": false, "constructor": false}, {"identifier": "getBusinessObjectDataStatusUpdateResponse", "parameters": "(CloseableHttpResponse response)", "modifiers": "private", "return": "BusinessObjectDataStatusUpdateResponse", "signature": "BusinessObjectDataStatusUpdateResponse getBusinessObjectDataStatusUpdateResponse(CloseableHttpResponse response)", "full_signature": "private BusinessObjectDataStatusUpdateResponse getBusinessObjectDataStatusUpdateResponse(CloseableHttpResponse response)", "class_method_signature": "DataBridgeWebClient.getBusinessObjectDataStatusUpdateResponse(CloseableHttpResponse response)", "testcase": false, "constructor": false}, {"identifier": "getS3KeyPrefixInformation", "parameters": "(CloseableHttpResponse httpResponse)", "modifiers": "private", "return": "S3KeyPrefixInformation", "signature": "S3KeyPrefixInformation getS3KeyPrefixInformation(CloseableHttpResponse httpResponse)", "full_signature": "private S3KeyPrefixInformation getS3KeyPrefixInformation(CloseableHttpResponse httpResponse)", "class_method_signature": "DataBridgeWebClient.getS3KeyPrefixInformation(CloseableHttpResponse httpResponse)", "testcase": false, "constructor": false}, {"identifier": "getStorage", "parameters": "(CloseableHttpResponse httpResponse)", "modifiers": "private", "return": "Storage", "signature": "Storage getStorage(CloseableHttpResponse httpResponse)", "full_signature": "private Storage getStorage(CloseableHttpResponse httpResponse)", "class_method_signature": "DataBridgeWebClient.getStorage(CloseableHttpResponse httpResponse)", "testcase": false, "constructor": false}], "file": "herd-code/herd-tools/herd-tools-common/src/main/java/org/finra/herd/tools/common/databridge/DataBridgeWebClient.java"}, "focal_method": {"identifier": "addStorageFiles", "parameters": "(BusinessObjectDataKey businessObjectDataKey, UploaderInputManifestDto manifest,\n        S3FileTransferRequestParamsDto s3FileTransferRequestParamsDto, String storageName)", "modifiers": "@SuppressFBWarnings(value = \"VA_FORMAT_STRING_USES_NEWLINE\", justification = \"We will use the standard carriage return character.\") public", "return": "BusinessObjectDataStorageFilesCreateResponse", "body": "@SuppressFBWarnings(value = \"VA_FORMAT_STRING_USES_NEWLINE\", justification = \"We will use the standard carriage return character.\")\n    public BusinessObjectDataStorageFilesCreateResponse addStorageFiles(BusinessObjectDataKey businessObjectDataKey, UploaderInputManifestDto manifest,\n        S3FileTransferRequestParamsDto s3FileTransferRequestParamsDto, String storageName)\n        throws IOException, JAXBException, URISyntaxException, NoSuchAlgorithmException, KeyStoreException, KeyManagementException\n    {\n        LOGGER.info(\"Adding storage files to the business object data ...\");\n\n        BusinessObjectDataStorageFilesCreateRequest request = new BusinessObjectDataStorageFilesCreateRequest();\n        request.setNamespace(businessObjectDataKey.getNamespace());\n        request.setBusinessObjectDefinitionName(businessObjectDataKey.getBusinessObjectDefinitionName());\n        request.setBusinessObjectFormatUsage(businessObjectDataKey.getBusinessObjectFormatUsage());\n        request.setBusinessObjectFormatFileType(businessObjectDataKey.getBusinessObjectFormatFileType());\n        request.setBusinessObjectFormatVersion(businessObjectDataKey.getBusinessObjectFormatVersion());\n        request.setPartitionValue(businessObjectDataKey.getPartitionValue());\n        request.setSubPartitionValues(businessObjectDataKey.getSubPartitionValues());\n        request.setBusinessObjectDataVersion(businessObjectDataKey.getBusinessObjectDataVersion());\n        request.setStorageName(storageName);\n\n        List<StorageFile> storageFiles = new ArrayList<>();\n        request.setStorageFiles(storageFiles);\n\n        String localPath = s3FileTransferRequestParamsDto.getLocalPath();\n        String s3KeyPrefix = s3FileTransferRequestParamsDto.getS3KeyPrefix();\n        List<ManifestFile> localFiles = manifest.getManifestFiles();\n\n        for (ManifestFile manifestFile : localFiles)\n        {\n            StorageFile storageFile = new StorageFile();\n            storageFiles.add(storageFile);\n            // Since the S3 key prefix represents a directory it is expected to contain a trailing '/' character.\n            storageFile.setFilePath((s3KeyPrefix + manifestFile.getFileName()).replaceAll(\"\\\\\\\\\", \"/\"));\n            storageFile.setFileSizeBytes(Paths.get(localPath, manifestFile.getFileName()).toFile().length());\n            storageFile.setRowCount(manifestFile.getRowCount());\n        }\n\n        // Create a JAXB context and marshaller\n        JAXBContext requestContext = JAXBContext.newInstance(BusinessObjectDataStorageFilesCreateRequest.class);\n        Marshaller requestMarshaller = requestContext.createMarshaller();\n        requestMarshaller.setProperty(Marshaller.JAXB_ENCODING, StandardCharsets.UTF_8.name());\n        requestMarshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);\n\n        StringWriter sw = new StringWriter();\n        requestMarshaller.marshal(request, sw);\n\n        BusinessObjectDataStorageFilesCreateResponse businessObjectDataStorageFilesCreateResponse;\n        try (CloseableHttpClient client = httpClientHelper\n            .createHttpClient(regServerAccessParamsDto.isTrustSelfSignedCertificate(), regServerAccessParamsDto.isDisableHostnameVerification()))\n        {\n            URI uri = new URIBuilder().setScheme(getUriScheme()).setHost(regServerAccessParamsDto.getRegServerHost())\n                .setPort(regServerAccessParamsDto.getRegServerPort()).setPath(HERD_APP_REST_URI_PREFIX + \"/businessObjectDataStorageFiles\").build();\n            HttpPost post = new HttpPost(uri);\n\n            post.addHeader(\"Content-Type\", DEFAULT_CONTENT_TYPE);\n            post.addHeader(\"Accepts\", DEFAULT_ACCEPT);\n\n            // If SSL is enabled, set the client authentication header.\n            if (regServerAccessParamsDto.isUseSsl())\n            {\n                post.addHeader(getAuthorizationHeader());\n            }\n\n            post.setEntity(new StringEntity(sw.toString()));\n\n            LOGGER.info(String.format(\"    HTTP POST URI: %s\", post.getURI().toString()));\n            LOGGER.info(String.format(\"    HTTP POST Entity Content:%n%s\", sw.toString()));\n\n            // getBusinessObjectDataStorageFilesCreateResponse() might return a null. That happens when the web client gets status code 200 back from\n            // the service (add storage files is a success), but it fails to retrieve or deserialize the actual HTTP response.\n            // Please note that processXmlHttpResponse() is responsible for logging the exception info as a warning.\n            businessObjectDataStorageFilesCreateResponse = getBusinessObjectDataStorageFilesCreateResponse(httpClientOperations.execute(client, post));\n        }\n\n        LOGGER.info(\"Successfully added storage files to the registered business object data.\");\n\n        return businessObjectDataStorageFilesCreateResponse;\n    }", "signature": "BusinessObjectDataStorageFilesCreateResponse addStorageFiles(BusinessObjectDataKey businessObjectDataKey, UploaderInputManifestDto manifest,\n        S3FileTransferRequestParamsDto s3FileTransferRequestParamsDto, String storageName)", "full_signature": "@SuppressFBWarnings(value = \"VA_FORMAT_STRING_USES_NEWLINE\", justification = \"We will use the standard carriage return character.\") public BusinessObjectDataStorageFilesCreateResponse addStorageFiles(BusinessObjectDataKey businessObjectDataKey, UploaderInputManifestDto manifest,\n        S3FileTransferRequestParamsDto s3FileTransferRequestParamsDto, String storageName)", "class_method_signature": "DataBridgeWebClient.addStorageFiles(BusinessObjectDataKey businessObjectDataKey, UploaderInputManifestDto manifest,\n        S3FileTransferRequestParamsDto s3FileTransferRequestParamsDto, String storageName)", "testcase": false, "constructor": false, "invocations": ["info", "setNamespace", "getNamespace", "setBusinessObjectDefinitionName", "getBusinessObjectDefinitionName", "setBusinessObjectFormatUsage", "getBusinessObjectFormatUsage", "setBusinessObjectFormatFileType", "getBusinessObjectFormatFileType", "setBusinessObjectFormatVersion", "getBusinessObjectFormatVersion", "setPartitionValue", "getPartitionValue", "setSubPartitionValues", "getSubPartitionValues", "setBusinessObjectDataVersion", "getBusinessObjectDataVersion", "setStorageName", "setStorageFiles", "getLocalPath", "getS3KeyPrefix", "getManifestFiles", "add", "setFilePath", "replaceAll", "getFileName", "setFileSizeBytes", "length", "toFile", "get", "getFileName", "setRowCount", "getRowCount", "newInstance", "createMarshaller", "setProperty", "name", "setProperty", "marshal", "createHttpClient", "isTrustSelfSignedCertificate", "isDisableHostnameVerification", "build", "setPath", "setPort", "setHost", "setScheme", "getUriScheme", "getRegServerHost", "getRegServerPort", "addHeader", "addHeader", "isUseSsl", "addHeader", "getAuthorizationHeader", "setEntity", "toString", "info", "format", "toString", "getURI", "info", "format", "toString", "getBusinessObjectDataStorageFilesCreateResponse", "execute", "info"]}, "repository": {"repo_id": 42949039, "url": "https://github.com/FINRAOS/herd", "language": "Java", "is_fork": false, "fork_count": 36, "stargazer_count": 120, "size": 205797, "license": "licensed"}}