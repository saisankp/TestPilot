{"test_class": {"identifier": "RequestDispatcherTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Rule public ExpectedException thrown = ExpectedException.none();", "modifier": "@Rule public", "type": "ExpectedException", "declarator": "thrown = ExpectedException.none()", "var_name": "thrown"}, {"original_string": "private ResourceBinder     resources;", "modifier": "private", "type": "ResourceBinder", "declarator": "resources", "var_name": "resources"}, {"original_string": "private ContainerRequest   request;", "modifier": "private", "type": "ContainerRequest", "declarator": "request", "var_name": "request"}, {"original_string": "private ContainerResponse  response;", "modifier": "private", "type": "ContainerResponse", "declarator": "response", "var_name": "response"}, {"original_string": "private ApplicationContext applicationContext;", "modifier": "private", "type": "ApplicationContext", "declarator": "applicationContext", "var_name": "applicationContext"}, {"original_string": "private MethodInvoker      methodInvoker;", "modifier": "private", "type": "MethodInvoker", "declarator": "methodInvoker", "var_name": "methodInvoker"}, {"original_string": "private List<String>       pathParameterValues;", "modifier": "private", "type": "List<String>", "declarator": "pathParameterValues", "var_name": "pathParameterValues"}, {"original_string": "private RequestDispatcher requestDispatcher;", "modifier": "private", "type": "RequestDispatcher", "declarator": "requestDispatcher", "var_name": "requestDispatcher"}], "file": "everrest-core/src/test/java/org/everrest/core/impl/RequestDispatcherTest.java"}, "test_case": {"identifier": "returnsResponseWithStatus_NOT_ACCEPTABLE_WhenSubResourceMethodDoesNotProduceContentAcceptableByCaller", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void returnsResponseWithStatus_NOT_ACCEPTABLE_WhenSubResourceMethodDoesNotProduceContentAcceptableByCaller() throws Exception {\n        when(applicationContext.getPathSegments(false)).thenReturn(createPathSegments(\"a\", \"b\", \"c\", \"d;x=y\"));\n        when(request.getAcceptMediaTypeList()).thenReturn(newArrayList(new AcceptMediaType(TEXT_PLAIN_TYPE)));\n\n        Resource resource = new Resource();\n        SubResourceMethodDescriptor subResourceMethod = mockSubResourceMethod(Resource.class.getMethod(\"echo\", String.class), \"c/d\", \"POST\",\n                                                                              newArrayList(WILDCARD_TYPE), newArrayList(TEXT_XML_TYPE, APPLICATION_XML_TYPE));\n        ObjectFactory resourceFactory = mockResourceFactory(resource, newArrayList(), newArrayList(subResourceMethod), newArrayList());\n\n        matchRequestPath(\"c/d\");\n        when(resources.getMatchedResource(eq(\"/a/b/c/d\"), anyList())).thenReturn(resourceFactory);\n\n        requestDispatcher.dispatch(request, response);\n\n        ArgumentCaptor<Response> argumentCaptor = ArgumentCaptor.forClass(Response.class);\n        verify(response, atLeastOnce()).setResponse(argumentCaptor.capture());\n        assertEquals(NOT_ACCEPTABLE, argumentCaptor.getValue().getStatusInfo());\n    }", "signature": "void returnsResponseWithStatus_NOT_ACCEPTABLE_WhenSubResourceMethodDoesNotProduceContentAcceptableByCaller()", "full_signature": "@Test public void returnsResponseWithStatus_NOT_ACCEPTABLE_WhenSubResourceMethodDoesNotProduceContentAcceptableByCaller()", "class_method_signature": "RequestDispatcherTest.returnsResponseWithStatus_NOT_ACCEPTABLE_WhenSubResourceMethodDoesNotProduceContentAcceptableByCaller()", "testcase": true, "constructor": false, "invocations": ["thenReturn", "when", "getPathSegments", "createPathSegments", "thenReturn", "when", "getAcceptMediaTypeList", "newArrayList", "mockSubResourceMethod", "getMethod", "newArrayList", "newArrayList", "mockResourceFactory", "newArrayList", "newArrayList", "newArrayList", "matchRequestPath", "thenReturn", "when", "getMatchedResource", "eq", "anyList", "dispatch", "forClass", "setResponse", "verify", "atLeastOnce", "capture", "assertEquals", "getStatusInfo", "getValue"]}, "focal_class": {"identifier": "RequestDispatcher", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger LOG = LoggerFactory.getLogger(RequestDispatcher.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOG = LoggerFactory.getLogger(RequestDispatcher.class)", "var_name": "LOG"}, {"original_string": "private final ResourceBinder resourceBinder;", "modifier": "private final", "type": "ResourceBinder", "declarator": "resourceBinder", "var_name": "resourceBinder"}, {"original_string": "private final LoadingCache<Class<?>, ResourceDescriptor> locatorDescriptorCache;", "modifier": "private final", "type": "LoadingCache<Class<?>, ResourceDescriptor>", "declarator": "locatorDescriptorCache", "var_name": "locatorDescriptorCache"}], "methods": [{"identifier": "RequestDispatcher", "parameters": "(ResourceBinder resourceBinder)", "modifiers": "public", "return": "", "signature": " RequestDispatcher(ResourceBinder resourceBinder)", "full_signature": "public  RequestDispatcher(ResourceBinder resourceBinder)", "class_method_signature": "RequestDispatcher.RequestDispatcher(ResourceBinder resourceBinder)", "testcase": false, "constructor": true}, {"identifier": "dispatch", "parameters": "(GenericContainerRequest request, GenericContainerResponse response)", "modifiers": "public", "return": "void", "signature": "void dispatch(GenericContainerRequest request, GenericContainerResponse response)", "full_signature": "public void dispatch(GenericContainerRequest request, GenericContainerResponse response)", "class_method_signature": "RequestDispatcher.dispatch(GenericContainerRequest request, GenericContainerResponse response)", "testcase": false, "constructor": false}, {"identifier": "getResources", "parameters": "()", "modifiers": "public", "return": "ResourceBinder", "signature": "ResourceBinder getResources()", "full_signature": "public ResourceBinder getResources()", "class_method_signature": "RequestDispatcher.getResources()", "testcase": false, "constructor": false}, {"identifier": "getRequestPathWithoutMatrixParameters", "parameters": "(ApplicationContext context)", "modifiers": "private", "return": "String", "signature": "String getRequestPathWithoutMatrixParameters(ApplicationContext context)", "full_signature": "private String getRequestPathWithoutMatrixParameters(ApplicationContext context)", "class_method_signature": "RequestDispatcher.getRequestPathWithoutMatrixParameters(ApplicationContext context)", "testcase": false, "constructor": false}, {"identifier": "getPathTail", "parameters": "(List<String> parameterValues)", "modifiers": "private", "return": "String", "signature": "String getPathTail(List<String> parameterValues)", "full_signature": "private String getPathTail(List<String> parameterValues)", "class_method_signature": "RequestDispatcher.getPathTail(List<String> parameterValues)", "testcase": false, "constructor": false}, {"identifier": "dispatch", "parameters": "(GenericContainerRequest request,\n                          GenericContainerResponse response,\n                          ApplicationContext context,\n                          ResourceDescriptor resourceDescriptor,\n                          Object resource,\n                          String requestPath)", "modifiers": "private", "return": "void", "signature": "void dispatch(GenericContainerRequest request,\n                          GenericContainerResponse response,\n                          ApplicationContext context,\n                          ResourceDescriptor resourceDescriptor,\n                          Object resource,\n                          String requestPath)", "full_signature": "private void dispatch(GenericContainerRequest request,\n                          GenericContainerResponse response,\n                          ApplicationContext context,\n                          ResourceDescriptor resourceDescriptor,\n                          Object resource,\n                          String requestPath)", "class_method_signature": "RequestDispatcher.dispatch(GenericContainerRequest request,\n                          GenericContainerResponse response,\n                          ApplicationContext context,\n                          ResourceDescriptor resourceDescriptor,\n                          Object resource,\n                          String requestPath)", "testcase": false, "constructor": false}, {"identifier": "invokeResourceMethod", "parameters": "(ResourceMethodDescriptor resourceMethod,\n                                      Object resource,\n                                      ApplicationContext context,\n                                      GenericContainerRequest request,\n                                      GenericContainerResponse response)", "modifiers": "private", "return": "void", "signature": "void invokeResourceMethod(ResourceMethodDescriptor resourceMethod,\n                                      Object resource,\n                                      ApplicationContext context,\n                                      GenericContainerRequest request,\n                                      GenericContainerResponse response)", "full_signature": "private void invokeResourceMethod(ResourceMethodDescriptor resourceMethod,\n                                      Object resource,\n                                      ApplicationContext context,\n                                      GenericContainerRequest request,\n                                      GenericContainerResponse response)", "class_method_signature": "RequestDispatcher.invokeResourceMethod(ResourceMethodDescriptor resourceMethod,\n                                      Object resource,\n                                      ApplicationContext context,\n                                      GenericContainerRequest request,\n                                      GenericContainerResponse response)", "testcase": false, "constructor": false}, {"identifier": "invokeSubResourceMethod", "parameters": "(String requestPath,\n                                         SubResourceMethodDescriptor subResourceMethod,\n                                         Object resource,\n                                         ApplicationContext context,\n                                         GenericContainerRequest request,\n                                         GenericContainerResponse response)", "modifiers": "private", "return": "void", "signature": "void invokeSubResourceMethod(String requestPath,\n                                         SubResourceMethodDescriptor subResourceMethod,\n                                         Object resource,\n                                         ApplicationContext context,\n                                         GenericContainerRequest request,\n                                         GenericContainerResponse response)", "full_signature": "private void invokeSubResourceMethod(String requestPath,\n                                         SubResourceMethodDescriptor subResourceMethod,\n                                         Object resource,\n                                         ApplicationContext context,\n                                         GenericContainerRequest request,\n                                         GenericContainerResponse response)", "class_method_signature": "RequestDispatcher.invokeSubResourceMethod(String requestPath,\n                                         SubResourceMethodDescriptor subResourceMethod,\n                                         Object resource,\n                                         ApplicationContext context,\n                                         GenericContainerRequest request,\n                                         GenericContainerResponse response)", "testcase": false, "constructor": false}, {"identifier": "doInvokeResource", "parameters": "(ResourceMethodDescriptor method,\n                                  Object resource,\n                                  ApplicationContext context,\n                                  GenericContainerRequest request,\n                                  GenericContainerResponse response)", "modifiers": "private", "return": "void", "signature": "void doInvokeResource(ResourceMethodDescriptor method,\n                                  Object resource,\n                                  ApplicationContext context,\n                                  GenericContainerRequest request,\n                                  GenericContainerResponse response)", "full_signature": "private void doInvokeResource(ResourceMethodDescriptor method,\n                                  Object resource,\n                                  ApplicationContext context,\n                                  GenericContainerRequest request,\n                                  GenericContainerResponse response)", "class_method_signature": "RequestDispatcher.doInvokeResource(ResourceMethodDescriptor method,\n                                  Object resource,\n                                  ApplicationContext context,\n                                  GenericContainerRequest request,\n                                  GenericContainerResponse response)", "testcase": false, "constructor": false}, {"identifier": "invokeSubResourceLocator", "parameters": "(String requestPath,\n                                          SubResourceLocatorDescriptor subResourceLocator,\n                                          Object resource,\n                                          ApplicationContext context,\n                                          GenericContainerRequest request,\n                                          GenericContainerResponse response)", "modifiers": "private", "return": "void", "signature": "void invokeSubResourceLocator(String requestPath,\n                                          SubResourceLocatorDescriptor subResourceLocator,\n                                          Object resource,\n                                          ApplicationContext context,\n                                          GenericContainerRequest request,\n                                          GenericContainerResponse response)", "full_signature": "private void invokeSubResourceLocator(String requestPath,\n                                          SubResourceLocatorDescriptor subResourceLocator,\n                                          Object resource,\n                                          ApplicationContext context,\n                                          GenericContainerRequest request,\n                                          GenericContainerResponse response)", "class_method_signature": "RequestDispatcher.invokeSubResourceLocator(String requestPath,\n                                          SubResourceLocatorDescriptor subResourceLocator,\n                                          Object resource,\n                                          ApplicationContext context,\n                                          GenericContainerRequest request,\n                                          GenericContainerResponse response)", "testcase": false, "constructor": false}, {"identifier": "compareSubResources", "parameters": "(SubResourceMethodDescriptor subResourceMethod, SubResourceLocatorDescriptor subResourceLocator)", "modifiers": "private", "return": "int", "signature": "int compareSubResources(SubResourceMethodDescriptor subResourceMethod, SubResourceLocatorDescriptor subResourceLocator)", "full_signature": "private int compareSubResources(SubResourceMethodDescriptor subResourceMethod, SubResourceLocatorDescriptor subResourceLocator)", "class_method_signature": "RequestDispatcher.compareSubResources(SubResourceMethodDescriptor subResourceMethod, SubResourceLocatorDescriptor subResourceLocator)", "testcase": false, "constructor": false}, {"identifier": "processResponse", "parameters": "(Object methodInvocationResult,\n                                 GenericContainerRequest request,\n                                 GenericContainerResponse response,\n                                 List<MediaType> produces,\n                                 ApplicationContext context)", "modifiers": "private", "return": "void", "signature": "void processResponse(Object methodInvocationResult,\n                                 GenericContainerRequest request,\n                                 GenericContainerResponse response,\n                                 List<MediaType> produces,\n                                 ApplicationContext context)", "full_signature": "private void processResponse(Object methodInvocationResult,\n                                 GenericContainerRequest request,\n                                 GenericContainerResponse response,\n                                 List<MediaType> produces,\n                                 ApplicationContext context)", "class_method_signature": "RequestDispatcher.processResponse(Object methodInvocationResult,\n                                 GenericContainerRequest request,\n                                 GenericContainerResponse response,\n                                 List<MediaType> produces,\n                                 ApplicationContext context)", "testcase": false, "constructor": false}, {"identifier": "processResourceMethod", "parameters": "(Map<String, List<T>> resourceMethods,\n                                                                               GenericContainerRequest request,\n                                                                               GenericContainerResponse response,\n                                                                               List<T> matchedMethods)", "modifiers": "private", "return": "boolean", "signature": "boolean processResourceMethod(Map<String, List<T>> resourceMethods,\n                                                                               GenericContainerRequest request,\n                                                                               GenericContainerResponse response,\n                                                                               List<T> matchedMethods)", "full_signature": "private boolean processResourceMethod(Map<String, List<T>> resourceMethods,\n                                                                               GenericContainerRequest request,\n                                                                               GenericContainerResponse response,\n                                                                               List<T> matchedMethods)", "class_method_signature": "RequestDispatcher.processResourceMethod(Map<String, List<T>> resourceMethods,\n                                                                               GenericContainerRequest request,\n                                                                               GenericContainerResponse response,\n                                                                               List<T> matchedMethods)", "testcase": false, "constructor": false}, {"identifier": "byAcceptMediaTypeComparator", "parameters": "(List<AcceptMediaType> acceptMediaTypes)", "modifiers": "private", "return": "Comparator<T>", "signature": "Comparator<T> byAcceptMediaTypeComparator(List<AcceptMediaType> acceptMediaTypes)", "full_signature": "private Comparator<T> byAcceptMediaTypeComparator(List<AcceptMediaType> acceptMediaTypes)", "class_method_signature": "RequestDispatcher.byAcceptMediaTypeComparator(List<AcceptMediaType> acceptMediaTypes)", "testcase": false, "constructor": false}, {"identifier": "notAcceptableFilter", "parameters": "(List<AcceptMediaType> acceptMediaTypes)", "modifiers": "private", "return": "Predicate<T>", "signature": "Predicate<T> notAcceptableFilter(List<AcceptMediaType> acceptMediaTypes)", "full_signature": "private Predicate<T> notAcceptableFilter(List<AcceptMediaType> acceptMediaTypes)", "class_method_signature": "RequestDispatcher.notAcceptableFilter(List<AcceptMediaType> acceptMediaTypes)", "testcase": false, "constructor": false}, {"identifier": "getAllow", "parameters": "(Map<String, List<T>> resourceMethods)", "modifiers": "private", "return": "Collection<String>", "signature": "Collection<String> getAllow(Map<String, List<T>> resourceMethods)", "full_signature": "private Collection<String> getAllow(Map<String, List<T>> resourceMethods)", "class_method_signature": "RequestDispatcher.getAllow(Map<String, List<T>> resourceMethods)", "testcase": false, "constructor": false}, {"identifier": "processSubResourceMethod", "parameters": "(Map<UriPattern, Map<String, List<SubResourceMethodDescriptor>>> subResourceMethods,\n                                             String requestedPath,\n                                             GenericContainerRequest request,\n                                             GenericContainerResponse response,\n                                             List<String> capturedValues,\n                                             List<SubResourceMethodDescriptor> matchedMethods)", "modifiers": "private", "return": "boolean", "signature": "boolean processSubResourceMethod(Map<UriPattern, Map<String, List<SubResourceMethodDescriptor>>> subResourceMethods,\n                                             String requestedPath,\n                                             GenericContainerRequest request,\n                                             GenericContainerResponse response,\n                                             List<String> capturedValues,\n                                             List<SubResourceMethodDescriptor> matchedMethods)", "full_signature": "private boolean processSubResourceMethod(Map<UriPattern, Map<String, List<SubResourceMethodDescriptor>>> subResourceMethods,\n                                             String requestedPath,\n                                             GenericContainerRequest request,\n                                             GenericContainerResponse response,\n                                             List<String> capturedValues,\n                                             List<SubResourceMethodDescriptor> matchedMethods)", "class_method_signature": "RequestDispatcher.processSubResourceMethod(Map<UriPattern, Map<String, List<SubResourceMethodDescriptor>>> subResourceMethods,\n                                             String requestedPath,\n                                             GenericContainerRequest request,\n                                             GenericContainerResponse response,\n                                             List<String> capturedValues,\n                                             List<SubResourceMethodDescriptor> matchedMethods)", "testcase": false, "constructor": false}, {"identifier": "processSubResourceLocator", "parameters": "(Map<UriPattern, SubResourceLocatorDescriptor> subResourceLocators,\n                                              String requestedPath,\n                                              List<String> capturingValues,\n                                              List<SubResourceLocatorDescriptor> locators)", "modifiers": "private", "return": "boolean", "signature": "boolean processSubResourceLocator(Map<UriPattern, SubResourceLocatorDescriptor> subResourceLocators,\n                                              String requestedPath,\n                                              List<String> capturingValues,\n                                              List<SubResourceLocatorDescriptor> locators)", "full_signature": "private boolean processSubResourceLocator(Map<UriPattern, SubResourceLocatorDescriptor> subResourceLocators,\n                                              String requestedPath,\n                                              List<String> capturingValues,\n                                              List<SubResourceLocatorDescriptor> locators)", "class_method_signature": "RequestDispatcher.processSubResourceLocator(Map<UriPattern, SubResourceLocatorDescriptor> subResourceLocators,\n                                              String requestedPath,\n                                              List<String> capturingValues,\n                                              List<SubResourceLocatorDescriptor> locators)", "testcase": false, "constructor": false}, {"identifier": "getRootResource", "parameters": "(List<String> parameterValues, String requestPath)", "modifiers": "private", "return": "ObjectFactory<ResourceDescriptor>", "signature": "ObjectFactory<ResourceDescriptor> getRootResource(List<String> parameterValues, String requestPath)", "full_signature": "private ObjectFactory<ResourceDescriptor> getRootResource(List<String> parameterValues, String requestPath)", "class_method_signature": "RequestDispatcher.getRootResource(List<String> parameterValues, String requestPath)", "testcase": false, "constructor": false}], "file": "everrest-core/src/main/java/org/everrest/core/impl/RequestDispatcher.java"}, "focal_method": {"identifier": "dispatch", "parameters": "(GenericContainerRequest request, GenericContainerResponse response)", "modifiers": "public", "return": "void", "body": "public void dispatch(GenericContainerRequest request, GenericContainerResponse response) {\n        ApplicationContext context = ApplicationContext.getCurrent();\n        String requestPath = getRequestPathWithoutMatrixParameters(context);\n        List<String> parameterValues = context.getParameterValues();\n\n        ObjectFactory<ResourceDescriptor> resourceFactory = getRootResource(parameterValues, requestPath);\n        if (resourceFactory == null) {\n            LOG.debug(\"Root resource not found for {}\", requestPath);\n            response.setResponse(Response.status(NOT_FOUND)\n                                         .entity(String.format(\"There is no any resources matched to request path %s\", requestPath))\n                                         .type(TEXT_PLAIN)\n                                         .build());\n            return;\n        }\n\n        // Take the tail of the request path, the tail will be requested path\n        // for lower resources, e. g. ResourceClass -> Sub-resource method/locator\n        String newRequestPath = getPathTail(parameterValues);\n        context.addMatchedURI(requestPath.substring(0, requestPath.lastIndexOf(newRequestPath)));\n        context.setParameterNames(resourceFactory.getObjectModel().getUriPattern().getParameterNames());\n\n        Object resource = resourceFactory.getInstance(context);\n        dispatch(request, response, context, resourceFactory.getObjectModel(), resource, newRequestPath);\n    }", "signature": "void dispatch(GenericContainerRequest request, GenericContainerResponse response)", "full_signature": "public void dispatch(GenericContainerRequest request, GenericContainerResponse response)", "class_method_signature": "RequestDispatcher.dispatch(GenericContainerRequest request, GenericContainerResponse response)", "testcase": false, "constructor": false, "invocations": ["getCurrent", "getRequestPathWithoutMatrixParameters", "getParameterValues", "getRootResource", "debug", "setResponse", "build", "type", "entity", "status", "format", "getPathTail", "addMatchedURI", "substring", "lastIndexOf", "setParameterNames", "getParameterNames", "getUriPattern", "getObjectModel", "getInstance", "dispatch", "getObjectModel"]}, "repository": {"repo_id": 14550159, "url": "https://github.com/codenvy/everrest", "language": "Java", "is_fork": false, "fork_count": 14, "stargazer_count": 24, "size": 4563, "license": "licensed"}}