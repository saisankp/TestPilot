{"test_class": {"identifier": "EncryptionServiceTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String SRC_TEST_RESOURCES_SECRET = \"src/test/resources/secret\";", "modifier": "private static final", "type": "String", "declarator": "SRC_TEST_RESOURCES_SECRET = \"src/test/resources/secret\"", "var_name": "SRC_TEST_RESOURCES_SECRET"}, {"original_string": "private static final String TEST_CONTENT = \"content to encrypt and decrypt\";", "modifier": "private static final", "type": "String", "declarator": "TEST_CONTENT = \"content to encrypt and decrypt\"", "var_name": "TEST_CONTENT"}, {"original_string": "private static final String PROVIDER = EncryptionService.PROVIDER;", "modifier": "private static final", "type": "String", "declarator": "PROVIDER = EncryptionService.PROVIDER", "var_name": "PROVIDER"}, {"original_string": "private static final String AES = EncryptionService.SECRET_KEY_SPEC;", "modifier": "private static final", "type": "String", "declarator": "AES = EncryptionService.SECRET_KEY_SPEC", "var_name": "AES"}, {"original_string": "private static final String SRC_TEST_RESOURCES_KEYS_SECRET_AES = \"src/test/resources/keys/secret.aes\";", "modifier": "private static final", "type": "String", "declarator": "SRC_TEST_RESOURCES_KEYS_SECRET_AES = \"src/test/resources/keys/secret.aes\"", "var_name": "SRC_TEST_RESOURCES_KEYS_SECRET_AES"}, {"original_string": "private static final String AUTH_KEY_ENCRYPTED_STRING = \"bc082efed278e1bbebddc0431877d4fae80fa4e72925b6ad0bc67c84b8721598eda8458bcc1b2827fe6e5e7918ce22fd\";", "modifier": "private static final", "type": "String", "declarator": "AUTH_KEY_ENCRYPTED_STRING = \"bc082efed278e1bbebddc0431877d4fae80fa4e72925b6ad0bc67c84b8721598eda8458bcc1b2827fe6e5e7918ce22fd\"", "var_name": "AUTH_KEY_ENCRYPTED_STRING"}, {"original_string": "private static final String SRC_TEST_RESOURCES_KEYS_AUTH_KEY_DECRYPTED = \"src/test/resources/keys/authkeydecrypted\";", "modifier": "private static final", "type": "String", "declarator": "SRC_TEST_RESOURCES_KEYS_AUTH_KEY_DECRYPTED = \"src/test/resources/keys/authkeydecrypted\"", "var_name": "SRC_TEST_RESOURCES_KEYS_AUTH_KEY_DECRYPTED"}, {"original_string": "private static final String ENC_KEY_ENCRYPTED_STRING = \"bc082efed278e1bbebddc0431877d4fa2df7728229f3e03c57b2549142b40d047b35011dbf9f77ad91db5fe6f19a7b9c\";", "modifier": "private static final", "type": "String", "declarator": "ENC_KEY_ENCRYPTED_STRING = \"bc082efed278e1bbebddc0431877d4fa2df7728229f3e03c57b2549142b40d047b35011dbf9f77ad91db5fe6f19a7b9c\"", "var_name": "ENC_KEY_ENCRYPTED_STRING"}, {"original_string": "private static final String SRC_TEST_RESOURCES_KEYS_ENC_KEY_DECRYPTED = \"src/test/resources/keys/enckeydecrypted\";", "modifier": "private static final", "type": "String", "declarator": "SRC_TEST_RESOURCES_KEYS_ENC_KEY_DECRYPTED = \"src/test/resources/keys/enckeydecrypted\"", "var_name": "SRC_TEST_RESOURCES_KEYS_ENC_KEY_DECRYPTED"}, {"original_string": "private static final String MASTER_KEY_ENCRYPTED_STRING = \"bc082efed278e1bbebddc0431877d4fa16374b00e96dd102beab666dcb72efbd1f0b868412497f6d3d0c62caa4700585\";", "modifier": "private static final", "type": "String", "declarator": "MASTER_KEY_ENCRYPTED_STRING = \"bc082efed278e1bbebddc0431877d4fa16374b00e96dd102beab666dcb72efbd1f0b868412497f6d3d0c62caa4700585\"", "var_name": "MASTER_KEY_ENCRYPTED_STRING"}, {"original_string": "private static final String SRC_TEST_RESOURCES_KEYS_MASTER_KEY_DECRYPTED = \"src/test/resources/keys/masterkeydecrypted\";", "modifier": "private static final", "type": "String", "declarator": "SRC_TEST_RESOURCES_KEYS_MASTER_KEY_DECRYPTED = \"src/test/resources/keys/masterkeydecrypted\"", "var_name": "SRC_TEST_RESOURCES_KEYS_MASTER_KEY_DECRYPTED"}], "file": "osgp/shared/shared/src/test/java/org/opensmartgridplatform/shared/security/EncryptionServiceTest.java"}, "test_case": {"identifier": "testPrepended", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testPrepended()\n            throws NoSuchAlgorithmException, IOException, NoSuchProviderException, FunctionalException {\n        final byte[] encrypted_prepended = Files.readAllBytes(new File(\"src/test/resources/prepended\").toPath());\n\n        final SecretKeySpec secretKey = this.createSecretKeySpec(new File(SRC_TEST_RESOURCES_SECRET).getPath());\n        final byte[] decrypted_prepended = new TestableEncService(secretKey).decrypt(encrypted_prepended);\n\n        // in this specific case the length of the decrypted bytes should become\n        // 16, after 0 bytes are stripped of\n        assertThat(decrypted_prepended.length).isEqualTo(16);\n\n    }", "signature": "void testPrepended()", "full_signature": "@Test public void testPrepended()", "class_method_signature": "EncryptionServiceTest.testPrepended()", "testcase": true, "constructor": false, "invocations": ["readAllBytes", "toPath", "createSecretKeySpec", "getPath", "decrypt", "isEqualTo", "assertThat"]}, "focal_class": {"identifier": "EncryptionService", "superclass": "", "interfaces": "", "fields": [{"original_string": "public static final String SECRET_KEY_SPEC = \"AES\";", "modifier": "public static final", "type": "String", "declarator": "SECRET_KEY_SPEC = \"AES\"", "var_name": "SECRET_KEY_SPEC"}, {"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(EncryptionService.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(EncryptionService.class)", "var_name": "LOGGER"}, {"original_string": "public static final String ALGORITHM = \"AES/CBC/PKCS5PADDING\";", "modifier": "public static final", "type": "String", "declarator": "ALGORITHM = \"AES/CBC/PKCS5PADDING\"", "var_name": "ALGORITHM"}, {"original_string": "public static final String PROVIDER = \"SunJCE\";", "modifier": "public static final", "type": "String", "declarator": "PROVIDER = \"SunJCE\"", "var_name": "PROVIDER"}, {"original_string": "@Value(\"${encryption.key.path:#{null}}}\")\n    private String keyPath;", "modifier": "@Value(\"${encryption.key.path:#{null}}}\")\n    private", "type": "String", "declarator": "keyPath", "var_name": "keyPath"}, {"original_string": "private SecretKey key;", "modifier": "private", "type": "SecretKey", "declarator": "key", "var_name": "key"}, {"original_string": "private static final byte[] IVBYTES = new byte[16];", "modifier": "private static final", "type": "byte[]", "declarator": "IVBYTES = new byte[16]", "var_name": "IVBYTES"}], "methods": [{"identifier": "EncryptionService", "parameters": "(final SecretKeySpec key)", "modifiers": "protected", "return": "", "signature": " EncryptionService(final SecretKeySpec key)", "full_signature": "protected  EncryptionService(final SecretKeySpec key)", "class_method_signature": "EncryptionService.EncryptionService(final SecretKeySpec key)", "testcase": false, "constructor": true}, {"identifier": "EncryptionService", "parameters": "()", "modifiers": "public", "return": "", "signature": " EncryptionService()", "full_signature": "public  EncryptionService()", "class_method_signature": "EncryptionService.EncryptionService()", "testcase": false, "constructor": true}, {"identifier": "initEncryption", "parameters": "()", "modifiers": "@PostConstruct private", "return": "void", "signature": "void initEncryption()", "full_signature": "@PostConstruct private void initEncryption()", "class_method_signature": "EncryptionService.initEncryption()", "testcase": false, "constructor": false}, {"identifier": "withSecretKeyAt", "parameters": "(final String keyPath)", "modifiers": "", "return": "EncryptionService", "signature": "EncryptionService withSecretKeyAt(final String keyPath)", "full_signature": " EncryptionService withSecretKeyAt(final String keyPath)", "class_method_signature": "EncryptionService.withSecretKeyAt(final String keyPath)", "testcase": false, "constructor": false}, {"identifier": "decrypt", "parameters": "(final byte[] inputData)", "modifiers": "public", "return": "byte[]", "signature": "byte[] decrypt(final byte[] inputData)", "full_signature": "public byte[] decrypt(final byte[] inputData)", "class_method_signature": "EncryptionService.decrypt(final byte[] inputData)", "testcase": false, "constructor": false}, {"identifier": "checkNullBytesPrepended", "parameters": "(final byte[] bytes)", "modifiers": "private", "return": "boolean", "signature": "boolean checkNullBytesPrepended(final byte[] bytes)", "full_signature": "private boolean checkNullBytesPrepended(final byte[] bytes)", "class_method_signature": "EncryptionService.checkNullBytesPrepended(final byte[] bytes)", "testcase": false, "constructor": false}, {"identifier": "encrypt", "parameters": "(final byte[] inputData)", "modifiers": "public", "return": "byte[]", "signature": "byte[] encrypt(final byte[] inputData)", "full_signature": "public byte[] encrypt(final byte[] inputData)", "class_method_signature": "EncryptionService.encrypt(final byte[] inputData)", "testcase": false, "constructor": false}, {"identifier": "getIvbytes", "parameters": "()", "modifiers": "public static", "return": "byte[]", "signature": "byte[] getIvbytes()", "full_signature": "public static byte[] getIvbytes()", "class_method_signature": "EncryptionService.getIvbytes()", "testcase": false, "constructor": false}], "file": "osgp/shared/shared/src/main/java/org/opensmartgridplatform/shared/security/EncryptionService.java"}, "focal_method": {"identifier": "decrypt", "parameters": "(final byte[] inputData)", "modifiers": "public", "return": "byte[]", "body": "public byte[] decrypt(final byte[] inputData) throws FunctionalException {\n\n        try {\n            final Cipher cipher = Cipher.getInstance(ALGORITHM, PROVIDER);\n            cipher.init(Cipher.DECRYPT_MODE, this.key, new IvParameterSpec(IVBYTES));\n            final byte[] decryptedData = cipher.doFinal(inputData);\n            if (this.checkNullBytesPrepended(decryptedData)) {\n                return Arrays.copyOfRange(decryptedData, IVBYTES.length, decryptedData.length);\n            } else {\n                return decryptedData;\n            }\n        } catch (final NoSuchAlgorithmException | NoSuchPaddingException | InvalidKeyException\n                | IllegalBlockSizeException | BadPaddingException | NoSuchProviderException\n                | InvalidAlgorithmParameterException e) {\n            LOGGER.error(\"Unexpected exception during decryption\", e);\n\n            throw new FunctionalException(FunctionalExceptionType.DECRYPTION_EXCEPTION, ComponentType.SHARED, e);\n        }\n    }", "signature": "byte[] decrypt(final byte[] inputData)", "full_signature": "public byte[] decrypt(final byte[] inputData)", "class_method_signature": "EncryptionService.decrypt(final byte[] inputData)", "testcase": false, "constructor": false, "invocations": ["getInstance", "init", "doFinal", "checkNullBytesPrepended", "copyOfRange", "error"]}, "repository": {"repo_id": 154302277, "url": "https://github.com/OSGP/open-smart-grid-platform", "stars": 30, "created": "10/23/2018 9:41:12 AM +00:00", "updates": "2020-01-26T20:15:09+00:00", "fork": "False", "license": "licensed"}}