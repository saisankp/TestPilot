{"test_class": {"identifier": "HttpProtocolTest", "superclass": "", "interfaces": "", "fields": [], "file": "dubbo-rpc/dubbo-rpc-http/src/test/java/org/apache/dubbo/rpc/protocol/http/HttpProtocolTest.java"}, "test_case": {"identifier": "testJsonrpcProtocolForServerJetty", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testJsonrpcProtocolForServerJetty() {\n        HttpServiceImpl server = new HttpServiceImpl();\n        assertFalse(server.isCalled());\n        ProxyFactory proxyFactory = ExtensionLoader.getExtensionLoader(ProxyFactory.class).getAdaptiveExtension();\n        Protocol protocol = ExtensionLoader.getExtensionLoader(Protocol.class).getAdaptiveExtension();\n        int port = NetUtils.getAvailablePort();\n        URL url = URL.valueOf(\"http://127.0.0.1:\" + port + \"/\" + HttpService.class.getName() + \"?version=1.0.0&server=jetty\");\n        Exporter<HttpService> exporter = protocol.export(proxyFactory.getInvoker(server, HttpService.class, url));\n        Invoker<HttpService> invoker = protocol.refer(HttpService.class, url);\n        HttpService client = proxyFactory.getProxy(invoker);\n        String result = client.sayHello(\"haha\");\n        assertTrue(server.isCalled());\n        assertEquals(\"Hello, haha\", result);\n        invoker.destroy();\n        exporter.unexport();\n    }", "signature": "void testJsonrpcProtocolForServerJetty()", "full_signature": "@Test public void testJsonrpcProtocolForServerJetty()", "class_method_signature": "HttpProtocolTest.testJsonrpcProtocolForServerJetty()", "testcase": true, "constructor": false, "invocations": ["assertFalse", "isCalled", "getAdaptiveExtension", "getExtensionLoader", "getAdaptiveExtension", "getExtensionLoader", "getAvailablePort", "valueOf", "getName", "export", "getInvoker", "refer", "getProxy", "sayHello", "assertTrue", "isCalled", "assertEquals", "destroy", "unexport"]}, "focal_class": {"identifier": "HttpProtocol", "superclass": "extends AbstractProxyProtocol", "interfaces": "", "fields": [{"original_string": "public static final String ACCESS_CONTROL_ALLOW_ORIGIN_HEADER = \"Access-Control-Allow-Origin\";", "modifier": "public static final", "type": "String", "declarator": "ACCESS_CONTROL_ALLOW_ORIGIN_HEADER = \"Access-Control-Allow-Origin\"", "var_name": "ACCESS_CONTROL_ALLOW_ORIGIN_HEADER"}, {"original_string": "public static final String ACCESS_CONTROL_ALLOW_METHODS_HEADER = \"Access-Control-Allow-Methods\";", "modifier": "public static final", "type": "String", "declarator": "ACCESS_CONTROL_ALLOW_METHODS_HEADER = \"Access-Control-Allow-Methods\"", "var_name": "ACCESS_CONTROL_ALLOW_METHODS_HEADER"}, {"original_string": "public static final String ACCESS_CONTROL_ALLOW_HEADERS_HEADER = \"Access-Control-Allow-Headers\";", "modifier": "public static final", "type": "String", "declarator": "ACCESS_CONTROL_ALLOW_HEADERS_HEADER = \"Access-Control-Allow-Headers\"", "var_name": "ACCESS_CONTROL_ALLOW_HEADERS_HEADER"}, {"original_string": "private final Map<String, JsonRpcServer> skeletonMap = new ConcurrentHashMap<>();", "modifier": "private final", "type": "Map<String, JsonRpcServer>", "declarator": "skeletonMap = new ConcurrentHashMap<>()", "var_name": "skeletonMap"}, {"original_string": "private HttpBinder httpBinder;", "modifier": "private", "type": "HttpBinder", "declarator": "httpBinder", "var_name": "httpBinder"}], "methods": [{"identifier": "HttpProtocol", "parameters": "()", "modifiers": "public", "return": "", "signature": " HttpProtocol()", "full_signature": "public  HttpProtocol()", "class_method_signature": "HttpProtocol.HttpProtocol()", "testcase": false, "constructor": true}, {"identifier": "setHttpBinder", "parameters": "(HttpBinder httpBinder)", "modifiers": "public", "return": "void", "signature": "void setHttpBinder(HttpBinder httpBinder)", "full_signature": "public void setHttpBinder(HttpBinder httpBinder)", "class_method_signature": "HttpProtocol.setHttpBinder(HttpBinder httpBinder)", "testcase": false, "constructor": false}, {"identifier": "getDefaultPort", "parameters": "()", "modifiers": "@Override public", "return": "int", "signature": "int getDefaultPort()", "full_signature": "@Override public int getDefaultPort()", "class_method_signature": "HttpProtocol.getDefaultPort()", "testcase": false, "constructor": false}, {"identifier": "doExport", "parameters": "(final T impl, Class<T> type, URL url)", "modifiers": "@Override protected", "return": "Runnable", "signature": "Runnable doExport(final T impl, Class<T> type, URL url)", "full_signature": "@Override protected Runnable doExport(final T impl, Class<T> type, URL url)", "class_method_signature": "HttpProtocol.doExport(final T impl, Class<T> type, URL url)", "testcase": false, "constructor": false}, {"identifier": "doRefer", "parameters": "(final Class<T> serviceType, URL url)", "modifiers": "@SuppressWarnings(\"unchecked\") @Override protected", "return": "T", "signature": "T doRefer(final Class<T> serviceType, URL url)", "full_signature": "@SuppressWarnings(\"unchecked\") @Override protected T doRefer(final Class<T> serviceType, URL url)", "class_method_signature": "HttpProtocol.doRefer(final Class<T> serviceType, URL url)", "testcase": false, "constructor": false}, {"identifier": "getErrorCode", "parameters": "(Throwable e)", "modifiers": "protected", "return": "int", "signature": "int getErrorCode(Throwable e)", "full_signature": "protected int getErrorCode(Throwable e)", "class_method_signature": "HttpProtocol.getErrorCode(Throwable e)", "testcase": false, "constructor": false}, {"identifier": "destroy", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void destroy()", "full_signature": "@Override public void destroy()", "class_method_signature": "HttpProtocol.destroy()", "testcase": false, "constructor": false}], "file": "dubbo-rpc/dubbo-rpc-http/src/main/java/org/apache/dubbo/rpc/protocol/http/HttpProtocol.java"}, "focal_method": {"identifier": "destroy", "parameters": "()", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void destroy() {\n        super.destroy();\n        for (String key : new ArrayList<>(serverMap.keySet())) {\n            ProtocolServer server = serverMap.remove(key);\n            if (server != null) {\n                try {\n                    if (logger.isInfoEnabled()) {\n                        logger.info(\"Close jsonrpc server \" + server.getUrl());\n                    }\n                    server.close();\n                } catch (Throwable t) {\n                    logger.warn(t.getMessage(), t);\n                }\n            }\n        }\n    }", "signature": "void destroy()", "full_signature": "@Override public void destroy()", "class_method_signature": "HttpProtocol.destroy()", "testcase": false, "constructor": false, "invocations": ["destroy", "keySet", "remove", "isInfoEnabled", "info", "getUrl", "close", "warn", "getMessage"]}, "repository": {"repo_id": 4710920, "url": "https://github.com/apache/dubbo", "stars": 30960, "created": "6/19/2012 7:56:02 AM +00:00", "updates": "2020-01-27T14:21:03+00:00", "fork": "False", "license": "licensed"}}