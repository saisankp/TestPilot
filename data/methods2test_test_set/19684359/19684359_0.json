{"test_class": {"identifier": "GoogleHadoopSyncableOutputStreamTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Mock private ExecutorService mockExecutorService;", "modifier": "@Mock private", "type": "ExecutorService", "declarator": "mockExecutorService", "var_name": "mockExecutorService"}, {"original_string": "private GoogleHadoopFileSystemBase ghfs;", "modifier": "private", "type": "GoogleHadoopFileSystemBase", "declarator": "ghfs", "var_name": "ghfs"}], "file": "gcs/src/test/java/com/google/cloud/hadoop/fs/gcs/GoogleHadoopSyncableOutputStreamTest.java"}, "test_case": {"identifier": "testCloseTwice", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testCloseTwice() throws IOException {\n    Path objectPath = new Path(ghfs.getFileSystemRoot(), \"dir/object.txt\");\n    FSDataOutputStream fout = ghfs.create(objectPath);\n    fout.close();\n    fout.close();  // Fine to close twice.\n  }", "signature": "void testCloseTwice()", "full_signature": "@Test public void testCloseTwice()", "class_method_signature": "GoogleHadoopSyncableOutputStreamTest.testCloseTwice()", "testcase": true, "constructor": false, "invocations": ["getFileSystemRoot", "create", "close", "close"]}, "focal_class": {"identifier": "GoogleHadoopSyncableOutputStream", "superclass": "extends OutputStream", "interfaces": "implements Syncable", "fields": [{"original_string": "private static final GoogleLogger logger = GoogleLogger.forEnclosingClass();", "modifier": "private static final", "type": "GoogleLogger", "declarator": "logger = GoogleLogger.forEnclosingClass()", "var_name": "logger"}, {"original_string": "public static final String TEMPFILE_PREFIX = \"_GCS_SYNCABLE_TEMPFILE_\";", "modifier": "public static final", "type": "String", "declarator": "TEMPFILE_PREFIX = \"_GCS_SYNCABLE_TEMPFILE_\"", "var_name": "TEMPFILE_PREFIX"}, {"original_string": "private static final CreateFileOptions TEMPFILE_CREATE_OPTIONS =\n      CreateFileOptions.DEFAULT_NO_OVERWRITE.toBuilder()\n          .setEnsureNoDirectoryConflict(false)\n          .setEnsureParentDirectoriesExist(false)\n          .setOverwriteGenerationId(0)\n          .build();", "modifier": "private static final", "type": "CreateFileOptions", "declarator": "TEMPFILE_CREATE_OPTIONS =\n      CreateFileOptions.DEFAULT_NO_OVERWRITE.toBuilder()\n          .setEnsureNoDirectoryConflict(false)\n          .setEnsureParentDirectoriesExist(false)\n          .setOverwriteGenerationId(0)\n          .build()", "var_name": "TEMPFILE_CREATE_OPTIONS"}, {"original_string": "private static final ExecutorService TEMPFILE_CLEANUP_THREADPOOL =\n      Executors.newCachedThreadPool(\n          new ThreadFactoryBuilder()\n              .setNameFormat(\"gcs-syncable-output-stream-cleanup-pool-%d\")\n              .setDaemon(true)\n              .build());", "modifier": "private static final", "type": "ExecutorService", "declarator": "TEMPFILE_CLEANUP_THREADPOOL =\n      Executors.newCachedThreadPool(\n          new ThreadFactoryBuilder()\n              .setNameFormat(\"gcs-syncable-output-stream-cleanup-pool-%d\")\n              .setDaemon(true)\n              .build())", "var_name": "TEMPFILE_CLEANUP_THREADPOOL"}, {"original_string": "private final GoogleHadoopFileSystemBase ghfs;", "modifier": "private final", "type": "GoogleHadoopFileSystemBase", "declarator": "ghfs", "var_name": "ghfs"}, {"original_string": "private final URI finalGcsPath;", "modifier": "private final", "type": "URI", "declarator": "finalGcsPath", "var_name": "finalGcsPath"}, {"original_string": "private final FileSystem.Statistics statistics;", "modifier": "private final", "type": "FileSystem.Statistics", "declarator": "statistics", "var_name": "statistics"}, {"original_string": "private final CreateFileOptions fileOptions;", "modifier": "private final", "type": "CreateFileOptions", "declarator": "fileOptions", "var_name": "fileOptions"}, {"original_string": "private final List<Future<Void>> deletionFutures;", "modifier": "private final", "type": "List<Future<Void>>", "declarator": "deletionFutures", "var_name": "deletionFutures"}, {"original_string": "private final SyncableOutputStreamOptions options;", "modifier": "private final", "type": "SyncableOutputStreamOptions", "declarator": "options", "var_name": "options"}, {"original_string": "private final RateLimiter syncRateLimiter;", "modifier": "private final", "type": "RateLimiter", "declarator": "syncRateLimiter", "var_name": "syncRateLimiter"}, {"original_string": "private final ExecutorService cleanupThreadpool;", "modifier": "private final", "type": "ExecutorService", "declarator": "cleanupThreadpool", "var_name": "cleanupThreadpool"}, {"original_string": "private URI curGcsPath;", "modifier": "private", "type": "URI", "declarator": "curGcsPath", "var_name": "curGcsPath"}, {"original_string": "private GoogleHadoopOutputStream curDelegate;", "modifier": "private", "type": "GoogleHadoopOutputStream", "declarator": "curDelegate", "var_name": "curDelegate"}, {"original_string": "private int curComponentIndex;", "modifier": "private", "type": "int", "declarator": "curComponentIndex", "var_name": "curComponentIndex"}, {"original_string": "private long curDestGenerationId;", "modifier": "private", "type": "long", "declarator": "curDestGenerationId", "var_name": "curDestGenerationId"}], "methods": [{"identifier": "GoogleHadoopSyncableOutputStream", "parameters": "(\n      GoogleHadoopFileSystemBase ghfs,\n      URI gcsPath,\n      FileSystem.Statistics statistics,\n      CreateFileOptions createFileOptions,\n      SyncableOutputStreamOptions options)", "modifiers": "public", "return": "", "signature": " GoogleHadoopSyncableOutputStream(\n      GoogleHadoopFileSystemBase ghfs,\n      URI gcsPath,\n      FileSystem.Statistics statistics,\n      CreateFileOptions createFileOptions,\n      SyncableOutputStreamOptions options)", "full_signature": "public  GoogleHadoopSyncableOutputStream(\n      GoogleHadoopFileSystemBase ghfs,\n      URI gcsPath,\n      FileSystem.Statistics statistics,\n      CreateFileOptions createFileOptions,\n      SyncableOutputStreamOptions options)", "class_method_signature": "GoogleHadoopSyncableOutputStream.GoogleHadoopSyncableOutputStream(\n      GoogleHadoopFileSystemBase ghfs,\n      URI gcsPath,\n      FileSystem.Statistics statistics,\n      CreateFileOptions createFileOptions,\n      SyncableOutputStreamOptions options)", "testcase": false, "constructor": true}, {"identifier": "GoogleHadoopSyncableOutputStream", "parameters": "(\n      GoogleHadoopFileSystemBase ghfs,\n      URI gcsPath,\n      FileSystem.Statistics statistics,\n      CreateFileOptions createFileOptions,\n      SyncableOutputStreamOptions options,\n      ExecutorService cleanupThreadpool)", "modifiers": "@VisibleForTesting", "return": "", "signature": " GoogleHadoopSyncableOutputStream(\n      GoogleHadoopFileSystemBase ghfs,\n      URI gcsPath,\n      FileSystem.Statistics statistics,\n      CreateFileOptions createFileOptions,\n      SyncableOutputStreamOptions options,\n      ExecutorService cleanupThreadpool)", "full_signature": "@VisibleForTesting  GoogleHadoopSyncableOutputStream(\n      GoogleHadoopFileSystemBase ghfs,\n      URI gcsPath,\n      FileSystem.Statistics statistics,\n      CreateFileOptions createFileOptions,\n      SyncableOutputStreamOptions options,\n      ExecutorService cleanupThreadpool)", "class_method_signature": "GoogleHadoopSyncableOutputStream.GoogleHadoopSyncableOutputStream(\n      GoogleHadoopFileSystemBase ghfs,\n      URI gcsPath,\n      FileSystem.Statistics statistics,\n      CreateFileOptions createFileOptions,\n      SyncableOutputStreamOptions options,\n      ExecutorService cleanupThreadpool)", "testcase": false, "constructor": true}, {"identifier": "createRateLimiter", "parameters": "(Duration minSyncInterval)", "modifiers": "private static", "return": "RateLimiter", "signature": "RateLimiter createRateLimiter(Duration minSyncInterval)", "full_signature": "private static RateLimiter createRateLimiter(Duration minSyncInterval)", "class_method_signature": "GoogleHadoopSyncableOutputStream.createRateLimiter(Duration minSyncInterval)", "testcase": false, "constructor": false}, {"identifier": "write", "parameters": "(int b)", "modifiers": "@Override public", "return": "void", "signature": "void write(int b)", "full_signature": "@Override public void write(int b)", "class_method_signature": "GoogleHadoopSyncableOutputStream.write(int b)", "testcase": false, "constructor": false}, {"identifier": "write", "parameters": "(byte[] b, int offset, int len)", "modifiers": "@Override public", "return": "void", "signature": "void write(byte[] b, int offset, int len)", "full_signature": "@Override public void write(byte[] b, int offset, int len)", "class_method_signature": "GoogleHadoopSyncableOutputStream.write(byte[] b, int offset, int len)", "testcase": false, "constructor": false}, {"identifier": "close", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void close()", "full_signature": "@Override public void close()", "class_method_signature": "GoogleHadoopSyncableOutputStream.close()", "testcase": false, "constructor": false}, {"identifier": "sync", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void sync()", "full_signature": "public void sync()", "class_method_signature": "GoogleHadoopSyncableOutputStream.sync()", "testcase": false, "constructor": false}, {"identifier": "hflush", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void hflush()", "full_signature": "@Override public void hflush()", "class_method_signature": "GoogleHadoopSyncableOutputStream.hflush()", "testcase": false, "constructor": false}, {"identifier": "hsync", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void hsync()", "full_signature": "@Override public void hsync()", "class_method_signature": "GoogleHadoopSyncableOutputStream.hsync()", "testcase": false, "constructor": false}, {"identifier": "hsyncInternal", "parameters": "(long startTimeNs)", "modifiers": "private", "return": "void", "signature": "void hsyncInternal(long startTimeNs)", "full_signature": "private void hsyncInternal(long startTimeNs)", "class_method_signature": "GoogleHadoopSyncableOutputStream.hsyncInternal(long startTimeNs)", "testcase": false, "constructor": false}, {"identifier": "commitCurrentFile", "parameters": "()", "modifiers": "private", "return": "void", "signature": "void commitCurrentFile()", "full_signature": "private void commitCurrentFile()", "class_method_signature": "GoogleHadoopSyncableOutputStream.commitCurrentFile()", "testcase": false, "constructor": false}, {"identifier": "getNextTemporaryPath", "parameters": "()", "modifiers": "private", "return": "URI", "signature": "URI getNextTemporaryPath()", "full_signature": "private URI getNextTemporaryPath()", "class_method_signature": "GoogleHadoopSyncableOutputStream.getNextTemporaryPath()", "testcase": false, "constructor": false}, {"identifier": "isOpen", "parameters": "()", "modifiers": "private", "return": "boolean", "signature": "boolean isOpen()", "full_signature": "private boolean isOpen()", "class_method_signature": "GoogleHadoopSyncableOutputStream.isOpen()", "testcase": false, "constructor": false}, {"identifier": "throwIfNotOpen", "parameters": "()", "modifiers": "private", "return": "void", "signature": "void throwIfNotOpen()", "full_signature": "private void throwIfNotOpen()", "class_method_signature": "GoogleHadoopSyncableOutputStream.throwIfNotOpen()", "testcase": false, "constructor": false}], "file": "gcs/src/main/java/com/google/cloud/hadoop/fs/gcs/GoogleHadoopSyncableOutputStream.java"}, "focal_method": {"identifier": "close", "parameters": "()", "modifiers": "@Override public", "return": "void", "body": "@Override\n  public void close() throws IOException {\n    logger.atFine().log(\n        \"close(): Current tail file: %s final destination: %s\", curGcsPath, finalGcsPath);\n    if (!isOpen()) {\n      logger.atFinest().log(\"close(): Ignoring; stream already closed.\");\n      return;\n    }\n    commitCurrentFile();\n\n    // null denotes stream closed.\n    // TODO(user): Add checks which throw IOException if further operations are attempted on a\n    // closed stream, except for multiple calls to close(), which should behave as no-ops.\n    curGcsPath = null;\n    curDelegate = null;\n\n    logger.atFine().log(\"close(): Awaiting %s deletionFutures\", deletionFutures.size());\n    for (Future<?> deletion : deletionFutures) {\n      try {\n        deletion.get();\n      } catch (ExecutionException | InterruptedException e) {\n        if (e instanceof InterruptedException) {\n          Thread.currentThread().interrupt();\n        }\n        throw new IOException(\"Failed to delete files while closing stream\", e);\n      }\n    }\n  }", "signature": "void close()", "full_signature": "@Override public void close()", "class_method_signature": "GoogleHadoopSyncableOutputStream.close()", "testcase": false, "constructor": false, "invocations": ["log", "atFine", "isOpen", "log", "atFinest", "commitCurrentFile", "log", "atFine", "size", "get", "interrupt", "currentThread"]}, "repository": {"repo_id": 19684359, "url": "https://github.com/GoogleCloudDataproc/bigdata-interop", "stars": 178, "created": "5/12/2014 3:11:55 AM +00:00", "updates": "2020-01-23T23:10:40+00:00", "fork": "False", "license": "licensed"}}