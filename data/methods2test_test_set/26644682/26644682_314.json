{"test_class": {"identifier": "CommandHelperTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final ObjectMapper mapper = new ObjectMapper();", "modifier": "private final", "type": "ObjectMapper", "declarator": "mapper = new ObjectMapper()", "var_name": "mapper"}], "file": "dataprep-backend-service/src/test/java/org/talend/dataprep/command/CommandHelperTest.java"}, "test_case": {"identifier": "testCommandToStreamingWithHeader", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testCommandToStreamingWithHeader() throws Exception {\n        GenericCommand<InputStream> command = new CommandHelperTestCommand();\n\n        final ResponseEntity<StreamingResponseBody> responseEntity = CommandHelper.toStreaming(command);\n        final ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n        responseEntity.getBody().writeTo(outputStream);\n        assertEquals(\"test\", new String(outputStream.toByteArray()));\n        assertEquals(HttpStatus.NO_CONTENT, responseEntity.getStatusCode());\n        assertEquals(\"custom value\", responseEntity.getHeaders().get(\"custom\").get(0));\n    }", "signature": "void testCommandToStreamingWithHeader()", "full_signature": "@Test public void testCommandToStreamingWithHeader()", "class_method_signature": "CommandHelperTest.testCommandToStreamingWithHeader()", "testcase": true, "constructor": false, "invocations": ["toStreaming", "writeTo", "getBody", "assertEquals", "toByteArray", "assertEquals", "getStatusCode", "assertEquals", "get", "get", "getHeaders"]}, "focal_class": {"identifier": "CommandHelper", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(CommandHelper.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(CommandHelper.class)", "var_name": "LOGGER"}], "methods": [{"identifier": "CommandHelper", "parameters": "()", "modifiers": "private", "return": "", "signature": " CommandHelper()", "full_signature": "private  CommandHelper()", "class_method_signature": "CommandHelper.CommandHelper()", "testcase": false, "constructor": true}, {"identifier": "toStreaming", "parameters": "(final HystrixCommand<InputStream> command)", "modifiers": "public static", "return": "StreamingResponseBody", "signature": "StreamingResponseBody toStreaming(final HystrixCommand<InputStream> command)", "full_signature": "public static StreamingResponseBody toStreaming(final HystrixCommand<InputStream> command)", "class_method_signature": "CommandHelper.toStreaming(final HystrixCommand<InputStream> command)", "testcase": false, "constructor": false}, {"identifier": "async", "parameters": "(final GenericCommand<?> command)", "modifiers": "public static", "return": "ResponseEntity<Void>", "signature": "ResponseEntity<Void> async(final GenericCommand<?> command)", "full_signature": "public static ResponseEntity<Void> async(final GenericCommand<?> command)", "class_method_signature": "CommandHelper.async(final GenericCommand<?> command)", "testcase": false, "constructor": false}, {"identifier": "toStreaming", "parameters": "(final GenericCommand<InputStream> command)", "modifiers": "public static", "return": "ResponseEntity<StreamingResponseBody>", "signature": "ResponseEntity<StreamingResponseBody> toStreaming(final GenericCommand<InputStream> command)", "full_signature": "public static ResponseEntity<StreamingResponseBody> toStreaming(final GenericCommand<InputStream> command)", "class_method_signature": "CommandHelper.toStreaming(final GenericCommand<InputStream> command)", "testcase": false, "constructor": false}, {"identifier": "toPublisher", "parameters": "(final Class<T> clazz, final ObjectMapper mapper,\n            final HystrixCommand<InputStream> command)", "modifiers": "public static", "return": "Publisher<T>", "signature": "Publisher<T> toPublisher(final Class<T> clazz, final ObjectMapper mapper,\n            final HystrixCommand<InputStream> command)", "full_signature": "public static Publisher<T> toPublisher(final Class<T> clazz, final ObjectMapper mapper,\n            final HystrixCommand<InputStream> command)", "class_method_signature": "CommandHelper.toPublisher(final Class<T> clazz, final ObjectMapper mapper,\n            final HystrixCommand<InputStream> command)", "testcase": false, "constructor": false}, {"identifier": "toStream", "parameters": "(Class<T> clazz, ObjectMapper mapper, HystrixCommand<InputStream> command)", "modifiers": "public static", "return": "Stream<T>", "signature": "Stream<T> toStream(Class<T> clazz, ObjectMapper mapper, HystrixCommand<InputStream> command)", "full_signature": "public static Stream<T> toStream(Class<T> clazz, ObjectMapper mapper, HystrixCommand<InputStream> command)", "class_method_signature": "CommandHelper.toStream(Class<T> clazz, ObjectMapper mapper, HystrixCommand<InputStream> command)", "testcase": false, "constructor": false}], "file": "dataprep-backend-service/src/main/java/org/talend/dataprep/command/CommandHelper.java"}, "focal_method": {"identifier": "toStreaming", "parameters": "(final HystrixCommand<InputStream> command)", "modifiers": "public static", "return": "StreamingResponseBody", "body": "public static StreamingResponseBody toStreaming(final HystrixCommand<InputStream> command) {\n        return outputStream -> {\n            final Observable<InputStream> stream = command.toObservable();\n            stream.toBlocking().subscribe(inputStream -> {\n                try {\n                    IOUtils.copyLarge(inputStream, outputStream);\n                    outputStream.flush();\n                } catch (IOException e) {\n                    try {\n                        inputStream.close();\n                    } catch (IOException closingException) {\n                        LOGGER.warn(\"could not close command result, a http connection may be leaked !\",\n                                closingException);\n                    }\n                    LOGGER.error(\"Unable to fully copy command result '{}'.\", command.getClass(), e);\n                }\n            }, TDPException::rethrowOrWrap);\n        };\n    }", "signature": "StreamingResponseBody toStreaming(final HystrixCommand<InputStream> command)", "full_signature": "public static StreamingResponseBody toStreaming(final HystrixCommand<InputStream> command)", "class_method_signature": "CommandHelper.toStreaming(final HystrixCommand<InputStream> command)", "testcase": false, "constructor": false, "invocations": ["toObservable", "subscribe", "toBlocking", "copyLarge", "flush", "close", "warn", "error", "getClass"]}, "repository": {"repo_id": 26644682, "url": "https://github.com/Talend/data-prep", "language": "Java", "is_fork": false, "fork_count": 29, "stargazer_count": 53, "size": 70450, "license": "licensed"}}