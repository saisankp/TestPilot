{"test_class": {"identifier": "ArchaiusEffectiveJobDisruptionBudgetResolverTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Job<?> JOB_NOT_SELF_MANAGED = JobGenerator.oneBatchJob();", "modifier": "private static final", "type": "Job<?>", "declarator": "JOB_NOT_SELF_MANAGED = JobGenerator.oneBatchJob()", "var_name": "JOB_NOT_SELF_MANAGED"}, {"original_string": "private static final Job<?> JOB_SELF_MANAGED = JobGenerator.oneBatchJob().but(j ->\n            j.toBuilder()\n                    .withJobDescriptor(j.getJobDescriptor().toBuilder()\n                            .withDisruptionBudget(budget(selfManagedPolicy(1_000), unlimitedRate(), Collections.emptyList()))\n                            .build()\n                    )\n                    .build()\n    );", "modifier": "private static final", "type": "Job<?>", "declarator": "JOB_SELF_MANAGED = JobGenerator.oneBatchJob().but(j ->\n            j.toBuilder()\n                    .withJobDescriptor(j.getJobDescriptor().toBuilder()\n                            .withDisruptionBudget(budget(selfManagedPolicy(1_000), unlimitedRate(), Collections.emptyList()))\n                            .build()\n                    )\n                    .build()\n    )", "var_name": "JOB_SELF_MANAGED"}, {"original_string": "private static final DisruptionBudget FALLBACK_BUDGET_1 = budget(\n            DisruptionBudgetGenerator.perTaskRelocationLimitPolicy(100),\n            DisruptionBudgetGenerator.unlimitedRate(),\n            Collections.emptyList()\n    );", "modifier": "private static final", "type": "DisruptionBudget", "declarator": "FALLBACK_BUDGET_1 = budget(\n            DisruptionBudgetGenerator.perTaskRelocationLimitPolicy(100),\n            DisruptionBudgetGenerator.unlimitedRate(),\n            Collections.emptyList()\n    )", "var_name": "FALLBACK_BUDGET_1"}, {"original_string": "private static final DisruptionBudget FALLBACK_BUDGET_2 = budget(\n            DisruptionBudgetGenerator.perTaskRelocationLimitPolicy(50),\n            DisruptionBudgetGenerator.unlimitedRate(),\n            Collections.emptyList()\n    );", "modifier": "private static final", "type": "DisruptionBudget", "declarator": "FALLBACK_BUDGET_2 = budget(\n            DisruptionBudgetGenerator.perTaskRelocationLimitPolicy(50),\n            DisruptionBudgetGenerator.unlimitedRate(),\n            Collections.emptyList()\n    )", "var_name": "FALLBACK_BUDGET_2"}, {"original_string": "private final EntitySanitizer sanitizer = mock(EntitySanitizer.class);", "modifier": "private final", "type": "EntitySanitizer", "declarator": "sanitizer = mock(EntitySanitizer.class)", "var_name": "sanitizer"}, {"original_string": "private final PropertyRepository repository = mock(PropertyRepository.class);", "modifier": "private final", "type": "PropertyRepository", "declarator": "repository = mock(PropertyRepository.class)", "var_name": "repository"}, {"original_string": "private final StubbedProperty property = new StubbedProperty();", "modifier": "private final", "type": "StubbedProperty", "declarator": "property = new StubbedProperty()", "var_name": "property"}], "file": "titus-server-master/src/test/java/com/netflix/titus/master/eviction/service/quota/job/ArchaiusEffectiveJobDisruptionBudgetResolverTest.java"}, "test_case": {"identifier": "testRefresh", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testRefresh() throws Exception {\n        property.set(toJson(FALLBACK_BUDGET_1));\n\n        ArchaiusEffectiveJobDisruptionBudgetResolver resolver = new ArchaiusEffectiveJobDisruptionBudgetResolver(repository, sanitizer);\n        assertThat(resolver.resolve(JOB_SELF_MANAGED)).isEqualTo(FALLBACK_BUDGET_1);\n\n        property.set(toJson(FALLBACK_BUDGET_2));\n        assertThat(resolver.resolve(JOB_SELF_MANAGED)).isEqualTo(FALLBACK_BUDGET_2);\n    }", "signature": "void testRefresh()", "full_signature": "@Test public void testRefresh()", "class_method_signature": "ArchaiusEffectiveJobDisruptionBudgetResolverTest.testRefresh()", "testcase": true, "constructor": false, "invocations": ["set", "toJson", "isEqualTo", "assertThat", "resolve", "set", "toJson", "isEqualTo", "assertThat", "resolve"]}, "focal_class": {"identifier": "ArchaiusEffectiveJobDisruptionBudgetResolver", "superclass": "", "interfaces": "implements EffectiveJobDisruptionBudgetResolver", "fields": [{"original_string": "private static final Logger logger = LoggerFactory.getLogger(ArchaiusEffectiveJobDisruptionBudgetResolver.class);", "modifier": "private static final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(ArchaiusEffectiveJobDisruptionBudgetResolver.class)", "var_name": "logger"}, {"original_string": "public static final String PROPERTY_KEY = \"titusMaster.eviction.selfManagedFallbackJobDisruptionBudget\";", "modifier": "public static final", "type": "String", "declarator": "PROPERTY_KEY = \"titusMaster.eviction.selfManagedFallbackJobDisruptionBudget\"", "var_name": "PROPERTY_KEY"}, {"original_string": "private static final DisruptionBudget DEFAULT_SELF_MANAGED_FALLBACK_JOB_DISRUPTION_BUDGET = DisruptionBudget.newBuilder()\n            .withDisruptionBudgetPolicy(AvailabilityPercentageLimitDisruptionBudgetPolicy.newBuilder().withPercentageOfHealthyContainers(90).build())\n            .withDisruptionBudgetRate(PercentagePerHourDisruptionBudgetRate.newBuilder().withMaxPercentageOfContainersRelocatedInHour(20).build())\n            .withTimeWindows(Collections.emptyList())\n            .build();", "modifier": "private static final", "type": "DisruptionBudget", "declarator": "DEFAULT_SELF_MANAGED_FALLBACK_JOB_DISRUPTION_BUDGET = DisruptionBudget.newBuilder()\n            .withDisruptionBudgetPolicy(AvailabilityPercentageLimitDisruptionBudgetPolicy.newBuilder().withPercentageOfHealthyContainers(90).build())\n            .withDisruptionBudgetRate(PercentagePerHourDisruptionBudgetRate.newBuilder().withMaxPercentageOfContainersRelocatedInHour(20).build())\n            .withTimeWindows(Collections.emptyList())\n            .build()", "var_name": "DEFAULT_SELF_MANAGED_FALLBACK_JOB_DISRUPTION_BUDGET"}, {"original_string": "private final PropertyRepository repository;", "modifier": "private final", "type": "PropertyRepository", "declarator": "repository", "var_name": "repository"}, {"original_string": "private final EntitySanitizer sanitizer;", "modifier": "private final", "type": "EntitySanitizer", "declarator": "sanitizer", "var_name": "sanitizer"}, {"original_string": "private final AtomicReference<DisruptionBudget> disruptionBudgetRef;", "modifier": "private final", "type": "AtomicReference<DisruptionBudget>", "declarator": "disruptionBudgetRef", "var_name": "disruptionBudgetRef"}, {"original_string": "private final Property.Subscription subscription;", "modifier": "private final", "type": "Property.Subscription", "declarator": "subscription", "var_name": "subscription"}], "methods": [{"identifier": "ArchaiusEffectiveJobDisruptionBudgetResolver", "parameters": "(PropertyRepository repository,\n                                                        @Named(JOB_STRICT_SANITIZER) EntitySanitizer sanitizer)", "modifiers": "@Inject public", "return": "", "signature": " ArchaiusEffectiveJobDisruptionBudgetResolver(PropertyRepository repository,\n                                                        @Named(JOB_STRICT_SANITIZER) EntitySanitizer sanitizer)", "full_signature": "@Inject public  ArchaiusEffectiveJobDisruptionBudgetResolver(PropertyRepository repository,\n                                                        @Named(JOB_STRICT_SANITIZER) EntitySanitizer sanitizer)", "class_method_signature": "ArchaiusEffectiveJobDisruptionBudgetResolver.ArchaiusEffectiveJobDisruptionBudgetResolver(PropertyRepository repository,\n                                                        @Named(JOB_STRICT_SANITIZER) EntitySanitizer sanitizer)", "testcase": false, "constructor": true}, {"identifier": "shutdown", "parameters": "()", "modifiers": "@PreDestroy public", "return": "void", "signature": "void shutdown()", "full_signature": "@PreDestroy public void shutdown()", "class_method_signature": "ArchaiusEffectiveJobDisruptionBudgetResolver.shutdown()", "testcase": false, "constructor": false}, {"identifier": "resolve", "parameters": "(Job<?> job)", "modifiers": "@Override public", "return": "DisruptionBudget", "signature": "DisruptionBudget resolve(Job<?> job)", "full_signature": "@Override public DisruptionBudget resolve(Job<?> job)", "class_method_signature": "ArchaiusEffectiveJobDisruptionBudgetResolver.resolve(Job<?> job)", "testcase": false, "constructor": false}, {"identifier": "refresh", "parameters": "()", "modifiers": "private", "return": "DisruptionBudget", "signature": "DisruptionBudget refresh()", "full_signature": "private DisruptionBudget refresh()", "class_method_signature": "ArchaiusEffectiveJobDisruptionBudgetResolver.refresh()", "testcase": false, "constructor": false}, {"identifier": "parse", "parameters": "(String newValue)", "modifiers": "private", "return": "DisruptionBudget", "signature": "DisruptionBudget parse(String newValue)", "full_signature": "private DisruptionBudget parse(String newValue)", "class_method_signature": "ArchaiusEffectiveJobDisruptionBudgetResolver.parse(String newValue)", "testcase": false, "constructor": false}], "file": "titus-server-master/src/main/java/com/netflix/titus/master/eviction/service/quota/job/ArchaiusEffectiveJobDisruptionBudgetResolver.java"}, "focal_method": {"identifier": "refresh", "parameters": "()", "modifiers": "private", "return": "DisruptionBudget", "body": "private DisruptionBudget refresh() {\n        Property<String> property = repository.get(PROPERTY_KEY, String.class);\n        if (property == null || StringExt.isEmpty(property.get())) {\n            return DEFAULT_SELF_MANAGED_FALLBACK_JOB_DISRUPTION_BUDGET;\n        }\n        try {\n            return parse(property.get());\n        } catch (Exception e) {\n            logger.warn(\"invalid SelfManaged fallback disruption budget configuration ({})\", e.getMessage());\n            return DEFAULT_SELF_MANAGED_FALLBACK_JOB_DISRUPTION_BUDGET;\n        }\n    }", "signature": "DisruptionBudget refresh()", "full_signature": "private DisruptionBudget refresh()", "class_method_signature": "ArchaiusEffectiveJobDisruptionBudgetResolver.refresh()", "testcase": false, "constructor": false, "invocations": ["get", "isEmpty", "get", "parse", "get", "warn", "getMessage"]}, "repository": {"repo_id": 107330274, "url": "https://github.com/Netflix/titus-control-plane", "stars": 241, "created": "10/17/2017 10:20:55 PM +00:00", "updates": "2020-01-25T13:01:05+00:00", "fork": "False", "license": "licensed"}}