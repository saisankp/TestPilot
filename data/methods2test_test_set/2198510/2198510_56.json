{"test_class": {"identifier": "TestHBaseSink", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger logger =\n      LoggerFactory.getLogger(TestHBaseSink.class);", "modifier": "private static final", "type": "Logger", "declarator": "logger =\n      LoggerFactory.getLogger(TestHBaseSink.class)", "var_name": "logger"}, {"original_string": "private static final HBaseTestingUtility testUtility = new HBaseTestingUtility();", "modifier": "private static final", "type": "HBaseTestingUtility", "declarator": "testUtility = new HBaseTestingUtility()", "var_name": "testUtility"}, {"original_string": "private static final String tableName = \"TestHbaseSink\";", "modifier": "private static final", "type": "String", "declarator": "tableName = \"TestHbaseSink\"", "var_name": "tableName"}, {"original_string": "private static final String columnFamily = \"TestColumnFamily\";", "modifier": "private static final", "type": "String", "declarator": "columnFamily = \"TestColumnFamily\"", "var_name": "columnFamily"}, {"original_string": "private static final String inColumn = \"iCol\";", "modifier": "private static final", "type": "String", "declarator": "inColumn = \"iCol\"", "var_name": "inColumn"}, {"original_string": "private static final String plCol = \"pCol\";", "modifier": "private static final", "type": "String", "declarator": "plCol = \"pCol\"", "var_name": "plCol"}, {"original_string": "private static final String valBase = \"testing hbase sink: jham\";", "modifier": "private static final", "type": "String", "declarator": "valBase = \"testing hbase sink: jham\"", "var_name": "valBase"}, {"original_string": "private Configuration conf;", "modifier": "private", "type": "Configuration", "declarator": "conf", "var_name": "conf"}, {"original_string": "private Context ctx;", "modifier": "private", "type": "Context", "declarator": "ctx", "var_name": "ctx"}], "file": "flume-ng-sinks/flume-ng-hbase-sink/src/test/java/org/apache/flume/sink/hbase/TestHBaseSink.java"}, "test_case": {"identifier": "testZKQuorumIncorrectPorts", "parameters": "()", "modifiers": "@Test(expected = FlumeException.class) public", "return": "void", "body": "@Test(expected = FlumeException.class)\n  public void testZKQuorumIncorrectPorts() throws Exception {\n    initContextForSimpleHbaseEventSerializer();\n    Context tmpContext = new Context(ctx.getParameters());\n\n    String zkQuorum = \"zk1.flume.apache.org:3345, zk2.flume.apache.org:3342, \" +\n                      \"zk3.flume.apache.org:3342\";\n    tmpContext.put(\"batchSize\", \"2\");\n    tmpContext.put(HBaseSinkConfigurationConstants.ZK_QUORUM, zkQuorum);\n    tmpContext.put(HBaseSinkConfigurationConstants.ZK_ZNODE_PARENT,\n                   conf.get(HConstants.ZOOKEEPER_ZNODE_PARENT,\n                            HConstants.DEFAULT_ZOOKEEPER_ZNODE_PARENT));\n    HBaseSink sink = new HBaseSink();\n    Configurables.configure(sink, tmpContext);\n    Assert.fail();\n  }", "signature": "void testZKQuorumIncorrectPorts()", "full_signature": "@Test(expected = FlumeException.class) public void testZKQuorumIncorrectPorts()", "class_method_signature": "TestHBaseSink.testZKQuorumIncorrectPorts()", "testcase": true, "constructor": false, "invocations": ["initContextForSimpleHbaseEventSerializer", "getParameters", "put", "put", "put", "get", "configure", "fail"]}, "focal_class": {"identifier": "HBaseSink", "superclass": "extends AbstractSink", "interfaces": "implements Configurable, BatchSizeSupported", "fields": [{"original_string": "private String tableName;", "modifier": "private", "type": "String", "declarator": "tableName", "var_name": "tableName"}, {"original_string": "private byte[] columnFamily;", "modifier": "private", "type": "byte[]", "declarator": "columnFamily", "var_name": "columnFamily"}, {"original_string": "private HTable table;", "modifier": "private", "type": "HTable", "declarator": "table", "var_name": "table"}, {"original_string": "private long batchSize;", "modifier": "private", "type": "long", "declarator": "batchSize", "var_name": "batchSize"}, {"original_string": "private Configuration config;", "modifier": "private", "type": "Configuration", "declarator": "config", "var_name": "config"}, {"original_string": "private static final Logger logger = LoggerFactory.getLogger(HBaseSink.class);", "modifier": "private static final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(HBaseSink.class)", "var_name": "logger"}, {"original_string": "private HbaseEventSerializer serializer;", "modifier": "private", "type": "HbaseEventSerializer", "declarator": "serializer", "var_name": "serializer"}, {"original_string": "private String eventSerializerType;", "modifier": "private", "type": "String", "declarator": "eventSerializerType", "var_name": "eventSerializerType"}, {"original_string": "private Context serializerContext;", "modifier": "private", "type": "Context", "declarator": "serializerContext", "var_name": "serializerContext"}, {"original_string": "private String kerberosPrincipal;", "modifier": "private", "type": "String", "declarator": "kerberosPrincipal", "var_name": "kerberosPrincipal"}, {"original_string": "private String kerberosKeytab;", "modifier": "private", "type": "String", "declarator": "kerberosKeytab", "var_name": "kerberosKeytab"}, {"original_string": "private boolean enableWal = true;", "modifier": "private", "type": "boolean", "declarator": "enableWal = true", "var_name": "enableWal"}, {"original_string": "private boolean batchIncrements = false;", "modifier": "private", "type": "boolean", "declarator": "batchIncrements = false", "var_name": "batchIncrements"}, {"original_string": "private Method refGetFamilyMap = null;", "modifier": "private", "type": "Method", "declarator": "refGetFamilyMap = null", "var_name": "refGetFamilyMap"}, {"original_string": "private SinkCounter sinkCounter;", "modifier": "private", "type": "SinkCounter", "declarator": "sinkCounter", "var_name": "sinkCounter"}, {"original_string": "private PrivilegedExecutor privilegedExecutor;", "modifier": "private", "type": "PrivilegedExecutor", "declarator": "privilegedExecutor", "var_name": "privilegedExecutor"}, {"original_string": "private DebugIncrementsCallback debugIncrCallback = null;", "modifier": "private", "type": "DebugIncrementsCallback", "declarator": "debugIncrCallback = null", "var_name": "debugIncrCallback"}], "methods": [{"identifier": "HBaseSink", "parameters": "()", "modifiers": "public", "return": "", "signature": " HBaseSink()", "full_signature": "public  HBaseSink()", "class_method_signature": "HBaseSink.HBaseSink()", "testcase": false, "constructor": true}, {"identifier": "HBaseSink", "parameters": "(Configuration conf)", "modifiers": "public", "return": "", "signature": " HBaseSink(Configuration conf)", "full_signature": "public  HBaseSink(Configuration conf)", "class_method_signature": "HBaseSink.HBaseSink(Configuration conf)", "testcase": false, "constructor": true}, {"identifier": "HBaseSink", "parameters": "(Configuration conf, DebugIncrementsCallback cb)", "modifiers": "@VisibleForTesting @InterfaceAudience.Private", "return": "", "signature": " HBaseSink(Configuration conf, DebugIncrementsCallback cb)", "full_signature": "@VisibleForTesting @InterfaceAudience.Private  HBaseSink(Configuration conf, DebugIncrementsCallback cb)", "class_method_signature": "HBaseSink.HBaseSink(Configuration conf, DebugIncrementsCallback cb)", "testcase": false, "constructor": true}, {"identifier": "start", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void start()", "full_signature": "@Override public void start()", "class_method_signature": "HBaseSink.start()", "testcase": false, "constructor": false}, {"identifier": "stop", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void stop()", "full_signature": "@Override public void stop()", "class_method_signature": "HBaseSink.stop()", "testcase": false, "constructor": false}, {"identifier": "configure", "parameters": "(Context context)", "modifiers": "@SuppressWarnings(\"unchecked\") @Override public", "return": "void", "signature": "void configure(Context context)", "full_signature": "@SuppressWarnings(\"unchecked\") @Override public void configure(Context context)", "class_method_signature": "HBaseSink.configure(Context context)", "testcase": false, "constructor": false}, {"identifier": "getConfig", "parameters": "()", "modifiers": "public", "return": "Configuration", "signature": "Configuration getConfig()", "full_signature": "public Configuration getConfig()", "class_method_signature": "HBaseSink.getConfig()", "testcase": false, "constructor": false}, {"identifier": "process", "parameters": "()", "modifiers": "@Override public", "return": "Status", "signature": "Status process()", "full_signature": "@Override public Status process()", "class_method_signature": "HBaseSink.process()", "testcase": false, "constructor": false}, {"identifier": "putEventsAndCommit", "parameters": "(final List<Row> actions,\n                                  final List<Increment> incs, Transaction txn)", "modifiers": "private", "return": "void", "signature": "void putEventsAndCommit(final List<Row> actions,\n                                  final List<Increment> incs, Transaction txn)", "full_signature": "private void putEventsAndCommit(final List<Row> actions,\n                                  final List<Increment> incs, Transaction txn)", "class_method_signature": "HBaseSink.putEventsAndCommit(final List<Row> actions,\n                                  final List<Increment> incs, Transaction txn)", "testcase": false, "constructor": false}, {"identifier": "reflectLookupGetFamilyMap", "parameters": "()", "modifiers": "@VisibleForTesting static", "return": "Method", "signature": "Method reflectLookupGetFamilyMap()", "full_signature": "@VisibleForTesting static Method reflectLookupGetFamilyMap()", "class_method_signature": "HBaseSink.reflectLookupGetFamilyMap()", "testcase": false, "constructor": false}, {"identifier": "getFamilyMap", "parameters": "(Increment inc)", "modifiers": "@SuppressWarnings(\"unchecked\") private", "return": "Map<byte[], NavigableMap<byte[], Long>>", "signature": "Map<byte[], NavigableMap<byte[], Long>> getFamilyMap(Increment inc)", "full_signature": "@SuppressWarnings(\"unchecked\") private Map<byte[], NavigableMap<byte[], Long>> getFamilyMap(Increment inc)", "class_method_signature": "HBaseSink.getFamilyMap(Increment inc)", "testcase": false, "constructor": false}, {"identifier": "coalesceIncrements", "parameters": "(Iterable<Increment> incs)", "modifiers": "private", "return": "List<Increment>", "signature": "List<Increment> coalesceIncrements(Iterable<Increment> incs)", "full_signature": "private List<Increment> coalesceIncrements(Iterable<Increment> incs)", "class_method_signature": "HBaseSink.coalesceIncrements(Iterable<Increment> incs)", "testcase": false, "constructor": false}, {"identifier": "incrementCounter", "parameters": "(\n      Map<byte[], Map<byte[], NavigableMap<byte[], Long>>> counters,\n      byte[] row, byte[] family, byte[] qualifier, Long count)", "modifiers": "private", "return": "void", "signature": "void incrementCounter(\n      Map<byte[], Map<byte[], NavigableMap<byte[], Long>>> counters,\n      byte[] row, byte[] family, byte[] qualifier, Long count)", "full_signature": "private void incrementCounter(\n      Map<byte[], Map<byte[], NavigableMap<byte[], Long>>> counters,\n      byte[] row, byte[] family, byte[] qualifier, Long count)", "class_method_signature": "HBaseSink.incrementCounter(\n      Map<byte[], Map<byte[], NavigableMap<byte[], Long>>> counters,\n      byte[] row, byte[] family, byte[] qualifier, Long count)", "testcase": false, "constructor": false}, {"identifier": "getSerializer", "parameters": "()", "modifiers": "@VisibleForTesting @InterfaceAudience.Private", "return": "HbaseEventSerializer", "signature": "HbaseEventSerializer getSerializer()", "full_signature": "@VisibleForTesting @InterfaceAudience.Private HbaseEventSerializer getSerializer()", "class_method_signature": "HBaseSink.getSerializer()", "testcase": false, "constructor": false}, {"identifier": "getBatchSize", "parameters": "()", "modifiers": "@Override public", "return": "long", "signature": "long getBatchSize()", "full_signature": "@Override public long getBatchSize()", "class_method_signature": "HBaseSink.getBatchSize()", "testcase": false, "constructor": false}], "file": "flume-ng-sinks/flume-ng-hbase-sink/src/main/java/org/apache/flume/sink/hbase/HBaseSink.java"}, "focal_method": {"identifier": "configure", "parameters": "(Context context)", "modifiers": "@SuppressWarnings(\"unchecked\") @Override public", "return": "void", "body": "@SuppressWarnings(\"unchecked\")\n  @Override\n  public void configure(Context context) {\n    if (!HBaseVersionCheck.hasVersionLessThan2(logger)) {\n      throw new ConfigurationException(\n          \"HBase major version number must be less than 2 for hbase-sink.\");\n    }\n    tableName = context.getString(HBaseSinkConfigurationConstants.CONFIG_TABLE);\n    String cf = context.getString(\n        HBaseSinkConfigurationConstants.CONFIG_COLUMN_FAMILY);\n    batchSize = context.getLong(\n        HBaseSinkConfigurationConstants.CONFIG_BATCHSIZE, new Long(100));\n    serializerContext = new Context();\n    //If not specified, will use HBase defaults.\n    eventSerializerType = context.getString(\n        HBaseSinkConfigurationConstants.CONFIG_SERIALIZER);\n    Preconditions.checkNotNull(tableName,\n        \"Table name cannot be empty, please specify in configuration file\");\n    Preconditions.checkNotNull(cf,\n        \"Column family cannot be empty, please specify in configuration file\");\n    //Check foe event serializer, if null set event serializer type\n    if (eventSerializerType == null || eventSerializerType.isEmpty()) {\n      eventSerializerType =\n          \"org.apache.flume.sink.hbase.SimpleHbaseEventSerializer\";\n      logger.info(\"No serializer defined, Will use default\");\n    }\n    serializerContext.putAll(context.getSubProperties(\n        HBaseSinkConfigurationConstants.CONFIG_SERIALIZER_PREFIX));\n    columnFamily = cf.getBytes(Charsets.UTF_8);\n    try {\n      Class<? extends HbaseEventSerializer> clazz =\n          (Class<? extends HbaseEventSerializer>)\n              Class.forName(eventSerializerType);\n      serializer = clazz.newInstance();\n      serializer.configure(serializerContext);\n    } catch (Exception e) {\n      logger.error(\"Could not instantiate event serializer.\", e);\n      Throwables.propagate(e);\n    }\n    kerberosKeytab = context.getString(HBaseSinkConfigurationConstants.CONFIG_KEYTAB);\n    kerberosPrincipal = context.getString(HBaseSinkConfigurationConstants.CONFIG_PRINCIPAL);\n\n    enableWal = context.getBoolean(HBaseSinkConfigurationConstants\n        .CONFIG_ENABLE_WAL, HBaseSinkConfigurationConstants.DEFAULT_ENABLE_WAL);\n    logger.info(\"The write to WAL option is set to: \" + String.valueOf(enableWal));\n    if (!enableWal) {\n      logger.warn(\"HBase Sink's enableWal configuration is set to false. All \" +\n          \"writes to HBase will have WAL disabled, and any data in the \" +\n          \"memstore of this region in the Region Server could be lost!\");\n    }\n\n    batchIncrements = context.getBoolean(\n        HBaseSinkConfigurationConstants.CONFIG_COALESCE_INCREMENTS,\n        HBaseSinkConfigurationConstants.DEFAULT_COALESCE_INCREMENTS);\n\n    if (batchIncrements) {\n      logger.info(\"Increment coalescing is enabled. Increments will be \" +\n          \"buffered.\");\n      refGetFamilyMap = reflectLookupGetFamilyMap();\n    }\n\n    String zkQuorum = context.getString(HBaseSinkConfigurationConstants\n        .ZK_QUORUM);\n    Integer port = null;\n    /**\n     * HBase allows multiple nodes in the quorum, but all need to use the\n     * same client port. So get the nodes in host:port format,\n     * and ignore the ports for all nodes except the first one. If no port is\n     * specified, use default.\n     */\n    if (zkQuorum != null && !zkQuorum.isEmpty()) {\n      StringBuilder zkBuilder = new StringBuilder();\n      logger.info(\"Using ZK Quorum: \" + zkQuorum);\n      String[] zkHosts = zkQuorum.split(\",\");\n      int length = zkHosts.length;\n      for (int i = 0; i < length; i++) {\n        String[] zkHostAndPort = zkHosts[i].split(\":\");\n        zkBuilder.append(zkHostAndPort[0].trim());\n        if (i != length - 1) {\n          zkBuilder.append(\",\");\n        } else {\n          zkQuorum = zkBuilder.toString();\n        }\n        if (zkHostAndPort[1] == null) {\n          throw new FlumeException(\"Expected client port for the ZK node!\");\n        }\n        if (port == null) {\n          port = Integer.parseInt(zkHostAndPort[1].trim());\n        } else if (!port.equals(Integer.parseInt(zkHostAndPort[1].trim()))) {\n          throw new FlumeException(\"All Zookeeper nodes in the quorum must \" +\n              \"use the same client port.\");\n        }\n      }\n      if (port == null) {\n        port = HConstants.DEFAULT_ZOOKEPER_CLIENT_PORT;\n      }\n      this.config.set(HConstants.ZOOKEEPER_QUORUM, zkQuorum);\n      this.config.setInt(HConstants.ZOOKEEPER_CLIENT_PORT, port);\n    }\n    String hbaseZnode = context.getString(\n        HBaseSinkConfigurationConstants.ZK_ZNODE_PARENT);\n    if (hbaseZnode != null && !hbaseZnode.isEmpty()) {\n      this.config.set(HConstants.ZOOKEEPER_ZNODE_PARENT, hbaseZnode);\n    }\n    sinkCounter = new SinkCounter(this.getName());\n  }", "signature": "void configure(Context context)", "full_signature": "@SuppressWarnings(\"unchecked\") @Override public void configure(Context context)", "class_method_signature": "HBaseSink.configure(Context context)", "testcase": false, "constructor": false, "invocations": ["hasVersionLessThan2", "getString", "getString", "getLong", "getString", "checkNotNull", "checkNotNull", "isEmpty", "info", "putAll", "getSubProperties", "getBytes", "forName", "newInstance", "configure", "error", "propagate", "getString", "getString", "getBoolean", "info", "valueOf", "warn", "getBoolean", "info", "reflectLookupGetFamilyMap", "getString", "isEmpty", "info", "split", "split", "append", "trim", "append", "toString", "parseInt", "trim", "equals", "parseInt", "trim", "set", "setInt", "getString", "isEmpty", "set", "getName"]}, "repository": {"repo_id": 2198510, "url": "https://github.com/apache/flume", "language": "Java", "is_fork": false, "fork_count": 1372, "stargazer_count": 1971, "size": 44377, "license": "licensed"}}