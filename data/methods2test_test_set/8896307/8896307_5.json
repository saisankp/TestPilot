{"test_class": {"identifier": "WorkspaceResourceTest", "superclass": "extends AbstractModelTest", "interfaces": "", "fields": [], "file": "phantasm-at-rest/src/test/java/com/chiralbehaviors/CoRE/phantasm/resources/WorkspaceResourceTest.java"}, "test_case": {"identifier": "testMeta", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testMeta() throws Exception {\n        WorkspaceResource resource = new WorkspaceResource();\n        assertNotNull(resource.queryMeta(model.getCurrentPrincipal(),\n                                         WellKnownObject.KERNEL_IRI,\n                                         new QueryRequest(getIntrospectionQuery()).asMap(),\n                                         model.create()));\n    }", "signature": "void testMeta()", "full_signature": "@Test public void testMeta()", "class_method_signature": "WorkspaceResourceTest.testMeta()", "testcase": true, "constructor": false, "invocations": ["assertNotNull", "queryMeta", "getCurrentPrincipal", "asMap", "getIntrospectionQuery", "create"]}, "focal_class": {"identifier": "WorkspaceResource", "superclass": "extends TransactionalResource", "interfaces": "", "fields": [{"original_string": "private static final Logger log       = LoggerFactory.getLogger(WorkspaceResource.class);", "modifier": "private static final", "type": "Logger", "declarator": "log       = LoggerFactory.getLogger(WorkspaceResource.class)", "var_name": "log"}, {"original_string": "static final String         QUERY     = \"query\";", "modifier": "static final", "type": "String", "declarator": "QUERY     = \"query\"", "var_name": "QUERY"}, {"original_string": "static final String         VARIABLES = \"variables\";", "modifier": "static final", "type": "String", "declarator": "VARIABLES = \"variables\"", "var_name": "VARIABLES"}, {"original_string": "private final ConcurrentMap<UUID, GraphQLSchema> cache = new ConcurrentHashMap<>();", "modifier": "private final", "type": "ConcurrentMap<UUID, GraphQLSchema>", "declarator": "cache = new ConcurrentHashMap<>()", "var_name": "cache"}, {"original_string": "private final URLClassLoader                     executionScope;", "modifier": "private final", "type": "URLClassLoader", "declarator": "executionScope", "var_name": "executionScope"}, {"original_string": "private final GraphQLSchema                      metaSchema;", "modifier": "private final", "type": "GraphQLSchema", "declarator": "metaSchema", "var_name": "metaSchema"}, {"original_string": "private final ObjectMapper                       objectMapper;", "modifier": "private final", "type": "ObjectMapper", "declarator": "objectMapper", "var_name": "objectMapper"}, {"original_string": "private final Reflections                        reflections;", "modifier": "private final", "type": "Reflections", "declarator": "reflections", "var_name": "reflections"}], "methods": [{"identifier": "getVariables", "parameters": "(Map request)", "modifiers": "@SuppressWarnings({ \"unchecked\", \"rawtypes\" }) public static", "return": "Map<String, Object>", "signature": "Map<String, Object> getVariables(Map request)", "full_signature": "@SuppressWarnings({ \"unchecked\", \"rawtypes\" }) public static Map<String, Object> getVariables(Map request)", "class_method_signature": "WorkspaceResource.getVariables(Map request)", "testcase": false, "constructor": false}, {"identifier": "WorkspaceResource", "parameters": "()", "modifiers": "public", "return": "", "signature": " WorkspaceResource()", "full_signature": "public  WorkspaceResource()", "class_method_signature": "WorkspaceResource.WorkspaceResource()", "testcase": false, "constructor": true}, {"identifier": "WorkspaceResource", "parameters": "(URLClassLoader executionScope)", "modifiers": "public", "return": "", "signature": " WorkspaceResource(URLClassLoader executionScope)", "full_signature": "public  WorkspaceResource(URLClassLoader executionScope)", "class_method_signature": "WorkspaceResource.WorkspaceResource(URLClassLoader executionScope)", "testcase": false, "constructor": true}, {"identifier": "getWorkspaces", "parameters": "(@Auth AuthorizedPrincipal principal,\n                                                   @Context DSLContext create)", "modifiers": "@Timed @GET public", "return": "List<Map<String, Object>>", "signature": "List<Map<String, Object>> getWorkspaces(@Auth AuthorizedPrincipal principal,\n                                                   @Context DSLContext create)", "full_signature": "@Timed @GET public List<Map<String, Object>> getWorkspaces(@Auth AuthorizedPrincipal principal,\n                                                   @Context DSLContext create)", "class_method_signature": "WorkspaceResource.getWorkspaces(@Auth AuthorizedPrincipal principal,\n                                                   @Context DSLContext create)", "testcase": false, "constructor": false}, {"identifier": "loadSnapshot", "parameters": "(@Auth AuthorizedPrincipal principal,\n                             @Context HttpServletRequest request,\n                             InputStream requestBody,\n                             @Context DSLContext create)", "modifiers": "@Timed @Path(\"loadSnapshot\") @POST public", "return": "void", "signature": "void loadSnapshot(@Auth AuthorizedPrincipal principal,\n                             @Context HttpServletRequest request,\n                             InputStream requestBody,\n                             @Context DSLContext create)", "full_signature": "@Timed @Path(\"loadSnapshot\") @POST public void loadSnapshot(@Auth AuthorizedPrincipal principal,\n                             @Context HttpServletRequest request,\n                             InputStream requestBody,\n                             @Context DSLContext create)", "class_method_signature": "WorkspaceResource.loadSnapshot(@Auth AuthorizedPrincipal principal,\n                             @Context HttpServletRequest request,\n                             InputStream requestBody,\n                             @Context DSLContext create)", "testcase": false, "constructor": false}, {"identifier": "loadWorkspace", "parameters": "(@Auth AuthorizedPrincipal principal,\n                                @Context HttpServletRequest request,\n                                InputStream requestBody,\n                                @Context DSLContext create)", "modifiers": "@Timed @Path(\"loadWorkspace\") @POST public", "return": "String", "signature": "String loadWorkspace(@Auth AuthorizedPrincipal principal,\n                                @Context HttpServletRequest request,\n                                InputStream requestBody,\n                                @Context DSLContext create)", "full_signature": "@Timed @Path(\"loadWorkspace\") @POST public String loadWorkspace(@Auth AuthorizedPrincipal principal,\n                                @Context HttpServletRequest request,\n                                InputStream requestBody,\n                                @Context DSLContext create)", "class_method_signature": "WorkspaceResource.loadWorkspace(@Auth AuthorizedPrincipal principal,\n                                @Context HttpServletRequest request,\n                                InputStream requestBody,\n                                @Context DSLContext create)", "testcase": false, "constructor": false}, {"identifier": "manifest", "parameters": "(@Auth AuthorizedPrincipal principal,\n                           @Context HttpServletRequest request,\n                           InputStream requestBody,\n                           @Context DSLContext create)", "modifiers": "@Timed @Path(\"manifest\") @POST public", "return": "String", "signature": "String manifest(@Auth AuthorizedPrincipal principal,\n                           @Context HttpServletRequest request,\n                           InputStream requestBody,\n                           @Context DSLContext create)", "full_signature": "@Timed @Path(\"manifest\") @POST public String manifest(@Auth AuthorizedPrincipal principal,\n                           @Context HttpServletRequest request,\n                           InputStream requestBody,\n                           @Context DSLContext create)", "class_method_signature": "WorkspaceResource.manifest(@Auth AuthorizedPrincipal principal,\n                           @Context HttpServletRequest request,\n                           InputStream requestBody,\n                           @Context DSLContext create)", "testcase": false, "constructor": false}, {"identifier": "workspaceGraphIql", "parameters": "(@Auth AuthorizedPrincipal principal,\n                                    @PathParam(\"workspace\") String workspace)", "modifiers": "@Path(\"{workspace}\") @GET @Produces({ MediaType.TEXT_HTML }) public", "return": "String", "signature": "String workspaceGraphIql(@Auth AuthorizedPrincipal principal,\n                                    @PathParam(\"workspace\") String workspace)", "full_signature": "@Path(\"{workspace}\") @GET @Produces({ MediaType.TEXT_HTML }) public String workspaceGraphIql(@Auth AuthorizedPrincipal principal,\n                                    @PathParam(\"workspace\") String workspace)", "class_method_signature": "WorkspaceResource.workspaceGraphIql(@Auth AuthorizedPrincipal principal,\n                                    @PathParam(\"workspace\") String workspace)", "testcase": false, "constructor": false}, {"identifier": "workspaceMetaGraphIql", "parameters": "(@Auth AuthorizedPrincipal principal,\n                                        @PathParam(\"workspace\") String workspace)", "modifiers": "@Path(\"{workspace}/meta\") @GET @Produces({ MediaType.TEXT_HTML }) public", "return": "String", "signature": "String workspaceMetaGraphIql(@Auth AuthorizedPrincipal principal,\n                                        @PathParam(\"workspace\") String workspace)", "full_signature": "@Path(\"{workspace}/meta\") @GET @Produces({ MediaType.TEXT_HTML }) public String workspaceMetaGraphIql(@Auth AuthorizedPrincipal principal,\n                                        @PathParam(\"workspace\") String workspace)", "class_method_signature": "WorkspaceResource.workspaceMetaGraphIql(@Auth AuthorizedPrincipal principal,\n                                        @PathParam(\"workspace\") String workspace)", "testcase": false, "constructor": false}, {"identifier": "query", "parameters": "(@Auth AuthorizedPrincipal principal,\n                                 @PathParam(\"workspace\") String workspace,\n                                 @SuppressWarnings(\"rawtypes\") Map request,\n                                 @Context DSLContext create)", "modifiers": "@Timed @Path(\"{workspace}\") @POST public", "return": "ExecutionResult", "signature": "ExecutionResult query(@Auth AuthorizedPrincipal principal,\n                                 @PathParam(\"workspace\") String workspace,\n                                 @SuppressWarnings(\"rawtypes\") Map request,\n                                 @Context DSLContext create)", "full_signature": "@Timed @Path(\"{workspace}\") @POST public ExecutionResult query(@Auth AuthorizedPrincipal principal,\n                                 @PathParam(\"workspace\") String workspace,\n                                 @SuppressWarnings(\"rawtypes\") Map request,\n                                 @Context DSLContext create)", "class_method_signature": "WorkspaceResource.query(@Auth AuthorizedPrincipal principal,\n                                 @PathParam(\"workspace\") String workspace,\n                                 @SuppressWarnings(\"rawtypes\") Map request,\n                                 @Context DSLContext create)", "testcase": false, "constructor": false}, {"identifier": "uuidFrom", "parameters": "(String encoded)", "modifiers": "private", "return": "UUID", "signature": "UUID uuidFrom(String encoded)", "full_signature": "private UUID uuidFrom(String encoded)", "class_method_signature": "WorkspaceResource.uuidFrom(String encoded)", "testcase": false, "constructor": false}, {"identifier": "queryMeta", "parameters": "(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @SuppressWarnings(\"rawtypes\") Map request,\n                                     @Context DSLContext create)", "modifiers": "@Timed @Path(\"{workspace}/meta\") @POST public", "return": "ExecutionResult", "signature": "ExecutionResult queryMeta(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @SuppressWarnings(\"rawtypes\") Map request,\n                                     @Context DSLContext create)", "full_signature": "@Timed @Path(\"{workspace}/meta\") @POST public ExecutionResult queryMeta(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @SuppressWarnings(\"rawtypes\") Map request,\n                                     @Context DSLContext create)", "class_method_signature": "WorkspaceResource.queryMeta(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @SuppressWarnings(\"rawtypes\") Map request,\n                                     @Context DSLContext create)", "testcase": false, "constructor": false}, {"identifier": "serializeWorkspace", "parameters": "(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @Context DSLContext create)", "modifiers": "@Timed @Path(\"{workspace}/serialize\") @GET public", "return": "String", "signature": "String serializeWorkspace(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @Context DSLContext create)", "full_signature": "@Timed @Path(\"{workspace}/serialize\") @GET public String serializeWorkspace(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @Context DSLContext create)", "class_method_signature": "WorkspaceResource.serializeWorkspace(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @Context DSLContext create)", "testcase": false, "constructor": false}, {"identifier": "snapshot", "parameters": "(@Auth AuthorizedPrincipal principal,\n                           @Context DSLContext create)", "modifiers": "@Timed @Path(\"snapshot\") @GET public", "return": "String", "signature": "String snapshot(@Auth AuthorizedPrincipal principal,\n                           @Context DSLContext create)", "full_signature": "@Timed @Path(\"snapshot\") @GET public String snapshot(@Auth AuthorizedPrincipal principal,\n                           @Context DSLContext create)", "class_method_signature": "WorkspaceResource.snapshot(@Auth AuthorizedPrincipal principal,\n                           @Context DSLContext create)", "testcase": false, "constructor": false}, {"identifier": "execute", "parameters": "(GraphQLSchema schema, PhantasmContext crud,\n                                    String query,\n                                    Map<String, Object> variables)", "modifiers": "private", "return": "ExecutionResult", "signature": "ExecutionResult execute(GraphQLSchema schema, PhantasmContext crud,\n                                    String query,\n                                    Map<String, Object> variables)", "full_signature": "private ExecutionResult execute(GraphQLSchema schema, PhantasmContext crud,\n                                    String query,\n                                    Map<String, Object> variables)", "class_method_signature": "WorkspaceResource.execute(GraphQLSchema schema, PhantasmContext crud,\n                                    String query,\n                                    Map<String, Object> variables)", "testcase": false, "constructor": false}], "file": "phantasm-at-rest/src/main/java/com/chiralbehaviors/CoRE/phantasm/resources/WorkspaceResource.java"}, "focal_method": {"identifier": "queryMeta", "parameters": "(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @SuppressWarnings(\"rawtypes\") Map request,\n                                     @Context DSLContext create)", "modifiers": "@Timed @Path(\"{workspace}/meta\") @POST public", "return": "ExecutionResult", "body": "@Timed\n    @Path(\"{workspace}/meta\")\n    @POST\n    public ExecutionResult queryMeta(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @SuppressWarnings(\"rawtypes\") Map request,\n                                     @Context DSLContext create) {\n        if (request == null) {\n            throw new WebApplicationException(\"Query request cannot be null\",\n                                              Status.BAD_REQUEST);\n        }\n        if (request.get(QUERY) == null) {\n            throw new WebApplicationException(\"Query cannot be null\",\n                                              Status.BAD_REQUEST);\n        }\n        return mutate(principal, model -> {\n            UUID uuid = uuidFrom(workspace);\n\n            Product definingProduct = model.records()\n                                           .resolve(uuid);\n            if (definingProduct == null) {\n                throw new WebApplicationException(String.format(\"Workspace not found [%s] %s\",\n                                                                uuid,\n                                                                workspace),\n                                                  Status.NOT_FOUND);\n            }\n            MetaContext crud = new MetaContext(model, definingProduct);\n            if (!model.checkRead((UpdatableRecord<?>) definingProduct)\n                || !model.checkRead((UpdatableRecord<?>) definingProduct)) {\n                Agency p = model.getCurrentPrincipal()\n                                .getPrincipal();\n                log.info(String.format(\"Failed executing query on workspace [%s:%s] by: %s:%s\",\n                                       definingProduct.getName(), uuid,\n                                       p.getName(), p.getId()));\n                return null;\n            }\n            Map<String, Object> variables = getVariables(request);\n            ExecutionResult result = crud.execute(metaSchema,\n                                                  (String) request.get(QUERY),\n                                                  variables);\n            if (result.getErrors()\n                      .isEmpty()) {\n                return result;\n            }\n            return result;\n        }, create);\n    }", "signature": "ExecutionResult queryMeta(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @SuppressWarnings(\"rawtypes\") Map request,\n                                     @Context DSLContext create)", "full_signature": "@Timed @Path(\"{workspace}/meta\") @POST public ExecutionResult queryMeta(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @SuppressWarnings(\"rawtypes\") Map request,\n                                     @Context DSLContext create)", "class_method_signature": "WorkspaceResource.queryMeta(@Auth AuthorizedPrincipal principal,\n                                     @PathParam(\"workspace\") String workspace,\n                                     @SuppressWarnings(\"rawtypes\") Map request,\n                                     @Context DSLContext create)", "testcase": false, "constructor": false, "invocations": ["get", "mutate", "uuidFrom", "resolve", "records", "format", "checkRead", "checkRead", "getPrincipal", "getCurrentPrincipal", "info", "format", "getName", "getName", "getId", "getVariables", "execute", "get", "isEmpty", "getErrors"]}, "repository": {"repo_id": 8896307, "url": "https://github.com/ChiralBehaviors/Ultrastructure", "language": "Java", "is_fork": false, "fork_count": 1, "stargazer_count": 5, "size": 22985, "license": "licensed"}}