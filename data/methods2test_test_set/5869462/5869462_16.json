{"test_class": {"identifier": "DHIS2ReportingServiceImplTest", "superclass": "extends\n\t\t\tBaseModuleContextSensitiveTest", "interfaces": "", "fields": [{"original_string": "protected static final String INITIAL_OBS_XML = \"db/ObsServiceTest-initial.xml\";", "modifier": "protected static final", "type": "String", "declarator": "INITIAL_OBS_XML = \"db/ObsServiceTest-initial.xml\"", "var_name": "INITIAL_OBS_XML"}, {"original_string": "protected final Log log = LogFactory.getLog(getClass());", "modifier": "protected final", "type": "Log", "declarator": "log = LogFactory.getLog(getClass())", "var_name": "log"}, {"original_string": "DHIS2ReportingService dhis2ReportingService = null;", "modifier": "", "type": "DHIS2ReportingService", "declarator": "dhis2ReportingService = null", "var_name": "dhis2ReportingService"}], "file": "api/src/test/java/org/openmrs/module/dhisreport/api/impl/DHIS2ReportingServiceImplTest.java"}, "test_case": {"identifier": "evaluateReportDefinition_shouldEvaluateReportDefinition", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n\tpublic void evaluateReportDefinition_shouldEvaluateReportDefinition()\n\t\t\tthrows Exception {\n\n\t\tClassPathResource resource = new ClassPathResource(\n\t\t\t\t\"reportDefinition.xml\");\n\t\tJAXBContext jaxbContext = JAXBContext\n\t\t\t\t.newInstance(ReportTemplates.class);\n\n\t\tUnmarshaller jaxbUnmarshaller = jaxbContext.createUnmarshaller();\n\t\tReportTemplates reportTemplates = (ReportTemplates) jaxbUnmarshaller\n\t\t\t\t.unmarshal(resource.getInputStream());\n\t\tList<ReportDefinition> rds = reportTemplates.getReportDefinitions();\n\t\tString timeperiod = \"2016-06-28\";\n\t\tLocation location = new Location();\n\t\tlocation.setName(\"County General\");\n\t\tlocation.setDescription(\"desc\");\n\t\tlocation.setAddress1(\"address1\");\n\t\tlocation.setId(3);\n\t\tPeriod period = new MonthlyPeriod(new SimpleDateFormat(\"yyyy-MM-dd\")\n\t\t\t\t.parse(timeperiod));\n\t\tSimpleDateFormat dateformat = new SimpleDateFormat(\"yyyy-MM-dd\");\n\t\tString start = \"2016-06-28\";\n\t\tString end = \"2016-06-30\";\n\t\tDate startDate = null;\n\t\tDate endDate = null;\n\n\t\tstartDate = dateformat.parse(start);\n\t\tendDate = dateformat.parse(end);\n\n\t\tperiod.setStartDate(startDate);\n\t\tperiod.setEndDate(endDate);\n\t\tfor (ReportDefinition rd : rds) {\n\t\t\tDataValueSet dvs = dhis2ReportingService.evaluateReportDefinition(\n\t\t\t\t\trd, period, location, false);\n\t\t\tList<DataValue> datavalues = dvs.getDataValues();\n\t\t\tfor (DataValue dv : datavalues) {\n\t\t\t\tassertEquals(\"0\", dv.getValue());\n\t\t\t}\n\n\t\t}\n\n\t\texecuteDataSet(INITIAL_OBS_XML);\n\n\t\tfor (ReportDefinition rd : rds) {\n\t\t\tDataValueSet dvs = dhis2ReportingService.evaluateReportDefinition(\n\t\t\t\t\trd, period, location, false);\n\t\t\tList<DataValue> datavalues = dvs.getDataValues();\n\t\t\tfor (DataValue dv : datavalues) {\n\t\t\t\tassertEquals(\"3\", dv.getValue());\n\t\t\t}\n\n\t\t}\n\n\t}", "signature": "void evaluateReportDefinition_shouldEvaluateReportDefinition()", "full_signature": "@Test public void evaluateReportDefinition_shouldEvaluateReportDefinition()", "class_method_signature": "DHIS2ReportingServiceImplTest.evaluateReportDefinition_shouldEvaluateReportDefinition()", "testcase": true, "constructor": false, "invocations": ["newInstance", "createUnmarshaller", "unmarshal", "getInputStream", "getReportDefinitions", "setName", "setDescription", "setAddress1", "setId", "parse", "parse", "parse", "setStartDate", "setEndDate", "evaluateReportDefinition", "getDataValues", "assertEquals", "getValue", "executeDataSet", "evaluateReportDefinition", "getDataValues", "assertEquals", "getValue"]}, "focal_class": {"identifier": "DHIS2ReportingServiceImpl", "superclass": "extends BaseOpenmrsService", "interfaces": "implements\n\t\t\tDHIS2ReportingService", "fields": [{"original_string": "protected final Log log = LogFactory.getLog(this.getClass());", "modifier": "protected final", "type": "Log", "declarator": "log = LogFactory.getLog(this.getClass())", "var_name": "log"}, {"original_string": "private DHIS2ReportingDAO dao;", "modifier": "private", "type": "DHIS2ReportingDAO", "declarator": "dao", "var_name": "dao"}, {"original_string": "private HttpDhis2Server dhis2Server;", "modifier": "private", "type": "HttpDhis2Server", "declarator": "dhis2Server", "var_name": "dhis2Server"}], "methods": [{"identifier": "setDao", "parameters": "(DHIS2ReportingDAO dao)", "modifiers": "public", "return": "void", "signature": "void setDao(DHIS2ReportingDAO dao)", "full_signature": "public void setDao(DHIS2ReportingDAO dao)", "class_method_signature": "DHIS2ReportingServiceImpl.setDao(DHIS2ReportingDAO dao)", "testcase": false, "constructor": false}, {"identifier": "getDao", "parameters": "()", "modifiers": "public", "return": "DHIS2ReportingDAO", "signature": "DHIS2ReportingDAO getDao()", "full_signature": "public DHIS2ReportingDAO getDao()", "class_method_signature": "DHIS2ReportingServiceImpl.getDao()", "testcase": false, "constructor": false}, {"identifier": "getDhis2Server", "parameters": "()", "modifiers": "@Override public", "return": "HttpDhis2Server", "signature": "HttpDhis2Server getDhis2Server()", "full_signature": "@Override public HttpDhis2Server getDhis2Server()", "class_method_signature": "DHIS2ReportingServiceImpl.getDhis2Server()", "testcase": false, "constructor": false}, {"identifier": "setDhis2Server", "parameters": "(HttpDhis2Server dhis2Server)", "modifiers": "@Override public", "return": "void", "signature": "void setDhis2Server(HttpDhis2Server dhis2Server)", "full_signature": "@Override public void setDhis2Server(HttpDhis2Server dhis2Server)", "class_method_signature": "DHIS2ReportingServiceImpl.setDhis2Server(HttpDhis2Server dhis2Server)", "testcase": false, "constructor": false}, {"identifier": "fetchReportTemplates", "parameters": "()", "modifiers": "@Override public", "return": "ReportDefinition", "signature": "ReportDefinition fetchReportTemplates()", "full_signature": "@Override public ReportDefinition fetchReportTemplates()", "class_method_signature": "DHIS2ReportingServiceImpl.fetchReportTemplates()", "testcase": false, "constructor": false}, {"identifier": "postDataValueSet", "parameters": "(DataValueSet dvset)", "modifiers": "@Override public", "return": "ImportSummary", "signature": "ImportSummary postDataValueSet(DataValueSet dvset)", "full_signature": "@Override public ImportSummary postDataValueSet(DataValueSet dvset)", "class_method_signature": "DHIS2ReportingServiceImpl.postDataValueSet(DataValueSet dvset)", "testcase": false, "constructor": false}, {"identifier": "postAdxReport", "parameters": "(AdxType adxReport)", "modifiers": "@Override public", "return": "AdxImportSummary", "signature": "AdxImportSummary postAdxReport(AdxType adxReport)", "full_signature": "@Override public AdxImportSummary postAdxReport(AdxType adxReport)", "class_method_signature": "DHIS2ReportingServiceImpl.postAdxReport(AdxType adxReport)", "testcase": false, "constructor": false}, {"identifier": "getDataElement", "parameters": "(Integer id)", "modifiers": "@Override public", "return": "DataElement", "signature": "DataElement getDataElement(Integer id)", "full_signature": "@Override public DataElement getDataElement(Integer id)", "class_method_signature": "DHIS2ReportingServiceImpl.getDataElement(Integer id)", "testcase": false, "constructor": false}, {"identifier": "getDataElementByUid", "parameters": "(String uid)", "modifiers": "@Override public", "return": "DataElement", "signature": "DataElement getDataElementByUid(String uid)", "full_signature": "@Override public DataElement getDataElementByUid(String uid)", "class_method_signature": "DHIS2ReportingServiceImpl.getDataElementByUid(String uid)", "testcase": false, "constructor": false}, {"identifier": "getDataElementByCode", "parameters": "(String code)", "modifiers": "@Override public", "return": "DataElement", "signature": "DataElement getDataElementByCode(String code)", "full_signature": "@Override public DataElement getDataElementByCode(String code)", "class_method_signature": "DHIS2ReportingServiceImpl.getDataElementByCode(String code)", "testcase": false, "constructor": false}, {"identifier": "saveDataElement", "parameters": "(DataElement de)", "modifiers": "@Override public", "return": "DataElement", "signature": "DataElement saveDataElement(DataElement de)", "full_signature": "@Override public DataElement saveDataElement(DataElement de)", "class_method_signature": "DHIS2ReportingServiceImpl.saveDataElement(DataElement de)", "testcase": false, "constructor": false}, {"identifier": "purgeDataElement", "parameters": "(DataElement de)", "modifiers": "@Override public", "return": "void", "signature": "void purgeDataElement(DataElement de)", "full_signature": "@Override public void purgeDataElement(DataElement de)", "class_method_signature": "DHIS2ReportingServiceImpl.purgeDataElement(DataElement de)", "testcase": false, "constructor": false}, {"identifier": "getDisaggregation", "parameters": "(Integer id)", "modifiers": "@Override public", "return": "Disaggregation", "signature": "Disaggregation getDisaggregation(Integer id)", "full_signature": "@Override public Disaggregation getDisaggregation(Integer id)", "class_method_signature": "DHIS2ReportingServiceImpl.getDisaggregation(Integer id)", "testcase": false, "constructor": false}, {"identifier": "saveDisaggregation", "parameters": "(Disaggregation disagg)", "modifiers": "@Override public", "return": "Disaggregation", "signature": "Disaggregation saveDisaggregation(Disaggregation disagg)", "full_signature": "@Override public Disaggregation saveDisaggregation(Disaggregation disagg)", "class_method_signature": "DHIS2ReportingServiceImpl.saveDisaggregation(Disaggregation disagg)", "testcase": false, "constructor": false}, {"identifier": "getReportDefinition", "parameters": "(Integer id)", "modifiers": "@Override public", "return": "ReportDefinition", "signature": "ReportDefinition getReportDefinition(Integer id)", "full_signature": "@Override public ReportDefinition getReportDefinition(Integer id)", "class_method_signature": "DHIS2ReportingServiceImpl.getReportDefinition(Integer id)", "testcase": false, "constructor": false}, {"identifier": "getReportDefinitionByUId", "parameters": "(String uid)", "modifiers": "public", "return": "ReportDefinition", "signature": "ReportDefinition getReportDefinitionByUId(String uid)", "full_signature": "public ReportDefinition getReportDefinitionByUId(String uid)", "class_method_signature": "DHIS2ReportingServiceImpl.getReportDefinitionByUId(String uid)", "testcase": false, "constructor": false}, {"identifier": "getReportDefinitionByCode", "parameters": "(String code)", "modifiers": "public", "return": "ReportDefinition", "signature": "ReportDefinition getReportDefinitionByCode(String code)", "full_signature": "public ReportDefinition getReportDefinitionByCode(String code)", "class_method_signature": "DHIS2ReportingServiceImpl.getReportDefinitionByCode(String code)", "testcase": false, "constructor": false}, {"identifier": "saveReportDefinition", "parameters": "(\n\t\t\tReportDefinition reportDefinition)", "modifiers": "@Override public", "return": "ReportDefinition", "signature": "ReportDefinition saveReportDefinition(\n\t\t\tReportDefinition reportDefinition)", "full_signature": "@Override public ReportDefinition saveReportDefinition(\n\t\t\tReportDefinition reportDefinition)", "class_method_signature": "DHIS2ReportingServiceImpl.saveReportDefinition(\n\t\t\tReportDefinition reportDefinition)", "testcase": false, "constructor": false}, {"identifier": "getAllDataElements", "parameters": "()", "modifiers": "@Override public", "return": "Collection<DataElement>", "signature": "Collection<DataElement> getAllDataElements()", "full_signature": "@Override public Collection<DataElement> getAllDataElements()", "class_method_signature": "DHIS2ReportingServiceImpl.getAllDataElements()", "testcase": false, "constructor": false}, {"identifier": "purgeDisaggregation", "parameters": "(Disaggregation disagg)", "modifiers": "@Override public", "return": "void", "signature": "void purgeDisaggregation(Disaggregation disagg)", "full_signature": "@Override public void purgeDisaggregation(Disaggregation disagg)", "class_method_signature": "DHIS2ReportingServiceImpl.purgeDisaggregation(Disaggregation disagg)", "testcase": false, "constructor": false}, {"identifier": "getAllDisaggregations", "parameters": "()", "modifiers": "@Override public", "return": "Collection<Disaggregation>", "signature": "Collection<Disaggregation> getAllDisaggregations()", "full_signature": "@Override public Collection<Disaggregation> getAllDisaggregations()", "class_method_signature": "DHIS2ReportingServiceImpl.getAllDisaggregations()", "testcase": false, "constructor": false}, {"identifier": "purgeReportDefinition", "parameters": "(ReportDefinition rd)", "modifiers": "@Override public", "return": "void", "signature": "void purgeReportDefinition(ReportDefinition rd)", "full_signature": "@Override public void purgeReportDefinition(ReportDefinition rd)", "class_method_signature": "DHIS2ReportingServiceImpl.purgeReportDefinition(ReportDefinition rd)", "testcase": false, "constructor": false}, {"identifier": "getAllReportDefinitions", "parameters": "()", "modifiers": "@Override public", "return": "Collection<ReportDefinition>", "signature": "Collection<ReportDefinition> getAllReportDefinitions()", "full_signature": "@Override public Collection<ReportDefinition> getAllReportDefinitions()", "class_method_signature": "DHIS2ReportingServiceImpl.getAllReportDefinitions()", "testcase": false, "constructor": false}, {"identifier": "evaluateDataValueTemplate", "parameters": "(DataValueTemplate dv,\n\t\t\tPeriod period, Location location)", "modifiers": "@Override public", "return": "String", "signature": "String evaluateDataValueTemplate(DataValueTemplate dv,\n\t\t\tPeriod period, Location location)", "full_signature": "@Override public String evaluateDataValueTemplate(DataValueTemplate dv,\n\t\t\tPeriod period, Location location)", "class_method_signature": "DHIS2ReportingServiceImpl.evaluateDataValueTemplate(DataValueTemplate dv,\n\t\t\tPeriod period, Location location)", "testcase": false, "constructor": false}, {"identifier": "evaluateReportDefinition", "parameters": "(\n\t\t\tReportDefinition reportDefinition, Period period,\n\t\t\tLocation location, boolean priority)", "modifiers": "@Override public", "return": "DataValueSet", "signature": "DataValueSet evaluateReportDefinition(\n\t\t\tReportDefinition reportDefinition, Period period,\n\t\t\tLocation location, boolean priority)", "full_signature": "@Override public DataValueSet evaluateReportDefinition(\n\t\t\tReportDefinition reportDefinition, Period period,\n\t\t\tLocation location, boolean priority)", "class_method_signature": "DHIS2ReportingServiceImpl.evaluateReportDefinition(\n\t\t\tReportDefinition reportDefinition, Period period,\n\t\t\tLocation location, boolean priority)", "testcase": false, "constructor": false}, {"identifier": "generateReportingReportDefinition", "parameters": "(\n\t\t\tReportDefinition reportDefinition, Period period, Location location)", "modifiers": "@Override public", "return": "DataValueSet", "signature": "DataValueSet generateReportingReportDefinition(\n\t\t\tReportDefinition reportDefinition, Period period, Location location)", "full_signature": "@Override public DataValueSet generateReportingReportDefinition(\n\t\t\tReportDefinition reportDefinition, Period period, Location location)", "class_method_signature": "DHIS2ReportingServiceImpl.generateReportingReportDefinition(\n\t\t\tReportDefinition reportDefinition, Period period, Location location)", "testcase": false, "constructor": false}, {"identifier": "saveReportTemplates", "parameters": "(ReportTemplates rt)", "modifiers": "@Override public", "return": "void", "signature": "void saveReportTemplates(ReportTemplates rt)", "full_signature": "@Override public void saveReportTemplates(ReportTemplates rt)", "class_method_signature": "DHIS2ReportingServiceImpl.saveReportTemplates(ReportTemplates rt)", "testcase": false, "constructor": false}, {"identifier": "unMarshallandSaveReportTemplates", "parameters": "(InputStream is)", "modifiers": "public", "return": "void", "signature": "void unMarshallandSaveReportTemplates(InputStream is)", "full_signature": "public void unMarshallandSaveReportTemplates(InputStream is)", "class_method_signature": "DHIS2ReportingServiceImpl.unMarshallandSaveReportTemplates(InputStream is)", "testcase": false, "constructor": false}, {"identifier": "getReportTemplates", "parameters": "()", "modifiers": "@Override public", "return": "ReportTemplates", "signature": "ReportTemplates getReportTemplates()", "full_signature": "@Override public ReportTemplates getReportTemplates()", "class_method_signature": "DHIS2ReportingServiceImpl.getReportTemplates()", "testcase": false, "constructor": false}, {"identifier": "marshallReportTemplates", "parameters": "(OutputStream os, ReportTemplates rt)", "modifiers": "@Override public", "return": "void", "signature": "void marshallReportTemplates(OutputStream os, ReportTemplates rt)", "full_signature": "@Override public void marshallReportTemplates(OutputStream os, ReportTemplates rt)", "class_method_signature": "DHIS2ReportingServiceImpl.marshallReportTemplates(OutputStream os, ReportTemplates rt)", "testcase": false, "constructor": false}, {"identifier": "getDataValueTemplate", "parameters": "(Integer id)", "modifiers": "@Override public", "return": "DataValueTemplate", "signature": "DataValueTemplate getDataValueTemplate(Integer id)", "full_signature": "@Override public DataValueTemplate getDataValueTemplate(Integer id)", "class_method_signature": "DHIS2ReportingServiceImpl.getDataValueTemplate(Integer id)", "testcase": false, "constructor": false}, {"identifier": "saveDataValueTemplate", "parameters": "(DataValueTemplate dvt)", "modifiers": "@Override public", "return": "void", "signature": "void saveDataValueTemplate(DataValueTemplate dvt)", "full_signature": "@Override public void saveDataValueTemplate(DataValueTemplate dvt)", "class_method_signature": "DHIS2ReportingServiceImpl.saveDataValueTemplate(DataValueTemplate dvt)", "testcase": false, "constructor": false}, {"identifier": "saveDataValueTemplateTest", "parameters": "(DataValueTemplate dvt)", "modifiers": "@Override public", "return": "void", "signature": "void saveDataValueTemplateTest(DataValueTemplate dvt)", "full_signature": "@Override public void saveDataValueTemplateTest(DataValueTemplate dvt)", "class_method_signature": "DHIS2ReportingServiceImpl.saveDataValueTemplateTest(DataValueTemplate dvt)", "testcase": false, "constructor": false}, {"identifier": "getLocationByOU_Code", "parameters": "(String OU_Code)", "modifiers": "@Override public", "return": "Location", "signature": "Location getLocationByOU_Code(String OU_Code)", "full_signature": "@Override public Location getLocationByOU_Code(String OU_Code)", "class_method_signature": "DHIS2ReportingServiceImpl.getLocationByOU_Code(String OU_Code)", "testcase": false, "constructor": false}, {"identifier": "getLocationByOrgUnitCode", "parameters": "(String orgUnitCode)", "modifiers": "@Override public", "return": "Location", "signature": "Location getLocationByOrgUnitCode(String orgUnitCode)", "full_signature": "@Override public Location getLocationByOrgUnitCode(String orgUnitCode)", "class_method_signature": "DHIS2ReportingServiceImpl.getLocationByOrgUnitCode(String orgUnitCode)", "testcase": false, "constructor": false}], "file": "api/src/main/java/org/openmrs/module/dhisreport/api/impl/DHIS2ReportingServiceImpl.java"}, "focal_method": {"identifier": "evaluateReportDefinition", "parameters": "(\n\t\t\tReportDefinition reportDefinition, Period period,\n\t\t\tLocation location, boolean priority)", "modifiers": "@Override public", "return": "DataValueSet", "body": "@Override\n\tpublic DataValueSet evaluateReportDefinition(\n\t\t\tReportDefinition reportDefinition, Period period,\n\t\t\tLocation location, boolean priority) {\n\t\tCollection<DataValueTemplate> templates = reportDefinition\n\t\t\t\t.getDataValueTemplates();\n\t\tDataValueSet dataValueSet = new DataValueSet();\n\t\tdataValueSet.setDataElementIdScheme(\"code\");\n\t\tdataValueSet.setOrgUnitIdScheme(\"code\");\n\t\tdataValueSet.setPeriod(period.getAsIsoString());\n\t\t// dataValueSet.setOrgUnit( \"OU_\" + location.getId() ); /* Removed\n\t\t// because will set directly from the controller */\n\t\tdataValueSet.setDataSet(reportDefinition.getCode());\n\n\t\tCollection<DataValue> dataValues = dataValueSet.getDataValues();\n\n\t\tfor (DataValueTemplate dvt : templates) {\n\t\t\tDataValue dataValue = new DataValue();\n\t\t\tdataValue.setDataElement(dvt.getDataelement().getCode());\n\t\t\tdataValue.setCategoryOptionCombo(dvt.getDisaggregation().getCode());\n\n\t\t\ttry {\n\t\t\t\tString value = dao.evaluateDataValueTemplate(dvt, period,\n\t\t\t\t\t\tlocation, priority);\n\t\t\t\tif (value != null) {\n\t\t\t\t\tdataValue.setValue(value);\n\t\t\t\t\tdataValues.add(dataValue);\n\t\t\t\t}\n\t\t\t} catch (DHIS2ReportingException ex) {\n\t\t\t\t// TODO: percolate this through to UI\n\t\t\t\tlog.warn(ex.getMessage());\n\t\t\t}\n\t\t}\n\n\t\treturn dataValueSet;\n\t}", "signature": "DataValueSet evaluateReportDefinition(\n\t\t\tReportDefinition reportDefinition, Period period,\n\t\t\tLocation location, boolean priority)", "full_signature": "@Override public DataValueSet evaluateReportDefinition(\n\t\t\tReportDefinition reportDefinition, Period period,\n\t\t\tLocation location, boolean priority)", "class_method_signature": "DHIS2ReportingServiceImpl.evaluateReportDefinition(\n\t\t\tReportDefinition reportDefinition, Period period,\n\t\t\tLocation location, boolean priority)", "testcase": false, "constructor": false, "invocations": ["getDataValueTemplates", "setDataElementIdScheme", "setOrgUnitIdScheme", "setPeriod", "getAsIsoString", "setDataSet", "getCode", "getDataValues", "setDataElement", "getCode", "getDataelement", "setCategoryOptionCombo", "getCode", "getDisaggregation", "evaluateDataValueTemplate", "setValue", "add", "warn", "getMessage"]}, "repository": {"repo_id": 5869462, "url": "https://github.com/openmrs/openmrs-module-dhisreport", "language": "Java", "is_fork": false, "fork_count": 38, "stargazer_count": 9, "size": 1862, "license": "licensed"}}