{"test_class": {"identifier": "QuotaCheckerTest", "superclass": "", "interfaces": "", "fields": [], "file": "servers/zms/src/test/java/com/yahoo/athenz/zms/QuotaCheckerTest.java"}, "test_case": {"identifier": "testCheckSubDomainQuotaTopLevel", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testCheckSubDomainQuotaTopLevel() {\n        \n        // top level domains have no check\n        QuotaChecker quotaCheck = new QuotaChecker();\n        quotaCheck.checkSubdomainQuota(null, \"athenz\", \"caller\");\n    }", "signature": "void testCheckSubDomainQuotaTopLevel()", "full_signature": "@Test public void testCheckSubDomainQuotaTopLevel()", "class_method_signature": "QuotaCheckerTest.testCheckSubDomainQuotaTopLevel()", "testcase": true, "constructor": false, "invocations": ["checkSubdomainQuota"]}, "focal_class": {"identifier": "QuotaChecker", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final Quota defaultQuota;", "modifier": "private final", "type": "Quota", "declarator": "defaultQuota", "var_name": "defaultQuota"}, {"original_string": "private boolean quotaCheckEnabled;", "modifier": "private", "type": "boolean", "declarator": "quotaCheckEnabled", "var_name": "quotaCheckEnabled"}], "methods": [{"identifier": "QuotaChecker", "parameters": "()", "modifiers": "public", "return": "", "signature": " QuotaChecker()", "full_signature": "public  QuotaChecker()", "class_method_signature": "QuotaChecker.QuotaChecker()", "testcase": false, "constructor": true}, {"identifier": "getDomainQuota", "parameters": "(ObjectStoreConnection con, String domainName)", "modifiers": "public", "return": "Quota", "signature": "Quota getDomainQuota(ObjectStoreConnection con, String domainName)", "full_signature": "public Quota getDomainQuota(ObjectStoreConnection con, String domainName)", "class_method_signature": "QuotaChecker.getDomainQuota(ObjectStoreConnection con, String domainName)", "testcase": false, "constructor": false}, {"identifier": "setQuotaCheckEnabled", "parameters": "(boolean quotaCheckEnabled)", "modifiers": "", "return": "void", "signature": "void setQuotaCheckEnabled(boolean quotaCheckEnabled)", "full_signature": " void setQuotaCheckEnabled(boolean quotaCheckEnabled)", "class_method_signature": "QuotaChecker.setQuotaCheckEnabled(boolean quotaCheckEnabled)", "testcase": false, "constructor": false}, {"identifier": "getListSize", "parameters": "(List<?> list)", "modifiers": "", "return": "int", "signature": "int getListSize(List<?> list)", "full_signature": " int getListSize(List<?> list)", "class_method_signature": "QuotaChecker.getListSize(List<?> list)", "testcase": false, "constructor": false}, {"identifier": "checkSubdomainQuota", "parameters": "(ObjectStoreConnection con, String domainName, String caller)", "modifiers": "", "return": "void", "signature": "void checkSubdomainQuota(ObjectStoreConnection con, String domainName, String caller)", "full_signature": " void checkSubdomainQuota(ObjectStoreConnection con, String domainName, String caller)", "class_method_signature": "QuotaChecker.checkSubdomainQuota(ObjectStoreConnection con, String domainName, String caller)", "testcase": false, "constructor": false}, {"identifier": "checkRoleQuota", "parameters": "(ObjectStoreConnection con, String domainName, Role role, String caller)", "modifiers": "", "return": "void", "signature": "void checkRoleQuota(ObjectStoreConnection con, String domainName, Role role, String caller)", "full_signature": " void checkRoleQuota(ObjectStoreConnection con, String domainName, Role role, String caller)", "class_method_signature": "QuotaChecker.checkRoleQuota(ObjectStoreConnection con, String domainName, Role role, String caller)", "testcase": false, "constructor": false}, {"identifier": "checkGroupQuota", "parameters": "(ObjectStoreConnection con, String domainName, Group group, String caller)", "modifiers": "", "return": "void", "signature": "void checkGroupQuota(ObjectStoreConnection con, String domainName, Group group, String caller)", "full_signature": " void checkGroupQuota(ObjectStoreConnection con, String domainName, Group group, String caller)", "class_method_signature": "QuotaChecker.checkGroupQuota(ObjectStoreConnection con, String domainName, Group group, String caller)", "testcase": false, "constructor": false}, {"identifier": "checkRoleMembershipQuota", "parameters": "(ObjectStoreConnection con, String domainName,\n            String roleName, String caller)", "modifiers": "", "return": "void", "signature": "void checkRoleMembershipQuota(ObjectStoreConnection con, String domainName,\n            String roleName, String caller)", "full_signature": " void checkRoleMembershipQuota(ObjectStoreConnection con, String domainName,\n            String roleName, String caller)", "class_method_signature": "QuotaChecker.checkRoleMembershipQuota(ObjectStoreConnection con, String domainName,\n            String roleName, String caller)", "testcase": false, "constructor": false}, {"identifier": "checkGroupMembershipQuota", "parameters": "(ObjectStoreConnection con, String domainName,\n                                  String groupName, String caller)", "modifiers": "", "return": "void", "signature": "void checkGroupMembershipQuota(ObjectStoreConnection con, String domainName,\n                                  String groupName, String caller)", "full_signature": " void checkGroupMembershipQuota(ObjectStoreConnection con, String domainName,\n                                  String groupName, String caller)", "class_method_signature": "QuotaChecker.checkGroupMembershipQuota(ObjectStoreConnection con, String domainName,\n                                  String groupName, String caller)", "testcase": false, "constructor": false}, {"identifier": "checkPolicyQuota", "parameters": "(ObjectStoreConnection con, String domainName, Policy policy, String caller)", "modifiers": "", "return": "void", "signature": "void checkPolicyQuota(ObjectStoreConnection con, String domainName, Policy policy, String caller)", "full_signature": " void checkPolicyQuota(ObjectStoreConnection con, String domainName, Policy policy, String caller)", "class_method_signature": "QuotaChecker.checkPolicyQuota(ObjectStoreConnection con, String domainName, Policy policy, String caller)", "testcase": false, "constructor": false}, {"identifier": "checkPolicyAssertionQuota", "parameters": "(ObjectStoreConnection con, String domainName,\n            String policyName, String caller)", "modifiers": "", "return": "void", "signature": "void checkPolicyAssertionQuota(ObjectStoreConnection con, String domainName,\n            String policyName, String caller)", "full_signature": " void checkPolicyAssertionQuota(ObjectStoreConnection con, String domainName,\n            String policyName, String caller)", "class_method_signature": "QuotaChecker.checkPolicyAssertionQuota(ObjectStoreConnection con, String domainName,\n            String policyName, String caller)", "testcase": false, "constructor": false}, {"identifier": "checkServiceIdentityQuota", "parameters": "(ObjectStoreConnection con, String domainName,\n            ServiceIdentity service, String caller)", "modifiers": "", "return": "void", "signature": "void checkServiceIdentityQuota(ObjectStoreConnection con, String domainName,\n            ServiceIdentity service, String caller)", "full_signature": " void checkServiceIdentityQuota(ObjectStoreConnection con, String domainName,\n            ServiceIdentity service, String caller)", "class_method_signature": "QuotaChecker.checkServiceIdentityQuota(ObjectStoreConnection con, String domainName,\n            ServiceIdentity service, String caller)", "testcase": false, "constructor": false}, {"identifier": "checkServiceIdentityPublicKeyQuota", "parameters": "(ObjectStoreConnection con, String domainName,\n            String serviceName, String caller)", "modifiers": "", "return": "void", "signature": "void checkServiceIdentityPublicKeyQuota(ObjectStoreConnection con, String domainName,\n            String serviceName, String caller)", "full_signature": " void checkServiceIdentityPublicKeyQuota(ObjectStoreConnection con, String domainName,\n            String serviceName, String caller)", "class_method_signature": "QuotaChecker.checkServiceIdentityPublicKeyQuota(ObjectStoreConnection con, String domainName,\n            String serviceName, String caller)", "testcase": false, "constructor": false}, {"identifier": "checkEntityQuota", "parameters": "(ObjectStoreConnection con, String domainName, Entity entity,\n            String caller)", "modifiers": "", "return": "void", "signature": "void checkEntityQuota(ObjectStoreConnection con, String domainName, Entity entity,\n            String caller)", "full_signature": " void checkEntityQuota(ObjectStoreConnection con, String domainName, Entity entity,\n            String caller)", "class_method_signature": "QuotaChecker.checkEntityQuota(ObjectStoreConnection con, String domainName, Entity entity,\n            String caller)", "testcase": false, "constructor": false}], "file": "servers/zms/src/main/java/com/yahoo/athenz/zms/QuotaChecker.java"}, "focal_method": {"identifier": "checkSubdomainQuota", "parameters": "(ObjectStoreConnection con, String domainName, String caller)", "modifiers": "", "return": "void", "body": "void checkSubdomainQuota(ObjectStoreConnection con, String domainName, String caller) {\n        \n        // if quota check is disabled we have nothing to do\n        \n        if (!quotaCheckEnabled) {\n            return;\n        }\n        \n        // for sub-domains we need to run the quota check against\n        // the top level domain so let's get that first. If we are\n        // creating a top level domain then there is no need for\n        // quota check\n        \n        int idx = domainName.indexOf('.');\n        if (idx == -1) {\n            return;\n        }\n        \n        final String topLevelDomain = domainName.substring(0, idx);\n        \n        // now get the quota for the top level domain\n        \n        final Quota quota = getDomainQuota(con, topLevelDomain);\n        \n        // get the list of sub-domains for our given top level domain\n        \n        final String domainPrefix = topLevelDomain + \".\";\n        int objectCount = con.listDomains(domainPrefix, 0).size() + 1;\n\n        if (quota.getSubdomain() < objectCount) {\n            throw ZMSUtils.quotaLimitError(\"subdomain quota exceeded - limit: \"\n                    + quota.getSubdomain() + \" actual: \" + objectCount, caller);\n        }\n    }", "signature": "void checkSubdomainQuota(ObjectStoreConnection con, String domainName, String caller)", "full_signature": " void checkSubdomainQuota(ObjectStoreConnection con, String domainName, String caller)", "class_method_signature": "QuotaChecker.checkSubdomainQuota(ObjectStoreConnection con, String domainName, String caller)", "testcase": false, "constructor": false, "invocations": ["indexOf", "substring", "getDomainQuota", "size", "listDomains", "getSubdomain", "quotaLimitError", "getSubdomain"]}, "repository": {"repo_id": 73948366, "url": "https://github.com/yahoo/athenz", "stars": 394, "created": "11/16/2016 6:23:08 PM +00:00", "updates": "2020-01-27T15:36:13+00:00", "fork": "False", "license": "licensed"}}