{"test_class": {"identifier": "InMemoryTimeoutManagerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final HeaderName<String> DEFAULT_HEADER = HeaderName.forName(\"defaultHeaderName\");", "modifier": "private static final", "type": "HeaderName<String>", "declarator": "DEFAULT_HEADER = HeaderName.forName(\"defaultHeaderName\")", "var_name": "DEFAULT_HEADER"}, {"original_string": "private static final String DEFAULT_HEADER_VALUE = \"ContextHeaderValue\";", "modifier": "private static final", "type": "String", "declarator": "DEFAULT_HEADER_VALUE = \"ContextHeaderValue\"", "var_name": "DEFAULT_HEADER_VALUE"}, {"original_string": "private InMemoryTimeoutManager sut;", "modifier": "private", "type": "InMemoryTimeoutManager", "declarator": "sut", "var_name": "sut"}, {"original_string": "private ScheduledExecutorService executor;", "modifier": "private", "type": "ScheduledExecutorService", "declarator": "executor", "var_name": "executor"}, {"original_string": "private Clock clock;", "modifier": "private", "type": "Clock", "declarator": "clock", "var_name": "clock"}], "file": "saga-lib/src/test/java/com/codebullets/sagalib/timeout/InMemoryTimeoutManagerTest.java"}, "test_case": {"identifier": "requestTimeout_TimeoutMessage_schedulesTimeoutTask", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void requestTimeout_TimeoutMessage_schedulesTimeoutTask() {\n        // given\n        long timeoutInSec = 5;\n\n        // when\n        sut.requestTimeout(mockContext(), \"anySagaId\", timeoutInSec, TimeUnit.SECONDS, \"anyName\", null);\n\n        // then\n        ArgumentCaptor<SagaTimeoutTask> captor = ArgumentCaptor.forClass(SagaTimeoutTask.class);\n        verify(executor).schedule(captor.capture(), eq(timeoutInSec), eq(TimeUnit.SECONDS));\n\n        assertThat(\"Scheduled task not of expected type.\", captor.getValue(), instanceOf(SagaTimeoutTask.class));\n    }", "signature": "void requestTimeout_TimeoutMessage_schedulesTimeoutTask()", "full_signature": "@Test public void requestTimeout_TimeoutMessage_schedulesTimeoutTask()", "class_method_signature": "InMemoryTimeoutManagerTest.requestTimeout_TimeoutMessage_schedulesTimeoutTask()", "testcase": true, "constructor": false, "invocations": ["requestTimeout", "mockContext", "forClass", "schedule", "verify", "capture", "eq", "eq", "assertThat", "getValue", "instanceOf"]}, "focal_class": {"identifier": "InMemoryTimeoutManager", "superclass": "", "interfaces": "implements TimeoutManager, AutoCloseable", "fields": [{"original_string": "private static final Logger LOG = LoggerFactory.getLogger(InMemoryTimeoutManager.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOG = LoggerFactory.getLogger(InMemoryTimeoutManager.class)", "var_name": "LOG"}, {"original_string": "private static final int TIMER_THREAD_POOL_SIZE = 2;", "modifier": "private static final", "type": "int", "declarator": "TIMER_THREAD_POOL_SIZE = 2", "var_name": "TIMER_THREAD_POOL_SIZE"}, {"original_string": "private final Object sync = new Object();", "modifier": "private final", "type": "Object", "declarator": "sync = new Object()", "var_name": "sync"}, {"original_string": "private final Collection<TimeoutExpired> callbacks = Collections.synchronizedCollection(new ArrayList<>());", "modifier": "private final", "type": "Collection<TimeoutExpired>", "declarator": "callbacks = Collections.synchronizedCollection(new ArrayList<>())", "var_name": "callbacks"}, {"original_string": "private final Table<TimeoutId, String, ScheduledFuture> openTimeouts = HashBasedTable.create();", "modifier": "private final", "type": "Table<TimeoutId, String, ScheduledFuture>", "declarator": "openTimeouts = HashBasedTable.create()", "var_name": "openTimeouts"}, {"original_string": "private final ScheduledExecutorService scheduledService;", "modifier": "private final", "type": "ScheduledExecutorService", "declarator": "scheduledService", "var_name": "scheduledService"}, {"original_string": "private final Clock clock;", "modifier": "private final", "type": "Clock", "declarator": "clock", "var_name": "clock"}], "methods": [{"identifier": "InMemoryTimeoutManager", "parameters": "()", "modifiers": "public", "return": "", "signature": " InMemoryTimeoutManager()", "full_signature": "public  InMemoryTimeoutManager()", "class_method_signature": "InMemoryTimeoutManager.InMemoryTimeoutManager()", "testcase": false, "constructor": true}, {"identifier": "InMemoryTimeoutManager", "parameters": "(final int timerThreadPoolSize)", "modifiers": "public", "return": "", "signature": " InMemoryTimeoutManager(final int timerThreadPoolSize)", "full_signature": "public  InMemoryTimeoutManager(final int timerThreadPoolSize)", "class_method_signature": "InMemoryTimeoutManager.InMemoryTimeoutManager(final int timerThreadPoolSize)", "testcase": false, "constructor": true}, {"identifier": "InMemoryTimeoutManager", "parameters": "(final ScheduledExecutorService scheduledService, final Clock clock)", "modifiers": "public", "return": "", "signature": " InMemoryTimeoutManager(final ScheduledExecutorService scheduledService, final Clock clock)", "full_signature": "public  InMemoryTimeoutManager(final ScheduledExecutorService scheduledService, final Clock clock)", "class_method_signature": "InMemoryTimeoutManager.InMemoryTimeoutManager(final ScheduledExecutorService scheduledService, final Clock clock)", "testcase": false, "constructor": true}, {"identifier": "addExpiredCallback", "parameters": "(final TimeoutExpired callback)", "modifiers": "@Override public", "return": "void", "signature": "void addExpiredCallback(final TimeoutExpired callback)", "full_signature": "@Override public void addExpiredCallback(final TimeoutExpired callback)", "class_method_signature": "InMemoryTimeoutManager.addExpiredCallback(final TimeoutExpired callback)", "testcase": false, "constructor": false}, {"identifier": "requestTimeout", "parameters": "(final ExecutionContext context, final String sagaId, final long delay, final TimeUnit timeUnit, @Nullable final String name,\n                               @Nullable final Object data)", "modifiers": "@Override public", "return": "TimeoutId", "signature": "TimeoutId requestTimeout(final ExecutionContext context, final String sagaId, final long delay, final TimeUnit timeUnit, @Nullable final String name,\n                               @Nullable final Object data)", "full_signature": "@Override public TimeoutId requestTimeout(final ExecutionContext context, final String sagaId, final long delay, final TimeUnit timeUnit, @Nullable final String name,\n                               @Nullable final Object data)", "class_method_signature": "InMemoryTimeoutManager.requestTimeout(final ExecutionContext context, final String sagaId, final long delay, final TimeUnit timeUnit, @Nullable final String name,\n                               @Nullable final Object data)", "testcase": false, "constructor": false}, {"identifier": "cancelTimeouts", "parameters": "(final String sagaId)", "modifiers": "@Override public", "return": "void", "signature": "void cancelTimeouts(final String sagaId)", "full_signature": "@Override public void cancelTimeouts(final String sagaId)", "class_method_signature": "InMemoryTimeoutManager.cancelTimeouts(final String sagaId)", "testcase": false, "constructor": false}, {"identifier": "cancelTimeout", "parameters": "(final TimeoutId id)", "modifiers": "@Override public", "return": "void", "signature": "void cancelTimeout(final TimeoutId id)", "full_signature": "@Override public void cancelTimeout(final TimeoutId id)", "class_method_signature": "InMemoryTimeoutManager.cancelTimeout(final TimeoutId id)", "testcase": false, "constructor": false}, {"identifier": "timeoutExpired", "parameters": "(final Timeout timeout, final TimeoutContext context)", "modifiers": "private", "return": "void", "signature": "void timeoutExpired(final Timeout timeout, final TimeoutContext context)", "full_signature": "private void timeoutExpired(final Timeout timeout, final TimeoutContext context)", "class_method_signature": "InMemoryTimeoutManager.timeoutExpired(final Timeout timeout, final TimeoutContext context)", "testcase": false, "constructor": false}, {"identifier": "removeExpiredTimeout", "parameters": "(final Timeout timeout)", "modifiers": "private", "return": "void", "signature": "void removeExpiredTimeout(final Timeout timeout)", "full_signature": "private void removeExpiredTimeout(final Timeout timeout)", "class_method_signature": "InMemoryTimeoutManager.removeExpiredTimeout(final Timeout timeout)", "testcase": false, "constructor": false}, {"identifier": "close", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void close()", "full_signature": "@Override public void close()", "class_method_signature": "InMemoryTimeoutManager.close()", "testcase": false, "constructor": false}], "file": "saga-lib/src/main/java/com/codebullets/sagalib/timeout/InMemoryTimeoutManager.java"}, "focal_method": {"identifier": "requestTimeout", "parameters": "(final ExecutionContext context, final String sagaId, final long delay, final TimeUnit timeUnit, @Nullable final String name,\n                               @Nullable final Object data)", "modifiers": "@Override public", "return": "TimeoutId", "body": "@Override\n    public TimeoutId requestTimeout(final ExecutionContext context, final String sagaId, final long delay, final TimeUnit timeUnit, @Nullable final String name,\n                               @Nullable final Object data) {\n        checkNotNull(sagaId, \"SagaId not allowed to be null.\");\n        UUIDTimeoutId id = UUIDTimeoutId.generateNewId();\n        TimeoutContext timeoutContext = new TimeoutContext(context.getAllHeaders());\n\n        SagaTimeoutTask timeoutTask = new SagaTimeoutTask(id, sagaId, name, timeout -> timeoutExpired(timeout, timeoutContext), clock, data);\n        ScheduledFuture future = scheduledService.schedule(timeoutTask, delay, timeUnit);\n\n        synchronized (sync) {\n            openTimeouts.put(id, sagaId, future);\n        }\n\n        return id;\n    }", "signature": "TimeoutId requestTimeout(final ExecutionContext context, final String sagaId, final long delay, final TimeUnit timeUnit, @Nullable final String name,\n                               @Nullable final Object data)", "full_signature": "@Override public TimeoutId requestTimeout(final ExecutionContext context, final String sagaId, final long delay, final TimeUnit timeUnit, @Nullable final String name,\n                               @Nullable final Object data)", "class_method_signature": "InMemoryTimeoutManager.requestTimeout(final ExecutionContext context, final String sagaId, final long delay, final TimeUnit timeUnit, @Nullable final String name,\n                               @Nullable final Object data)", "testcase": false, "constructor": false, "invocations": ["checkNotNull", "generateNewId", "getAllHeaders", "timeoutExpired", "schedule", "put"]}, "repository": {"repo_id": 10566148, "url": "https://github.com/Domo42/saga-lib", "language": "Java", "is_fork": false, "fork_count": 12, "stargazer_count": 32, "size": 545, "license": "licensed"}}