{"test_class": {"identifier": "LogTelnetHandlerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static TelnetHandler log = new LogTelnetHandler();", "modifier": "private static", "type": "TelnetHandler", "declarator": "log = new LogTelnetHandler()", "var_name": "log"}, {"original_string": "private Channel mockChannel;", "modifier": "private", "type": "Channel", "declarator": "mockChannel", "var_name": "mockChannel"}], "file": "dubbo-rpc/dubbo-rpc-dubbo/src/test/java/com/alibaba/dubbo/rpc/protocol/dubbo/telnet/LogTelnetHandlerTest.java"}, "test_case": {"identifier": "testChangeLogLevel", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testChangeLogLevel() throws RemotingException {\n        mockChannel = mock(Channel.class);\n\n        String result = log.telnet(mockChannel, \"error\");\n        assertTrue(result.contains(\"\\r\\nCURRENT LOG LEVEL:ERROR\"));\n        String result2 = log.telnet(mockChannel, \"warn\");\n        assertTrue(result2.contains(\"\\r\\nCURRENT LOG LEVEL:WARN\"));\n    }", "signature": "void testChangeLogLevel()", "full_signature": "@Test public void testChangeLogLevel()", "class_method_signature": "LogTelnetHandlerTest.testChangeLogLevel()", "testcase": true, "constructor": false, "invocations": ["mock", "telnet", "assertTrue", "contains", "telnet", "assertTrue", "contains"]}, "focal_class": {"identifier": "LogTelnetHandler", "superclass": "", "interfaces": "implements TelnetHandler", "fields": [{"original_string": "public static final String SERVICE_KEY = \"telnet.log\";", "modifier": "public static final", "type": "String", "declarator": "SERVICE_KEY = \"telnet.log\"", "var_name": "SERVICE_KEY"}], "methods": [{"identifier": "telnet", "parameters": "(Channel channel, String message)", "modifiers": "@Override public", "return": "String", "signature": "String telnet(Channel channel, String message)", "full_signature": "@Override public String telnet(Channel channel, String message)", "class_method_signature": "LogTelnetHandler.telnet(Channel channel, String message)", "testcase": false, "constructor": false}], "file": "dubbo-rpc/dubbo-rpc-dubbo/src/main/java/com/alibaba/dubbo/rpc/protocol/dubbo/telnet/LogTelnetHandler.java"}, "focal_method": {"identifier": "telnet", "parameters": "(Channel channel, String message)", "modifiers": "@Override public", "return": "String", "body": "@Override\n    public String telnet(Channel channel, String message) {\n        long size = 0;\n        File file = LoggerFactory.getFile();\n        StringBuffer buf = new StringBuffer();\n        if (message == null || message.trim().length() == 0) {\n            buf.append(\"EXAMPLE: log error / log 100\");\n        } else {\n            String str[] = message.split(\" \");\n            if (!StringUtils.isInteger(str[0])) {\n                LoggerFactory.setLevel(Level.valueOf(message.toUpperCase()));\n            } else {\n                int SHOW_LOG_LENGTH = Integer.parseInt(str[0]);\n\n                if (file != null && file.exists()) {\n                    try {\n                        FileInputStream fis = new FileInputStream(file);\n                        FileChannel filechannel = fis.getChannel();\n                        size = filechannel.size();\n                        ByteBuffer bb;\n                        if (size <= SHOW_LOG_LENGTH) {\n                            bb = ByteBuffer.allocate((int) size);\n                            filechannel.read(bb, 0);\n                        } else {\n                            int pos = (int) (size - SHOW_LOG_LENGTH);\n                            bb = ByteBuffer.allocate(SHOW_LOG_LENGTH);\n                            filechannel.read(bb, pos);\n                        }\n                        bb.flip();\n                        String content = new String(bb.array()).replace(\"<\", \"&lt;\")\n                                .replace(\">\", \"&gt;\").replace(\"\\n\", \"<br/><br/>\");\n                        buf.append(\"\\r\\ncontent:\" + content);\n\n                        buf.append(\"\\r\\nmodified:\" + (new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\")\n                                .format(new Date(file.lastModified()))));\n                        buf.append(\"\\r\\nsize:\" + size + \"\\r\\n\");\n                    } catch (Exception e) {\n                        buf.append(e.getMessage());\n                    }\n                } else {\n                    size = 0;\n                    buf.append(\"\\r\\nMESSAGE: log file not exists or log appender is console .\");\n                }\n            }\n        }\n        buf.append(\"\\r\\nCURRENT LOG LEVEL:\" + LoggerFactory.getLevel())\n                .append(\"\\r\\nCURRENT LOG APPENDER:\" + (file == null ? \"console\" : file.getAbsolutePath()));\n        return buf.toString();\n    }", "signature": "String telnet(Channel channel, String message)", "full_signature": "@Override public String telnet(Channel channel, String message)", "class_method_signature": "LogTelnetHandler.telnet(Channel channel, String message)", "testcase": false, "constructor": false, "invocations": ["getFile", "length", "trim", "append", "split", "isInteger", "setLevel", "valueOf", "toUpperCase", "parseInt", "exists", "getChannel", "size", "allocate", "read", "allocate", "read", "flip", "replace", "replace", "replace", "array", "append", "append", "format", "lastModified", "append", "append", "getMessage", "append", "append", "append", "getLevel", "getAbsolutePath", "toString"]}, "repository": {"repo_id": 189562861, "url": "https://github.com/smallFive55/dubbo-dubbo-2.6.6", "language": "Java", "is_fork": false, "fork_count": 11, "stargazer_count": 8, "size": 1428, "license": "licensed"}}