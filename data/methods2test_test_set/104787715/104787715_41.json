{"test_class": {"identifier": "GitHubUtilTest", "superclass": "", "interfaces": "", "fields": [], "file": "dockerfile-image-update/src/test/java/com/salesforce/dockerfileimageupdate/utils/GitHubUtilTest.java"}, "test_case": {"identifier": "testGetGHRepositories", "parameters": "()", "modifiers": "@Test(timeOut = 1000) public", "return": "void", "body": "@Test(timeOut = 1000)\n    public void testGetGHRepositories() throws Exception {\n\n        Multimap<String, String> parentToPath = HashMultimap.create();\n        parentToPath.put(\"test1\", \"test\");\n        parentToPath.put(\"test2\", \"correct\");\n        parentToPath.put(\"test3\", \"test\");\n        parentToPath.put(\"test4\", \"test\");\n\n        GHMyself currentUser = mock(GHMyself.class);\n        PagedIterable<GHRepository> listOfRepos = mock(PagedIterable.class);\n\n        GHRepository repo1 = mock(GHRepository.class);\n        when(repo1.getName()).thenReturn(\"test1\");\n        GHRepository repo2 = mock(GHRepository.class);\n        when(repo2.getName()).thenReturn(\"test2\");\n        GHRepository repo3 = mock(GHRepository.class);\n        when(repo3.getName()).thenReturn(\"test3\");\n        GHRepository repo4 = mock(GHRepository.class);\n        when(repo4.getName()).thenReturn(\"test4\");\n\n        PagedIterator<GHRepository> listOfReposIterator = mock(PagedIterator.class);\n        when(listOfReposIterator.hasNext()).thenReturn(true, true, true, true, false);\n        /* Uncomment below and check if it times out. */\n//        Mockito.when(listOfReposIterator.hasNext()).thenReturn(true, true, true, false, false);\n        when(listOfReposIterator.next()).thenReturn(repo1, repo2, repo3, repo4, null);\n        when(listOfRepos.iterator()).thenReturn(listOfReposIterator);\n\n        when(currentUser.listRepositories(100, GHMyself.RepositoryListFilter.OWNER)).thenReturn(listOfRepos);\n\n        GitHub github = mock(GitHub.class);\n        GitHubUtil gitHubUtil = new GitHubUtil(github);\n        List<GHRepository> actualList = gitHubUtil.getGHRepositories(parentToPath, currentUser);\n        List<GHRepository> expectedList = new ArrayList<>();\n        expectedList.add(repo1);\n        expectedList.add(repo2);\n        expectedList.add(repo3);\n        expectedList.add(repo4);\n        assertEquals(expectedList.size(), actualList.size());\n        assertTrue(actualList.containsAll(expectedList));\n        assertTrue(expectedList.containsAll(actualList));\n    }", "signature": "void testGetGHRepositories()", "full_signature": "@Test(timeOut = 1000) public void testGetGHRepositories()", "class_method_signature": "GitHubUtilTest.testGetGHRepositories()", "testcase": true, "constructor": false, "invocations": ["create", "put", "put", "put", "put", "mock", "mock", "mock", "thenReturn", "when", "getName", "mock", "thenReturn", "when", "getName", "mock", "thenReturn", "when", "getName", "mock", "thenReturn", "when", "getName", "mock", "thenReturn", "when", "hasNext", "thenReturn", "when", "next", "thenReturn", "when", "iterator", "thenReturn", "when", "listRepositories", "mock", "getGHRepositories", "add", "add", "add", "add", "assertEquals", "size", "size", "assertTrue", "containsAll", "assertTrue", "containsAll"]}, "focal_class": {"identifier": "GitHubUtil", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger log = LoggerFactory.getLogger(GitHubUtil.class);", "modifier": "private static final", "type": "Logger", "declarator": "log = LoggerFactory.getLogger(GitHubUtil.class)", "var_name": "log"}, {"original_string": "public static final String NO_BRANCH_WARN_FORMAT = \"Couldn't find branch `%s` in repo `%s`. Waiting a second...\";", "modifier": "public static final", "type": "String", "declarator": "NO_BRANCH_WARN_FORMAT = \"Couldn't find branch `%s` in repo `%s`. Waiting a second...\"", "var_name": "NO_BRANCH_WARN_FORMAT"}, {"original_string": "private final GitHub github;", "modifier": "private final", "type": "GitHub", "declarator": "github", "var_name": "github"}], "methods": [{"identifier": "GitHubUtil", "parameters": "(GitHub gitHub)", "modifiers": "public", "return": "", "signature": " GitHubUtil(GitHub gitHub)", "full_signature": "public  GitHubUtil(GitHub gitHub)", "class_method_signature": "GitHubUtil.GitHubUtil(GitHub gitHub)", "testcase": false, "constructor": true}, {"identifier": "getGithub", "parameters": "()", "modifiers": "public", "return": "GitHub", "signature": "GitHub getGithub()", "full_signature": "public GitHub getGithub()", "class_method_signature": "GitHubUtil.getGithub()", "testcase": false, "constructor": false}, {"identifier": "getRepo", "parameters": "(String repo)", "modifiers": "public", "return": "GHRepository", "signature": "GHRepository getRepo(String repo)", "full_signature": "public GHRepository getRepo(String repo)", "class_method_signature": "GitHubUtil.getRepo(String repo)", "testcase": false, "constructor": false}, {"identifier": "createPublicRepo", "parameters": "(String repoName)", "modifiers": "public", "return": "GHRepository", "signature": "GHRepository createPublicRepo(String repoName)", "full_signature": "public GHRepository createPublicRepo(String repoName)", "class_method_signature": "GitHubUtil.createPublicRepo(String repoName)", "testcase": false, "constructor": false}, {"identifier": "getMyself", "parameters": "()", "modifiers": "public", "return": "GHMyself", "signature": "GHMyself getMyself()", "full_signature": "public GHMyself getMyself()", "class_method_signature": "GitHubUtil.getMyself()", "testcase": false, "constructor": false}, {"identifier": "startSearch", "parameters": "()", "modifiers": "public", "return": "GHContentSearchBuilder", "signature": "GHContentSearchBuilder startSearch()", "full_signature": "public GHContentSearchBuilder startSearch()", "class_method_signature": "GitHubUtil.startSearch()", "testcase": false, "constructor": false}, {"identifier": "createFork", "parameters": "(GHRepository repo)", "modifiers": "public", "return": "GHRepository", "signature": "GHRepository createFork(GHRepository repo)", "full_signature": "public GHRepository createFork(GHRepository repo)", "class_method_signature": "GitHubUtil.createFork(GHRepository repo)", "testcase": false, "constructor": false}, {"identifier": "safeDeleteRepo", "parameters": "(GHRepository repo)", "modifiers": "public", "return": "void", "signature": "void safeDeleteRepo(GHRepository repo)", "full_signature": "public void safeDeleteRepo(GHRepository repo)", "class_method_signature": "GitHubUtil.safeDeleteRepo(GHRepository repo)", "testcase": false, "constructor": false}, {"identifier": "createPullReq", "parameters": "(GHRepository origRepo, String branch,\n                                 GHRepository forkRepo, String title, String body)", "modifiers": "public", "return": "int", "signature": "int createPullReq(GHRepository origRepo, String branch,\n                                 GHRepository forkRepo, String title, String body)", "full_signature": "public int createPullReq(GHRepository origRepo, String branch,\n                                 GHRepository forkRepo, String title, String body)", "class_method_signature": "GitHubUtil.createPullReq(GHRepository origRepo, String branch,\n                                 GHRepository forkRepo, String title, String body)", "testcase": false, "constructor": false}, {"identifier": "tryRetrievingBranch", "parameters": "(GHRepository repo, String branchName)", "modifiers": "protected", "return": "GHBranch", "signature": "GHBranch tryRetrievingBranch(GHRepository repo, String branchName)", "full_signature": "protected GHBranch tryRetrievingBranch(GHRepository repo, String branchName)", "class_method_signature": "GitHubUtil.tryRetrievingBranch(GHRepository repo, String branchName)", "testcase": false, "constructor": false}, {"identifier": "tryRetrievingRepository", "parameters": "(String repoName)", "modifiers": "public", "return": "GHRepository", "signature": "GHRepository tryRetrievingRepository(String repoName)", "full_signature": "public GHRepository tryRetrievingRepository(String repoName)", "class_method_signature": "GitHubUtil.tryRetrievingRepository(String repoName)", "testcase": false, "constructor": false}, {"identifier": "tryRetrievingContent", "parameters": "(GHRepository repo, String path, String branch)", "modifiers": "public", "return": "GHContent", "signature": "GHContent tryRetrievingContent(GHRepository repo, String path, String branch)", "full_signature": "public GHContent tryRetrievingContent(GHRepository repo, String path, String branch)", "class_method_signature": "GitHubUtil.tryRetrievingContent(GHRepository repo, String path, String branch)", "testcase": false, "constructor": false}, {"identifier": "getGHRepositories", "parameters": "(Multimap<String, String> pathToDockerfileInParentRepo,\n                                                 GHMyself currentUser)", "modifiers": "public", "return": "List<GHRepository>", "signature": "List<GHRepository> getGHRepositories(Multimap<String, String> pathToDockerfileInParentRepo,\n                                                 GHMyself currentUser)", "full_signature": "public List<GHRepository> getGHRepositories(Multimap<String, String> pathToDockerfileInParentRepo,\n                                                 GHMyself currentUser)", "class_method_signature": "GitHubUtil.getGHRepositories(Multimap<String, String> pathToDockerfileInParentRepo,\n                                                 GHMyself currentUser)", "testcase": false, "constructor": false}, {"identifier": "waitFor", "parameters": "(long millis)", "modifiers": "protected", "return": "void", "signature": "void waitFor(long millis)", "full_signature": "protected void waitFor(long millis)", "class_method_signature": "GitHubUtil.waitFor(long millis)", "testcase": false, "constructor": false}, {"identifier": "repoHasBranch", "parameters": "(GHRepository repo, String branchName)", "modifiers": "public", "return": "boolean", "signature": "boolean repoHasBranch(GHRepository repo, String branchName)", "full_signature": "public boolean repoHasBranch(GHRepository repo, String branchName)", "class_method_signature": "GitHubUtil.repoHasBranch(GHRepository repo, String branchName)", "testcase": false, "constructor": false}, {"identifier": "getReposForUserAtCurrentInstant", "parameters": "(GHMyself user)", "modifiers": "public", "return": "Map<String, GHRepository>", "signature": "Map<String, GHRepository> getReposForUserAtCurrentInstant(GHMyself user)", "full_signature": "public Map<String, GHRepository> getReposForUserAtCurrentInstant(GHMyself user)", "class_method_signature": "GitHubUtil.getReposForUserAtCurrentInstant(GHMyself user)", "testcase": false, "constructor": false}], "file": "dockerfile-image-update/src/main/java/com/salesforce/dockerfileimageupdate/utils/GitHubUtil.java"}, "focal_method": {"identifier": "getGHRepositories", "parameters": "(Multimap<String, String> pathToDockerfileInParentRepo,\n                                                 GHMyself currentUser)", "modifiers": "public", "return": "List<GHRepository>", "body": "public List<GHRepository> getGHRepositories(Multimap<String, String> pathToDockerfileInParentRepo,\n                                                 GHMyself currentUser) throws InterruptedException {\n        List<GHRepository> listOfRepos = new ArrayList<>();\n        while (true) {\n            Map<String, GHRepository> repoByName = getReposForUserAtCurrentInstant(currentUser);\n            boolean listOfReposHasRecentForks = true;\n            for (String s : pathToDockerfileInParentRepo.keySet()) {\n                String forkName = s.substring(s.lastIndexOf('/') + 1);\n                log.info(String.format(\"Verifying that %s has been forked\", forkName));\n                if (repoByName.containsKey(forkName)) {\n                    listOfRepos.add(repoByName.get(forkName));\n                } else {\n                    log.debug(\"Forking is still in progress for {}\" , forkName);\n                    listOfReposHasRecentForks = false;\n                }\n            }\n            if (listOfReposHasRecentForks) {\n                break;\n            } else {\n                log.info(\"Waiting for GitHub API cache to clear...\");\n                waitFor(TimeUnit.MINUTES.toMillis(1));\n            }\n        }\n        return listOfRepos;\n    }", "signature": "List<GHRepository> getGHRepositories(Multimap<String, String> pathToDockerfileInParentRepo,\n                                                 GHMyself currentUser)", "full_signature": "public List<GHRepository> getGHRepositories(Multimap<String, String> pathToDockerfileInParentRepo,\n                                                 GHMyself currentUser)", "class_method_signature": "GitHubUtil.getGHRepositories(Multimap<String, String> pathToDockerfileInParentRepo,\n                                                 GHMyself currentUser)", "testcase": false, "constructor": false, "invocations": ["getReposForUserAtCurrentInstant", "keySet", "substring", "lastIndexOf", "info", "format", "containsKey", "add", "get", "debug", "info", "waitFor", "toMillis"]}, "repository": {"repo_id": 104787715, "url": "https://github.com/salesforce/dockerfile-image-update", "stars": 62, "created": "9/25/2017 6:38:13 PM +00:00", "updates": "2020-01-23T07:15:59+00:00", "fork": "False", "license": "licensed"}}