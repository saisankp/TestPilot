{"test_class": {"identifier": "ProductResourceTest", "superclass": "extends ResourceTest", "interfaces": "", "fields": [{"original_string": "private RepositoryHandler repositoryHandler;", "modifier": "private", "type": "RepositoryHandler", "declarator": "repositoryHandler", "var_name": "repositoryHandler"}], "file": "server/src/test/java/org/axway/grapes/server/webapp/resources/ProductResourceTest.java"}, "test_case": {"identifier": "deleteDelivery", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void deleteDelivery(){\n        final DbProduct product = new DbProduct();\n        product.setName(\"product1\");\n        \n        Delivery delivery = new Delivery();\n        delivery.setCommercialName(\"delivery1\");\n        delivery.setCommercialVersion(\"1.0.0\");   \n        delivery.setVersion(\"1.0.0-1\");\n        delivery.setJenkinsBuildUrl(\"http://localhost:8080/job/20\");\n        product.getDeliveries().add(delivery);\n\n        // creating a dummy product in storage with delivery\n        when(repositoryHandler.getProduct(product.getName())).thenReturn(product);\n\n        // request\n        client().addFilter(new HTTPBasicAuthFilter(GrapesTestUtils.USER_4TEST, GrapesTestUtils.PASSWORD_4TEST));\n        WebResource resource = client().resource(\"/\" + ServerAPI.PRODUCT_RESOURCE + \"/\" + product.getName() + ServerAPI.GET_DELIVERIES + \"/delivery1/1.0.0\" );\n        ClientResponse response = resource.type(MediaType.APPLICATION_JSON).delete(ClientResponse.class);\n        \n        // check response\n        assertNotNull(response);\n        assertEquals(HttpStatus.OK_200, response.getStatus());\n\n        ArgumentCaptor<DbProduct> captor = ArgumentCaptor.forClass(DbProduct.class);\n        \n        // checks\n        verify(repositoryHandler).store(captor.capture());\n        assertEquals(0, captor.getValue().getDeliveries().size());\n    }", "signature": "void deleteDelivery()", "full_signature": "@Test public void deleteDelivery()", "class_method_signature": "ProductResourceTest.deleteDelivery()", "testcase": true, "constructor": false, "invocations": ["setName", "setCommercialName", "setCommercialVersion", "setVersion", "setJenkinsBuildUrl", "add", "getDeliveries", "thenReturn", "when", "getProduct", "getName", "addFilter", "client", "resource", "client", "getName", "delete", "type", "assertNotNull", "assertEquals", "getStatus", "forClass", "store", "verify", "capture", "assertEquals", "size", "getDeliveries", "getValue"]}, "focal_class": {"identifier": "ProductResource", "superclass": "extends AbstractResource", "interfaces": "", "fields": [{"original_string": "private static final Logger LOG = LoggerFactory.getLogger(ProductResource.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOG = LoggerFactory.getLogger(ProductResource.class)", "var_name": "LOG"}, {"original_string": "private static final String DELIVERY_MSG_TEMPLATE = \"Delivery [%s %s] %s [%s]\";", "modifier": "private static final", "type": "String", "declarator": "DELIVERY_MSG_TEMPLATE = \"Delivery [%s %s] %s [%s]\"", "var_name": "DELIVERY_MSG_TEMPLATE"}], "methods": [{"identifier": "ProductResource", "parameters": "(final RepositoryHandler repositoryHandler, final GrapesServerConfig configuration)", "modifiers": "public", "return": "", "signature": " ProductResource(final RepositoryHandler repositoryHandler, final GrapesServerConfig configuration)", "full_signature": "public  ProductResource(final RepositoryHandler repositoryHandler, final GrapesServerConfig configuration)", "class_method_signature": "ProductResource.ProductResource(final RepositoryHandler repositoryHandler, final GrapesServerConfig configuration)", "testcase": false, "constructor": true}, {"identifier": "createProduct", "parameters": "(@Auth final DbCredential credential, final String productName)", "modifiers": "@POST public", "return": "Response", "signature": "Response createProduct(@Auth final DbCredential credential, final String productName)", "full_signature": "@POST public Response createProduct(@Auth final DbCredential credential, final String productName)", "class_method_signature": "ProductResource.createProduct(@Auth final DbCredential credential, final String productName)", "testcase": false, "constructor": false}, {"identifier": "getNames", "parameters": "()", "modifiers": "@GET @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(ServerAPI.GET_NAMES) public", "return": "Response", "signature": "Response getNames()", "full_signature": "@GET @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(ServerAPI.GET_NAMES) public Response getNames()", "class_method_signature": "ProductResource.getNames()", "testcase": false, "constructor": false}, {"identifier": "get", "parameters": "(@PathParam(\"name\") final String name)", "modifiers": "@GET @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(\"/{name}\") public", "return": "Response", "signature": "Response get(@PathParam(\"name\") final String name)", "full_signature": "@GET @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(\"/{name}\") public Response get(@PathParam(\"name\") final String name)", "class_method_signature": "ProductResource.get(@PathParam(\"name\") final String name)", "testcase": false, "constructor": false}, {"identifier": "delete", "parameters": "(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "modifiers": "@DELETE @Path(\"/{name}\") public", "return": "Response", "signature": "Response delete(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "full_signature": "@DELETE @Path(\"/{name}\") public Response delete(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "class_method_signature": "ProductResource.delete(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "testcase": false, "constructor": false}, {"identifier": "getModuleNames", "parameters": "(@PathParam(\"name\") final String name)", "modifiers": "@GET @Path(\"/{name}\" + ServerAPI.GET_MODULES) @Produces(MediaType.APPLICATION_JSON) public", "return": "Response", "signature": "Response getModuleNames(@PathParam(\"name\") final String name)", "full_signature": "@GET @Path(\"/{name}\" + ServerAPI.GET_MODULES) @Produces(MediaType.APPLICATION_JSON) public Response getModuleNames(@PathParam(\"name\") final String name)", "class_method_signature": "ProductResource.getModuleNames(@PathParam(\"name\") final String name)", "testcase": false, "constructor": false}, {"identifier": "setModuleNames", "parameters": "(@Auth final DbCredential credential, @PathParam(\"name\") final String name, final List<String> moduleNames)", "modifiers": "@POST @Path(\"/{name}\" + ServerAPI.GET_MODULES) public", "return": "Response", "signature": "Response setModuleNames(@Auth final DbCredential credential, @PathParam(\"name\") final String name, final List<String> moduleNames)", "full_signature": "@POST @Path(\"/{name}\" + ServerAPI.GET_MODULES) public Response setModuleNames(@Auth final DbCredential credential, @PathParam(\"name\") final String name, final List<String> moduleNames)", "class_method_signature": "ProductResource.setModuleNames(@Auth final DbCredential credential, @PathParam(\"name\") final String name, final List<String> moduleNames)", "testcase": false, "constructor": false}, {"identifier": "getDeliveries", "parameters": "(@PathParam(\"name\") final String name)", "modifiers": "@GET @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES) @Produces(MediaType.APPLICATION_JSON) public", "return": "Response", "signature": "Response getDeliveries(@PathParam(\"name\") final String name)", "full_signature": "@GET @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES) @Produces(MediaType.APPLICATION_JSON) public Response getDeliveries(@PathParam(\"name\") final String name)", "class_method_signature": "ProductResource.getDeliveries(@PathParam(\"name\") final String name)", "testcase": false, "constructor": false}, {"identifier": "createNewDelivery", "parameters": "(@Auth final DbCredential credential, @PathParam(\"name\") final String name, final Delivery delivery)", "modifiers": "@POST @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES) public", "return": "Response", "signature": "Response createNewDelivery(@Auth final DbCredential credential, @PathParam(\"name\") final String name, final Delivery delivery)", "full_signature": "@POST @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES) public Response createNewDelivery(@Auth final DbCredential credential, @PathParam(\"name\") final String name, final Delivery delivery)", "class_method_signature": "ProductResource.createNewDelivery(@Auth final DbCredential credential, @PathParam(\"name\") final String name, final Delivery delivery)", "testcase": false, "constructor": false}, {"identifier": "getDelivery", "parameters": "(@PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "modifiers": "@GET @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES+\"/{commercialName}\"+\"/{commercialVersion}\") @Produces(MediaType.APPLICATION_JSON) public", "return": "Response", "signature": "Response getDelivery(@PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "full_signature": "@GET @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES+\"/{commercialName}\"+\"/{commercialVersion}\") @Produces(MediaType.APPLICATION_JSON) public Response getDelivery(@PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "class_method_signature": "ProductResource.getDelivery(@PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "testcase": false, "constructor": false}, {"identifier": "deleteDelivery", "parameters": "(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "modifiers": "@DELETE @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES+\"/{commercialName}\"+\"/{commercialVersion}\") @Produces(MediaType.APPLICATION_JSON) public", "return": "Response", "signature": "Response deleteDelivery(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "full_signature": "@DELETE @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES+\"/{commercialName}\"+\"/{commercialVersion}\") @Produces(MediaType.APPLICATION_JSON) public Response deleteDelivery(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "class_method_signature": "ProductResource.deleteDelivery(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "testcase": false, "constructor": false}, {"identifier": "setDeliveryDependency", "parameters": "(@Auth final DbCredential credential,\n                                          @PathParam(\"name\") final String name,\n                                          @PathParam(\"commercialName\") final String commercialName,\n                                          @PathParam(\"commercialVersion\") final String commercialVersion,\n                                          List<String> dependencies)", "modifiers": "@POST @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES+\"/{commercialName}\"+\"/{commercialVersion}\") @Produces(MediaType.APPLICATION_JSON) public", "return": "Response", "signature": "Response setDeliveryDependency(@Auth final DbCredential credential,\n                                          @PathParam(\"name\") final String name,\n                                          @PathParam(\"commercialName\") final String commercialName,\n                                          @PathParam(\"commercialVersion\") final String commercialVersion,\n                                          List<String> dependencies)", "full_signature": "@POST @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES+\"/{commercialName}\"+\"/{commercialVersion}\") @Produces(MediaType.APPLICATION_JSON) public Response setDeliveryDependency(@Auth final DbCredential credential,\n                                          @PathParam(\"name\") final String name,\n                                          @PathParam(\"commercialName\") final String commercialName,\n                                          @PathParam(\"commercialVersion\") final String commercialVersion,\n                                          List<String> dependencies)", "class_method_signature": "ProductResource.setDeliveryDependency(@Auth final DbCredential credential,\n                                          @PathParam(\"name\") final String name,\n                                          @PathParam(\"commercialName\") final String commercialName,\n                                          @PathParam(\"commercialVersion\") final String commercialVersion,\n                                          List<String> dependencies)", "testcase": false, "constructor": false}], "file": "server/src/main/java/org/axway/grapes/server/webapp/resources/ProductResource.java"}, "focal_method": {"identifier": "deleteDelivery", "parameters": "(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "modifiers": "@DELETE @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES+\"/{commercialName}\"+\"/{commercialVersion}\") @Produces(MediaType.APPLICATION_JSON) public", "return": "Response", "body": "@DELETE\n    @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES+\"/{commercialName}\"+\"/{commercialVersion}\")\n    @Produces(MediaType.APPLICATION_JSON)\n    public Response deleteDelivery(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion){\n        if(!credential.getRoles().contains(DbCredential.AvailableRoles.DATA_DELETER)){\n            throw new WebApplicationException(Response.status(Response.Status.UNAUTHORIZED).build());\n        }\n\n        if(LOG.isInfoEnabled()) {\n            LOG.info(String.format(\"Got a delete delivery request for product [%s]\", name));\n        }\n\n        final DbProduct dbProduct = getProductHandler().getProduct(name);\n\n        final Delivery delivery = dbProduct.getDelivery(commercialName, commercialVersion);\n        \n        if(! dbProduct.getDeliveries().contains(delivery)){\n            throw new WebApplicationException(Response.serverError().status(HttpStatus.NOT_FOUND_404)\n                    .entity(String.format(DELIVERY_MSG_TEMPLATE, commercialName, commercialVersion, \" does not exist for \", name)).build());\n        }\n\n        dbProduct.getDeliveries().remove(delivery);\n        getProductHandler().update(dbProduct);\n\n        return Response.ok().build();\n    }", "signature": "Response deleteDelivery(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "full_signature": "@DELETE @Path(\"/{name}\" + ServerAPI.GET_DELIVERIES+\"/{commercialName}\"+\"/{commercialVersion}\") @Produces(MediaType.APPLICATION_JSON) public Response deleteDelivery(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "class_method_signature": "ProductResource.deleteDelivery(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @PathParam(\"commercialName\") final String commercialName, @PathParam(\"commercialVersion\") final String commercialVersion)", "testcase": false, "constructor": false, "invocations": ["contains", "getRoles", "build", "status", "isInfoEnabled", "info", "format", "getProduct", "getProductHandler", "getDelivery", "contains", "getDeliveries", "build", "entity", "status", "serverError", "format", "remove", "getDeliveries", "update", "getProductHandler", "build", "ok"]}, "repository": {"repo_id": 14858974, "url": "https://github.com/Axway/Grapes", "language": "Java", "is_fork": false, "fork_count": 9, "stargazer_count": 8, "size": 3620, "license": "licensed"}}