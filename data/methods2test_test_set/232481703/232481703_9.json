{"test_class": {"identifier": "SqlDebugDriverTest", "superclass": "", "interfaces": "", "fields": [], "file": "plink-sql/plink-sql-core/src/test/java/com/github/hairless/plink/sql/SqlDebugDriverTest.java"}, "test_case": {"identifier": "debug", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void debug() throws Exception {\n        String sql =\n                \"create table t1( a int,b string, c int) with ( 'connector' = 'collection','data'='[]');\" +\n                        \"create table t2(a int comment '\u6d4b\u8bd5',b string,c int) with ( 'connector' = 'print');\" +\n                        \"create view temp_view as select * from t1;\" +\n                        \"insert into t2(a,b,c) select a,b,c from temp_view t1;\" +\n                        \"insert into t2(a,b,c) select a,b,c from temp_view t1;\";\n        List<String> sourceData = Stream.of(\n                new JSONObject().fluentPut(\"a\", 1).fluentPut(\"b\", \"1000\").fluentPut(\"c\", 2).toJSONString(),\n                new JSONObject().fluentPut(\"a\", 2).fluentPut(\"b\", \"1000\").fluentPut(\"c\", 3).toJSONString(),\n                new JSONObject().fluentPut(\"a\", 3).fluentPut(\"b\", \"2000\").fluentPut(\"c\", 4).toJSONString(),\n                new JSONObject().fluentPut(\"a\", 4).fluentPut(\"b\", \"2000\").fluentPut(\"c\", 5).toJSONString(),\n                new JSONObject().fluentPut(\"a\", 5).fluentPut(\"b\", \"3000\").fluentPut(\"c\", 6).toJSONString()\n        ).collect(Collectors.toList());\n        SqlDebugConfig sqlDebugConfig = new SqlDebugConfig();\n        HashMap<String, SqlDebugConfig.SourceConfig> sourceConfigMap = new HashMap<>();\n        sourceConfigMap.put(\"t1\", new SqlDebugConfig.SourceConfig(sourceData));\n        sqlDebugConfig.setSourceConfigMap(sourceConfigMap);\n        sqlDebugConfig.setSql(sql);\n        log.info(\"sqlDebugConfig={}\", JSON.toJSONString(sqlDebugConfig));\n        Map<String, List<String>> debugResult = SqlDebugDriver.debug(sqlDebugConfig);\n        assert MapUtils.isNotEmpty(debugResult);\n    }", "signature": "void debug()", "full_signature": "@Test public void debug()", "class_method_signature": "SqlDebugDriverTest.debug()", "testcase": true, "constructor": false, "invocations": ["collect", "of", "toJSONString", "fluentPut", "fluentPut", "fluentPut", "toJSONString", "fluentPut", "fluentPut", "fluentPut", "toJSONString", "fluentPut", "fluentPut", "fluentPut", "toJSONString", "fluentPut", "fluentPut", "fluentPut", "toJSONString", "fluentPut", "fluentPut", "fluentPut", "toList", "put", "setSourceConfigMap", "setSql", "info", "toJSONString", "debug", "isNotEmpty"]}, "focal_class": {"identifier": "SqlDebugDriver", "superclass": "", "interfaces": "", "fields": [], "methods": [{"identifier": "debug", "parameters": "(SqlDebugConfig sqlDebugConfig)", "modifiers": "public static", "return": "Map<String, List<String>>", "signature": "Map<String, List<String>> debug(SqlDebugConfig sqlDebugConfig)", "full_signature": "public static Map<String, List<String>> debug(SqlDebugConfig sqlDebugConfig)", "class_method_signature": "SqlDebugDriver.debug(SqlDebugConfig sqlDebugConfig)", "testcase": false, "constructor": false}, {"identifier": "handleDebugSql", "parameters": "(final String identifier, String sql, SqlDebugConfig sqlDebugConfig)", "modifiers": "private static", "return": "String", "signature": "String handleDebugSql(final String identifier, String sql, SqlDebugConfig sqlDebugConfig)", "full_signature": "private static String handleDebugSql(final String identifier, String sql, SqlDebugConfig sqlDebugConfig)", "class_method_signature": "SqlDebugDriver.handleDebugSql(final String identifier, String sql, SqlDebugConfig sqlDebugConfig)", "testcase": false, "constructor": false}, {"identifier": "buildDebugSourceSql", "parameters": "(SqlParseNode sourceTable, SqlDebugConfig.SourceConfig sourceConfig)", "modifiers": "private static", "return": "String", "signature": "String buildDebugSourceSql(SqlParseNode sourceTable, SqlDebugConfig.SourceConfig sourceConfig)", "full_signature": "private static String buildDebugSourceSql(SqlParseNode sourceTable, SqlDebugConfig.SourceConfig sourceConfig)", "class_method_signature": "SqlDebugDriver.buildDebugSourceSql(SqlParseNode sourceTable, SqlDebugConfig.SourceConfig sourceConfig)", "testcase": false, "constructor": false}, {"identifier": "buildDebugSinkSql", "parameters": "(String identifier, SqlParseNode sinkTable)", "modifiers": "private static", "return": "String", "signature": "String buildDebugSinkSql(String identifier, SqlParseNode sinkTable)", "full_signature": "private static String buildDebugSinkSql(String identifier, SqlParseNode sinkTable)", "class_method_signature": "SqlDebugDriver.buildDebugSinkSql(String identifier, SqlParseNode sinkTable)", "testcase": false, "constructor": false}, {"identifier": "buildDebugSinkSql", "parameters": "(String identifier, SqlParseNode sinkTable, String newTableName)", "modifiers": "private static", "return": "String", "signature": "String buildDebugSinkSql(String identifier, SqlParseNode sinkTable, String newTableName)", "full_signature": "private static String buildDebugSinkSql(String identifier, SqlParseNode sinkTable, String newTableName)", "class_method_signature": "SqlDebugDriver.buildDebugSinkSql(String identifier, SqlParseNode sinkTable, String newTableName)", "testcase": false, "constructor": false}, {"identifier": "buildDebugInsertSql", "parameters": "(SqlParseNode fromTable, String targetTableName)", "modifiers": "private static", "return": "String", "signature": "String buildDebugInsertSql(SqlParseNode fromTable, String targetTableName)", "full_signature": "private static String buildDebugInsertSql(SqlParseNode fromTable, String targetTableName)", "class_method_signature": "SqlDebugDriver.buildDebugInsertSql(SqlParseNode fromTable, String targetTableName)", "testcase": false, "constructor": false}, {"identifier": "filterFormatProperties", "parameters": "(Map<String, String> properties)", "modifiers": "private static", "return": "Map<String, String>", "signature": "Map<String, String> filterFormatProperties(Map<String, String> properties)", "full_signature": "private static Map<String, String> filterFormatProperties(Map<String, String> properties)", "class_method_signature": "SqlDebugDriver.filterFormatProperties(Map<String, String> properties)", "testcase": false, "constructor": false}, {"identifier": "newSqlTableOption", "parameters": "(String key, String value)", "modifiers": "private static", "return": "SqlTableOption", "signature": "SqlTableOption newSqlTableOption(String key, String value)", "full_signature": "private static SqlTableOption newSqlTableOption(String key, String value)", "class_method_signature": "SqlDebugDriver.newSqlTableOption(String key, String value)", "testcase": false, "constructor": false}], "file": "plink-sql/plink-sql-core/src/main/java/com/github/hairless/plink/sql/SqlDebugDriver.java"}, "focal_method": {"identifier": "debug", "parameters": "(SqlDebugConfig sqlDebugConfig)", "modifiers": "public static", "return": "Map<String, List<String>>", "body": "public static Map<String, List<String>> debug(SqlDebugConfig sqlDebugConfig) throws Exception {\n        Preconditions.checkNotNull(sqlDebugConfig, \"sqlDebugConfig should be not null\");\n        Preconditions.checkNotNull(sqlDebugConfig.getSql(), \"sql should be not null\");\n        String identifier = UUID.randomUUID().toString();\n        String debugSql = handleDebugSql(identifier, sqlDebugConfig.getSql(), sqlDebugConfig);\n        log.debug(\"start sql debug,sql:{}\", debugSql);\n        SqlConfig config = SqlConfig.builder().sql(debugSql).jobName(\"sql_job_debug_test\").build();\n        SqlJob sqlJob = new SqlJob(config);\n        try {\n            CollectionDataWarehouse.registerLock(identifier);\n            sqlJob.start();\n            return CollectionDataWarehouse.getData(identifier);\n        } finally {\n            CollectionDataWarehouse.remove(identifier);\n        }\n    }", "signature": "Map<String, List<String>> debug(SqlDebugConfig sqlDebugConfig)", "full_signature": "public static Map<String, List<String>> debug(SqlDebugConfig sqlDebugConfig)", "class_method_signature": "SqlDebugDriver.debug(SqlDebugConfig sqlDebugConfig)", "testcase": false, "constructor": false, "invocations": ["checkNotNull", "checkNotNull", "getSql", "toString", "randomUUID", "handleDebugSql", "getSql", "debug", "build", "jobName", "sql", "builder", "registerLock", "start", "getData", "remove"]}, "repository": {"repo_id": 232481703, "url": "https://github.com/hairless/plink", "stars": 10, "created": "1/8/2020 5:01:32 AM +00:00", "updates": "2020-01-27T16:15:22+00:00", "fork": "False", "license": "licensed"}}