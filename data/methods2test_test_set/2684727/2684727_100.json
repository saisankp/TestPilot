{"test_class": {"identifier": "OcrPurchaseTrackerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final int REMAINING_SCANS = 49;", "modifier": "private static final", "type": "int", "declarator": "REMAINING_SCANS = 49", "var_name": "REMAINING_SCANS"}, {"original_string": "OcrPurchaseTracker ocrPurchaseTracker;", "modifier": "", "type": "OcrPurchaseTracker", "declarator": "ocrPurchaseTracker", "var_name": "ocrPurchaseTracker"}, {"original_string": "@Mock\n    IdentityManager identityManager;", "modifier": "@Mock", "type": "IdentityManager", "declarator": "identityManager", "var_name": "identityManager"}, {"original_string": "@Mock\n    WebServiceManager webServiceManager;", "modifier": "@Mock", "type": "WebServiceManager", "declarator": "webServiceManager", "var_name": "webServiceManager"}, {"original_string": "@Mock\n    PurchaseManager purchaseManager;", "modifier": "@Mock", "type": "PurchaseManager", "declarator": "purchaseManager", "var_name": "purchaseManager"}, {"original_string": "@Mock\n    PurchaseWallet purchaseWallet;", "modifier": "@Mock", "type": "PurchaseWallet", "declarator": "purchaseWallet", "var_name": "purchaseWallet"}, {"original_string": "@Mock\n    DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer;", "modifier": "@Mock", "type": "DefaultInAppPurchaseConsumer", "declarator": "defaultInAppPurchaseConsumer", "var_name": "defaultInAppPurchaseConsumer"}, {"original_string": "@Mock\n    LocalOcrScansTracker localOcrScansTracker;", "modifier": "@Mock", "type": "LocalOcrScansTracker", "declarator": "localOcrScansTracker", "var_name": "localOcrScansTracker"}, {"original_string": "@Mock\n    ManagedProduct managedProduct;", "modifier": "@Mock", "type": "ManagedProduct", "declarator": "managedProduct", "var_name": "managedProduct"}, {"original_string": "@Mock\n    MobileAppPurchasesService mobileAppPurchasesService;", "modifier": "@Mock", "type": "MobileAppPurchasesService", "declarator": "mobileAppPurchasesService", "var_name": "mobileAppPurchasesService"}, {"original_string": "@Mock\n    PurchaseResponse purchaseResponse;", "modifier": "@Mock", "type": "PurchaseResponse", "declarator": "purchaseResponse", "var_name": "purchaseResponse"}, {"original_string": "@Mock\n    MeResponse meResponse;", "modifier": "@Mock", "type": "MeResponse", "declarator": "meResponse", "var_name": "meResponse"}, {"original_string": "@Mock\n    User user;", "modifier": "@Mock", "type": "User", "declarator": "user", "var_name": "user"}, {"original_string": "@Mock\n    ResponseBody retrofitResponseBody;", "modifier": "@Mock", "type": "ResponseBody", "declarator": "retrofitResponseBody", "var_name": "retrofitResponseBody"}], "file": "app/src/test/java/co/smartreceipts/android/ocr/purchases/OcrPurchaseTrackerTest.java"}, "test_case": {"identifier": "initializeUploadFailsWith422CodeAndSmartReceiptsApiExceptionWithListOfUnknownErrors", "parameters": "()", "modifiers": "@SuppressWarnings(\"ThrowableInstanceNeverThrown\") @Test public", "return": "void", "body": "@SuppressWarnings(\"ThrowableInstanceNeverThrown\")\n    @Test\n    public void initializeUploadFailsWith422CodeAndSmartReceiptsApiExceptionWithListOfUnknownErrors() {\n        // Configure\n        final SmartReceiptsApiErrorResponse errorResponse = new SmartReceiptsApiErrorResponse(Arrays.asList(\"error1\", \"error2\", \"error3\"));\n        final SmartReceiptsApiException smartReceiptsApiException = new SmartReceiptsApiException(Response.error(422, retrofitResponseBody), new Exception(\"test\"), errorResponse);\n        when(purchaseManager.getAllOwnedPurchases()).thenReturn(Observable.just(Collections.singleton(managedProduct)));\n        when(mobileAppPurchasesService.addPurchase(any(PurchaseRequest.class))).thenReturn(Observable.error(smartReceiptsApiException));\n\n        // Test\n        ocrPurchaseTracker.initialize();\n\n        // Verify\n        verify(purchaseManager).addEventListener(ocrPurchaseTracker);\n        verify(localOcrScansTracker).setRemainingScans(REMAINING_SCANS);\n        verify(defaultInAppPurchaseConsumer, never()).consumePurchase(any(ManagedProduct.class), any(PurchaseFamily.class));\n    }", "signature": "void initializeUploadFailsWith422CodeAndSmartReceiptsApiExceptionWithListOfUnknownErrors()", "full_signature": "@SuppressWarnings(\"ThrowableInstanceNeverThrown\") @Test public void initializeUploadFailsWith422CodeAndSmartReceiptsApiExceptionWithListOfUnknownErrors()", "class_method_signature": "OcrPurchaseTrackerTest.initializeUploadFailsWith422CodeAndSmartReceiptsApiExceptionWithListOfUnknownErrors()", "testcase": true, "constructor": false, "invocations": ["asList", "error", "thenReturn", "when", "getAllOwnedPurchases", "just", "singleton", "thenReturn", "when", "addPurchase", "any", "error", "initialize", "addEventListener", "verify", "setRemainingScans", "verify", "consumePurchase", "verify", "never", "any", "any"]}, "focal_class": {"identifier": "OcrPurchaseTracker", "superclass": "", "interfaces": "implements PurchaseEventsListener", "fields": [{"original_string": "private static final String GOAL = \"Recognition\";", "modifier": "private static final", "type": "String", "declarator": "GOAL = \"Recognition\"", "var_name": "GOAL"}, {"original_string": "private final IdentityManager identityManager;", "modifier": "private final", "type": "IdentityManager", "declarator": "identityManager", "var_name": "identityManager"}, {"original_string": "private final WebServiceManager webServiceManager;", "modifier": "private final", "type": "WebServiceManager", "declarator": "webServiceManager", "var_name": "webServiceManager"}, {"original_string": "private final PurchaseManager purchaseManager;", "modifier": "private final", "type": "PurchaseManager", "declarator": "purchaseManager", "var_name": "purchaseManager"}, {"original_string": "private final PurchaseWallet purchaseWallet;", "modifier": "private final", "type": "PurchaseWallet", "declarator": "purchaseWallet", "var_name": "purchaseWallet"}, {"original_string": "private final DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer;", "modifier": "private final", "type": "DefaultInAppPurchaseConsumer", "declarator": "defaultInAppPurchaseConsumer", "var_name": "defaultInAppPurchaseConsumer"}, {"original_string": "private final LocalOcrScansTracker localOcrScansTracker;", "modifier": "private final", "type": "LocalOcrScansTracker", "declarator": "localOcrScansTracker", "var_name": "localOcrScansTracker"}, {"original_string": "private final Scheduler subscribeOnScheduler;", "modifier": "private final", "type": "Scheduler", "declarator": "subscribeOnScheduler", "var_name": "subscribeOnScheduler"}], "methods": [{"identifier": "OcrPurchaseTracker", "parameters": "(@NonNull IdentityManager identityManager,\n                              @NonNull WebServiceManager webServiceManager,\n                              @NonNull PurchaseManager purchaseManager,\n                              @NonNull PurchaseWallet purchaseWallet,\n                              @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                              @NonNull LocalOcrScansTracker localOcrScansTracker)", "modifiers": "@Inject public", "return": "", "signature": " OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                              @NonNull WebServiceManager webServiceManager,\n                              @NonNull PurchaseManager purchaseManager,\n                              @NonNull PurchaseWallet purchaseWallet,\n                              @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                              @NonNull LocalOcrScansTracker localOcrScansTracker)", "full_signature": "@Inject public  OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                              @NonNull WebServiceManager webServiceManager,\n                              @NonNull PurchaseManager purchaseManager,\n                              @NonNull PurchaseWallet purchaseWallet,\n                              @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                              @NonNull LocalOcrScansTracker localOcrScansTracker)", "class_method_signature": "OcrPurchaseTracker.OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                              @NonNull WebServiceManager webServiceManager,\n                              @NonNull PurchaseManager purchaseManager,\n                              @NonNull PurchaseWallet purchaseWallet,\n                              @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                              @NonNull LocalOcrScansTracker localOcrScansTracker)", "testcase": false, "constructor": true}, {"identifier": "OcrPurchaseTracker", "parameters": "(@NonNull IdentityManager identityManager,\n                       @NonNull WebServiceManager webServiceManager,\n                       @NonNull PurchaseManager purchaseManager,\n                       @NonNull PurchaseWallet purchaseWallet,\n                       @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                       @NonNull LocalOcrScansTracker localOcrScansTracker,\n                       @NonNull Scheduler subscribeOnScheduler)", "modifiers": "@VisibleForTesting", "return": "", "signature": " OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                       @NonNull WebServiceManager webServiceManager,\n                       @NonNull PurchaseManager purchaseManager,\n                       @NonNull PurchaseWallet purchaseWallet,\n                       @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                       @NonNull LocalOcrScansTracker localOcrScansTracker,\n                       @NonNull Scheduler subscribeOnScheduler)", "full_signature": "@VisibleForTesting  OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                       @NonNull WebServiceManager webServiceManager,\n                       @NonNull PurchaseManager purchaseManager,\n                       @NonNull PurchaseWallet purchaseWallet,\n                       @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                       @NonNull LocalOcrScansTracker localOcrScansTracker,\n                       @NonNull Scheduler subscribeOnScheduler)", "class_method_signature": "OcrPurchaseTracker.OcrPurchaseTracker(@NonNull IdentityManager identityManager,\n                       @NonNull WebServiceManager webServiceManager,\n                       @NonNull PurchaseManager purchaseManager,\n                       @NonNull PurchaseWallet purchaseWallet,\n                       @NonNull DefaultInAppPurchaseConsumer defaultInAppPurchaseConsumer,\n                       @NonNull LocalOcrScansTracker localOcrScansTracker,\n                       @NonNull Scheduler subscribeOnScheduler)", "testcase": false, "constructor": true}, {"identifier": "initialize", "parameters": "()", "modifiers": "@SuppressLint(\"CheckResult\") public", "return": "void", "signature": "void initialize()", "full_signature": "@SuppressLint(\"CheckResult\") public void initialize()", "class_method_signature": "OcrPurchaseTracker.initialize()", "testcase": false, "constructor": false}, {"identifier": "onPurchaseSuccess", "parameters": "(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "modifiers": "@Override public", "return": "void", "signature": "void onPurchaseSuccess(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "full_signature": "@Override public void onPurchaseSuccess(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "class_method_signature": "OcrPurchaseTracker.onPurchaseSuccess(@NonNull InAppPurchase inAppPurchase, @NonNull PurchaseSource purchaseSource)", "testcase": false, "constructor": false}, {"identifier": "onPurchaseFailed", "parameters": "(@NonNull PurchaseSource purchaseSource)", "modifiers": "@Override public", "return": "void", "signature": "void onPurchaseFailed(@NonNull PurchaseSource purchaseSource)", "full_signature": "@Override public void onPurchaseFailed(@NonNull PurchaseSource purchaseSource)", "class_method_signature": "OcrPurchaseTracker.onPurchaseFailed(@NonNull PurchaseSource purchaseSource)", "testcase": false, "constructor": false}, {"identifier": "getRemainingScans", "parameters": "()", "modifiers": "public", "return": "int", "signature": "int getRemainingScans()", "full_signature": "public int getRemainingScans()", "class_method_signature": "OcrPurchaseTracker.getRemainingScans()", "testcase": false, "constructor": false}, {"identifier": "getRemainingScansStream", "parameters": "()", "modifiers": "public", "return": "Observable<Integer>", "signature": "Observable<Integer> getRemainingScansStream()", "full_signature": "public Observable<Integer> getRemainingScansStream()", "class_method_signature": "OcrPurchaseTracker.getRemainingScansStream()", "testcase": false, "constructor": false}, {"identifier": "hasAvailableScans", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean hasAvailableScans()", "full_signature": "public boolean hasAvailableScans()", "class_method_signature": "OcrPurchaseTracker.hasAvailableScans()", "testcase": false, "constructor": false}, {"identifier": "decrementRemainingScans", "parameters": "()", "modifiers": "public", "return": "void", "signature": "void decrementRemainingScans()", "full_signature": "public void decrementRemainingScans()", "class_method_signature": "OcrPurchaseTracker.decrementRemainingScans()", "testcase": false, "constructor": false}, {"identifier": "uploadOcrPurchase", "parameters": "(@NonNull final ManagedProduct managedProduct)", "modifiers": "@NonNull private", "return": "Observable<Object>", "signature": "Observable<Object> uploadOcrPurchase(@NonNull final ManagedProduct managedProduct)", "full_signature": "@NonNull private Observable<Object> uploadOcrPurchase(@NonNull final ManagedProduct managedProduct)", "class_method_signature": "OcrPurchaseTracker.uploadOcrPurchase(@NonNull final ManagedProduct managedProduct)", "testcase": false, "constructor": false}, {"identifier": "fetchAndPersistAvailableRecognitions", "parameters": "()", "modifiers": "@NonNull private", "return": "Observable<Integer>", "signature": "Observable<Integer> fetchAndPersistAvailableRecognitions()", "full_signature": "@NonNull private Observable<Integer> fetchAndPersistAvailableRecognitions()", "class_method_signature": "OcrPurchaseTracker.fetchAndPersistAvailableRecognitions()", "testcase": false, "constructor": false}], "file": "app/src/main/java/co/smartreceipts/android/ocr/purchases/OcrPurchaseTracker.java"}, "focal_method": {"identifier": "initialize", "parameters": "()", "modifiers": "@SuppressLint(\"CheckResult\") public", "return": "void", "body": "@SuppressLint(\"CheckResult\")\n    public void initialize() {\n        Logger.debug(this, \"Initializing...\");\n        this.purchaseManager.addEventListener(this);\n\n        this.identityManager.isLoggedInStream()\n                .subscribeOn(subscribeOnScheduler)\n                .filter(isLoggedIn -> isLoggedIn)\n                .flatMap(aBoolean -> {\n                    // Attempt to update our latest scan count\n                    return fetchAndPersistAvailableRecognitions();\n                })\n                .flatMap(integer -> purchaseManager.getAllOwnedPurchases())\n                .flatMap(managedProducts -> {\n                     for (final ManagedProduct managedProduct : managedProducts) {\n                        if (managedProduct.getInAppPurchase().getPurchaseFamilies().contains(PurchaseFamily.Ocr)) {\n                            Logger.debug(OcrPurchaseTracker.this, \"Found available OCR purchase: {}\", managedProduct.getInAppPurchase());\n                            if (!defaultInAppPurchaseConsumer.isConsumed(managedProduct, PurchaseFamily.Ocr)) {\n                                return uploadOcrPurchase(managedProduct);\n                            } else {\n                                Logger.debug(OcrPurchaseTracker.this, \"But {} was already consumed...\", managedProduct.getInAppPurchase());\n                            }\n                        }\n                    }\n                    return Observable.empty();\n                })\n                .subscribe(o -> Logger.info(OcrPurchaseTracker.this, \"Successfully initialized\"),\n                        throwable -> Logger.error(OcrPurchaseTracker.this, \"Failed to initialize.\", throwable));\n    }", "signature": "void initialize()", "full_signature": "@SuppressLint(\"CheckResult\") public void initialize()", "class_method_signature": "OcrPurchaseTracker.initialize()", "testcase": false, "constructor": false, "invocations": ["debug", "addEventListener", "subscribe", "flatMap", "flatMap", "flatMap", "filter", "subscribeOn", "isLoggedInStream", "fetchAndPersistAvailableRecognitions", "getAllOwnedPurchases", "contains", "getPurchaseFamilies", "getInAppPurchase", "debug", "getInAppPurchase", "isConsumed", "uploadOcrPurchase", "debug", "getInAppPurchase", "empty", "info", "error"]}, "repository": {"repo_id": 2684727, "url": "https://github.com/wbaumann/SmartReceiptsLibrary", "stars": 166, "created": "11/1/2011 12:32:39 AM +00:00", "updates": "2020-01-26T22:04:24+00:00", "fork": "False", "license": "licensed"}}