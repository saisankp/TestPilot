{"test_class": {"identifier": "SystemDeleteBulkActionTest", "superclass": "extends AbstractBulkActionTest", "interfaces": "", "fields": [{"original_string": "@Autowired\n\tprivate TestHelper helper;", "modifier": "@Autowired\n\tprivate", "type": "TestHelper", "declarator": "helper", "var_name": "helper"}, {"original_string": "@Autowired\n\tprivate SysSystemService systemService;", "modifier": "@Autowired\n\tprivate", "type": "SysSystemService", "declarator": "systemService", "var_name": "systemService"}], "file": "Realization/backend/acc/src/test/java/eu/bcvsolutions/idm/acc/bulk/action/impl/SystemDeleteBulkActionTest.java"}, "test_case": {"identifier": "prevalidationBulkActionByIds", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n\tpublic void prevalidationBulkActionByIds() {\n\t\tSysSystemDto system = helper.createSystem(getHelper().createName());\n\n\t\tIdmBulkActionDto bulkAction = this.findBulkAction(SysSystem.class, SystemDeleteBulkAction.NAME);\n\t\tbulkAction.getIdentifiers().add(system.getId());\n\n\t\t// None info results\n\t\tResultModels resultModels = bulkActionManager.prevalidate(bulkAction);\n\t\tassertEquals(0, resultModels.getInfos().size());\n\n\t\t// Assign identity to system\n\t\thelper.createIdentityAccount(system, getHelper().createIdentity());\n\n\t\t// Warning message, role has identity\n\t\tresultModels = bulkActionManager.prevalidate(bulkAction);\n\t\tassertEquals(1, resultModels.getInfos().size());\n\t}", "signature": "void prevalidationBulkActionByIds()", "full_signature": "@Test public void prevalidationBulkActionByIds()", "class_method_signature": "SystemDeleteBulkActionTest.prevalidationBulkActionByIds()", "testcase": true, "constructor": false, "invocations": ["createSystem", "createName", "getHelper", "findBulkAction", "add", "getIdentifiers", "getId", "prevalidate", "assertEquals", "size", "getInfos", "createIdentityAccount", "createIdentity", "getHelper", "prevalidate", "assertEquals", "size", "getInfos"]}, "focal_class": {"identifier": "SystemDeleteBulkAction", "superclass": "extends AbstractRemoveBulkAction<SysSystemDto, SysSystemFilter>", "interfaces": "", "fields": [{"original_string": "public static final String NAME = \"system-delete-bulk-action\";", "modifier": "public static final", "type": "String", "declarator": "NAME = \"system-delete-bulk-action\"", "var_name": "NAME"}, {"original_string": "@Autowired\n\tprivate SysSystemService systemService;", "modifier": "@Autowired\n\tprivate", "type": "SysSystemService", "declarator": "systemService", "var_name": "systemService"}, {"original_string": "@Autowired\n\tprivate AccAccountService accountService;", "modifier": "@Autowired\n\tprivate", "type": "AccAccountService", "declarator": "accountService", "var_name": "accountService"}, {"original_string": "@Autowired\n\tprivate SysProvisioningOperationService provisioningOperationService;", "modifier": "@Autowired\n\tprivate", "type": "SysProvisioningOperationService", "declarator": "provisioningOperationService", "var_name": "provisioningOperationService"}], "methods": [{"identifier": "getName", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String getName()", "full_signature": "@Override public String getName()", "class_method_signature": "SystemDeleteBulkAction.getName()", "testcase": false, "constructor": false}, {"identifier": "getAuthoritiesForEntity", "parameters": "()", "modifiers": "@Override protected", "return": "List<String>", "signature": "List<String> getAuthoritiesForEntity()", "full_signature": "@Override protected List<String> getAuthoritiesForEntity()", "class_method_signature": "SystemDeleteBulkAction.getAuthoritiesForEntity()", "testcase": false, "constructor": false}, {"identifier": "prevalidate", "parameters": "()", "modifiers": "@Override public", "return": "ResultModels", "signature": "ResultModels prevalidate()", "full_signature": "@Override public ResultModels prevalidate()", "class_method_signature": "SystemDeleteBulkAction.prevalidate()", "testcase": false, "constructor": false}, {"identifier": "getService", "parameters": "()", "modifiers": "@Override public", "return": "ReadWriteDtoService<SysSystemDto, SysSystemFilter>", "signature": "ReadWriteDtoService<SysSystemDto, SysSystemFilter> getService()", "full_signature": "@Override public ReadWriteDtoService<SysSystemDto, SysSystemFilter> getService()", "class_method_signature": "SystemDeleteBulkAction.getService()", "testcase": false, "constructor": false}], "file": "Realization/backend/acc/src/main/java/eu/bcvsolutions/idm/acc/bulk/action/impl/SystemDeleteBulkAction.java"}, "focal_method": {"identifier": "prevalidate", "parameters": "()", "modifiers": "@Override public", "return": "ResultModels", "body": "@Override\n\tpublic ResultModels prevalidate() {\n\t\tIdmBulkActionDto action = getAction();\n\t\tList<UUID> entities = getEntities(action, new StringBuilder());\n\t\tResultModels result = new ResultModels();\n\n\t\tMap<ResultModel, Long> models = new HashMap<>();\n\t\tentities.forEach(systemId -> {\n\t\t\tAccAccountFilter accountFilter = new AccAccountFilter();\n\t\t\taccountFilter.setSystemId(systemId);\n\t\t\t\n\t\t\tSysSystemDto system = getService().get(systemId);\n\t\t\t\n\t\t\tlong count = accountService.count(accountFilter);\n\t\t\tif (count > 0) {\n\t\t\t\tmodels.put(new DefaultResultModel(AccResultCode.SYSTEM_DELETE_BULK_ACTION_NUMBER_OF_ACCOUNTS,\n\t\t\t\t\t\tImmutableMap.of(\"system\", system.getCode(), \"count\", count)), count);\n\t\t\t}\n\t\t\t\n\t\t\tSysProvisioningOperationFilter operationFilter = new SysProvisioningOperationFilter();\n\t\t\toperationFilter.setSystemId(system.getId());\n\t\t\tlong countEntities = provisioningOperationService.count(operationFilter);\n\t\t\tif (countEntities > 0) {\n\t\t\t\tmodels.put(new DefaultResultModel(AccResultCode.SYSTEM_DELETE_BULK_ACTION_NUMBER_OF_PROVISIONINGS,\n\t\t\t\t\t\tImmutableMap.of(\"system\", system.getCode(), \"count\", countEntities)), countEntities);\n\t\t\t}\n\t\t});\n\n\t\t// Sort by count\n\t\tList<Entry<ResultModel, Long>> collect = models //\n\t\t\t\t.entrySet() //\n\t\t\t\t.stream() //\n\t\t\t\t.sorted(Collections.reverseOrder(Map.Entry.comparingByValue())) //\n\t\t\t\t// .limit(5) //\n\t\t\t\t.collect(Collectors.toList()); //\n\t\tcollect.forEach(entry -> {\n\t\t\tresult.addInfo(entry.getKey());\n\t\t});\n\n\t\treturn result;\n\t}", "signature": "ResultModels prevalidate()", "full_signature": "@Override public ResultModels prevalidate()", "class_method_signature": "SystemDeleteBulkAction.prevalidate()", "testcase": false, "constructor": false, "invocations": ["getAction", "getEntities", "forEach", "setSystemId", "get", "getService", "count", "put", "of", "getCode", "setSystemId", "getId", "count", "put", "of", "getCode", "collect", "sorted", "stream", "entrySet", "reverseOrder", "comparingByValue", "toList", "forEach", "addInfo", "getKey"]}, "repository": {"repo_id": 61879415, "url": "https://github.com/bcvsolutions/CzechIdMng", "stars": 25, "created": "6/24/2016 11:18:23 AM +00:00", "updates": "2020-01-27T15:14:40+00:00", "fork": "False", "license": "licensed"}}