{"test_class": {"identifier": "GetPeriodicMeterReadsCommandExecutorTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@InjectMocks\n    private GetPeriodicMeterReadsCommandExecutor executor;", "modifier": "@InjectMocks\n    private", "type": "GetPeriodicMeterReadsCommandExecutor", "declarator": "executor", "var_name": "executor"}, {"original_string": "@Mock\n    private DlmsMessageListener dlmsMessageListener;", "modifier": "@Mock\n    private", "type": "DlmsMessageListener", "declarator": "dlmsMessageListener", "var_name": "dlmsMessageListener"}, {"original_string": "@Mock\n    private DlmsHelper dlmsHelper;", "modifier": "@Mock\n    private", "type": "DlmsHelper", "declarator": "dlmsHelper", "var_name": "dlmsHelper"}, {"original_string": "@Mock\n    private DlmsObjectConfigService dlmsObjectConfigService;", "modifier": "@Mock\n    private", "type": "DlmsObjectConfigService", "declarator": "dlmsObjectConfigService", "var_name": "dlmsObjectConfigService"}, {"original_string": "@Mock\n    private DlmsConnectionManager connectionManager;", "modifier": "@Mock\n    private", "type": "DlmsConnectionManager", "declarator": "connectionManager", "var_name": "connectionManager"}, {"original_string": "private final DlmsDevice device = this.createDevice(Protocol.DSMR_4_2_2);", "modifier": "private final", "type": "DlmsDevice", "declarator": "device = this.createDevice(Protocol.DSMR_4_2_2)", "var_name": "device"}, {"original_string": "private final long from = 1111111L;", "modifier": "private final", "type": "long", "declarator": "from = 1111111L", "var_name": "from"}, {"original_string": "private final long to = 2222222L;", "modifier": "private final", "type": "long", "declarator": "to = 2222222L", "var_name": "to"}, {"original_string": "private final DateTime fromDateTime = new DateTime(this.from);", "modifier": "private final", "type": "DateTime", "declarator": "fromDateTime = new DateTime(this.from)", "var_name": "fromDateTime"}, {"original_string": "private final DateTime toDateTime = new DateTime(this.to);", "modifier": "private final", "type": "DateTime", "declarator": "toDateTime = new DateTime(this.to)", "var_name": "toDateTime"}], "file": "osgp/protocol-adapter-dlms/osgp-protocol-adapter-dlms/src/test/java/org/opensmartgridplatform/adapter/protocol/dlms/domain/commands/periodicmeterreads/GetPeriodicMeterReadsCommandExecutorTest.java"}, "test_case": {"identifier": "testExecuteObjectNotFound", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testExecuteObjectNotFound() {\n        // SETUP\n        final PeriodicMeterReadsRequestDto request = new PeriodicMeterReadsRequestDto(PeriodTypeDto.DAILY,\n                this.fromDateTime.toDate(), this.toDateTime.toDate(), ChannelDto.ONE);\n        when(this.dlmsObjectConfigService.findAttributeAddressForProfile(any(), any(), any(), any(), any(), any()))\n                .thenReturn(Optional.empty());\n\n        // CALL\n        try {\n            this.executor.execute(this.connectionManager, this.device, request);\n            fail(\"When no matching object is found, then execute should fail\");\n        } catch (final ProtocolAdapterException e) {\n            assertThat(e.getMessage()).isEqualTo(\"No address found for \" + DlmsObjectType.DAILY_LOAD_PROFILE);\n        }\n    }", "signature": "void testExecuteObjectNotFound()", "full_signature": "@Test public void testExecuteObjectNotFound()", "class_method_signature": "GetPeriodicMeterReadsCommandExecutorTest.testExecuteObjectNotFound()", "testcase": true, "constructor": false, "invocations": ["toDate", "toDate", "thenReturn", "when", "findAttributeAddressForProfile", "any", "any", "any", "any", "any", "any", "empty", "execute", "fail", "isEqualTo", "assertThat", "getMessage"]}, "focal_class": {"identifier": "GetPeriodicMeterReadsCommandExecutor", "superclass": "extends AbstractPeriodicMeterReadsCommandExecutor<PeriodicMeterReadsRequestDto, PeriodicMeterReadsResponseDto>", "interfaces": "", "fields": [{"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(GetPeriodicMeterReadsCommandExecutor.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(GetPeriodicMeterReadsCommandExecutor.class)", "var_name": "LOGGER"}, {"original_string": "static final String PERIODIC_E_METER_READS = \"Periodic E-Meter Reads\";", "modifier": "static final", "type": "String", "declarator": "PERIODIC_E_METER_READS = \"Periodic E-Meter Reads\"", "var_name": "PERIODIC_E_METER_READS"}, {"original_string": "private static final String FORMAT_DESCRIPTION =\n            \"GetPeriodicMeterReads %s from %s until %s, retrieve attribute: \" + \"%s\";", "modifier": "private static final", "type": "String", "declarator": "FORMAT_DESCRIPTION =\n            \"GetPeriodicMeterReads %s from %s until %s, retrieve attribute: \" + \"%s\"", "var_name": "FORMAT_DESCRIPTION"}, {"original_string": "private final DlmsHelper dlmsHelper;", "modifier": "private final", "type": "DlmsHelper", "declarator": "dlmsHelper", "var_name": "dlmsHelper"}, {"original_string": "private final DlmsObjectConfigService dlmsObjectConfigService;", "modifier": "private final", "type": "DlmsObjectConfigService", "declarator": "dlmsObjectConfigService", "var_name": "dlmsObjectConfigService"}], "methods": [{"identifier": "GetPeriodicMeterReadsCommandExecutor", "parameters": "(final DlmsHelper dlmsHelper,\n            final AmrProfileStatusCodeHelper amrProfileStatusCodeHelper,\n            final DlmsObjectConfigService dlmsObjectConfigService)", "modifiers": "@Autowired public", "return": "", "signature": " GetPeriodicMeterReadsCommandExecutor(final DlmsHelper dlmsHelper,\n            final AmrProfileStatusCodeHelper amrProfileStatusCodeHelper,\n            final DlmsObjectConfigService dlmsObjectConfigService)", "full_signature": "@Autowired public  GetPeriodicMeterReadsCommandExecutor(final DlmsHelper dlmsHelper,\n            final AmrProfileStatusCodeHelper amrProfileStatusCodeHelper,\n            final DlmsObjectConfigService dlmsObjectConfigService)", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.GetPeriodicMeterReadsCommandExecutor(final DlmsHelper dlmsHelper,\n            final AmrProfileStatusCodeHelper amrProfileStatusCodeHelper,\n            final DlmsObjectConfigService dlmsObjectConfigService)", "testcase": false, "constructor": true}, {"identifier": "fromBundleRequestInput", "parameters": "(final ActionRequestDto bundleInput)", "modifiers": "@Override public", "return": "PeriodicMeterReadsRequestDto", "signature": "PeriodicMeterReadsRequestDto fromBundleRequestInput(final ActionRequestDto bundleInput)", "full_signature": "@Override public PeriodicMeterReadsRequestDto fromBundleRequestInput(final ActionRequestDto bundleInput)", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.fromBundleRequestInput(final ActionRequestDto bundleInput)", "testcase": false, "constructor": false}, {"identifier": "execute", "parameters": "(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "modifiers": "@Override public", "return": "PeriodicMeterReadsResponseDto", "signature": "PeriodicMeterReadsResponseDto execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "full_signature": "@Override public PeriodicMeterReadsResponseDto execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "testcase": false, "constructor": false}, {"identifier": "convertToResponseItem", "parameters": "(final ConversionContext ctx,\n            final List<PeriodicMeterReadsResponseItemDto> periodicMeterReads)", "modifiers": "private", "return": "PeriodicMeterReadsResponseItemDto", "signature": "PeriodicMeterReadsResponseItemDto convertToResponseItem(final ConversionContext ctx,\n            final List<PeriodicMeterReadsResponseItemDto> periodicMeterReads)", "full_signature": "private PeriodicMeterReadsResponseItemDto convertToResponseItem(final ConversionContext ctx,\n            final List<PeriodicMeterReadsResponseItemDto> periodicMeterReads)", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.convertToResponseItem(final ConversionContext ctx,\n            final List<PeriodicMeterReadsResponseItemDto> periodicMeterReads)", "testcase": false, "constructor": false}, {"identifier": "getPreviousLogTime", "parameters": "(final List<PeriodicMeterReadsResponseItemDto> periodicMeterReads)", "modifiers": "private", "return": "Optional<Date>", "signature": "Optional<Date> getPreviousLogTime(final List<PeriodicMeterReadsResponseItemDto> periodicMeterReads)", "full_signature": "private Optional<Date> getPreviousLogTime(final List<PeriodicMeterReadsResponseItemDto> periodicMeterReads)", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.getPreviousLogTime(final List<PeriodicMeterReadsResponseItemDto> periodicMeterReads)", "testcase": false, "constructor": false}, {"identifier": "getScaledMeterValue", "parameters": "(final List<DataObject> bufferedObjects,\n            final List<GetResult> getResultList, final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType,\n            final String description)", "modifiers": "private", "return": "DlmsMeterValueDto", "signature": "DlmsMeterValueDto getScaledMeterValue(final List<DataObject> bufferedObjects,\n            final List<GetResult> getResultList, final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType,\n            final String description)", "full_signature": "private DlmsMeterValueDto getScaledMeterValue(final List<DataObject> bufferedObjects,\n            final List<GetResult> getResultList, final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType,\n            final String description)", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.getScaledMeterValue(final List<DataObject> bufferedObjects,\n            final List<GetResult> getResultList, final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType,\n            final String description)", "testcase": false, "constructor": false}, {"identifier": "readValue", "parameters": "(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType)", "modifiers": "private", "return": "DataObject", "signature": "DataObject readValue(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType)", "full_signature": "private DataObject readValue(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType)", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.readValue(final List<DataObject> bufferedObjects,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType)", "testcase": false, "constructor": false}, {"identifier": "readScalerUnit", "parameters": "(final List<GetResult> getResultList,\n            final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType)", "modifiers": "private", "return": "DataObject", "signature": "DataObject readScalerUnit(final List<GetResult> getResultList,\n            final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType)", "full_signature": "private DataObject readScalerUnit(final List<GetResult> getResultList,\n            final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType)", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.readScalerUnit(final List<GetResult> getResultList,\n            final List<AttributeAddress> attributeAddresses,\n            final AttributeAddressForProfile attributeAddressForProfile, final DlmsObjectType objectType)", "testcase": false, "constructor": false}, {"identifier": "getProfileBufferAddress", "parameters": "(final PeriodTypeDto periodType,\n            final DateTime beginDateTime, final DateTime endDateTime, final DlmsDevice device)", "modifiers": "private", "return": "AttributeAddressForProfile", "signature": "AttributeAddressForProfile getProfileBufferAddress(final PeriodTypeDto periodType,\n            final DateTime beginDateTime, final DateTime endDateTime, final DlmsDevice device)", "full_signature": "private AttributeAddressForProfile getProfileBufferAddress(final PeriodTypeDto periodType,\n            final DateTime beginDateTime, final DateTime endDateTime, final DlmsDevice device)", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.getProfileBufferAddress(final PeriodTypeDto periodType,\n            final DateTime beginDateTime, final DateTime endDateTime, final DlmsDevice device)", "testcase": false, "constructor": false}, {"identifier": "getScalerUnitAddresses", "parameters": "(final AttributeAddressForProfile attributeAddressForProfile)", "modifiers": "private", "return": "List<AttributeAddress>", "signature": "List<AttributeAddress> getScalerUnitAddresses(final AttributeAddressForProfile attributeAddressForProfile)", "full_signature": "private List<AttributeAddress> getScalerUnitAddresses(final AttributeAddressForProfile attributeAddressForProfile)", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.getScalerUnitAddresses(final AttributeAddressForProfile attributeAddressForProfile)", "testcase": false, "constructor": false}, {"identifier": "getLogger", "parameters": "()", "modifiers": "@Override protected", "return": "Logger", "signature": "Logger getLogger()", "full_signature": "@Override protected Logger getLogger()", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.getLogger()", "testcase": false, "constructor": false}], "file": "osgp/protocol-adapter-dlms/osgp-protocol-adapter-dlms/src/main/java/org/opensmartgridplatform/adapter/protocol/dlms/domain/commands/periodicmeterreads/GetPeriodicMeterReadsCommandExecutor.java"}, "focal_method": {"identifier": "execute", "parameters": "(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "modifiers": "@Override public", "return": "PeriodicMeterReadsResponseDto", "body": "@Override\n    public PeriodicMeterReadsResponseDto execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery) throws ProtocolAdapterException {\n\n        if (periodicMeterReadsQuery == null) {\n            throw new IllegalArgumentException(\n                    \"PeriodicMeterReadsQuery should contain PeriodType, BeginDate and EndDate.\");\n        }\n\n        final PeriodTypeDto queryPeriodType = periodicMeterReadsQuery.getPeriodType();\n        final DateTime from = new DateTime(periodicMeterReadsQuery.getBeginDate());\n        final DateTime to = new DateTime(periodicMeterReadsQuery.getEndDate());\n\n        final AttributeAddressForProfile profileBufferAddress = this.getProfileBufferAddress(queryPeriodType, from, to,\n                device);\n\n        final List<AttributeAddress> scalerUnitAddresses = this.getScalerUnitAddresses(profileBufferAddress);\n\n        final Optional<ProfileCaptureTime> intervalTime = this.getProfileCaptureTime(device,\n                this.dlmsObjectConfigService, Medium.ELECTRICITY);\n\n        LOGGER.debug(\"Retrieving current billing period and profiles for period type: {}, from: {}, to: {}\",\n                queryPeriodType, from, to);\n\n        // Get results one by one because getWithList does not work for all devices\n        final List<GetResult> getResultList = new ArrayList<>();\n\n        final List<AttributeAddress> allAttributeAddresses = new ArrayList<>();\n        allAttributeAddresses.add(profileBufferAddress.getAttributeAddress());\n        allAttributeAddresses.addAll(scalerUnitAddresses);\n\n        for (final AttributeAddress address : allAttributeAddresses) {\n\n            conn.getDlmsMessageListener().setDescription(String.format(FORMAT_DESCRIPTION, queryPeriodType, from, to,\n                    JdlmsObjectToStringUtil.describeAttributes(address)));\n\n            getResultList.addAll(\n                    this.dlmsHelper.getAndCheck(conn, device, \"retrieve periodic meter reads for \" + queryPeriodType,\n                            address));\n        }\n\n        LOGGER.info(\"Received getResult: {} \", getResultList);\n\n        final DataObject resultData = this.dlmsHelper.readDataObject(getResultList.get(0), PERIODIC_E_METER_READS);\n        final List<DataObject> bufferedObjectsList = resultData.getValue();\n\n        final List<PeriodicMeterReadsResponseItemDto> periodicMeterReads = new ArrayList<>();\n        for (final DataObject bufferedObject : bufferedObjectsList) {\n            final List<DataObject> bufferedObjectValue = bufferedObject.getValue();\n\n            try {\n                periodicMeterReads.add(this.convertToResponseItem(\n                        new ConversionContext(periodicMeterReadsQuery, bufferedObjectValue, getResultList,\n                                profileBufferAddress, scalerUnitAddresses, intervalTime), periodicMeterReads));\n            } catch (final BufferedDateTimeValidationException e) {\n                LOGGER.warn(e.getMessage(), e);\n            }\n        }\n\n        return new PeriodicMeterReadsResponseDto(queryPeriodType, periodicMeterReads);\n    }", "signature": "PeriodicMeterReadsResponseDto execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "full_signature": "@Override public PeriodicMeterReadsResponseDto execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "class_method_signature": "GetPeriodicMeterReadsCommandExecutor.execute(final DlmsConnectionManager conn, final DlmsDevice device,\n            final PeriodicMeterReadsRequestDto periodicMeterReadsQuery)", "testcase": false, "constructor": false, "invocations": ["getPeriodType", "getBeginDate", "getEndDate", "getProfileBufferAddress", "getScalerUnitAddresses", "getProfileCaptureTime", "debug", "add", "getAttributeAddress", "addAll", "setDescription", "getDlmsMessageListener", "format", "describeAttributes", "addAll", "getAndCheck", "info", "readDataObject", "get", "getValue", "getValue", "add", "convertToResponseItem", "warn", "getMessage"]}, "repository": {"repo_id": 154302277, "url": "https://github.com/OSGP/open-smart-grid-platform", "stars": 30, "created": "10/23/2018 9:41:12 AM +00:00", "updates": "2020-01-26T20:15:09+00:00", "fork": "False", "license": "licensed"}}