{"test_class": {"identifier": "BaseJavaDelegateTest", "superclass": "extends AbstractServiceTest", "interfaces": "", "fields": [{"original_string": "@Mock\n    private ActivitiHelper activitiHelper;", "modifier": "@Mock\n    private", "type": "ActivitiHelper", "declarator": "activitiHelper", "var_name": "activitiHelper"}, {"original_string": "@Mock\n    private ActivitiRuntimeHelper activitiRuntimeHelper;", "modifier": "@Mock\n    private", "type": "ActivitiRuntimeHelper", "declarator": "activitiRuntimeHelper", "var_name": "activitiRuntimeHelper"}, {"original_string": "@Mock\n    private ActivitiService activitiService;", "modifier": "@Mock\n    private", "type": "ActivitiService", "declarator": "activitiService", "var_name": "activitiService"}, {"original_string": "@Autowired\n    @InjectMocks\n    private MockJavaDelegate baseJavaDelegate;", "modifier": "@Autowired\n    @InjectMocks\n    private", "type": "MockJavaDelegate", "declarator": "baseJavaDelegate", "var_name": "baseJavaDelegate"}, {"original_string": "@Mock\n    private ConfigurationDaoHelper configurationDaoHelper;", "modifier": "@Mock\n    private", "type": "ConfigurationDaoHelper", "declarator": "configurationDaoHelper", "var_name": "configurationDaoHelper"}, {"original_string": "@Mock\n    private DelegateExecution delegateExecution;", "modifier": "@Mock\n    private", "type": "DelegateExecution", "declarator": "delegateExecution", "var_name": "delegateExecution"}, {"original_string": "@Mock\n    private JobDefinitionDaoHelper jobDefinitionDaoHelper;", "modifier": "@Mock\n    private", "type": "JobDefinitionDaoHelper", "declarator": "jobDefinitionDaoHelper", "var_name": "jobDefinitionDaoHelper"}, {"original_string": "@Mock\n    private UserNamespaceAuthorizationHelper userNamespaceAuthorizationHelper;", "modifier": "@Mock\n    private", "type": "UserNamespaceAuthorizationHelper", "declarator": "userNamespaceAuthorizationHelper", "var_name": "userNamespaceAuthorizationHelper"}], "file": "herd-code/herd-service/src/test/java/org/finra/herd/service/activiti/task/BaseJavaDelegateTest.java"}, "test_case": {"identifier": "testExecute", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testExecute() throws Exception\n    {\n        // Set up expected values.\n        String jobDefinitionNamespace = \"jobDefinitionNamespace\";\n        String jobDefinitionName = \"jobDefinitionName\";\n        String processDefinitionId = \"processDefinitionId\";\n        String processDefinitionKey = String.format(\"%s.%s\", jobDefinitionNamespace, jobDefinitionName);\n        String updatedBy = \"updatedBy\";\n        JobDefinitionEntity jobDefinitionEntity = new JobDefinitionEntity();\n        jobDefinitionEntity.setUpdatedBy(updatedBy);\n\n        // Mock dependency methods.\n        when(delegateExecution.getProcessDefinitionId()).thenReturn(processDefinitionId);\n        ProcessDefinition processDefinition = mock(ProcessDefinition.class);\n        when(processDefinition.getKey()).thenReturn(processDefinitionKey);\n        when(activitiService.getProcessDefinitionById(any())).thenReturn(processDefinition);\n        when(jobDefinitionDaoHelper.getJobDefinitionEntity(any(), any())).thenReturn(jobDefinitionEntity);\n\n        // Execute test method.\n        baseJavaDelegate.execute(delegateExecution);\n\n        // Verify dependencies were invoked correctly.\n        InOrder inOrder = inOrder(configurationDaoHelper, activitiService, jobDefinitionDaoHelper, userNamespaceAuthorizationHelper, activitiRuntimeHelper);\n        inOrder.verify(configurationDaoHelper).checkNotAllowedMethod(baseJavaDelegate.getClass().getCanonicalName());\n        inOrder.verify(activitiService).getProcessDefinitionById(processDefinitionId);\n        inOrder.verify(jobDefinitionDaoHelper).getJobDefinitionEntity(jobDefinitionNamespace, jobDefinitionName);\n        inOrder.verify(userNamespaceAuthorizationHelper).buildNamespaceAuthorizations(applicationUserUserIdEq(updatedBy));\n        inOrder.verify(activitiRuntimeHelper).setTaskSuccessInWorkflow(delegateExecution);\n        inOrder.verifyNoMoreInteractions();\n        verifyNoMoreInteractions(configurationDaoHelper, activitiService, jobDefinitionDaoHelper, userNamespaceAuthorizationHelper, activitiRuntimeHelper);\n\n        // Assert that security context is cleared at the end of execute.\n        assertNull(SecurityContextHolder.getContext().getAuthentication());\n    }", "signature": "void testExecute()", "full_signature": "@Test public void testExecute()", "class_method_signature": "BaseJavaDelegateTest.testExecute()", "testcase": true, "constructor": false, "invocations": ["format", "setUpdatedBy", "thenReturn", "when", "getProcessDefinitionId", "mock", "thenReturn", "when", "getKey", "thenReturn", "when", "getProcessDefinitionById", "any", "thenReturn", "when", "getJobDefinitionEntity", "any", "any", "execute", "inOrder", "checkNotAllowedMethod", "verify", "getCanonicalName", "getClass", "getProcessDefinitionById", "verify", "getJobDefinitionEntity", "verify", "buildNamespaceAuthorizations", "verify", "applicationUserUserIdEq", "setTaskSuccessInWorkflow", "verify", "verifyNoMoreInteractions", "verifyNoMoreInteractions", "assertNull", "getAuthentication", "getContext"]}, "focal_class": {"identifier": "BaseJavaDelegate", "superclass": "", "interfaces": "implements JavaDelegate", "fields": [{"original_string": "private static final Logger LOGGER = LoggerFactory.getLogger(BaseJavaDelegate.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOGGER = LoggerFactory.getLogger(BaseJavaDelegate.class)", "var_name": "LOGGER"}, {"original_string": "private static final String ACTIVITI_PROCESS_INSTANCE_ID_KEY = \"activitiProcessInstanceId\";", "modifier": "private static final", "type": "String", "declarator": "ACTIVITI_PROCESS_INSTANCE_ID_KEY = \"activitiProcessInstanceId\"", "var_name": "ACTIVITI_PROCESS_INSTANCE_ID_KEY"}, {"original_string": "private static final String USER_ID_KEY = \"uid\";", "modifier": "private static final", "type": "String", "declarator": "USER_ID_KEY = \"uid\"", "var_name": "USER_ID_KEY"}, {"original_string": "private static final String ACTIVITI_LOG_MESSAGE_PREFIX = \"HerdTimingLog timingSource=Activiti\";", "modifier": "private static final", "type": "String", "declarator": "ACTIVITI_LOG_MESSAGE_PREFIX = \"HerdTimingLog timingSource=Activiti\"", "var_name": "ACTIVITI_LOG_MESSAGE_PREFIX"}, {"original_string": "@Autowired\n    protected ActivitiService activitiService;", "modifier": "@Autowired\n    protected", "type": "ActivitiService", "declarator": "activitiService", "var_name": "activitiService"}, {"original_string": "@Autowired\n    protected ConfigurationDaoHelper configurationDaoHelper;", "modifier": "@Autowired\n    protected", "type": "ConfigurationDaoHelper", "declarator": "configurationDaoHelper", "var_name": "configurationDaoHelper"}, {"original_string": "@Autowired\n    protected HerdStringHelper daoHelper;", "modifier": "@Autowired\n    protected", "type": "HerdStringHelper", "declarator": "daoHelper", "var_name": "daoHelper"}, {"original_string": "@Autowired\n    protected HerdStringHelper herdStringHelper;", "modifier": "@Autowired\n    protected", "type": "HerdStringHelper", "declarator": "herdStringHelper", "var_name": "herdStringHelper"}, {"original_string": "@Autowired\n    protected JobDefinitionDao jobDefinitionDao;", "modifier": "@Autowired\n    protected", "type": "JobDefinitionDao", "declarator": "jobDefinitionDao", "var_name": "jobDefinitionDao"}, {"original_string": "@Autowired\n    protected JobDefinitionDaoHelper jobDefinitionDaoHelper;", "modifier": "@Autowired\n    protected", "type": "JobDefinitionDaoHelper", "declarator": "jobDefinitionDaoHelper", "var_name": "jobDefinitionDaoHelper"}, {"original_string": "@Autowired\n    protected JobDefinitionHelper jobDefinitionHelper;", "modifier": "@Autowired\n    protected", "type": "JobDefinitionHelper", "declarator": "jobDefinitionHelper", "var_name": "jobDefinitionHelper"}, {"original_string": "@Autowired\n    protected JsonHelper jsonHelper;", "modifier": "@Autowired\n    protected", "type": "JsonHelper", "declarator": "jsonHelper", "var_name": "jsonHelper"}, {"original_string": "@Autowired\n    protected UserNamespaceAuthorizationHelper userNamespaceAuthorizationHelper;", "modifier": "@Autowired\n    protected", "type": "UserNamespaceAuthorizationHelper", "declarator": "userNamespaceAuthorizationHelper", "var_name": "userNamespaceAuthorizationHelper"}, {"original_string": "@Autowired\n    protected XmlHelper xmlHelper;", "modifier": "@Autowired\n    protected", "type": "XmlHelper", "declarator": "xmlHelper", "var_name": "xmlHelper"}, {"original_string": "public static final String VARIABLE_JSON_RESPONSE = \"jsonResponse\";", "modifier": "public static final", "type": "String", "declarator": "VARIABLE_JSON_RESPONSE = \"jsonResponse\"", "var_name": "VARIABLE_JSON_RESPONSE"}, {"original_string": "private boolean springInitialized;", "modifier": "private", "type": "boolean", "declarator": "springInitialized", "var_name": "springInitialized"}, {"original_string": "@Autowired\n    protected ActivitiHelper activitiHelper;", "modifier": "@Autowired\n    protected", "type": "ActivitiHelper", "declarator": "activitiHelper", "var_name": "activitiHelper"}, {"original_string": "@Autowired\n    protected ActivitiRuntimeHelper activitiRuntimeHelper;", "modifier": "@Autowired\n    protected", "type": "ActivitiRuntimeHelper", "declarator": "activitiRuntimeHelper", "var_name": "activitiRuntimeHelper"}, {"original_string": "@Autowired\n    @Qualifier(\"herdErrorInformationExceptionHandler\") // This is to ensure we get the base class bean rather than any classes that extend it.\n    private HerdErrorInformationExceptionHandler errorInformationExceptionHandler;", "modifier": "@Autowired\n    @Qualifier(\"herdErrorInformationExceptionHandler\") // This is to ensure we get the base class bean rather than any classes that extend it.\n    private", "type": "HerdErrorInformationExceptionHandler", "declarator": "errorInformationExceptionHandler", "var_name": "errorInformationExceptionHandler"}], "methods": [{"identifier": "executeImpl", "parameters": "(DelegateExecution execution)", "modifiers": "public abstract", "return": "void", "signature": "void executeImpl(DelegateExecution execution)", "full_signature": "public abstract void executeImpl(DelegateExecution execution)", "class_method_signature": "BaseJavaDelegate.executeImpl(DelegateExecution execution)", "testcase": false, "constructor": false}, {"identifier": "execute", "parameters": "(DelegateExecution execution)", "modifiers": "@Override public final", "return": "void", "signature": "void execute(DelegateExecution execution)", "full_signature": "@Override public final void execute(DelegateExecution execution)", "class_method_signature": "BaseJavaDelegate.execute(DelegateExecution execution)", "testcase": false, "constructor": false}, {"identifier": "logTaskExecutionTime", "parameters": "(long taskBeginTimeMillis, boolean taskSuccessFlag)", "modifiers": "protected", "return": "void", "signature": "void logTaskExecutionTime(long taskBeginTimeMillis, boolean taskSuccessFlag)", "full_signature": "protected void logTaskExecutionTime(long taskBeginTimeMillis, boolean taskSuccessFlag)", "class_method_signature": "BaseJavaDelegate.logTaskExecutionTime(long taskBeginTimeMillis, boolean taskSuccessFlag)", "testcase": false, "constructor": false}, {"identifier": "setSecurityContext", "parameters": "(ApplicationUser applicationUser)", "modifiers": "protected", "return": "void", "signature": "void setSecurityContext(ApplicationUser applicationUser)", "full_signature": "protected void setSecurityContext(ApplicationUser applicationUser)", "class_method_signature": "BaseJavaDelegate.setSecurityContext(ApplicationUser applicationUser)", "testcase": false, "constructor": false}, {"identifier": "getApplicationUser", "parameters": "(DelegateExecution execution)", "modifiers": "protected", "return": "ApplicationUser", "signature": "ApplicationUser getApplicationUser(DelegateExecution execution)", "full_signature": "protected ApplicationUser getApplicationUser(DelegateExecution execution)", "class_method_signature": "BaseJavaDelegate.getApplicationUser(DelegateExecution execution)", "testcase": false, "constructor": false}, {"identifier": "handleException", "parameters": "(DelegateExecution execution, Exception exception)", "modifiers": "protected", "return": "void", "signature": "void handleException(DelegateExecution execution, Exception exception)", "full_signature": "protected void handleException(DelegateExecution execution, Exception exception)", "class_method_signature": "BaseJavaDelegate.handleException(DelegateExecution execution, Exception exception)", "testcase": false, "constructor": false}, {"identifier": "setJsonResponseAsWorkflowVariable", "parameters": "(Object responseObject, DelegateExecution execution)", "modifiers": "public", "return": "void", "signature": "void setJsonResponseAsWorkflowVariable(Object responseObject, DelegateExecution execution)", "full_signature": "public void setJsonResponseAsWorkflowVariable(Object responseObject, DelegateExecution execution)", "class_method_signature": "BaseJavaDelegate.setJsonResponseAsWorkflowVariable(Object responseObject, DelegateExecution execution)", "testcase": false, "constructor": false}, {"identifier": "setJsonResponseAsWorkflowVariable", "parameters": "(Object responseObject, String executionId, String activitiId)", "modifiers": "public", "return": "void", "signature": "void setJsonResponseAsWorkflowVariable(Object responseObject, String executionId, String activitiId)", "full_signature": "public void setJsonResponseAsWorkflowVariable(Object responseObject, String executionId, String activitiId)", "class_method_signature": "BaseJavaDelegate.setJsonResponseAsWorkflowVariable(Object responseObject, String executionId, String activitiId)", "testcase": false, "constructor": false}, {"identifier": "isSpringInitialized", "parameters": "()", "modifiers": "public", "return": "boolean", "signature": "boolean isSpringInitialized()", "full_signature": "public boolean isSpringInitialized()", "class_method_signature": "BaseJavaDelegate.isSpringInitialized()", "testcase": false, "constructor": false}, {"identifier": "setSpringInitialized", "parameters": "(boolean springInitialized)", "modifiers": "public", "return": "void", "signature": "void setSpringInitialized(boolean springInitialized)", "full_signature": "public void setSpringInitialized(boolean springInitialized)", "class_method_signature": "BaseJavaDelegate.setSpringInitialized(boolean springInitialized)", "testcase": false, "constructor": false}, {"identifier": "setTaskWorkflowVariable", "parameters": "(DelegateExecution execution, String variableName, Object variableValue)", "modifiers": "protected", "return": "void", "signature": "void setTaskWorkflowVariable(DelegateExecution execution, String variableName, Object variableValue)", "full_signature": "protected void setTaskWorkflowVariable(DelegateExecution execution, String variableName, Object variableValue)", "class_method_signature": "BaseJavaDelegate.setTaskWorkflowVariable(DelegateExecution execution, String variableName, Object variableValue)", "testcase": false, "constructor": false}, {"identifier": "setTaskWorkflowVariable", "parameters": "(String executionId, String activitiId, String variableName, Object variableValue)", "modifiers": "protected", "return": "void", "signature": "void setTaskWorkflowVariable(String executionId, String activitiId, String variableName, Object variableValue)", "full_signature": "protected void setTaskWorkflowVariable(String executionId, String activitiId, String variableName, Object variableValue)", "class_method_signature": "BaseJavaDelegate.setTaskWorkflowVariable(String executionId, String activitiId, String variableName, Object variableValue)", "testcase": false, "constructor": false}, {"identifier": "getRequestObject", "parameters": "(String contentType, String requestString, Class xsdClass)", "modifiers": "@SuppressWarnings({\"unchecked\", \"rawtypes\"}) protected", "return": "T", "signature": "T getRequestObject(String contentType, String requestString, Class xsdClass)", "full_signature": "@SuppressWarnings({\"unchecked\", \"rawtypes\"}) protected T getRequestObject(String contentType, String requestString, Class xsdClass)", "class_method_signature": "BaseJavaDelegate.getRequestObject(String contentType, String requestString, Class xsdClass)", "testcase": false, "constructor": false}, {"identifier": "logInputParameters", "parameters": "(DelegateExecution execution)", "modifiers": "protected", "return": "void", "signature": "void logInputParameters(DelegateExecution execution)", "full_signature": "protected void logInputParameters(DelegateExecution execution)", "class_method_signature": "BaseJavaDelegate.logInputParameters(DelegateExecution execution)", "testcase": false, "constructor": false}], "file": "herd-code/herd-service/src/main/java/org/finra/herd/service/activiti/task/BaseJavaDelegate.java"}, "focal_method": {"identifier": "execute", "parameters": "(DelegateExecution execution)", "modifiers": "@Override public final", "return": "void", "body": "@Override\n    public final void execute(DelegateExecution execution) throws Exception\n    {\n        long taskBeginTimeMillis = 0;\n        boolean taskSuccessFlag = false;\n        try\n        {\n            // Set the task begin time\n            taskBeginTimeMillis = System.currentTimeMillis();\n            \n            // Need to clear the security context here since the current thread may have been reused,\n            // which may might have left over its security context. If we do not clear the security\n            // context, any subsequent calls may be restricted by the permissions given\n            // to the previous thread's security context.\n            SecurityContextHolder.clearContext();\n\n            // Check if method is not allowed.\n            configurationDaoHelper.checkNotAllowedMethod(this.getClass().getCanonicalName());\n\n            // Set the security context per last updater of the current process instance's job definition.\n            ApplicationUser applicationUser = getApplicationUser(execution);\n            setSecurityContext(applicationUser);\n\n            // Set the MDC property for the Activiti process instance ID and user ID.\n            MDC.put(ACTIVITI_PROCESS_INSTANCE_ID_KEY, \"activitiProcessInstanceId=\" + execution.getProcessInstanceId());\n            MDC.put(USER_ID_KEY, \"userId=\" + (applicationUser.getUserId() == null ? \"\" : applicationUser.getUserId()));\n\n            // Log all input variables from the execution (before the execution starts).\n            logInputParameters(execution);\n\n            // Perform the execution implementation handled in the sub-class.\n            executeImpl(execution);\n\n            // Set a success status as a workflow variable.\n            activitiRuntimeHelper.setTaskSuccessInWorkflow(execution);\n\n            // Set the flag to true since there is no exception thrown\n            taskSuccessFlag = true;\n        }\n        catch (Exception ex)\n        {\n            handleException(execution, ex);\n        }\n        finally\n        {\n            // Log the task execution time\n            logTaskExecutionTime(taskBeginTimeMillis, taskSuccessFlag);\n\n            // Remove the MDC property to ensure they don't accidentally get used by anybody else.\n            MDC.remove(ACTIVITI_PROCESS_INSTANCE_ID_KEY);\n            MDC.remove(USER_ID_KEY);\n\n            // Clear up the security context.\n            SecurityContextHolder.clearContext();\n        }\n    }", "signature": "void execute(DelegateExecution execution)", "full_signature": "@Override public final void execute(DelegateExecution execution)", "class_method_signature": "BaseJavaDelegate.execute(DelegateExecution execution)", "testcase": false, "constructor": false, "invocations": ["currentTimeMillis", "clearContext", "checkNotAllowedMethod", "getCanonicalName", "getClass", "getApplicationUser", "setSecurityContext", "put", "getProcessInstanceId", "put", "getUserId", "getUserId", "logInputParameters", "executeImpl", "setTaskSuccessInWorkflow", "handleException", "logTaskExecutionTime", "remove", "remove", "clearContext"]}, "repository": {"repo_id": 42949039, "url": "https://github.com/FINRAOS/herd", "language": "Java", "is_fork": false, "fork_count": 36, "stargazer_count": 120, "size": 205797, "license": "licensed"}}