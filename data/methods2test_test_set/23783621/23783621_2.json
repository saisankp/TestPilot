{"test_class": {"identifier": "VanillaIndexCacheTest", "superclass": "extends VanillaChronicleTestBase", "interfaces": "", "fields": [], "file": "chronicle/src/test/java/net/openhft/chronicle/VanillaIndexCacheTest.java"}, "test_case": {"identifier": "testIndexFor", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testIndexFor() throws Exception {\n        final String baseDir = getTestPath();\n        assertNotNull(baseDir);\n\n        final DateCache dateCache = new DateCache(\"yyyyMMddHHmmss\", 1000);\n        final VanillaIndexCache cache = new VanillaIndexCache(baseDir, 10 + 3, dateCache);\n\n        try {\n            int cycle = (int) (System.currentTimeMillis() / 1000);\n            VanillaMappedBytes vanillaBuffer0 = cache.indexFor(cycle, 0, true);\n            vanillaBuffer0.writeLong(0, 0x12345678);\n            File file0 = cache.fileFor(cycle, 0, true);\n            assertEquals(8 << 10, file0.length());\n            assertEquals(0x12345678L, vanillaBuffer0.readLong(0));\n            vanillaBuffer0.release();\n\n            VanillaMappedBytes vanillaBuffer1 = cache.indexFor(cycle, 1, true);\n            File file1 = cache.fileFor(cycle, 1, true);\n            assertEquals(8 << 10, file1.length());\n            vanillaBuffer1.release();\n            assertNotEquals(file1, file0);\n\n            VanillaMappedBytes vanillaBuffer2 = cache.indexFor(cycle, 2, true);\n            File file2 = cache.fileFor(cycle, 2, true);\n            assertEquals(8 << 10, file2.length());\n            vanillaBuffer2.release();\n\n            assertNotEquals(file2, file0);\n            assertNotEquals(file2, file1);\n            cache.close();\n            assertEquals(0, vanillaBuffer0.refCount());\n            assertEquals(0, vanillaBuffer1.refCount());\n            assertEquals(0, vanillaBuffer2.refCount());\n\n            // check you can delete after closing.\n            assertTrue(file0.delete());\n            assertTrue(file1.delete());\n            assertTrue(file2.delete());\n            assertTrue(file0.getParentFile().delete());\n\n            cache.checkCounts(1, 1);\n        } finally {\n            cache.close();\n            IOTools.deleteDir(baseDir);\n\n            assertFalse(new File(baseDir).exists());\n        }\n    }", "signature": "void testIndexFor()", "full_signature": "@Test public void testIndexFor()", "class_method_signature": "VanillaIndexCacheTest.testIndexFor()", "testcase": true, "constructor": false, "invocations": ["getTestPath", "assertNotNull", "currentTimeMillis", "indexFor", "writeLong", "fileFor", "assertEquals", "length", "assertEquals", "readLong", "release", "indexFor", "fileFor", "assertEquals", "length", "release", "assertNotEquals", "indexFor", "fileFor", "assertEquals", "length", "release", "assertNotEquals", "assertNotEquals", "close", "assertEquals", "refCount", "assertEquals", "refCount", "assertEquals", "refCount", "assertTrue", "delete", "assertTrue", "delete", "assertTrue", "delete", "assertTrue", "delete", "getParentFile", "checkCounts", "close", "deleteDir", "assertFalse", "exists"]}, "focal_class": {"identifier": "VanillaIndexCache", "superclass": "", "interfaces": "implements Closeable", "fields": [{"original_string": "private static final String FILE_NAME_PREFIX = \"index-\";", "modifier": "private static final", "type": "String", "declarator": "FILE_NAME_PREFIX = \"index-\"", "var_name": "FILE_NAME_PREFIX"}, {"original_string": "private final String basePath;", "modifier": "private final", "type": "String", "declarator": "basePath", "var_name": "basePath"}, {"original_string": "private final File baseFile;", "modifier": "private final", "type": "File", "declarator": "baseFile", "var_name": "baseFile"}, {"original_string": "private final IndexKey key = new IndexKey();", "modifier": "private final", "type": "IndexKey", "declarator": "key = new IndexKey()", "var_name": "key"}, {"original_string": "private final int blockBits;", "modifier": "private final", "type": "int", "declarator": "blockBits", "var_name": "blockBits"}, {"original_string": "private final DateCache dateCache;", "modifier": "private final", "type": "DateCache", "declarator": "dateCache", "var_name": "dateCache"}, {"original_string": "private final VanillaMappedCache<IndexKey> cache;", "modifier": "private final", "type": "VanillaMappedCache<IndexKey>", "declarator": "cache", "var_name": "cache"}], "methods": [{"identifier": "VanillaIndexCache", "parameters": "(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache)", "modifiers": "public", "return": "", "signature": " VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache)", "full_signature": "public  VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache)", "class_method_signature": "VanillaIndexCache.VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache)", "testcase": false, "constructor": true}, {"identifier": "VanillaIndexCache", "parameters": "(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, @NotNull VanillaChronicleConfig config)", "modifiers": "public", "return": "", "signature": " VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, @NotNull VanillaChronicleConfig config)", "full_signature": "public  VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, @NotNull VanillaChronicleConfig config)", "class_method_signature": "VanillaIndexCache.VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, @NotNull VanillaChronicleConfig config)", "testcase": false, "constructor": true}, {"identifier": "VanillaIndexCache", "parameters": "(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, int capacity)", "modifiers": "public", "return": "", "signature": " VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, int capacity)", "full_signature": "public  VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, int capacity)", "class_method_signature": "VanillaIndexCache.VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, int capacity)", "testcase": false, "constructor": true}, {"identifier": "VanillaIndexCache", "parameters": "(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, int capacity, boolean cleanupOnClose)", "modifiers": "public", "return": "", "signature": " VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, int capacity, boolean cleanupOnClose)", "full_signature": "public  VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, int capacity, boolean cleanupOnClose)", "class_method_signature": "VanillaIndexCache.VanillaIndexCache(@NotNull String basePath, int blockBits, @NotNull DateCache dateCache, int capacity, boolean cleanupOnClose)", "testcase": false, "constructor": true}, {"identifier": "fileFor", "parameters": "(int cycle, int indexCount, boolean forAppend)", "modifiers": "public", "return": "File", "signature": "File fileFor(int cycle, int indexCount, boolean forAppend)", "full_signature": "public File fileFor(int cycle, int indexCount, boolean forAppend)", "class_method_signature": "VanillaIndexCache.fileFor(int cycle, int indexCount, boolean forAppend)", "testcase": false, "constructor": false}, {"identifier": "indexFor", "parameters": "(int cycle, int indexCount, boolean forAppend)", "modifiers": "public synchronized", "return": "VanillaMappedBytes", "signature": "VanillaMappedBytes indexFor(int cycle, int indexCount, boolean forAppend)", "full_signature": "public synchronized VanillaMappedBytes indexFor(int cycle, int indexCount, boolean forAppend)", "class_method_signature": "VanillaIndexCache.indexFor(int cycle, int indexCount, boolean forAppend)", "testcase": false, "constructor": false}, {"identifier": "close", "parameters": "()", "modifiers": "@Override public synchronized", "return": "void", "signature": "void close()", "full_signature": "@Override public synchronized void close()", "class_method_signature": "VanillaIndexCache.close()", "testcase": false, "constructor": false}, {"identifier": "lastIndexFile", "parameters": "(int cycle)", "modifiers": "", "return": "int", "signature": "int lastIndexFile(int cycle)", "full_signature": " int lastIndexFile(int cycle)", "class_method_signature": "VanillaIndexCache.lastIndexFile(int cycle)", "testcase": false, "constructor": false}, {"identifier": "lastIndexFile", "parameters": "(int cycle, int defaultCycle)", "modifiers": "", "return": "int", "signature": "int lastIndexFile(int cycle, int defaultCycle)", "full_signature": " int lastIndexFile(int cycle, int defaultCycle)", "class_method_signature": "VanillaIndexCache.lastIndexFile(int cycle, int defaultCycle)", "testcase": false, "constructor": false}, {"identifier": "append", "parameters": "(int cycle, long indexValue, boolean synchronous, long[] position)", "modifiers": "public", "return": "VanillaMappedBytes", "signature": "VanillaMappedBytes append(int cycle, long indexValue, boolean synchronous, long[] position)", "full_signature": "public VanillaMappedBytes append(int cycle, long indexValue, boolean synchronous, long[] position)", "class_method_signature": "VanillaIndexCache.append(int cycle, long indexValue, boolean synchronous, long[] position)", "testcase": false, "constructor": false}, {"identifier": "append", "parameters": "(final VanillaMappedBytes bytes, final long indexValue, final boolean synchronous)", "modifiers": "public static", "return": "long", "signature": "long append(final VanillaMappedBytes bytes, final long indexValue, final boolean synchronous)", "full_signature": "public static long append(final VanillaMappedBytes bytes, final long indexValue, final boolean synchronous)", "class_method_signature": "VanillaIndexCache.append(final VanillaMappedBytes bytes, final long indexValue, final boolean synchronous)", "testcase": false, "constructor": false}, {"identifier": "countIndices", "parameters": "(final VanillaMappedBytes buffer)", "modifiers": "public static", "return": "long", "signature": "long countIndices(final VanillaMappedBytes buffer)", "full_signature": "public static long countIndices(final VanillaMappedBytes buffer)", "class_method_signature": "VanillaIndexCache.countIndices(final VanillaMappedBytes buffer)", "testcase": false, "constructor": false}, {"identifier": "firstCycle", "parameters": "()", "modifiers": "public", "return": "long", "signature": "long firstCycle()", "full_signature": "public long firstCycle()", "class_method_signature": "VanillaIndexCache.firstCycle()", "testcase": false, "constructor": false}, {"identifier": "lastCycle", "parameters": "()", "modifiers": "public", "return": "long", "signature": "long lastCycle()", "full_signature": "public long lastCycle()", "class_method_signature": "VanillaIndexCache.lastCycle()", "testcase": false, "constructor": false}, {"identifier": "checkCounts", "parameters": "(int min, int max)", "modifiers": "public", "return": "void", "signature": "void checkCounts(int min, int max)", "full_signature": "public void checkCounts(int min, int max)", "class_method_signature": "VanillaIndexCache.checkCounts(int min, int max)", "testcase": false, "constructor": false}], "file": "chronicle/src/main/java/net/openhft/chronicle/VanillaIndexCache.java"}, "focal_method": {"identifier": "indexFor", "parameters": "(int cycle, int indexCount, boolean forAppend)", "modifiers": "public synchronized", "return": "VanillaMappedBytes", "body": "public synchronized VanillaMappedBytes indexFor(int cycle, int indexCount, boolean forAppend) throws IOException {\n        key.cycle = cycle;\n        key.indexCount = indexCount << blockBits;\n\n        VanillaMappedBytes vmb = this.cache.get(key);\n        if(vmb == null) {\n            vmb = this.cache.put(\n                key.clone(),\n                VanillaChronicleUtils.mkFiles(\n                    basePath,\n                    dateCache.formatFor(cycle),\n                    FILE_NAME_PREFIX + indexCount,\n                    forAppend),\n                1L << blockBits,\n                indexCount);\n        }\n\n        vmb.reserve();\n\n        return vmb;\n    }", "signature": "VanillaMappedBytes indexFor(int cycle, int indexCount, boolean forAppend)", "full_signature": "public synchronized VanillaMappedBytes indexFor(int cycle, int indexCount, boolean forAppend)", "class_method_signature": "VanillaIndexCache.indexFor(int cycle, int indexCount, boolean forAppend)", "testcase": false, "constructor": false, "invocations": ["get", "put", "clone", "mkFiles", "formatFor", "reserve"]}, "repository": {"repo_id": 23783621, "url": "https://github.com/peter-lawrey/Java-Chronicle-OLD", "language": "Java", "is_fork": false, "fork_count": 7, "stargazer_count": 33, "size": 1275, "license": "licensed"}}