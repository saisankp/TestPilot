{"test_class": {"identifier": "ThreePhaseCommitCohortProxyTest", "superclass": "extends AbstractActorTest", "interfaces": "", "fields": [{"original_string": "private ActorUtils actorUtils;", "modifier": "private", "type": "ActorUtils", "declarator": "actorUtils", "var_name": "actorUtils"}, {"original_string": "@Mock\n    private Timer commitTimer;", "modifier": "@Mock\n    private", "type": "Timer", "declarator": "commitTimer", "var_name": "commitTimer"}, {"original_string": "@Mock\n    private Timer.Context commitTimerContext;", "modifier": "@Mock\n    private", "type": "Timer.Context", "declarator": "commitTimerContext", "var_name": "commitTimerContext"}, {"original_string": "@Mock\n    private Snapshot commitSnapshot;", "modifier": "@Mock\n    private", "type": "Snapshot", "declarator": "commitSnapshot", "var_name": "commitSnapshot"}, {"original_string": "private final TestActorFactory actorFactory = new TestActorFactory(getSystem());", "modifier": "private final", "type": "TestActorFactory", "declarator": "actorFactory = new TestActorFactory(getSystem())", "var_name": "actorFactory"}, {"original_string": "private final List<TestActorRef<CohortActor>> cohortActors = new ArrayList<>();", "modifier": "private final", "type": "List<TestActorRef<CohortActor>>", "declarator": "cohortActors = new ArrayList<>()", "var_name": "cohortActors"}, {"original_string": "private final TransactionIdentifier tx = nextTransactionId();", "modifier": "private final", "type": "TransactionIdentifier", "declarator": "tx = nextTransactionId()", "var_name": "tx"}], "file": "opendaylight/md-sal/sal-distributed-datastore/src/test/java/org/opendaylight/controller/cluster/datastore/ThreePhaseCommitCohortProxyTest.java"}, "test_case": {"identifier": "testCanCommitWithInvalidResponseType", "parameters": "()", "modifiers": "@Test(expected = IllegalArgumentException.class) public", "return": "void", "body": "@Test(expected = IllegalArgumentException.class)\n    public void testCanCommitWithInvalidResponseType() throws Exception {\n        ThreePhaseCommitCohortProxy proxy = new ThreePhaseCommitCohortProxy(actorUtils, Arrays.asList(\n                newCohortInfo(new CohortActor.Builder(tx).expectCanCommit(\"invalid\"))), tx);\n\n        propagateExecutionExceptionCause(proxy.canCommit());\n    }", "signature": "void testCanCommitWithInvalidResponseType()", "full_signature": "@Test(expected = IllegalArgumentException.class) public void testCanCommitWithInvalidResponseType()", "class_method_signature": "ThreePhaseCommitCohortProxyTest.testCanCommitWithInvalidResponseType()", "testcase": true, "constructor": false, "invocations": ["asList", "newCohortInfo", "expectCanCommit", "propagateExecutionExceptionCause", "canCommit"]}, "focal_class": {"identifier": "ThreePhaseCommitCohortProxy", "superclass": "extends AbstractThreePhaseCommitCohort<ActorSelection>", "interfaces": "", "fields": [{"original_string": "private static final Logger LOG = LoggerFactory.getLogger(ThreePhaseCommitCohortProxy.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOG = LoggerFactory.getLogger(ThreePhaseCommitCohortProxy.class)", "var_name": "LOG"}, {"original_string": "private static final MessageSupplier COMMIT_MESSAGE_SUPPLIER = new MessageSupplier() {\n        @Override\n        public Object newMessage(final TransactionIdentifier transactionId, final short version) {\n            return new CommitTransaction(transactionId, version).toSerializable();\n        }\n\n        @Override\n        public boolean isSerializedReplyType(final Object reply) {\n            return CommitTransactionReply.isSerializedType(reply);\n        }\n    };", "modifier": "private static final", "type": "MessageSupplier", "declarator": "COMMIT_MESSAGE_SUPPLIER = new MessageSupplier() {\n        @Override\n        public Object newMessage(final TransactionIdentifier transactionId, final short version) {\n            return new CommitTransaction(transactionId, version).toSerializable();\n        }\n\n        @Override\n        public boolean isSerializedReplyType(final Object reply) {\n            return CommitTransactionReply.isSerializedType(reply);\n        }\n    }", "var_name": "COMMIT_MESSAGE_SUPPLIER"}, {"original_string": "private static final MessageSupplier ABORT_MESSAGE_SUPPLIER = new MessageSupplier() {\n        @Override\n        public Object newMessage(final TransactionIdentifier transactionId, final short version) {\n            return new AbortTransaction(transactionId, version).toSerializable();\n        }\n\n        @Override\n        public boolean isSerializedReplyType(final Object reply) {\n            return AbortTransactionReply.isSerializedType(reply);\n        }\n    };", "modifier": "private static final", "type": "MessageSupplier", "declarator": "ABORT_MESSAGE_SUPPLIER = new MessageSupplier() {\n        @Override\n        public Object newMessage(final TransactionIdentifier transactionId, final short version) {\n            return new AbortTransaction(transactionId, version).toSerializable();\n        }\n\n        @Override\n        public boolean isSerializedReplyType(final Object reply) {\n            return AbortTransactionReply.isSerializedType(reply);\n        }\n    }", "var_name": "ABORT_MESSAGE_SUPPLIER"}, {"original_string": "private final ActorUtils actorUtils;", "modifier": "private final", "type": "ActorUtils", "declarator": "actorUtils", "var_name": "actorUtils"}, {"original_string": "private final List<CohortInfo> cohorts;", "modifier": "private final", "type": "List<CohortInfo>", "declarator": "cohorts", "var_name": "cohorts"}, {"original_string": "private final SettableFuture<Void> cohortsResolvedFuture = SettableFuture.create();", "modifier": "private final", "type": "SettableFuture<Void>", "declarator": "cohortsResolvedFuture = SettableFuture.create()", "var_name": "cohortsResolvedFuture"}, {"original_string": "private final TransactionIdentifier transactionId;", "modifier": "private final", "type": "TransactionIdentifier", "declarator": "transactionId", "var_name": "transactionId"}, {"original_string": "private volatile OperationCallback commitOperationCallback;", "modifier": "private volatile", "type": "OperationCallback", "declarator": "commitOperationCallback", "var_name": "commitOperationCallback"}], "methods": [{"identifier": "ThreePhaseCommitCohortProxy", "parameters": "(final ActorUtils actorUtils, final List<CohortInfo> cohorts,\n            final TransactionIdentifier transactionId)", "modifiers": "public", "return": "", "signature": " ThreePhaseCommitCohortProxy(final ActorUtils actorUtils, final List<CohortInfo> cohorts,\n            final TransactionIdentifier transactionId)", "full_signature": "public  ThreePhaseCommitCohortProxy(final ActorUtils actorUtils, final List<CohortInfo> cohorts,\n            final TransactionIdentifier transactionId)", "class_method_signature": "ThreePhaseCommitCohortProxy.ThreePhaseCommitCohortProxy(final ActorUtils actorUtils, final List<CohortInfo> cohorts,\n            final TransactionIdentifier transactionId)", "testcase": false, "constructor": true}, {"identifier": "resolveCohorts", "parameters": "()", "modifiers": "private", "return": "ListenableFuture<Void>", "signature": "ListenableFuture<Void> resolveCohorts()", "full_signature": "private ListenableFuture<Void> resolveCohorts()", "class_method_signature": "ThreePhaseCommitCohortProxy.resolveCohorts()", "testcase": false, "constructor": false}, {"identifier": "canCommit", "parameters": "()", "modifiers": "@Override public", "return": "ListenableFuture<Boolean>", "signature": "ListenableFuture<Boolean> canCommit()", "full_signature": "@Override public ListenableFuture<Boolean> canCommit()", "class_method_signature": "ThreePhaseCommitCohortProxy.canCommit()", "testcase": false, "constructor": false}, {"identifier": "finishCanCommit", "parameters": "(final SettableFuture<Boolean> returnFuture)", "modifiers": "@SuppressFBWarnings(value = \"UPM_UNCALLED_PRIVATE_METHOD\", justification = \"https://github.com/spotbugs/spotbugs/issues/811\") private", "return": "void", "signature": "void finishCanCommit(final SettableFuture<Boolean> returnFuture)", "full_signature": "@SuppressFBWarnings(value = \"UPM_UNCALLED_PRIVATE_METHOD\", justification = \"https://github.com/spotbugs/spotbugs/issues/811\") private void finishCanCommit(final SettableFuture<Boolean> returnFuture)", "class_method_signature": "ThreePhaseCommitCohortProxy.finishCanCommit(final SettableFuture<Boolean> returnFuture)", "testcase": false, "constructor": false}, {"identifier": "sendCanCommitTransaction", "parameters": "(final CohortInfo toCohortInfo, final OnComplete<Object> onComplete)", "modifiers": "private", "return": "void", "signature": "void sendCanCommitTransaction(final CohortInfo toCohortInfo, final OnComplete<Object> onComplete)", "full_signature": "private void sendCanCommitTransaction(final CohortInfo toCohortInfo, final OnComplete<Object> onComplete)", "class_method_signature": "ThreePhaseCommitCohortProxy.sendCanCommitTransaction(final CohortInfo toCohortInfo, final OnComplete<Object> onComplete)", "testcase": false, "constructor": false}, {"identifier": "invokeCohorts", "parameters": "(final MessageSupplier messageSupplier)", "modifiers": "private", "return": "Future<Iterable<Object>>", "signature": "Future<Iterable<Object>> invokeCohorts(final MessageSupplier messageSupplier)", "full_signature": "private Future<Iterable<Object>> invokeCohorts(final MessageSupplier messageSupplier)", "class_method_signature": "ThreePhaseCommitCohortProxy.invokeCohorts(final MessageSupplier messageSupplier)", "testcase": false, "constructor": false}, {"identifier": "preCommit", "parameters": "()", "modifiers": "@Override public", "return": "ListenableFuture<Void>", "signature": "ListenableFuture<Void> preCommit()", "full_signature": "@Override public ListenableFuture<Void> preCommit()", "class_method_signature": "ThreePhaseCommitCohortProxy.preCommit()", "testcase": false, "constructor": false}, {"identifier": "abort", "parameters": "()", "modifiers": "@Override public", "return": "ListenableFuture<Void>", "signature": "ListenableFuture<Void> abort()", "full_signature": "@Override public ListenableFuture<Void> abort()", "class_method_signature": "ThreePhaseCommitCohortProxy.abort()", "testcase": false, "constructor": false}, {"identifier": "commit", "parameters": "()", "modifiers": "@Override public", "return": "ListenableFuture<Void>", "signature": "ListenableFuture<Void> commit()", "full_signature": "@Override public ListenableFuture<Void> commit()", "class_method_signature": "ThreePhaseCommitCohortProxy.commit()", "testcase": false, "constructor": false}, {"identifier": "successfulFuture", "parameters": "(final ListenableFuture<Void> future)", "modifiers": "@SuppressWarnings(\"checkstyle:IllegalCatch\") private static", "return": "boolean", "signature": "boolean successfulFuture(final ListenableFuture<Void> future)", "full_signature": "@SuppressWarnings(\"checkstyle:IllegalCatch\") private static boolean successfulFuture(final ListenableFuture<Void> future)", "class_method_signature": "ThreePhaseCommitCohortProxy.successfulFuture(final ListenableFuture<Void> future)", "testcase": false, "constructor": false}, {"identifier": "voidOperation", "parameters": "(final String operationName,\n            final MessageSupplier messageSupplier, final Class<?> expectedResponseClass,\n            final boolean propagateException, final OperationCallback callback)", "modifiers": "private", "return": "ListenableFuture<Void>", "signature": "ListenableFuture<Void> voidOperation(final String operationName,\n            final MessageSupplier messageSupplier, final Class<?> expectedResponseClass,\n            final boolean propagateException, final OperationCallback callback)", "full_signature": "private ListenableFuture<Void> voidOperation(final String operationName,\n            final MessageSupplier messageSupplier, final Class<?> expectedResponseClass,\n            final boolean propagateException, final OperationCallback callback)", "class_method_signature": "ThreePhaseCommitCohortProxy.voidOperation(final String operationName,\n            final MessageSupplier messageSupplier, final Class<?> expectedResponseClass,\n            final boolean propagateException, final OperationCallback callback)", "testcase": false, "constructor": false}, {"identifier": "finishVoidOperation", "parameters": "(final String operationName, final MessageSupplier messageSupplier,\n                                     final Class<?> expectedResponseClass, final boolean propagateException,\n                                     final SettableFuture<Void> returnFuture, final OperationCallback callback)", "modifiers": "private", "return": "void", "signature": "void finishVoidOperation(final String operationName, final MessageSupplier messageSupplier,\n                                     final Class<?> expectedResponseClass, final boolean propagateException,\n                                     final SettableFuture<Void> returnFuture, final OperationCallback callback)", "full_signature": "private void finishVoidOperation(final String operationName, final MessageSupplier messageSupplier,\n                                     final Class<?> expectedResponseClass, final boolean propagateException,\n                                     final SettableFuture<Void> returnFuture, final OperationCallback callback)", "class_method_signature": "ThreePhaseCommitCohortProxy.finishVoidOperation(final String operationName, final MessageSupplier messageSupplier,\n                                     final Class<?> expectedResponseClass, final boolean propagateException,\n                                     final SettableFuture<Void> returnFuture, final OperationCallback callback)", "testcase": false, "constructor": false}, {"identifier": "getCohortFutures", "parameters": "()", "modifiers": "@Override", "return": "List<Future<ActorSelection>>", "signature": "List<Future<ActorSelection>> getCohortFutures()", "full_signature": "@Override List<Future<ActorSelection>> getCohortFutures()", "class_method_signature": "ThreePhaseCommitCohortProxy.getCohortFutures()", "testcase": false, "constructor": false}], "file": "opendaylight/md-sal/sal-distributed-datastore/src/main/java/org/opendaylight/controller/cluster/datastore/ThreePhaseCommitCohortProxy.java"}, "focal_method": {"identifier": "canCommit", "parameters": "()", "modifiers": "@Override public", "return": "ListenableFuture<Boolean>", "body": "@Override\n    public ListenableFuture<Boolean> canCommit() {\n        LOG.debug(\"Tx {} canCommit\", transactionId);\n\n        final SettableFuture<Boolean> returnFuture = SettableFuture.create();\n\n        // The first phase of canCommit is to gather the list of cohort actor paths that will\n        // participate in the commit. buildCohortPathsList combines the cohort path Futures into\n        // one Future which we wait on asynchronously here. The cohort actor paths are\n        // extracted from ReadyTransactionReply messages by the Futures that were obtained earlier\n        // and passed to us from upstream processing. If any one fails then  we'll fail canCommit.\n\n        Futures.addCallback(resolveCohorts(), new FutureCallback<Void>() {\n            @Override\n            public void onSuccess(final Void notUsed) {\n                finishCanCommit(returnFuture);\n            }\n\n            @Override\n            public void onFailure(final Throwable failure) {\n                returnFuture.setException(failure);\n            }\n        }, MoreExecutors.directExecutor());\n\n        return returnFuture;\n    }", "signature": "ListenableFuture<Boolean> canCommit()", "full_signature": "@Override public ListenableFuture<Boolean> canCommit()", "class_method_signature": "ThreePhaseCommitCohortProxy.canCommit()", "testcase": false, "constructor": false, "invocations": ["debug", "create", "addCallback", "resolveCohorts", "finishCanCommit", "setException", "directExecutor"]}, "repository": {"repo_id": 16362479, "url": "https://github.com/opendaylight/controller", "stars": 313, "created": "1/29/2014 11:10:45 PM +00:00", "updates": "2020-01-20T11:02:36+00:00", "fork": "False", "license": "licensed"}}