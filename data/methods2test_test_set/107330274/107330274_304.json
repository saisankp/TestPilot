{"test_class": {"identifier": "PodUnknownGcControllerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String POD_NAME = \"pod-name\";", "modifier": "private static final", "type": "String", "declarator": "POD_NAME = \"pod-name\"", "var_name": "POD_NAME"}, {"original_string": "private static final TestClock clock = new DefaultTestClock();", "modifier": "private static final", "type": "TestClock", "declarator": "clock = new DefaultTestClock()", "var_name": "clock"}, {"original_string": "private static final long POD_UNKNOWN_GRACE_PERIOD = 1000L;", "modifier": "private static final", "type": "long", "declarator": "POD_UNKNOWN_GRACE_PERIOD = 1000L", "var_name": "POD_UNKNOWN_GRACE_PERIOD"}, {"original_string": "private final TitusRuntime titusRuntime = TitusRuntimes.test(clock);", "modifier": "private final", "type": "TitusRuntime", "declarator": "titusRuntime = TitusRuntimes.test(clock)", "var_name": "titusRuntime"}, {"original_string": "private final FixedIntervalTokenBucketConfiguration tokenBucketConfiguration = mock(FixedIntervalTokenBucketConfiguration.class);", "modifier": "private final", "type": "FixedIntervalTokenBucketConfiguration", "declarator": "tokenBucketConfiguration = mock(FixedIntervalTokenBucketConfiguration.class)", "var_name": "tokenBucketConfiguration"}, {"original_string": "private final ControllerConfiguration controllerConfiguration = mock(ControllerConfiguration.class);", "modifier": "private final", "type": "ControllerConfiguration", "declarator": "controllerConfiguration = mock(ControllerConfiguration.class)", "var_name": "controllerConfiguration"}, {"original_string": "private final KubeApiFacade kubeApiFacade = mock(KubeApiFacade.class);", "modifier": "private final", "type": "KubeApiFacade", "declarator": "kubeApiFacade = mock(KubeApiFacade.class)", "var_name": "kubeApiFacade"}, {"original_string": "private final LocalScheduler scheduler = mock(LocalScheduler.class);", "modifier": "private final", "type": "LocalScheduler", "declarator": "scheduler = mock(LocalScheduler.class)", "var_name": "scheduler"}, {"original_string": "private final KubeControllerConfiguration kubeControllerConfiguration = mock(KubeControllerConfiguration.class);", "modifier": "private final", "type": "KubeControllerConfiguration", "declarator": "kubeControllerConfiguration = mock(KubeControllerConfiguration.class)", "var_name": "kubeControllerConfiguration"}, {"original_string": "private final V3JobOperations v3JobOperations = mock(V3JobOperations.class);", "modifier": "private final", "type": "V3JobOperations", "declarator": "v3JobOperations = mock(V3JobOperations.class)", "var_name": "v3JobOperations"}, {"original_string": "private final PodUnknownGcController podGcController = new PodUnknownGcController(\n            titusRuntime,\n            scheduler,\n            tokenBucketConfiguration,\n            controllerConfiguration,\n            kubeApiFacade,\n            kubeControllerConfiguration,\n            v3JobOperations\n    );", "modifier": "private final", "type": "PodUnknownGcController", "declarator": "podGcController = new PodUnknownGcController(\n            titusRuntime,\n            scheduler,\n            tokenBucketConfiguration,\n            controllerConfiguration,\n            kubeApiFacade,\n            kubeControllerConfiguration,\n            v3JobOperations\n    )", "var_name": "podGcController"}], "file": "titus-server-master/src/test/java/com/netflix/titus/master/kubernetes/controller/PodUnknownGcControllerTest.java"}, "test_case": {"identifier": "podIsKnownToJobManagement", "parameters": "()", "modifiers": "@Test", "return": "void", "body": "@Test\n    void podIsKnownToJobManagement() {\n        when(kubeControllerConfiguration.getPodUnknownGracePeriodMs()).thenReturn(POD_UNKNOWN_GRACE_PERIOD);\n\n        V1Pod pod = new V1Pod()\n                .metadata(new V1ObjectMeta().name(POD_NAME).creationTimestamp(new DateTime(clock.wallTime())))\n                .status(new V1PodStatus().phase(RUNNING));\n\n        clock.advanceTime(Duration.ofMillis(POD_UNKNOWN_GRACE_PERIOD + 1));\n\n        Map<String, Task> currentTasks = Collections.singletonMap(POD_NAME, mock(Task.class));\n        Assertions.assertThat(podGcController.isPodUnknownToJobManagement(pod, currentTasks)).isFalse();\n    }", "signature": "void podIsKnownToJobManagement()", "full_signature": "@Test void podIsKnownToJobManagement()", "class_method_signature": "PodUnknownGcControllerTest.podIsKnownToJobManagement()", "testcase": true, "constructor": false, "invocations": ["thenReturn", "when", "getPodUnknownGracePeriodMs", "status", "metadata", "creationTimestamp", "name", "wallTime", "phase", "advanceTime", "ofMillis", "singletonMap", "mock", "isFalse", "assertThat", "isPodUnknownToJobManagement"]}, "focal_class": {"identifier": "PodUnknownGcController", "superclass": "extends BaseGcController<V1Pod>", "interfaces": "", "fields": [{"original_string": "public static final String POD_UNKNOWN_GC_CONTROLLER = \"podUnknownGcController\";", "modifier": "public static final", "type": "String", "declarator": "POD_UNKNOWN_GC_CONTROLLER = \"podUnknownGcController\"", "var_name": "POD_UNKNOWN_GC_CONTROLLER"}, {"original_string": "public static final String POD_UNKNOWN_GC_CONTROLLER_DESCRIPTION = \"GC pods that are unknown to Titus.\";", "modifier": "public static final", "type": "String", "declarator": "POD_UNKNOWN_GC_CONTROLLER_DESCRIPTION = \"GC pods that are unknown to Titus.\"", "var_name": "POD_UNKNOWN_GC_CONTROLLER_DESCRIPTION"}, {"original_string": "private static final Logger logger = LoggerFactory.getLogger(PodUnknownGcController.class);", "modifier": "private static final", "type": "Logger", "declarator": "logger = LoggerFactory.getLogger(PodUnknownGcController.class)", "var_name": "logger"}, {"original_string": "private final KubeApiFacade kubeApiFacade;", "modifier": "private final", "type": "KubeApiFacade", "declarator": "kubeApiFacade", "var_name": "kubeApiFacade"}, {"original_string": "private final Clock clock;", "modifier": "private final", "type": "Clock", "declarator": "clock", "var_name": "clock"}, {"original_string": "private final KubeControllerConfiguration kubeControllerConfiguration;", "modifier": "private final", "type": "KubeControllerConfiguration", "declarator": "kubeControllerConfiguration", "var_name": "kubeControllerConfiguration"}, {"original_string": "private final V3JobOperations v3JobOperations;", "modifier": "private final", "type": "V3JobOperations", "declarator": "v3JobOperations", "var_name": "v3JobOperations"}], "methods": [{"identifier": "PodUnknownGcController", "parameters": "(\n            TitusRuntime titusRuntime,\n            LocalScheduler scheduler,\n            @Named(POD_UNKNOWN_GC_CONTROLLER) FixedIntervalTokenBucketConfiguration tokenBucketConfiguration,\n            @Named(POD_UNKNOWN_GC_CONTROLLER) ControllerConfiguration controllerConfiguration,\n            KubeApiFacade kubeApiFacade,\n            KubeControllerConfiguration kubeControllerConfiguration,\n            V3JobOperations v3JobOperations\n    )", "modifiers": "@Inject public", "return": "", "signature": " PodUnknownGcController(\n            TitusRuntime titusRuntime,\n            LocalScheduler scheduler,\n            @Named(POD_UNKNOWN_GC_CONTROLLER) FixedIntervalTokenBucketConfiguration tokenBucketConfiguration,\n            @Named(POD_UNKNOWN_GC_CONTROLLER) ControllerConfiguration controllerConfiguration,\n            KubeApiFacade kubeApiFacade,\n            KubeControllerConfiguration kubeControllerConfiguration,\n            V3JobOperations v3JobOperations\n    )", "full_signature": "@Inject public  PodUnknownGcController(\n            TitusRuntime titusRuntime,\n            LocalScheduler scheduler,\n            @Named(POD_UNKNOWN_GC_CONTROLLER) FixedIntervalTokenBucketConfiguration tokenBucketConfiguration,\n            @Named(POD_UNKNOWN_GC_CONTROLLER) ControllerConfiguration controllerConfiguration,\n            KubeApiFacade kubeApiFacade,\n            KubeControllerConfiguration kubeControllerConfiguration,\n            V3JobOperations v3JobOperations\n    )", "class_method_signature": "PodUnknownGcController.PodUnknownGcController(\n            TitusRuntime titusRuntime,\n            LocalScheduler scheduler,\n            @Named(POD_UNKNOWN_GC_CONTROLLER) FixedIntervalTokenBucketConfiguration tokenBucketConfiguration,\n            @Named(POD_UNKNOWN_GC_CONTROLLER) ControllerConfiguration controllerConfiguration,\n            KubeApiFacade kubeApiFacade,\n            KubeControllerConfiguration kubeControllerConfiguration,\n            V3JobOperations v3JobOperations\n    )", "testcase": false, "constructor": true}, {"identifier": "shouldGc", "parameters": "()", "modifiers": "@Override public", "return": "boolean", "signature": "boolean shouldGc()", "full_signature": "@Override public boolean shouldGc()", "class_method_signature": "PodUnknownGcController.shouldGc()", "testcase": false, "constructor": false}, {"identifier": "getItemsToGc", "parameters": "()", "modifiers": "@Override public", "return": "List<V1Pod>", "signature": "List<V1Pod> getItemsToGc()", "full_signature": "@Override public List<V1Pod> getItemsToGc()", "class_method_signature": "PodUnknownGcController.getItemsToGc()", "testcase": false, "constructor": false}, {"identifier": "gcItem", "parameters": "(V1Pod item)", "modifiers": "@Override public", "return": "boolean", "signature": "boolean gcItem(V1Pod item)", "full_signature": "@Override public boolean gcItem(V1Pod item)", "class_method_signature": "PodUnknownGcController.gcItem(V1Pod item)", "testcase": false, "constructor": false}, {"identifier": "isPodUnknownToJobManagement", "parameters": "(V1Pod pod, Map<String, Task> currentTasks)", "modifiers": "@VisibleForTesting", "return": "boolean", "signature": "boolean isPodUnknownToJobManagement(V1Pod pod, Map<String, Task> currentTasks)", "full_signature": "@VisibleForTesting boolean isPodUnknownToJobManagement(V1Pod pod, Map<String, Task> currentTasks)", "class_method_signature": "PodUnknownGcController.isPodUnknownToJobManagement(V1Pod pod, Map<String, Task> currentTasks)", "testcase": false, "constructor": false}], "file": "titus-server-master/src/main/java/com/netflix/titus/master/kubernetes/controller/PodUnknownGcController.java"}, "focal_method": {"identifier": "isPodUnknownToJobManagement", "parameters": "(V1Pod pod, Map<String, Task> currentTasks)", "modifiers": "@VisibleForTesting", "return": "boolean", "body": "@VisibleForTesting\n    boolean isPodUnknownToJobManagement(V1Pod pod, Map<String, Task> currentTasks) {\n        V1ObjectMeta metadata = pod.getMetadata();\n        V1PodStatus status = pod.getStatus();\n\n        if (metadata == null || status == null) {\n            // this pod is missing data so GC it\n            return true;\n        }\n\n        if (KubeUtil.isPodPhaseTerminal(status.getPhase()) || currentTasks.containsKey(metadata.getName())) {\n            return false;\n        }\n\n        DateTime creationTimestamp = metadata.getCreationTimestamp();\n        return creationTimestamp != null &&\n                clock.isPast(creationTimestamp.getMillis() + kubeControllerConfiguration.getPodUnknownGracePeriodMs());\n    }", "signature": "boolean isPodUnknownToJobManagement(V1Pod pod, Map<String, Task> currentTasks)", "full_signature": "@VisibleForTesting boolean isPodUnknownToJobManagement(V1Pod pod, Map<String, Task> currentTasks)", "class_method_signature": "PodUnknownGcController.isPodUnknownToJobManagement(V1Pod pod, Map<String, Task> currentTasks)", "testcase": false, "constructor": false, "invocations": ["getMetadata", "getStatus", "isPodPhaseTerminal", "getPhase", "containsKey", "getName", "getCreationTimestamp", "isPast", "getMillis", "getPodUnknownGracePeriodMs"]}, "repository": {"repo_id": 107330274, "url": "https://github.com/Netflix/titus-control-plane", "stars": 241, "created": "10/17/2017 10:20:55 PM +00:00", "updates": "2020-01-25T13:01:05+00:00", "fork": "False", "license": "licensed"}}