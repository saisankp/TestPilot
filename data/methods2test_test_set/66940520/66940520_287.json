{"test_class": {"identifier": "CriteriaQueryEngineTest", "superclass": "extends DhisSpringTest", "interfaces": "", "fields": [{"original_string": "@Autowired\n    private SchemaService schemaService;", "modifier": "@Autowired\n    private", "type": "SchemaService", "declarator": "schemaService", "var_name": "schemaService"}, {"original_string": "@Autowired\n    private QueryService queryService;", "modifier": "@Autowired\n    private", "type": "QueryService", "declarator": "queryService", "var_name": "queryService"}, {"original_string": "@Autowired\n    private CriteriaQueryEngine<? extends IdentifiableObject> queryEngine;", "modifier": "@Autowired\n    private", "type": "CriteriaQueryEngine<? extends IdentifiableObject>", "declarator": "queryEngine", "var_name": "queryEngine"}, {"original_string": "@Autowired\n    private IdentifiableObjectManager identifiableObjectManager;", "modifier": "@Autowired\n    private", "type": "IdentifiableObjectManager", "declarator": "identifiableObjectManager", "var_name": "identifiableObjectManager"}], "file": "dhis-2/dhis-services/dhis-service-core/src/test/java/org/hisp/dhis/query/CriteriaQueryEngineTest.java"}, "test_case": {"identifier": "testIsNull", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testIsNull()\n    {\n        Query query = Query.from( schemaService.getDynamicSchema( DataElement.class ) );\n        query.add( Restrictions.isNull( \"categoryCombo\" ) );\n\n        List<? extends IdentifiableObject> objects = queryEngine.query( query );\n\n        assertEquals( 0, objects.size() );\n    }", "signature": "void testIsNull()", "full_signature": "@Test public void testIsNull()", "class_method_signature": "CriteriaQueryEngineTest.testIsNull()", "testcase": true, "constructor": false, "invocations": ["from", "getDynamicSchema", "add", "isNull", "query", "assertEquals", "size"]}, "focal_class": {"identifier": "CriteriaQueryEngine", "superclass": "", "interfaces": "implements QueryEngine<T>", "fields": [{"original_string": "private final CurrentUserService currentUserService;", "modifier": "private final", "type": "CurrentUserService", "declarator": "currentUserService", "var_name": "currentUserService"}, {"original_string": "private final QueryPlanner queryPlanner;", "modifier": "private final", "type": "QueryPlanner", "declarator": "queryPlanner", "var_name": "queryPlanner"}, {"original_string": "private final List<InternalHibernateGenericStore<T>> hibernateGenericStores;", "modifier": "private final", "type": "List<InternalHibernateGenericStore<T>>", "declarator": "hibernateGenericStores", "var_name": "hibernateGenericStores"}, {"original_string": "private Map<Class<?>, InternalHibernateGenericStore<T>> stores = new HashMap<>();", "modifier": "private", "type": "Map<Class<?>, InternalHibernateGenericStore<T>>", "declarator": "stores = new HashMap<>()", "var_name": "stores"}], "methods": [{"identifier": "CriteriaQueryEngine", "parameters": "( CurrentUserService currentUserService, QueryPlanner queryPlanner,\n        List<InternalHibernateGenericStore<T>> hibernateGenericStores )", "modifiers": "@Autowired public", "return": "", "signature": " CriteriaQueryEngine( CurrentUserService currentUserService, QueryPlanner queryPlanner,\n        List<InternalHibernateGenericStore<T>> hibernateGenericStores )", "full_signature": "@Autowired public  CriteriaQueryEngine( CurrentUserService currentUserService, QueryPlanner queryPlanner,\n        List<InternalHibernateGenericStore<T>> hibernateGenericStores )", "class_method_signature": "CriteriaQueryEngine.CriteriaQueryEngine( CurrentUserService currentUserService, QueryPlanner queryPlanner,\n        List<InternalHibernateGenericStore<T>> hibernateGenericStores )", "testcase": false, "constructor": true}, {"identifier": "query", "parameters": "( Query query )", "modifiers": "@Override @SuppressWarnings( \"unchecked\" ) public", "return": "List<T>", "signature": "List<T> query( Query query )", "full_signature": "@Override @SuppressWarnings( \"unchecked\" ) public List<T> query( Query query )", "class_method_signature": "CriteriaQueryEngine.query( Query query )", "testcase": false, "constructor": false}, {"identifier": "count", "parameters": "( Query query )", "modifiers": "@Override @SuppressWarnings( \"unchecked\" ) public", "return": "int", "signature": "int count( Query query )", "full_signature": "@Override @SuppressWarnings( \"unchecked\" ) public int count( Query query )", "class_method_signature": "CriteriaQueryEngine.count( Query query )", "testcase": false, "constructor": false}, {"identifier": "buildCriteria", "parameters": "( DetachedCriteria detachedCriteria, Query query )", "modifiers": "private", "return": "DetachedCriteria", "signature": "DetachedCriteria buildCriteria( DetachedCriteria detachedCriteria, Query query )", "full_signature": "private DetachedCriteria buildCriteria( DetachedCriteria detachedCriteria, Query query )", "class_method_signature": "CriteriaQueryEngine.buildCriteria( DetachedCriteria detachedCriteria, Query query )", "testcase": false, "constructor": false}, {"identifier": "addCriterion", "parameters": "( org.hibernate.criterion.Junction criteria, org.hisp.dhis.query.Criterion criterion )", "modifiers": "private", "return": "void", "signature": "void addCriterion( org.hibernate.criterion.Junction criteria, org.hisp.dhis.query.Criterion criterion )", "full_signature": "private void addCriterion( org.hibernate.criterion.Junction criteria, org.hisp.dhis.query.Criterion criterion )", "class_method_signature": "CriteriaQueryEngine.addCriterion( org.hibernate.criterion.Junction criteria, org.hisp.dhis.query.Criterion criterion )", "testcase": false, "constructor": false}, {"identifier": "addJunction", "parameters": "( org.hibernate.criterion.Junction junction, org.hisp.dhis.query.Criterion criterion )", "modifiers": "private", "return": "void", "signature": "void addJunction( org.hibernate.criterion.Junction junction, org.hisp.dhis.query.Criterion criterion )", "full_signature": "private void addJunction( org.hibernate.criterion.Junction junction, org.hisp.dhis.query.Criterion criterion )", "class_method_signature": "CriteriaQueryEngine.addJunction( org.hibernate.criterion.Junction junction, org.hisp.dhis.query.Criterion criterion )", "testcase": false, "constructor": false}, {"identifier": "getHibernateJunction", "parameters": "( Junction.Type type )", "modifiers": "private", "return": "org.hibernate.criterion.Junction", "signature": "org.hibernate.criterion.Junction getHibernateJunction( Junction.Type type )", "full_signature": "private org.hibernate.criterion.Junction getHibernateJunction( Junction.Type type )", "class_method_signature": "CriteriaQueryEngine.getHibernateJunction( Junction.Type type )", "testcase": false, "constructor": false}, {"identifier": "getHibernateCriterion", "parameters": "( Restriction restriction )", "modifiers": "private", "return": "Criterion", "signature": "Criterion getHibernateCriterion( Restriction restriction )", "full_signature": "private Criterion getHibernateCriterion( Restriction restriction )", "class_method_signature": "CriteriaQueryEngine.getHibernateCriterion( Restriction restriction )", "testcase": false, "constructor": false}, {"identifier": "getHibernateOrder", "parameters": "( Order order )", "modifiers": "public", "return": "org.hibernate.criterion.Order", "signature": "org.hibernate.criterion.Order getHibernateOrder( Order order )", "full_signature": "public org.hibernate.criterion.Order getHibernateOrder( Order order )", "class_method_signature": "CriteriaQueryEngine.getHibernateOrder( Order order )", "testcase": false, "constructor": false}, {"identifier": "initStoreMap", "parameters": "()", "modifiers": "private", "return": "void", "signature": "void initStoreMap()", "full_signature": "private void initStoreMap()", "class_method_signature": "CriteriaQueryEngine.initStoreMap()", "testcase": false, "constructor": false}, {"identifier": "getStore", "parameters": "( Class<? extends IdentifiableObject> klass )", "modifiers": "private", "return": "InternalHibernateGenericStore<?>", "signature": "InternalHibernateGenericStore<?> getStore( Class<? extends IdentifiableObject> klass )", "full_signature": "private InternalHibernateGenericStore<?> getStore( Class<? extends IdentifiableObject> klass )", "class_method_signature": "CriteriaQueryEngine.getStore( Class<? extends IdentifiableObject> klass )", "testcase": false, "constructor": false}], "file": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/query/CriteriaQueryEngine.java"}, "focal_method": {"identifier": "query", "parameters": "( Query query )", "modifiers": "@Override @SuppressWarnings( \"unchecked\" ) public", "return": "List<T>", "body": "@Override\n    @SuppressWarnings( \"unchecked\" )\n    public List<T> query( Query query )\n    {\n        Schema schema = query.getSchema();\n        InternalHibernateGenericStore<?> store = getStore( (Class<? extends IdentifiableObject>) schema.getKlass() );\n\n        if ( store == null )\n        {\n            return new ArrayList<>();\n        }\n\n        if ( query.getUser() == null )\n        {\n            query.setUser( currentUserService.getCurrentUser() );\n        }\n\n        if ( !query.isPlannedQuery() )\n        {\n            QueryPlan queryPlan = queryPlanner.planQuery( query, true );\n            query = queryPlan.getPersistedQuery();\n        }\n\n        DetachedCriteria detachedCriteria = buildCriteria( store.getSharingDetachedCriteria( query.getUser() ), query );\n        Criteria criteria = store.getCriteria();\n\n        if ( criteria == null )\n        {\n            return new ArrayList<>();\n        }\n\n        criteria.setFirstResult( query.getFirstResult() );\n        criteria.setMaxResults( query.getMaxResults() );\n\n        for ( Order order : query.getOrders() )\n        {\n            criteria.addOrder( getHibernateOrder( order ) );\n        }\n\n        return criteria.add( Subqueries.propertyIn( \"id\", detachedCriteria ) ).list();\n    }", "signature": "List<T> query( Query query )", "full_signature": "@Override @SuppressWarnings( \"unchecked\" ) public List<T> query( Query query )", "class_method_signature": "CriteriaQueryEngine.query( Query query )", "testcase": false, "constructor": false, "invocations": ["getSchema", "getStore", "getKlass", "getUser", "setUser", "getCurrentUser", "isPlannedQuery", "planQuery", "getPersistedQuery", "buildCriteria", "getSharingDetachedCriteria", "getUser", "getCriteria", "setFirstResult", "getFirstResult", "setMaxResults", "getMaxResults", "getOrders", "addOrder", "getHibernateOrder", "list", "add", "propertyIn"]}, "repository": {"repo_id": 66940520, "url": "https://github.com/dhis2/dhis2-core", "stars": 151, "created": "8/30/2016 12:57:05 PM +00:00", "updates": "2020-01-24T18:06:36+00:00", "fork": "False", "license": "licensed"}}