{"test_class": {"identifier": "LicenseResourceTest", "superclass": "extends ResourceTest", "interfaces": "", "fields": [{"original_string": "private RepositoryHandler repositoryHandler;", "modifier": "private", "type": "RepositoryHandler", "declarator": "repositoryHandler", "var_name": "repositoryHandler"}], "file": "server/src/test/java/org/axway/grapes/server/webapp/resources/LicenseResourceTest.java"}, "test_case": {"identifier": "deleteALicense", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void deleteALicense() throws UnknownHostException, AuthenticationException{\n        final String licenseName = \"licenseId\";\n        when(repositoryHandler.getLicense(anyString())).thenReturn(new DbLicense());\n\n        List<DbArtifact> artifacts = new ArrayList<DbArtifact>();\n        artifacts.add(new DbArtifact());\n        ArgumentCaptor<FiltersHolder> filters = ArgumentCaptor.forClass(FiltersHolder.class);\n        when(repositoryHandler.getArtifacts(filters.capture())).thenReturn(artifacts);\n\n        client().addFilter(new HTTPBasicAuthFilter(GrapesTestUtils.USER_4TEST, GrapesTestUtils.PASSWORD_4TEST));\n        WebResource resource = client().resource(\"/\" + ServerAPI.LICENSE_RESOURCE + \"/\" + licenseName);\n        ClientResponse response = resource.accept(MediaType.APPLICATION_JSON).delete(ClientResponse.class);\n        assertNotNull(response);\n        assertEquals(HttpStatus.OK_200, response.getStatus());\n\n        ArgumentCaptor<String> strCaptor = ArgumentCaptor.forClass(String.class);\n        ArgumentCaptor<LicenseMatcher> matcherCaptor = ArgumentCaptor.forClass(LicenseMatcher.class);\n        verify(repositoryHandler, times(1)).removeLicenseFromArtifact( (DbArtifact)any(), strCaptor.capture(), matcherCaptor.capture());\n        assertEquals(licenseName, strCaptor.getValue());\n    }", "signature": "void deleteALicense()", "full_signature": "@Test public void deleteALicense()", "class_method_signature": "LicenseResourceTest.deleteALicense()", "testcase": true, "constructor": false, "invocations": ["thenReturn", "when", "getLicense", "anyString", "add", "forClass", "thenReturn", "when", "getArtifacts", "capture", "addFilter", "client", "resource", "client", "delete", "accept", "assertNotNull", "assertEquals", "getStatus", "forClass", "forClass", "removeLicenseFromArtifact", "verify", "times", "any", "capture", "capture", "assertEquals", "getValue"]}, "focal_class": {"identifier": "LicenseResource", "superclass": "extends AbstractResource", "interfaces": "", "fields": [{"original_string": "private static final Logger LOG = LoggerFactory.getLogger(LicenseResource.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOG = LoggerFactory.getLogger(LicenseResource.class)", "var_name": "LOG"}, {"original_string": "private CacheUtils cacheUtils = new CacheUtils();", "modifier": "private", "type": "CacheUtils", "declarator": "cacheUtils = new CacheUtils()", "var_name": "cacheUtils"}], "methods": [{"identifier": "LicenseResource", "parameters": "(final RepositoryHandler repoHandler, final GrapesServerConfig dmConfig)", "modifiers": "public", "return": "", "signature": " LicenseResource(final RepositoryHandler repoHandler, final GrapesServerConfig dmConfig)", "full_signature": "public  LicenseResource(final RepositoryHandler repoHandler, final GrapesServerConfig dmConfig)", "class_method_signature": "LicenseResource.LicenseResource(final RepositoryHandler repoHandler, final GrapesServerConfig dmConfig)", "testcase": false, "constructor": true}, {"identifier": "postLicense", "parameters": "(@Auth final DbCredential credential, final License license)", "modifiers": "@POST public", "return": "Response", "signature": "Response postLicense(@Auth final DbCredential credential, final License license)", "full_signature": "@POST public Response postLicense(@Auth final DbCredential credential, final License license)", "class_method_signature": "LicenseResource.postLicense(@Auth final DbCredential credential, final License license)", "testcase": false, "constructor": false}, {"identifier": "getNames", "parameters": "(@Context final UriInfo uriInfo)", "modifiers": "@GET @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(ServerAPI.GET_NAMES) public", "return": "Response", "signature": "Response getNames(@Context final UriInfo uriInfo)", "full_signature": "@GET @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(ServerAPI.GET_NAMES) public Response getNames(@Context final UriInfo uriInfo)", "class_method_signature": "LicenseResource.getNames(@Context final UriInfo uriInfo)", "testcase": false, "constructor": false}, {"identifier": "get", "parameters": "(@PathParam(\"name\") final String name)", "modifiers": "@GET @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(\"/{name}\") public", "return": "Response", "signature": "Response get(@PathParam(\"name\") final String name)", "full_signature": "@GET @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(\"/{name}\") public Response get(@PathParam(\"name\") final String name)", "class_method_signature": "LicenseResource.get(@PathParam(\"name\") final String name)", "testcase": false, "constructor": false}, {"identifier": "delete", "parameters": "(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "modifiers": "@DELETE @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(\"/{name}\") public", "return": "Response", "signature": "Response delete(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "full_signature": "@DELETE @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(\"/{name}\") public Response delete(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "class_method_signature": "LicenseResource.delete(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "testcase": false, "constructor": false}, {"identifier": "approve", "parameters": "(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @QueryParam(ServerAPI.APPROVED_PARAM) final BooleanParam approved)", "modifiers": "@POST @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(\"/{name}\") public", "return": "Response", "signature": "Response approve(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @QueryParam(ServerAPI.APPROVED_PARAM) final BooleanParam approved)", "full_signature": "@POST @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(\"/{name}\") public Response approve(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @QueryParam(ServerAPI.APPROVED_PARAM) final BooleanParam approved)", "class_method_signature": "LicenseResource.approve(@Auth final DbCredential credential, @PathParam(\"name\") final String name, @QueryParam(ServerAPI.APPROVED_PARAM) final BooleanParam approved)", "testcase": false, "constructor": false}], "file": "server/src/main/java/org/axway/grapes/server/webapp/resources/LicenseResource.java"}, "focal_method": {"identifier": "delete", "parameters": "(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "modifiers": "@DELETE @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(\"/{name}\") public", "return": "Response", "body": "@DELETE\n    @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON})\n    @Path(\"/{name}\")\n    public Response delete(@Auth final DbCredential credential, @PathParam(\"name\") final String name){\n        if(!credential.getRoles().contains(AvailableRoles.DATA_DELETER)){\n            throw new WebApplicationException(Response.status(Response.Status.UNAUTHORIZED).build());\n        }\n\n        LOG.info(\"Got a delete license request.\");\n        getLicenseHandler().deleteLicense(name);\n        cacheUtils.clear(CacheName.PROMOTION_REPORTS);\n        return Response.ok(\"done\").build();\n    }", "signature": "Response delete(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "full_signature": "@DELETE @Produces({MediaType.TEXT_HTML, MediaType.APPLICATION_JSON}) @Path(\"/{name}\") public Response delete(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "class_method_signature": "LicenseResource.delete(@Auth final DbCredential credential, @PathParam(\"name\") final String name)", "testcase": false, "constructor": false, "invocations": ["contains", "getRoles", "build", "status", "info", "deleteLicense", "getLicenseHandler", "clear", "build", "ok"]}, "repository": {"repo_id": 14858974, "url": "https://github.com/Axway/Grapes", "language": "Java", "is_fork": false, "fork_count": 9, "stargazer_count": 8, "size": 3620, "license": "licensed"}}