{"test_class": {"identifier": "ParameterEntryDAOTest", "superclass": "extends DatabaseTest", "interfaces": "", "fields": [], "file": "smartparam-repository-jdbc/src/test/java/org/smartparam/repository/jdbc/dao/ParameterEntryDAOTest.java"}, "test_case": {"identifier": "shouldSelectEntriesWithGivenOffset", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void shouldSelectEntriesWithGivenOffset() {\n        // given\n        database().withParameter(\"parameter\").withParameterEntries(\"parameter\", 9).build();\n        ParameterEntryDAO parameterEntryDAO = get(ParameterEntryDAO.class);\n        QueryRunner runner = queryRunner();\n\n        JdbcParameter parameter = get(ParameterDAO.class).getParameter(runner, \"parameter\");\n\n        // when\n        List<ParameterEntry> entries = parameterEntryDAO.list(runner, parameter, new ParameterEntriesFilter(1, 5));\n        runner.close();\n\n        // then\n        assertThat(entries).hasSize(4);\n    }", "signature": "void shouldSelectEntriesWithGivenOffset()", "full_signature": "@Test public void shouldSelectEntriesWithGivenOffset()", "class_method_signature": "ParameterEntryDAOTest.shouldSelectEntriesWithGivenOffset()", "testcase": true, "constructor": false, "invocations": ["build", "withParameterEntries", "withParameter", "database", "get", "queryRunner", "getParameter", "get", "list", "close", "hasSize", "assertThat"]}, "focal_class": {"identifier": "ParameterEntryDAO", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final DefaultJdbcConfig configuration;", "modifier": "private final", "type": "DefaultJdbcConfig", "declarator": "configuration", "var_name": "configuration"}], "methods": [{"identifier": "ParameterEntryDAO", "parameters": "(DefaultJdbcConfig configuration)", "modifiers": "public", "return": "", "signature": " ParameterEntryDAO(DefaultJdbcConfig configuration)", "full_signature": "public  ParameterEntryDAO(DefaultJdbcConfig configuration)", "class_method_signature": "ParameterEntryDAO.ParameterEntryDAO(DefaultJdbcConfig configuration)", "testcase": false, "constructor": true}, {"identifier": "insert", "parameters": "(QueryRunner queryRunner, ParameterEntry parameterEntry, long parameterId)", "modifiers": "public", "return": "long", "signature": "long insert(QueryRunner queryRunner, ParameterEntry parameterEntry, long parameterId)", "full_signature": "public long insert(QueryRunner queryRunner, ParameterEntry parameterEntry, long parameterId)", "class_method_signature": "ParameterEntryDAO.insert(QueryRunner queryRunner, ParameterEntry parameterEntry, long parameterId)", "testcase": false, "constructor": false}, {"identifier": "insert", "parameters": "(QueryRunner queryRunner, Iterable<ParameterEntry> parameterEntries, long parameterId)", "modifiers": "public", "return": "List<Long>", "signature": "List<Long> insert(QueryRunner queryRunner, Iterable<ParameterEntry> parameterEntries, long parameterId)", "full_signature": "public List<Long> insert(QueryRunner queryRunner, Iterable<ParameterEntry> parameterEntries, long parameterId)", "class_method_signature": "ParameterEntryDAO.insert(QueryRunner queryRunner, Iterable<ParameterEntry> parameterEntries, long parameterId)", "testcase": false, "constructor": false}, {"identifier": "concatenateLastLevels", "parameters": "(String[] entryLevels, int maxDistinctLevels)", "modifiers": "private", "return": "String", "signature": "String concatenateLastLevels(String[] entryLevels, int maxDistinctLevels)", "full_signature": "private String concatenateLastLevels(String[] entryLevels, int maxDistinctLevels)", "class_method_signature": "ParameterEntryDAO.concatenateLastLevels(String[] entryLevels, int maxDistinctLevels)", "testcase": false, "constructor": false}, {"identifier": "getParameterEntries", "parameters": "(QueryRunner queryRunner, String parameterName)", "modifiers": "public", "return": "Set<ParameterEntry>", "signature": "Set<ParameterEntry> getParameterEntries(QueryRunner queryRunner, String parameterName)", "full_signature": "public Set<ParameterEntry> getParameterEntries(QueryRunner queryRunner, String parameterName)", "class_method_signature": "ParameterEntryDAO.getParameterEntries(QueryRunner queryRunner, String parameterName)", "testcase": false, "constructor": false}, {"identifier": "getParameterEntries", "parameters": "(QueryRunner queryRunner, List<Long> ids)", "modifiers": "public", "return": "List<ParameterEntry>", "signature": "List<ParameterEntry> getParameterEntries(QueryRunner queryRunner, List<Long> ids)", "full_signature": "public List<ParameterEntry> getParameterEntries(QueryRunner queryRunner, List<Long> ids)", "class_method_signature": "ParameterEntryDAO.getParameterEntries(QueryRunner queryRunner, List<Long> ids)", "testcase": false, "constructor": false}, {"identifier": "getJdbcParameterEntries", "parameters": "(QueryRunner queryRunner, String parameterName)", "modifiers": "public", "return": "Set<JdbcParameterEntry>", "signature": "Set<JdbcParameterEntry> getJdbcParameterEntries(QueryRunner queryRunner, String parameterName)", "full_signature": "public Set<JdbcParameterEntry> getJdbcParameterEntries(QueryRunner queryRunner, String parameterName)", "class_method_signature": "ParameterEntryDAO.getJdbcParameterEntries(QueryRunner queryRunner, String parameterName)", "testcase": false, "constructor": false}, {"identifier": "getParameterEntriesBatch", "parameters": "(QueryRunner queryRunner, String parameterName, long lastEntryId, int batchSize)", "modifiers": "public", "return": "List<ParameterEntry>", "signature": "List<ParameterEntry> getParameterEntriesBatch(QueryRunner queryRunner, String parameterName, long lastEntryId, int batchSize)", "full_signature": "public List<ParameterEntry> getParameterEntriesBatch(QueryRunner queryRunner, String parameterName, long lastEntryId, int batchSize)", "class_method_signature": "ParameterEntryDAO.getParameterEntriesBatch(QueryRunner queryRunner, String parameterName, long lastEntryId, int batchSize)", "testcase": false, "constructor": false}, {"identifier": "createSelectQuery", "parameters": "(String parameterName)", "modifiers": "private", "return": "SelectQuery", "signature": "SelectQuery createSelectQuery(String parameterName)", "full_signature": "private SelectQuery createSelectQuery(String parameterName)", "class_method_signature": "ParameterEntryDAO.createSelectQuery(String parameterName)", "testcase": false, "constructor": false}, {"identifier": "deleteParameterEntries", "parameters": "(QueryRunner queryRunner, String parameterName)", "modifiers": "public", "return": "void", "signature": "void deleteParameterEntries(QueryRunner queryRunner, String parameterName)", "full_signature": "public void deleteParameterEntries(QueryRunner queryRunner, String parameterName)", "class_method_signature": "ParameterEntryDAO.deleteParameterEntries(QueryRunner queryRunner, String parameterName)", "testcase": false, "constructor": false}, {"identifier": "delete", "parameters": "(QueryRunner queryRunner, long entryId)", "modifiers": "public", "return": "void", "signature": "void delete(QueryRunner queryRunner, long entryId)", "full_signature": "public void delete(QueryRunner queryRunner, long entryId)", "class_method_signature": "ParameterEntryDAO.delete(QueryRunner queryRunner, long entryId)", "testcase": false, "constructor": false}, {"identifier": "delete", "parameters": "(QueryRunner queryRunner, Iterable<Long> entriesIds)", "modifiers": "public", "return": "void", "signature": "void delete(QueryRunner queryRunner, Iterable<Long> entriesIds)", "full_signature": "public void delete(QueryRunner queryRunner, Iterable<Long> entriesIds)", "class_method_signature": "ParameterEntryDAO.delete(QueryRunner queryRunner, Iterable<Long> entriesIds)", "testcase": false, "constructor": false}, {"identifier": "update", "parameters": "(QueryRunner queryRunner, long entryId, ParameterEntry entry)", "modifiers": "public", "return": "void", "signature": "void update(QueryRunner queryRunner, long entryId, ParameterEntry entry)", "full_signature": "public void update(QueryRunner queryRunner, long entryId, ParameterEntry entry)", "class_method_signature": "ParameterEntryDAO.update(QueryRunner queryRunner, long entryId, ParameterEntry entry)", "testcase": false, "constructor": false}, {"identifier": "list", "parameters": "(QueryRunner queryRunner, JdbcParameter parameter, ParameterEntriesFilter filters)", "modifiers": "public", "return": "List<ParameterEntry>", "signature": "List<ParameterEntry> list(QueryRunner queryRunner, JdbcParameter parameter, ParameterEntriesFilter filters)", "full_signature": "public List<ParameterEntry> list(QueryRunner queryRunner, JdbcParameter parameter, ParameterEntriesFilter filters)", "class_method_signature": "ParameterEntryDAO.list(QueryRunner queryRunner, JdbcParameter parameter, ParameterEntriesFilter filters)", "testcase": false, "constructor": false}, {"identifier": "createLevelIndex", "parameters": "(Parameter parameter)", "modifiers": "private", "return": "Map<String, Integer>", "signature": "Map<String, Integer> createLevelIndex(Parameter parameter)", "full_signature": "private Map<String, Integer> createLevelIndex(Parameter parameter)", "class_method_signature": "ParameterEntryDAO.createLevelIndex(Parameter parameter)", "testcase": false, "constructor": false}, {"identifier": "levelSearchCondition", "parameters": "(LevelFilter levelFilter, int levelIndex)", "modifiers": "private", "return": "String", "signature": "String levelSearchCondition(LevelFilter levelFilter, int levelIndex)", "full_signature": "private String levelSearchCondition(LevelFilter levelFilter, int levelIndex)", "class_method_signature": "ParameterEntryDAO.levelSearchCondition(LevelFilter levelFilter, int levelIndex)", "testcase": false, "constructor": false}, {"identifier": "lastLevel", "parameters": "()", "modifiers": "private", "return": "String", "signature": "String lastLevel()", "full_signature": "private String lastLevel()", "class_method_signature": "ParameterEntryDAO.lastLevel()", "testcase": false, "constructor": false}, {"identifier": "level", "parameters": "(int levelIndex)", "modifiers": "private", "return": "String", "signature": "String level(int levelIndex)", "full_signature": "private String level(int levelIndex)", "class_method_signature": "ParameterEntryDAO.level(int levelIndex)", "testcase": false, "constructor": false}], "file": "smartparam-repository-jdbc/src/main/java/org/smartparam/repository/jdbc/dao/ParameterEntryDAO.java"}, "focal_method": {"identifier": "list", "parameters": "(QueryRunner queryRunner, JdbcParameter parameter, ParameterEntriesFilter filters)", "modifiers": "public", "return": "List<ParameterEntry>", "body": "public List<ParameterEntry> list(QueryRunner queryRunner, JdbcParameter parameter, ParameterEntriesFilter filters) {\n        SelectQuery query = QueryFactory.selectAll().from(configuration.parameterEntryEntityName())\n                .where(\"fk_parameter = :parameterId\")\n                .withArgument(\"parameterId\", parameter.getId());\n\n        int maxDistinctLevels = configuration.levelColumnCount();\n        int levelIndex = 0;\n        for (Level level : parameter.getLevels()) {\n            if (levelIndex >= maxDistinctLevels) {\n                break;\n            }\n\n            if (filters.hasFilter(level.getName())) {\n                LevelFilter filter = filters.levelFilter(level.getName());\n\n                query.append(\" and (upper(\" + level(levelIndex) + \")\").append(levelSearchCondition(filter, levelIndex)).append(\")\");\n                query.withArgument(level(levelIndex), FilterConverter.parseAntMatcher(filter.value()));\n            }\n\n            levelIndex++;\n        }\n\n        Map<String, Integer> levelIndexMap = createLevelIndex(parameter);\n        for (LevelSorting levelSorting : filters.sorting()) {\n            if (levelIndexMap.containsKey(levelSorting.level())) {\n                levelIndex = levelIndexMap.get(levelSorting.level());\n                if(levelIndex < maxDistinctLevels) {\n                    query.orderBy(level(levelIndex), parseSortOrder(levelSorting.direction()));\n                }\n            }\n        }\n\n        if (filters.applyPaging()) {\n            query.limit(filters.pageSize(), filters.offset());\n        } else if (filters.applyLimits()) {\n            query.limit(filters.pageSize());\n        }\n\n        return queryRunner.queryList(query, new ParameterEntryMapper(configuration));\n    }", "signature": "List<ParameterEntry> list(QueryRunner queryRunner, JdbcParameter parameter, ParameterEntriesFilter filters)", "full_signature": "public List<ParameterEntry> list(QueryRunner queryRunner, JdbcParameter parameter, ParameterEntriesFilter filters)", "class_method_signature": "ParameterEntryDAO.list(QueryRunner queryRunner, JdbcParameter parameter, ParameterEntriesFilter filters)", "testcase": false, "constructor": false, "invocations": ["withArgument", "where", "from", "selectAll", "parameterEntryEntityName", "getId", "levelColumnCount", "getLevels", "hasFilter", "getName", "levelFilter", "getName", "append", "append", "append", "level", "levelSearchCondition", "withArgument", "level", "parseAntMatcher", "value", "createLevelIndex", "sorting", "containsKey", "level", "get", "level", "orderBy", "level", "parseSortOrder", "direction", "applyPaging", "limit", "pageSize", "offset", "applyLimits", "limit", "pageSize", "queryList"]}, "repository": {"repo_id": 15057951, "url": "https://github.com/smartparam/smartparam", "language": "Java", "is_fork": false, "fork_count": 6, "stargazer_count": 27, "size": 2358, "license": "licensed"}}