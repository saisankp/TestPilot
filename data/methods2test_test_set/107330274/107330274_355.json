{"test_class": {"identifier": "AvailabilityZoneConstraintTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String MACHINE_ID = \"1234\";", "modifier": "private static final", "type": "String", "declarator": "MACHINE_ID = \"1234\"", "var_name": "MACHINE_ID"}, {"original_string": "private static final String AVAILABILITY_ZONE = \"zone-1\";", "modifier": "private static final", "type": "String", "declarator": "AVAILABILITY_ZONE = \"zone-1\"", "var_name": "AVAILABILITY_ZONE"}, {"original_string": "private static final String AVAILABILITY_ZONE_ATTRIBUTE_NAME = \"zone\";", "modifier": "private static final", "type": "String", "declarator": "AVAILABILITY_ZONE_ATTRIBUTE_NAME = \"zone\"", "var_name": "AVAILABILITY_ZONE_ATTRIBUTE_NAME"}, {"original_string": "private final SchedulerConfiguration schedulerConfiguration = mock(SchedulerConfiguration.class);", "modifier": "private final", "type": "SchedulerConfiguration", "declarator": "schedulerConfiguration = mock(SchedulerConfiguration.class)", "var_name": "schedulerConfiguration"}, {"original_string": "private final AgentManagementService agentManagementService = mock(AgentManagementService.class);", "modifier": "private final", "type": "AgentManagementService", "declarator": "agentManagementService = mock(AgentManagementService.class)", "var_name": "agentManagementService"}, {"original_string": "private final AvailabilityZoneConstraint constraint = new AvailabilityZoneConstraint(schedulerConfiguration, agentManagementService, AVAILABILITY_ZONE);", "modifier": "private final", "type": "AvailabilityZoneConstraint", "declarator": "constraint = new AvailabilityZoneConstraint(schedulerConfiguration, agentManagementService, AVAILABILITY_ZONE)", "var_name": "constraint"}], "file": "titus-server-master/src/test/java/com/netflix/titus/master/scheduler/constraint/AvailabilityZoneConstraintTest.java"}, "test_case": {"identifier": "availabilityZoneDoesNotMatch", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void availabilityZoneDoesNotMatch() {\n        AgentInstance instance = AgentGenerator.agentInstances().getValue().toBuilder()\n                .withId(MACHINE_ID)\n                .withAttributes(Collections.singletonMap(AVAILABILITY_ZONE_ATTRIBUTE_NAME, \"noMatch\"))\n                .build();\n        when(agentManagementService.findAgentInstance(MACHINE_ID)).thenReturn(Optional.of(instance));\n        Result result = constraint.evaluate(createTaskRequest(TASK_ID), createVirtualMachineCurrentStateMock(MACHINE_ID), createTaskTrackerState());\n        assertThat(result.isSuccessful()).isFalse();\n        assertThat(result.getFailureReason()).isEqualToIgnoringCase(\"The availability zone does not match the specified availability zone\");\n    }", "signature": "void availabilityZoneDoesNotMatch()", "full_signature": "@Test public void availabilityZoneDoesNotMatch()", "class_method_signature": "AvailabilityZoneConstraintTest.availabilityZoneDoesNotMatch()", "testcase": true, "constructor": false, "invocations": ["build", "withAttributes", "withId", "toBuilder", "getValue", "agentInstances", "singletonMap", "thenReturn", "when", "findAgentInstance", "of", "evaluate", "createTaskRequest", "createVirtualMachineCurrentStateMock", "createTaskTrackerState", "isFalse", "assertThat", "isSuccessful", "isEqualToIgnoringCase", "assertThat", "getFailureReason"]}, "focal_class": {"identifier": "AvailabilityZoneConstraint", "superclass": "", "interfaces": "implements ConstraintEvaluator", "fields": [{"original_string": "public static final String NAME = \"AvailabilityZoneConstraint\";", "modifier": "public static final", "type": "String", "declarator": "NAME = \"AvailabilityZoneConstraint\"", "var_name": "NAME"}, {"original_string": "private static final Result VALID = new Result(true, null);", "modifier": "private static final", "type": "Result", "declarator": "VALID = new Result(true, null)", "var_name": "VALID"}, {"original_string": "private static final Result MACHINE_DOES_NOT_EXIST = new Result(false, \"The machine does not exist\");", "modifier": "private static final", "type": "Result", "declarator": "MACHINE_DOES_NOT_EXIST = new Result(false, \"The machine does not exist\")", "var_name": "MACHINE_DOES_NOT_EXIST"}, {"original_string": "private static final Result AVAILABILITY_ZONE_DOES_NOT_MATCH = new Result(false, \"The availability zone does not match the specified availability zone\");", "modifier": "private static final", "type": "Result", "declarator": "AVAILABILITY_ZONE_DOES_NOT_MATCH = new Result(false, \"The availability zone does not match the specified availability zone\")", "var_name": "AVAILABILITY_ZONE_DOES_NOT_MATCH"}, {"original_string": "private final SchedulerConfiguration configuration;", "modifier": "private final", "type": "SchedulerConfiguration", "declarator": "configuration", "var_name": "configuration"}, {"original_string": "private final AgentManagementService agentManagementService;", "modifier": "private final", "type": "AgentManagementService", "declarator": "agentManagementService", "var_name": "agentManagementService"}, {"original_string": "private final String availabilityZone;", "modifier": "private final", "type": "String", "declarator": "availabilityZone", "var_name": "availabilityZone"}], "methods": [{"identifier": "AvailabilityZoneConstraint", "parameters": "(SchedulerConfiguration configuration, AgentManagementService agentManagementService, String availabilityZone)", "modifiers": "public", "return": "", "signature": " AvailabilityZoneConstraint(SchedulerConfiguration configuration, AgentManagementService agentManagementService, String availabilityZone)", "full_signature": "public  AvailabilityZoneConstraint(SchedulerConfiguration configuration, AgentManagementService agentManagementService, String availabilityZone)", "class_method_signature": "AvailabilityZoneConstraint.AvailabilityZoneConstraint(SchedulerConfiguration configuration, AgentManagementService agentManagementService, String availabilityZone)", "testcase": false, "constructor": true}, {"identifier": "getName", "parameters": "()", "modifiers": "@Override public", "return": "String", "signature": "String getName()", "full_signature": "@Override public String getName()", "class_method_signature": "AvailabilityZoneConstraint.getName()", "testcase": false, "constructor": false}, {"identifier": "evaluate", "parameters": "(TaskRequest taskRequest, VirtualMachineCurrentState targetVM, TaskTrackerState taskTrackerState)", "modifiers": "@Override public", "return": "Result", "signature": "Result evaluate(TaskRequest taskRequest, VirtualMachineCurrentState targetVM, TaskTrackerState taskTrackerState)", "full_signature": "@Override public Result evaluate(TaskRequest taskRequest, VirtualMachineCurrentState targetVM, TaskTrackerState taskTrackerState)", "class_method_signature": "AvailabilityZoneConstraint.evaluate(TaskRequest taskRequest, VirtualMachineCurrentState targetVM, TaskTrackerState taskTrackerState)", "testcase": false, "constructor": false}], "file": "titus-server-master/src/main/java/com/netflix/titus/master/scheduler/constraint/AvailabilityZoneConstraint.java"}, "focal_method": {"identifier": "evaluate", "parameters": "(TaskRequest taskRequest, VirtualMachineCurrentState targetVM, TaskTrackerState taskTrackerState)", "modifiers": "@Override public", "return": "Result", "body": "@Override\n    public Result evaluate(TaskRequest taskRequest, VirtualMachineCurrentState targetVM, TaskTrackerState taskTrackerState) {\n        Optional<AgentInstance> instanceOpt = SchedulerUtils.findInstance(agentManagementService, configuration.getInstanceAttributeName(), targetVM);\n        if (!instanceOpt.isPresent()) {\n            return MACHINE_DOES_NOT_EXIST;\n        }\n\n        AgentInstance agentInstance = instanceOpt.get();\n        String instanceAvailabilityZone = agentInstance.getAttributes().getOrDefault(configuration.getAvailabilityZoneAttributeName(), \"\");\n        return instanceAvailabilityZone.equalsIgnoreCase(availabilityZone) ? VALID : AVAILABILITY_ZONE_DOES_NOT_MATCH;\n    }", "signature": "Result evaluate(TaskRequest taskRequest, VirtualMachineCurrentState targetVM, TaskTrackerState taskTrackerState)", "full_signature": "@Override public Result evaluate(TaskRequest taskRequest, VirtualMachineCurrentState targetVM, TaskTrackerState taskTrackerState)", "class_method_signature": "AvailabilityZoneConstraint.evaluate(TaskRequest taskRequest, VirtualMachineCurrentState targetVM, TaskTrackerState taskTrackerState)", "testcase": false, "constructor": false, "invocations": ["findInstance", "getInstanceAttributeName", "isPresent", "get", "getOrDefault", "getAttributes", "getAvailabilityZoneAttributeName", "equalsIgnoreCase"]}, "repository": {"repo_id": 107330274, "url": "https://github.com/Netflix/titus-control-plane", "stars": 241, "created": "10/17/2017 10:20:55 PM +00:00", "updates": "2020-01-25T13:01:05+00:00", "fork": "False", "license": "licensed"}}