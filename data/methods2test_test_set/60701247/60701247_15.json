{"test_class": {"identifier": "MemoryServiceProxyTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Common.Session SESSION1 = Common.Session.newBuilder().setSessionId(1).setPid(1).build();", "modifier": "private static final", "type": "Common.Session", "declarator": "SESSION1 = Common.Session.newBuilder().setSessionId(1).setPid(1).build()", "var_name": "SESSION1"}, {"original_string": "private static final Common.Session SESSION2 = Common.Session.newBuilder().setSessionId(2).setPid(2).build();", "modifier": "private static final", "type": "Common.Session", "declarator": "SESSION2 = Common.Session.newBuilder().setSessionId(2).setPid(2).build()", "var_name": "SESSION2"}, {"original_string": "@NotNull private final FakeMemoryService myService = new FakeMemoryService();", "modifier": "@NotNull private final", "type": "FakeMemoryService", "declarator": "myService = new FakeMemoryService()", "var_name": "myService"}, {"original_string": "@Rule public FakeGrpcChannel myGrpcChannel = new FakeGrpcChannel(\"MemoryServiceProxyTest\", myService);", "modifier": "@Rule public", "type": "FakeGrpcChannel", "declarator": "myGrpcChannel = new FakeGrpcChannel(\"MemoryServiceProxyTest\", myService)", "var_name": "myGrpcChannel"}, {"original_string": "@NotNull private MemoryServiceProxy myProxy;", "modifier": "@NotNull private", "type": "MemoryServiceProxy", "declarator": "myProxy", "var_name": "myProxy"}, {"original_string": "private IDevice myDevice;", "modifier": "private", "type": "IDevice", "declarator": "myDevice", "var_name": "myDevice"}, {"original_string": "private Map<String, ByteString> myProxyBytesCache = new HashMap<>();", "modifier": "private", "type": "Map<String, ByteString>", "declarator": "myProxyBytesCache = new HashMap<>()", "var_name": "myProxyBytesCache"}, {"original_string": "private FakeLegacyAllocationTracker myTracker = new FakeLegacyAllocationTracker();", "modifier": "private", "type": "FakeLegacyAllocationTracker", "declarator": "myTracker = new FakeLegacyAllocationTracker()", "var_name": "myTracker"}], "file": "profilers-android/testSrc/com/android/tools/idea/profilers/perfd/MemoryServiceProxyTest.java"}, "test_case": {"identifier": "testLegacyAllocationTrackingReturningNullData", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testLegacyAllocationTrackingReturningNullData() throws Exception {\n    int time1 = 5;\n    int time2 = 10;\n\n    // Enable a tracking session on Process 1\n    myProxy.trackAllocations(\n      TrackAllocationsRequest.newBuilder().setSession(SESSION1).setEnabled(true).setRequestTime(time1).build(),\n      mock(StreamObserver.class));\n\n    // Disable a tracking session on Process 1\n    myProxy.trackAllocations(\n      TrackAllocationsRequest.newBuilder().setSession(SESSION1).setEnabled(false).setRequestTime(time2).build(),\n      mock(StreamObserver.class));\n\n    // Mock completion of the parsing process and returning of null data;\n    myTracker.setReturnNullTrackingData(true);\n    myTracker.getParsingWaitLatch().countDown();\n    myTracker.getParsingDoneLatch().await();\n    assertThat(myProxyBytesCache.get(Integer.toString(time1))).isEqualTo(ByteString.EMPTY);\n  }", "signature": "void testLegacyAllocationTrackingReturningNullData()", "full_signature": "@Test public void testLegacyAllocationTrackingReturningNullData()", "class_method_signature": "MemoryServiceProxyTest.testLegacyAllocationTrackingReturningNullData()", "testcase": true, "constructor": false, "invocations": ["trackAllocations", "build", "setRequestTime", "setEnabled", "setSession", "newBuilder", "mock", "trackAllocations", "build", "setRequestTime", "setEnabled", "setSession", "newBuilder", "mock", "setReturnNullTrackingData", "countDown", "getParsingWaitLatch", "await", "getParsingDoneLatch", "isEqualTo", "assertThat", "get", "toString"]}, "focal_class": {"identifier": "MemoryServiceProxy", "superclass": "extends ServiceProxy", "interfaces": "", "fields": [{"original_string": "@NotNull private Executor myFetchExecutor;", "modifier": "@NotNull private", "type": "Executor", "declarator": "myFetchExecutor", "var_name": "myFetchExecutor"}, {"original_string": "@NotNull private final MemoryServiceGrpc.MemoryServiceBlockingStub myServiceStub;", "modifier": "@NotNull private final", "type": "MemoryServiceGrpc.MemoryServiceBlockingStub", "declarator": "myServiceStub", "var_name": "myServiceStub"}, {"original_string": "@NotNull private final IDevice myDevice;", "modifier": "@NotNull private final", "type": "IDevice", "declarator": "myDevice", "var_name": "myDevice"}, {"original_string": "@NotNull private BiFunction<IDevice, Integer, LegacyAllocationTracker> myTrackerSupplier;", "modifier": "@NotNull private", "type": "BiFunction<IDevice, Integer, LegacyAllocationTracker>", "declarator": "myTrackerSupplier", "var_name": "myTrackerSupplier"}, {"original_string": "@NotNull private final Map<String, ByteString> myProxyBytesCache;", "modifier": "@NotNull private final", "type": "Map<String, ByteString>", "declarator": "myProxyBytesCache", "var_name": "myProxyBytesCache"}, {"original_string": "private boolean myUseLegacyTracking;", "modifier": "private", "type": "boolean", "declarator": "myUseLegacyTracking", "var_name": "myUseLegacyTracking"}, {"original_string": "private final Object myUpdatingDataLock;", "modifier": "private final", "type": "Object", "declarator": "myUpdatingDataLock", "var_name": "myUpdatingDataLock"}, {"original_string": "@Nullable private Long2ObjectMap<LegacyAllocationTracker> myLegacyTrackers;", "modifier": "@Nullable private", "type": "Long2ObjectMap<LegacyAllocationTracker>", "declarator": "myLegacyTrackers", "var_name": "myLegacyTrackers"}, {"original_string": "@Nullable private Long2ObjectMap<Long2ObjectMap<AllocationsInfo>> myTrackingInfos;", "modifier": "@Nullable private", "type": "Long2ObjectMap<Long2ObjectMap<AllocationsInfo>>", "declarator": "myTrackingInfos", "var_name": "myTrackingInfos"}, {"original_string": "@Nullable private Long2ObjectMap<AllocationsInfo> myInProgressTrackingInfo;", "modifier": "@Nullable private", "type": "Long2ObjectMap<AllocationsInfo>", "declarator": "myInProgressTrackingInfo", "var_name": "myInProgressTrackingInfo"}, {"original_string": "@Nullable private Long2ObjectMap<Long2ObjectMap<AllocatedClass>> myAllocatedClasses;", "modifier": "@Nullable private", "type": "Long2ObjectMap<Long2ObjectMap<AllocatedClass>>", "declarator": "myAllocatedClasses", "var_name": "myAllocatedClasses"}, {"original_string": "@Nullable private Long2ObjectMap<Long2ObjectMap<AllocationStack>> myAllocationStacks;", "modifier": "@Nullable private", "type": "Long2ObjectMap<Long2ObjectMap<AllocationStack>>", "declarator": "myAllocationStacks", "var_name": "myAllocationStacks"}], "methods": [{"identifier": "getLogger", "parameters": "()", "modifiers": "private static", "return": "Logger", "signature": "Logger getLogger()", "full_signature": "private static Logger getLogger()", "class_method_signature": "MemoryServiceProxy.getLogger()", "testcase": false, "constructor": false}, {"identifier": "MemoryServiceProxy", "parameters": "(@NotNull IDevice device,\n                            @NotNull ManagedChannel channel,\n                            @NotNull Executor fetchExecutor,\n                            @NotNull BiFunction<IDevice, Integer, LegacyAllocationTracker> legacyTrackerSupplier,\n                            Map<String, ByteString> proxyBytesCache)", "modifiers": "public", "return": "", "signature": " MemoryServiceProxy(@NotNull IDevice device,\n                            @NotNull ManagedChannel channel,\n                            @NotNull Executor fetchExecutor,\n                            @NotNull BiFunction<IDevice, Integer, LegacyAllocationTracker> legacyTrackerSupplier,\n                            Map<String, ByteString> proxyBytesCache)", "full_signature": "public  MemoryServiceProxy(@NotNull IDevice device,\n                            @NotNull ManagedChannel channel,\n                            @NotNull Executor fetchExecutor,\n                            @NotNull BiFunction<IDevice, Integer, LegacyAllocationTracker> legacyTrackerSupplier,\n                            Map<String, ByteString> proxyBytesCache)", "class_method_signature": "MemoryServiceProxy.MemoryServiceProxy(@NotNull IDevice device,\n                            @NotNull ManagedChannel channel,\n                            @NotNull Executor fetchExecutor,\n                            @NotNull BiFunction<IDevice, Integer, LegacyAllocationTracker> legacyTrackerSupplier,\n                            Map<String, ByteString> proxyBytesCache)", "testcase": false, "constructor": true}, {"identifier": "startMonitoringApp", "parameters": "(MemoryProfiler.MemoryStartRequest request,\n                                 StreamObserver<MemoryProfiler.MemoryStartResponse> responseObserver)", "modifiers": "public", "return": "void", "signature": "void startMonitoringApp(MemoryProfiler.MemoryStartRequest request,\n                                 StreamObserver<MemoryProfiler.MemoryStartResponse> responseObserver)", "full_signature": "public void startMonitoringApp(MemoryProfiler.MemoryStartRequest request,\n                                 StreamObserver<MemoryProfiler.MemoryStartResponse> responseObserver)", "class_method_signature": "MemoryServiceProxy.startMonitoringApp(MemoryProfiler.MemoryStartRequest request,\n                                 StreamObserver<MemoryProfiler.MemoryStartResponse> responseObserver)", "testcase": false, "constructor": false}, {"identifier": "stopMonitoringApp", "parameters": "(MemoryProfiler.MemoryStopRequest request,\n                                StreamObserver<MemoryProfiler.MemoryStopResponse> responseObserver)", "modifiers": "public", "return": "void", "signature": "void stopMonitoringApp(MemoryProfiler.MemoryStopRequest request,\n                                StreamObserver<MemoryProfiler.MemoryStopResponse> responseObserver)", "full_signature": "public void stopMonitoringApp(MemoryProfiler.MemoryStopRequest request,\n                                StreamObserver<MemoryProfiler.MemoryStopResponse> responseObserver)", "class_method_signature": "MemoryServiceProxy.stopMonitoringApp(MemoryProfiler.MemoryStopRequest request,\n                                StreamObserver<MemoryProfiler.MemoryStopResponse> responseObserver)", "testcase": false, "constructor": false}, {"identifier": "getData", "parameters": "(MemoryProfiler.MemoryRequest request, StreamObserver<MemoryProfiler.MemoryData> responseObserver)", "modifiers": "public", "return": "void", "signature": "void getData(MemoryProfiler.MemoryRequest request, StreamObserver<MemoryProfiler.MemoryData> responseObserver)", "full_signature": "public void getData(MemoryProfiler.MemoryRequest request, StreamObserver<MemoryProfiler.MemoryData> responseObserver)", "class_method_signature": "MemoryServiceProxy.getData(MemoryProfiler.MemoryRequest request, StreamObserver<MemoryProfiler.MemoryData> responseObserver)", "testcase": false, "constructor": false}, {"identifier": "trackAllocations", "parameters": "(TrackAllocationsRequest request,\n                               StreamObserver<TrackAllocationsResponse> responseObserver)", "modifiers": "public", "return": "void", "signature": "void trackAllocations(TrackAllocationsRequest request,\n                               StreamObserver<TrackAllocationsResponse> responseObserver)", "full_signature": "public void trackAllocations(TrackAllocationsRequest request,\n                               StreamObserver<TrackAllocationsResponse> responseObserver)", "class_method_signature": "MemoryServiceProxy.trackAllocations(TrackAllocationsRequest request,\n                               StreamObserver<TrackAllocationsResponse> responseObserver)", "testcase": false, "constructor": false}, {"identifier": "enableAllocations", "parameters": "(long startTimeNs, long sessionId)", "modifiers": "private", "return": "TrackAllocationsResponse", "signature": "TrackAllocationsResponse enableAllocations(long startTimeNs, long sessionId)", "full_signature": "private TrackAllocationsResponse enableAllocations(long startTimeNs, long sessionId)", "class_method_signature": "MemoryServiceProxy.enableAllocations(long startTimeNs, long sessionId)", "testcase": false, "constructor": false}, {"identifier": "disableAllocations", "parameters": "(long endtimeNs, long sessionId)", "modifiers": "private", "return": "TrackAllocationsResponse", "signature": "TrackAllocationsResponse disableAllocations(long endtimeNs, long sessionId)", "full_signature": "private TrackAllocationsResponse disableAllocations(long endtimeNs, long sessionId)", "class_method_signature": "MemoryServiceProxy.disableAllocations(long endtimeNs, long sessionId)", "testcase": false, "constructor": false}, {"identifier": "saveAllocationData", "parameters": "(long sessionId, long infoId, @Nullable byte[] rawBytes)", "modifiers": "private", "return": "void", "signature": "void saveAllocationData(long sessionId, long infoId, @Nullable byte[] rawBytes)", "full_signature": "private void saveAllocationData(long sessionId, long infoId, @Nullable byte[] rawBytes)", "class_method_signature": "MemoryServiceProxy.saveAllocationData(long sessionId, long infoId, @Nullable byte[] rawBytes)", "testcase": false, "constructor": false}, {"identifier": "forceGarbageCollection", "parameters": "(ForceGarbageCollectionRequest request, StreamObserver<ForceGarbageCollectionResponse> observer)", "modifiers": "public", "return": "void", "signature": "void forceGarbageCollection(ForceGarbageCollectionRequest request, StreamObserver<ForceGarbageCollectionResponse> observer)", "full_signature": "public void forceGarbageCollection(ForceGarbageCollectionRequest request, StreamObserver<ForceGarbageCollectionResponse> observer)", "class_method_signature": "MemoryServiceProxy.forceGarbageCollection(ForceGarbageCollectionRequest request, StreamObserver<ForceGarbageCollectionResponse> observer)", "testcase": false, "constructor": false}, {"identifier": "getServiceDefinition", "parameters": "()", "modifiers": "@Override public", "return": "ServerServiceDefinition", "signature": "ServerServiceDefinition getServiceDefinition()", "full_signature": "@Override public ServerServiceDefinition getServiceDefinition()", "class_method_signature": "MemoryServiceProxy.getServiceDefinition()", "testcase": false, "constructor": false}], "file": "profilers-android/src/com/android/tools/idea/profilers/perfd/MemoryServiceProxy.java"}, "focal_method": {"identifier": "trackAllocations", "parameters": "(TrackAllocationsRequest request,\n                               StreamObserver<TrackAllocationsResponse> responseObserver)", "modifiers": "public", "return": "void", "body": "public void trackAllocations(TrackAllocationsRequest request,\n                               StreamObserver<TrackAllocationsResponse> responseObserver) {\n    long sessionId = request.getSession().getSessionId();\n    long timestamp = request.getRequestTime();\n    TrackAllocationsResponse response;\n    if (myUseLegacyTracking) {\n      response = request.getEnabled() ? enableAllocations(timestamp, sessionId) : disableAllocations(timestamp, sessionId);\n    }\n    else {\n      // Post-O tracking - goes straight to perfd.\n      response = myServiceStub.trackAllocations(request);\n    }\n\n    responseObserver.onNext(response);\n    responseObserver.onCompleted();\n  }", "signature": "void trackAllocations(TrackAllocationsRequest request,\n                               StreamObserver<TrackAllocationsResponse> responseObserver)", "full_signature": "public void trackAllocations(TrackAllocationsRequest request,\n                               StreamObserver<TrackAllocationsResponse> responseObserver)", "class_method_signature": "MemoryServiceProxy.trackAllocations(TrackAllocationsRequest request,\n                               StreamObserver<TrackAllocationsResponse> responseObserver)", "testcase": false, "constructor": false, "invocations": ["getSessionId", "getSession", "getRequestTime", "getEnabled", "enableAllocations", "disableAllocations", "trackAllocations", "onNext", "onCompleted"]}, "repository": {"repo_id": 60701247, "url": "https://github.com/JetBrains/android", "stars": 486, "created": "6/8/2016 1:46:48 PM +00:00", "updates": "2020-01-27T16:45:40+00:00", "fork": "False", "license": "licensed"}}