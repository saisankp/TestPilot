{"test_class": {"identifier": "HibernateDHIS2ReportingDAOTest", "superclass": "extends\n\t\t\tBaseModuleContextSensitiveTest", "interfaces": "", "fields": [{"original_string": "protected final Log log = LogFactory.getLog(getClass());", "modifier": "protected final", "type": "Log", "declarator": "log = LogFactory.getLog(getClass())", "var_name": "log"}, {"original_string": "protected static final String INITIAL_OBS_XML = \"db/ObsServiceTest-initial.xml\";", "modifier": "protected static final", "type": "String", "declarator": "INITIAL_OBS_XML = \"db/ObsServiceTest-initial.xml\"", "var_name": "INITIAL_OBS_XML"}, {"original_string": "DHIS2ReportingService dhis2ReportingService = null;", "modifier": "", "type": "DHIS2ReportingService", "declarator": "dhis2ReportingService = null", "var_name": "dhis2ReportingService"}, {"original_string": "DHIS2ReportingDAO dao;", "modifier": "", "type": "DHIS2ReportingDAO", "declarator": "dao", "var_name": "dao"}], "file": "api/src/test/java/org/openmrs/module/dhisreport/api/db/hibernate/HibernateDHIS2ReportingDAOTest.java"}, "test_case": {"identifier": "shouldevaluateDataValueTemplate", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n\tpublic void shouldevaluateDataValueTemplate()\n\t\t\tthrows DHIS2ReportingException, JAXBException, IOException,\n\t\t\tParseException {\n\t\tClassPathResource resource = new ClassPathResource(\n\t\t\t\t\"reportDefinition.xml\");\n\t\tJAXBContext jaxbContext = JAXBContext\n\t\t\t\t.newInstance(ReportTemplates.class);\n\n\t\tUnmarshaller jaxbUnmarshaller = jaxbContext.createUnmarshaller();\n\t\tReportTemplates reportTemplates = (ReportTemplates) jaxbUnmarshaller\n\t\t\t\t.unmarshal(resource.getInputStream());\n\t\tList<ReportDefinition> rds = reportTemplates.getReportDefinitions();\n\t\tString timeperiod = \"2016-06-28\";\n\t\tLocation location = new Location();\n\t\tlocation.setName(\"County General\");\n\t\tlocation.setDescription(\"desc\");\n\t\tlocation.setAddress1(\"address1\");\n\t\tlocation.setId(3);\n\n\t\tPeriod period = new MonthlyPeriod(new SimpleDateFormat(\"yyyy-MM-dd\")\n\t\t\t\t.parse(timeperiod));\n\t\tSimpleDateFormat dateformat = new SimpleDateFormat(\"yyyy-MM-dd\");\n\t\tString start = \"2016-06-28\";\n\t\tString end = \"2016-06-30\";\n\t\tDate startDate = null;\n\t\tDate endDate = null;\n\t\tstartDate = dateformat.parse(start);\n\t\tendDate = dateformat.parse(end);\n\n\t\tperiod.setStartDate(startDate);\n\t\tperiod.setEndDate(endDate);\n\t\tfor (ReportDefinition rd : rds) {\n\t\t\tfor (DataValueTemplate r : rd.getDataValueTemplates()) {\n\n\t\t\t\tString dvs = dao.evaluateDataValueTemplate(r, period, location,\n\t\t\t\t\t\tfalse);\n\t\t\t\tassertEquals(\"3\", dvs);\n\t\t\t}\n\t\t}\n\t}", "signature": "void shouldevaluateDataValueTemplate()", "full_signature": "@Test public void shouldevaluateDataValueTemplate()", "class_method_signature": "HibernateDHIS2ReportingDAOTest.shouldevaluateDataValueTemplate()", "testcase": true, "constructor": false, "invocations": ["newInstance", "createUnmarshaller", "unmarshal", "getInputStream", "getReportDefinitions", "setName", "setDescription", "setAddress1", "setId", "parse", "parse", "parse", "setStartDate", "setEndDate", "getDataValueTemplates", "evaluateDataValueTemplate", "assertEquals"]}, "focal_class": {"identifier": "HibernateDHIS2ReportingDAO", "superclass": "", "interfaces": "implements DHIS2ReportingDAO", "fields": [{"original_string": "private static final String LOCATION = \"locationId\";", "modifier": "private static final", "type": "String", "declarator": "LOCATION = \"locationId\"", "var_name": "LOCATION"}, {"original_string": "private static final String START = \"startDate\";", "modifier": "private static final", "type": "String", "declarator": "START = \"startDate\"", "var_name": "START"}, {"original_string": "private static final String END = \"endDate\";", "modifier": "private static final", "type": "String", "declarator": "END = \"endDate\"", "var_name": "END"}, {"original_string": "protected final Log log = LogFactory.getLog(this.getClass());", "modifier": "protected final", "type": "Log", "declarator": "log = LogFactory.getLog(this.getClass())", "var_name": "log"}, {"original_string": "private SessionFactory sessionFactory;", "modifier": "private", "type": "SessionFactory", "declarator": "sessionFactory", "var_name": "sessionFactory"}], "methods": [{"identifier": "setSessionFactory", "parameters": "(SessionFactory sessionFactory)", "modifiers": "public", "return": "void", "signature": "void setSessionFactory(SessionFactory sessionFactory)", "full_signature": "public void setSessionFactory(SessionFactory sessionFactory)", "class_method_signature": "HibernateDHIS2ReportingDAO.setSessionFactory(SessionFactory sessionFactory)", "testcase": false, "constructor": false}, {"identifier": "getSessionFactory", "parameters": "()", "modifiers": "public", "return": "SessionFactory", "signature": "SessionFactory getSessionFactory()", "full_signature": "public SessionFactory getSessionFactory()", "class_method_signature": "HibernateDHIS2ReportingDAO.getSessionFactory()", "testcase": false, "constructor": false}, {"identifier": "getDataElement", "parameters": "(Integer id)", "modifiers": "@Override public", "return": "DataElement", "signature": "DataElement getDataElement(Integer id)", "full_signature": "@Override public DataElement getDataElement(Integer id)", "class_method_signature": "HibernateDHIS2ReportingDAO.getDataElement(Integer id)", "testcase": false, "constructor": false}, {"identifier": "saveDataElement", "parameters": "(DataElement de)", "modifiers": "@Override public", "return": "DataElement", "signature": "DataElement saveDataElement(DataElement de)", "full_signature": "@Override public DataElement saveDataElement(DataElement de)", "class_method_signature": "HibernateDHIS2ReportingDAO.saveDataElement(DataElement de)", "testcase": false, "constructor": false}, {"identifier": "deleteDataElement", "parameters": "(DataElement de)", "modifiers": "@Override public", "return": "void", "signature": "void deleteDataElement(DataElement de)", "full_signature": "@Override public void deleteDataElement(DataElement de)", "class_method_signature": "HibernateDHIS2ReportingDAO.deleteDataElement(DataElement de)", "testcase": false, "constructor": false}, {"identifier": "getDisaggregation", "parameters": "(Integer id)", "modifiers": "@Override public", "return": "Disaggregation", "signature": "Disaggregation getDisaggregation(Integer id)", "full_signature": "@Override public Disaggregation getDisaggregation(Integer id)", "class_method_signature": "HibernateDHIS2ReportingDAO.getDisaggregation(Integer id)", "testcase": false, "constructor": false}, {"identifier": "saveDisaggregation", "parameters": "(Disaggregation disagg)", "modifiers": "@Override public", "return": "Disaggregation", "signature": "Disaggregation saveDisaggregation(Disaggregation disagg)", "full_signature": "@Override public Disaggregation saveDisaggregation(Disaggregation disagg)", "class_method_signature": "HibernateDHIS2ReportingDAO.saveDisaggregation(Disaggregation disagg)", "testcase": false, "constructor": false}, {"identifier": "getReportDefinition", "parameters": "(Integer id)", "modifiers": "@Override public", "return": "ReportDefinition", "signature": "ReportDefinition getReportDefinition(Integer id)", "full_signature": "@Override public ReportDefinition getReportDefinition(Integer id)", "class_method_signature": "HibernateDHIS2ReportingDAO.getReportDefinition(Integer id)", "testcase": false, "constructor": false}, {"identifier": "saveReportDefinition", "parameters": "(ReportDefinition rd)", "modifiers": "@Override public", "return": "ReportDefinition", "signature": "ReportDefinition saveReportDefinition(ReportDefinition rd)", "full_signature": "@Override public ReportDefinition saveReportDefinition(ReportDefinition rd)", "class_method_signature": "HibernateDHIS2ReportingDAO.saveReportDefinition(ReportDefinition rd)", "testcase": false, "constructor": false}, {"identifier": "getAllDataElements", "parameters": "()", "modifiers": "@Override public", "return": "Collection<DataElement>", "signature": "Collection<DataElement> getAllDataElements()", "full_signature": "@Override public Collection<DataElement> getAllDataElements()", "class_method_signature": "HibernateDHIS2ReportingDAO.getAllDataElements()", "testcase": false, "constructor": false}, {"identifier": "getAllDisaggregations", "parameters": "()", "modifiers": "@Override public", "return": "Collection<Disaggregation>", "signature": "Collection<Disaggregation> getAllDisaggregations()", "full_signature": "@Override public Collection<Disaggregation> getAllDisaggregations()", "class_method_signature": "HibernateDHIS2ReportingDAO.getAllDisaggregations()", "testcase": false, "constructor": false}, {"identifier": "deleteDisaggregation", "parameters": "(Disaggregation disagg)", "modifiers": "@Override public", "return": "void", "signature": "void deleteDisaggregation(Disaggregation disagg)", "full_signature": "@Override public void deleteDisaggregation(Disaggregation disagg)", "class_method_signature": "HibernateDHIS2ReportingDAO.deleteDisaggregation(Disaggregation disagg)", "testcase": false, "constructor": false}, {"identifier": "getAllReportDefinitions", "parameters": "()", "modifiers": "@Override public", "return": "Collection<ReportDefinition>", "signature": "Collection<ReportDefinition> getAllReportDefinitions()", "full_signature": "@Override public Collection<ReportDefinition> getAllReportDefinitions()", "class_method_signature": "HibernateDHIS2ReportingDAO.getAllReportDefinitions()", "testcase": false, "constructor": false}, {"identifier": "deleteReportDefinition", "parameters": "(ReportDefinition rd)", "modifiers": "@Override public", "return": "void", "signature": "void deleteReportDefinition(ReportDefinition rd)", "full_signature": "@Override public void deleteReportDefinition(ReportDefinition rd)", "class_method_signature": "HibernateDHIS2ReportingDAO.deleteReportDefinition(ReportDefinition rd)", "testcase": false, "constructor": false}, {"identifier": "evaluateDataValueTemplate", "parameters": "(DataValueTemplate dvt,\n\t\t\tPeriod period, Location location, boolean priority)", "modifiers": "@Override public", "return": "String", "signature": "String evaluateDataValueTemplate(DataValueTemplate dvt,\n\t\t\tPeriod period, Location location, boolean priority)", "full_signature": "@Override public String evaluateDataValueTemplate(DataValueTemplate dvt,\n\t\t\tPeriod period, Location location, boolean priority)", "class_method_signature": "HibernateDHIS2ReportingDAO.evaluateDataValueTemplate(DataValueTemplate dvt,\n\t\t\tPeriod period, Location location, boolean priority)", "testcase": false, "constructor": false}, {"identifier": "getObjectByUid", "parameters": "(String uid, Class<?> clazz)", "modifiers": "public", "return": "Identifiable", "signature": "Identifiable getObjectByUid(String uid, Class<?> clazz)", "full_signature": "public Identifiable getObjectByUid(String uid, Class<?> clazz)", "class_method_signature": "HibernateDHIS2ReportingDAO.getObjectByUid(String uid, Class<?> clazz)", "testcase": false, "constructor": false}, {"identifier": "saveReportDefinitionObject", "parameters": "(ReportDefinition object)", "modifiers": "@Transactional public", "return": "Identifiable", "signature": "Identifiable saveReportDefinitionObject(ReportDefinition object)", "full_signature": "@Transactional public Identifiable saveReportDefinitionObject(ReportDefinition object)", "class_method_signature": "HibernateDHIS2ReportingDAO.saveReportDefinitionObject(ReportDefinition object)", "testcase": false, "constructor": false}, {"identifier": "saveDataElementObject", "parameters": "(DataElement object)", "modifiers": "@Transactional public", "return": "Identifiable", "signature": "Identifiable saveDataElementObject(DataElement object)", "full_signature": "@Transactional public Identifiable saveDataElementObject(DataElement object)", "class_method_signature": "HibernateDHIS2ReportingDAO.saveDataElementObject(DataElement object)", "testcase": false, "constructor": false}, {"identifier": "saveObject", "parameters": "(Identifiable object)", "modifiers": "@Transactional public", "return": "Identifiable", "signature": "Identifiable saveObject(Identifiable object)", "full_signature": "@Transactional public Identifiable saveObject(Identifiable object)", "class_method_signature": "HibernateDHIS2ReportingDAO.saveObject(Identifiable object)", "testcase": false, "constructor": false}, {"identifier": "getDataElementByUid", "parameters": "(String uid)", "modifiers": "@Override public", "return": "DataElement", "signature": "DataElement getDataElementByUid(String uid)", "full_signature": "@Override public DataElement getDataElementByUid(String uid)", "class_method_signature": "HibernateDHIS2ReportingDAO.getDataElementByUid(String uid)", "testcase": false, "constructor": false}, {"identifier": "getDisaggregationByUid", "parameters": "(String uid)", "modifiers": "@Override public", "return": "Disaggregation", "signature": "Disaggregation getDisaggregationByUid(String uid)", "full_signature": "@Override public Disaggregation getDisaggregationByUid(String uid)", "class_method_signature": "HibernateDHIS2ReportingDAO.getDisaggregationByUid(String uid)", "testcase": false, "constructor": false}, {"identifier": "getReportDefinitionByUid", "parameters": "(String uid)", "modifiers": "@Override public", "return": "ReportDefinition", "signature": "ReportDefinition getReportDefinitionByUid(String uid)", "full_signature": "@Override public ReportDefinition getReportDefinitionByUid(String uid)", "class_method_signature": "HibernateDHIS2ReportingDAO.getReportDefinitionByUid(String uid)", "testcase": false, "constructor": false}, {"identifier": "getReportDefinitionByCode", "parameters": "(String code)", "modifiers": "@Override public", "return": "ReportDefinition", "signature": "ReportDefinition getReportDefinitionByCode(String code)", "full_signature": "@Override public ReportDefinition getReportDefinitionByCode(String code)", "class_method_signature": "HibernateDHIS2ReportingDAO.getReportDefinitionByCode(String code)", "testcase": false, "constructor": false}, {"identifier": "getDataValueTemplate", "parameters": "(Integer id)", "modifiers": "@Override public", "return": "DataValueTemplate", "signature": "DataValueTemplate getDataValueTemplate(Integer id)", "full_signature": "@Override public DataValueTemplate getDataValueTemplate(Integer id)", "class_method_signature": "HibernateDHIS2ReportingDAO.getDataValueTemplate(Integer id)", "testcase": false, "constructor": false}, {"identifier": "saveDataValueTemplate", "parameters": "(DataValueTemplate dvt)", "modifiers": "@Override public", "return": "DataValueTemplate", "signature": "DataValueTemplate saveDataValueTemplate(DataValueTemplate dvt)", "full_signature": "@Override public DataValueTemplate saveDataValueTemplate(DataValueTemplate dvt)", "class_method_signature": "HibernateDHIS2ReportingDAO.saveDataValueTemplate(DataValueTemplate dvt)", "testcase": false, "constructor": false}, {"identifier": "saveDataValueTemplateTest", "parameters": "(DataValueTemplate dvt)", "modifiers": "@Override public", "return": "DataValueTemplate", "signature": "DataValueTemplate saveDataValueTemplateTest(DataValueTemplate dvt)", "full_signature": "@Override public DataValueTemplate saveDataValueTemplateTest(DataValueTemplate dvt)", "class_method_signature": "HibernateDHIS2ReportingDAO.saveDataValueTemplateTest(DataValueTemplate dvt)", "testcase": false, "constructor": false}, {"identifier": "getLocationByOU_Code", "parameters": "(String OU_Code)", "modifiers": "@Override public", "return": "Location", "signature": "Location getLocationByOU_Code(String OU_Code)", "full_signature": "@Override public Location getLocationByOU_Code(String OU_Code)", "class_method_signature": "HibernateDHIS2ReportingDAO.getLocationByOU_Code(String OU_Code)", "testcase": false, "constructor": false}, {"identifier": "getDataElementByCode", "parameters": "(String code)", "modifiers": "@Override public", "return": "DataElement", "signature": "DataElement getDataElementByCode(String code)", "full_signature": "@Override public DataElement getDataElementByCode(String code)", "class_method_signature": "HibernateDHIS2ReportingDAO.getDataElementByCode(String code)", "testcase": false, "constructor": false}, {"identifier": "getCurrentSession", "parameters": "()", "modifiers": "private", "return": "org.hibernate.Session", "signature": "org.hibernate.Session getCurrentSession()", "full_signature": "private org.hibernate.Session getCurrentSession()", "class_method_signature": "HibernateDHIS2ReportingDAO.getCurrentSession()", "testcase": false, "constructor": false}, {"identifier": "getReport", "parameters": "(\n\t\t\torg.openmrs.module.reporting.report.definition.ReportDefinition repD,\n\t\t\tString label, Location location, Period period)", "modifiers": "private", "return": "Object", "signature": "Object getReport(\n\t\t\torg.openmrs.module.reporting.report.definition.ReportDefinition repD,\n\t\t\tString label, Location location, Period period)", "full_signature": "private Object getReport(\n\t\t\torg.openmrs.module.reporting.report.definition.ReportDefinition repD,\n\t\t\tString label, Location location, Period period)", "class_method_signature": "HibernateDHIS2ReportingDAO.getReport(\n\t\t\torg.openmrs.module.reporting.report.definition.ReportDefinition repD,\n\t\t\tString label, Location location, Period period)", "testcase": false, "constructor": false}], "file": "api/src/main/java/org/openmrs/module/dhisreport/api/db/hibernate/HibernateDHIS2ReportingDAO.java"}, "focal_method": {"identifier": "evaluateDataValueTemplate", "parameters": "(DataValueTemplate dvt,\n\t\t\tPeriod period, Location location, boolean priority)", "modifiers": "@Override public", "return": "String", "body": "@Override\n\tpublic String evaluateDataValueTemplate(DataValueTemplate dvt,\n\t\t\tPeriod period, Location location, boolean priority)\n\t\t\tthrows DHIS2ReportingException {\n\t\tString queryString = dvt.getQuery();\n\t\tqueryString = queryString.replaceAll(\"\\t\", \" \");\n\t\tqueryString = queryString.replaceAll(\"\\n\", \" \");\n\t\tqueryString = queryString.trim();\n\t\tString mappedUuid = dvt.getMappeddefinitionuuid();\n\t\tif (queryString == null || queryString.isEmpty()\n\t\t\t\t|| (priority && mappedUuid != null)) {\n\t\t\torg.openmrs.module.reporting.report.definition.ReportDefinition rrd = Context\n\t\t\t\t\t.getService(ReportDefinitionService.class)\n\t\t\t\t\t.getDefinitionByUuid(dvt.getMappeddefinitionuuid());\n\t\t\ttry {\n\t\t\t\treturn getReport(rrd, dvt.getMappeddefinitionlabel(), location,\n\t\t\t\t\t\tperiod).toString();\n\t\t\t} catch (EvaluationException ex) {\n\t\t\t\tlog.debug(\"Evaluation Exception : \" + ex.getMessage());\n\t\t\t}\n\t\t}\n\n\t\tif (dvt.potentialUpdateDelete()) {\n\t\t\tthrow new DHIS2ReportingException(\n\t\t\t\t\t\"Attempt to execute potential update/delete query for \"\n\t\t\t\t\t\t\t+ dvt.getDataelement().getName() + \" : \"\n\t\t\t\t\t\t\t+ dvt.getDisaggregation().getName());\n\t\t}\n\n\t\tQuery query = getCurrentSession().createSQLQuery(queryString);\n\n\t\tList<String> parameters = new ArrayList<String>(Arrays.asList(query\n\t\t\t\t.getNamedParameters()));\n\t\t// loactionId is optional\n\t\tif (parameters.contains(\"locationId\")) {\n\t\t\tquery.setParameter(\"locationId\", location.getId().toString());\n\t\t}\n\t\tquery.setParameter(\"startOfPeriod\", period.getStartDate());\n\t\tquery.setParameter(\"endOfPeriod\", period.getEndDate());\n\t\treturn query.uniqueResult().toString();\n\t}", "signature": "String evaluateDataValueTemplate(DataValueTemplate dvt,\n\t\t\tPeriod period, Location location, boolean priority)", "full_signature": "@Override public String evaluateDataValueTemplate(DataValueTemplate dvt,\n\t\t\tPeriod period, Location location, boolean priority)", "class_method_signature": "HibernateDHIS2ReportingDAO.evaluateDataValueTemplate(DataValueTemplate dvt,\n\t\t\tPeriod period, Location location, boolean priority)", "testcase": false, "constructor": false, "invocations": ["getQuery", "replaceAll", "replaceAll", "trim", "getMappeddefinitionuuid", "isEmpty", "getDefinitionByUuid", "getService", "getMappeddefinitionuuid", "toString", "getReport", "getMappeddefinitionlabel", "debug", "getMessage", "potentialUpdateDelete", "getName", "getDataelement", "getName", "getDisaggregation", "createSQLQuery", "getCurrentSession", "asList", "getNamedParameters", "contains", "setParameter", "toString", "getId", "setParameter", "getStartDate", "setParameter", "getEndDate", "toString", "uniqueResult"]}, "repository": {"repo_id": 5869462, "url": "https://github.com/openmrs/openmrs-module-dhisreport", "language": "Java", "is_fork": false, "fork_count": 38, "stargazer_count": 9, "size": 1862, "license": "licensed"}}