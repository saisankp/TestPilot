{"test_class": {"identifier": "SearchProductManagerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "@Autowired\n    private SearchProductManager searchProductManager;", "modifier": "@Autowired\n    private", "type": "SearchProductManager", "declarator": "searchProductManager", "var_name": "searchProductManager"}, {"original_string": "@Autowired\n    private ESProductRepository esProductRepository;", "modifier": "@Autowired\n    private", "type": "ESProductRepository", "declarator": "esProductRepository", "var_name": "esProductRepository"}], "file": "search-service-project/search-service-app/src/test/java/cn/iocoder/mall/searchservice/manager/product/SearchProductManagerTest.java"}, "test_case": {"identifier": "testRebuild", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testRebuild() {\n        int counts = searchProductManager.rebuild();\n        System.out.println(\"\u91cd\u5efa\u6570\u91cf\uff1a\" + counts);\n\n        System.out.println(esProductRepository.count());\n    }", "signature": "void testRebuild()", "full_signature": "@Test public void testRebuild()", "class_method_signature": "SearchProductManagerTest.testRebuild()", "testcase": true, "constructor": false, "invocations": ["rebuild", "println", "println", "count"]}, "focal_class": {"identifier": "SearchProductManager", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Integer REBUILD_FETCH_PER_SIZE = 100;", "modifier": "private static final", "type": "Integer", "declarator": "REBUILD_FETCH_PER_SIZE = 100", "var_name": "REBUILD_FETCH_PER_SIZE"}, {"original_string": "@DubboReference(version = \"${dubbo.consumer.ProductSpuRpc.version}\")\n    private ProductSpuRpc productSpuRpc;", "modifier": "@DubboReference(version = \"${dubbo.consumer.ProductSpuRpc.version}\")\n    private", "type": "ProductSpuRpc", "declarator": "productSpuRpc", "var_name": "productSpuRpc"}, {"original_string": "@DubboReference(version = \"${dubbo.consumer.ProductSkuRpc.version}\")\n    private ProductSkuRpc productSkuRpc;", "modifier": "@DubboReference(version = \"${dubbo.consumer.ProductSkuRpc.version}\")\n    private", "type": "ProductSkuRpc", "declarator": "productSkuRpc", "var_name": "productSkuRpc"}, {"original_string": "@DubboReference(version = \"${dubbo.consumer.ProductCategoryRpc.version}\")\n    private ProductCategoryRpc productCategoryRpc;", "modifier": "@DubboReference(version = \"${dubbo.consumer.ProductCategoryRpc.version}\")\n    private", "type": "ProductCategoryRpc", "declarator": "productCategoryRpc", "var_name": "productCategoryRpc"}, {"original_string": "@Autowired\n    private SearchProductService searchProductService;", "modifier": "@Autowired\n    private", "type": "SearchProductService", "declarator": "searchProductService", "var_name": "searchProductService"}], "methods": [{"identifier": "pageSearchProduct", "parameters": "(SearchProductPageReqDTO pageReqDTO)", "modifiers": "public", "return": "PageResult<SearchProductRespDTO>", "signature": "PageResult<SearchProductRespDTO> pageSearchProduct(SearchProductPageReqDTO pageReqDTO)", "full_signature": "public PageResult<SearchProductRespDTO> pageSearchProduct(SearchProductPageReqDTO pageReqDTO)", "class_method_signature": "SearchProductManager.pageSearchProduct(SearchProductPageReqDTO pageReqDTO)", "testcase": false, "constructor": false}, {"identifier": "getSearchProductCondition", "parameters": "(SearchProductConditionReqDTO conditionReqDTO)", "modifiers": "public", "return": "SearchProductConditionRespDTO", "signature": "SearchProductConditionRespDTO getSearchProductCondition(SearchProductConditionReqDTO conditionReqDTO)", "full_signature": "public SearchProductConditionRespDTO getSearchProductCondition(SearchProductConditionReqDTO conditionReqDTO)", "class_method_signature": "SearchProductManager.getSearchProductCondition(SearchProductConditionReqDTO conditionReqDTO)", "testcase": false, "constructor": false}, {"identifier": "rebuild", "parameters": "()", "modifiers": "public", "return": "Integer", "signature": "Integer rebuild()", "full_signature": "public Integer rebuild()", "class_method_signature": "SearchProductManager.rebuild()", "testcase": false, "constructor": false}, {"identifier": "saveProduct", "parameters": "(Integer id)", "modifiers": "public", "return": "Boolean", "signature": "Boolean saveProduct(Integer id)", "full_signature": "public Boolean saveProduct(Integer id)", "class_method_signature": "SearchProductManager.saveProduct(Integer id)", "testcase": false, "constructor": false}], "file": "search-service-project/search-service-app/src/main/java/cn/iocoder/mall/searchservice/manager/product/SearchProductManager.java"}, "focal_method": {"identifier": "rebuild", "parameters": "()", "modifiers": "public", "return": "Integer", "body": "public Integer rebuild() {\n        // TODO \u828b\u827f\uff0c\u56e0\u4e3a\u76ee\u524d\u5546\u54c1\u6bd4\u8f83\u5c11\uff0c\u6240\u4ee5\u5199\u7684\u5f88\u7c97\u66b4\u3002\u7b49\u672a\u6765\u91cd\u6784\n        Integer lastId = null;\n        int rebuildCounts = 0;\n        while (true) {\n            // \u4ece\u5546\u54c1\u670d\u52a1\uff0c\u589e\u91cf\u83b7\u53d6\u5546\u54c1\u5217\u8868\u7f16\u53f7\n            CommonResult<List<Integer>> listProductSpuIdsResult = productSpuRpc.listProductSpuIds(lastId, REBUILD_FETCH_PER_SIZE);\n            listProductSpuIdsResult.checkError();\n            List<Integer> spuIds = listProductSpuIdsResult.getData();\n            // \u9010\u4e2a\u91cd\u5efa\u7d22\u5f15\u5230 ES \u4e2d\n            spuIds.forEach(this::saveProduct);\n            // \u8bbe\u7f6e\u65b0\u7684 lastId \uff0c\u6216\u8005\u7ed3\u675f\n            rebuildCounts += listProductSpuIdsResult.getData().size();\n            if (spuIds.size() < REBUILD_FETCH_PER_SIZE) {\n                break;\n            } else {\n                lastId = spuIds.get(spuIds.size() - 1);\n            }\n        }\n        // \u8fd4\u56de\u6210\u529f\n        return rebuildCounts;\n    }", "signature": "Integer rebuild()", "full_signature": "public Integer rebuild()", "class_method_signature": "SearchProductManager.rebuild()", "testcase": false, "constructor": false, "invocations": ["listProductSpuIds", "checkError", "getData", "forEach", "size", "getData", "size", "get", "size"]}, "repository": {"repo_id": 184611677, "url": "https://github.com/YunaiV/onemall", "language": "Java", "is_fork": false, "fork_count": 1162, "stargazer_count": 2893, "size": 7986, "license": "licensed"}}