{"test_class": {"identifier": "ReportsServiceTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private final TransactionsService transactionsService = mock(TransactionsService.class);", "modifier": "private final", "type": "TransactionsService", "declarator": "transactionsService = mock(TransactionsService.class)", "var_name": "transactionsService"}, {"original_string": "private final ReportsService service = new ReportsService(transactionsService);", "modifier": "private final", "type": "ReportsService", "declarator": "service = new ReportsService(transactionsService)", "var_name": "service"}, {"original_string": "private Transactions transactions = createTransactions();", "modifier": "private", "type": "Transactions", "declarator": "transactions = createTransactions()", "var_name": "transactions"}], "file": "services/src/test/java/com/greensopinion/finance/services/reports/ReportsServiceTest.java"}, "test_case": {"identifier": "detailsForMonthWithCategories", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n\tpublic void detailsForMonthWithCategories() {\n\t\ttransactions = createTransactionsWithCategories();\n\t\tdoReturn(transactions).when(transactionsService).retrieve();\n\n\t\tPeriodDetails detailsForMonth = service.detailsForMonth(201501);\n\t\tassertEquals(\"January 2015\", detailsForMonth.getName());\n\t\tassertEquals(2, detailsForMonth.getCategories().size());\n\n\t\tCategorySummary categorySummary = detailsForMonth.getCategories().get(0);\n\t\tassertEquals(\"Fries\", categorySummary.getName());\n\t\tassertEquals(-1500L, categorySummary.getAmount());\n\n\t\tcategorySummary = detailsForMonth.getCategories().get(1);\n\t\tassertEquals(\"Burgers\", categorySummary.getName());\n\t\tassertEquals(102300L, categorySummary.getAmount());\n\t}", "signature": "void detailsForMonthWithCategories()", "full_signature": "@Test public void detailsForMonthWithCategories()", "class_method_signature": "ReportsServiceTest.detailsForMonthWithCategories()", "testcase": true, "constructor": false, "invocations": ["createTransactionsWithCategories", "retrieve", "when", "doReturn", "detailsForMonth", "assertEquals", "getName", "assertEquals", "size", "getCategories", "get", "getCategories", "assertEquals", "getName", "assertEquals", "getAmount", "get", "getCategories", "assertEquals", "getName", "assertEquals", "getAmount"]}, "focal_class": {"identifier": "ReportsService", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final ThreadLocal<DateFormat> yearMonthFormat = new ThreadLocal<DateFormat>() {\n\t\t@Override\n\t\tprotected DateFormat initialValue() {\n\t\t\treturn new SimpleDateFormat(\"yyyyMM\");\n\t\t}\n\t};", "modifier": "private static final", "type": "ThreadLocal<DateFormat>", "declarator": "yearMonthFormat = new ThreadLocal<DateFormat>() {\n\t\t@Override\n\t\tprotected DateFormat initialValue() {\n\t\t\treturn new SimpleDateFormat(\"yyyyMM\");\n\t\t}\n\t}", "var_name": "yearMonthFormat"}, {"original_string": "private static final ThreadLocal<DateFormat> readableYearMonthFormat = new ThreadLocal<DateFormat>() {\n\t\t@Override\n\t\tprotected DateFormat initialValue() {\n\t\t\treturn new SimpleDateFormat(\"MMMMMMMMMMM yyyy\");\n\t\t}\n\t};", "modifier": "private static final", "type": "ThreadLocal<DateFormat>", "declarator": "readableYearMonthFormat = new ThreadLocal<DateFormat>() {\n\t\t@Override\n\t\tprotected DateFormat initialValue() {\n\t\t\treturn new SimpleDateFormat(\"MMMMMMMMMMM yyyy\");\n\t\t}\n\t}", "var_name": "readableYearMonthFormat"}, {"original_string": "private final TransactionsService transactionsService;", "modifier": "private final", "type": "TransactionsService", "declarator": "transactionsService", "var_name": "transactionsService"}], "methods": [{"identifier": "ReportsService", "parameters": "(TransactionsService transactionsService)", "modifiers": "@Inject", "return": "", "signature": " ReportsService(TransactionsService transactionsService)", "full_signature": "@Inject  ReportsService(TransactionsService transactionsService)", "class_method_signature": "ReportsService.ReportsService(TransactionsService transactionsService)", "testcase": false, "constructor": true}, {"identifier": "incomeVersusExpenses", "parameters": "()", "modifiers": "public", "return": "IncomeVersusExpensesReport", "signature": "IncomeVersusExpensesReport incomeVersusExpenses()", "full_signature": "public IncomeVersusExpensesReport incomeVersusExpenses()", "class_method_signature": "ReportsService.incomeVersusExpenses()", "testcase": false, "constructor": false}, {"identifier": "expensesByCategory", "parameters": "()", "modifiers": "public", "return": "ExpensesByCategoryReport", "signature": "ExpensesByCategoryReport expensesByCategory()", "full_signature": "public ExpensesByCategoryReport expensesByCategory()", "class_method_signature": "ReportsService.expensesByCategory()", "testcase": false, "constructor": false}, {"identifier": "transactionsForMonth", "parameters": "(long yearMonth)", "modifiers": "public", "return": "PeriodTransactions", "signature": "PeriodTransactions transactionsForMonth(long yearMonth)", "full_signature": "public PeriodTransactions transactionsForMonth(long yearMonth)", "class_method_signature": "ReportsService.transactionsForMonth(long yearMonth)", "testcase": false, "constructor": false}, {"identifier": "detailsForMonth", "parameters": "(long yearMonth)", "modifiers": "public", "return": "PeriodDetails", "signature": "PeriodDetails detailsForMonth(long yearMonth)", "full_signature": "public PeriodDetails detailsForMonth(long yearMonth)", "class_method_signature": "ReportsService.detailsForMonth(long yearMonth)", "testcase": false, "constructor": false}, {"identifier": "transactions", "parameters": "(long yearMonth)", "modifiers": "private", "return": "List<Transaction>", "signature": "List<Transaction> transactions(long yearMonth)", "full_signature": "private List<Transaction> transactions(long yearMonth)", "class_method_signature": "ReportsService.transactions(long yearMonth)", "testcase": false, "constructor": false}, {"identifier": "monthName", "parameters": "(final Long yearMonth)", "modifiers": "private", "return": "String", "signature": "String monthName(final Long yearMonth)", "full_signature": "private String monthName(final Long yearMonth)", "class_method_signature": "ReportsService.monthName(final Long yearMonth)", "testcase": false, "constructor": false}, {"identifier": "yearMonth", "parameters": "(Date date)", "modifiers": "private", "return": "Long", "signature": "Long yearMonth(Date date)", "full_signature": "private Long yearMonth(Date date)", "class_method_signature": "ReportsService.yearMonth(Date date)", "testcase": false, "constructor": false}, {"identifier": "yearMonthFormat", "parameters": "()", "modifiers": "private", "return": "DateFormat", "signature": "DateFormat yearMonthFormat()", "full_signature": "private DateFormat yearMonthFormat()", "class_method_signature": "ReportsService.yearMonthFormat()", "testcase": false, "constructor": false}, {"identifier": "readableYearMonthFormat", "parameters": "()", "modifiers": "private", "return": "DateFormat", "signature": "DateFormat readableYearMonthFormat()", "full_signature": "private DateFormat readableYearMonthFormat()", "class_method_signature": "ReportsService.readableYearMonthFormat()", "testcase": false, "constructor": false}], "file": "services/src/main/java/com/greensopinion/finance/services/reports/ReportsService.java"}, "focal_method": {"identifier": "detailsForMonth", "parameters": "(long yearMonth)", "modifiers": "public", "return": "PeriodDetails", "body": "public PeriodDetails detailsForMonth(long yearMonth) {\n\t\tList<Transaction> transactions = new TransactionNormalizer().normalize(transactions(yearMonth));\n\t\tMap<String, Long> amountByCategoryName = new HashMap<>();\n\t\tfor (Transaction transaction : transactions) {\n\t\t\tCategory category = transaction.getCategory();\n\t\t\tString categoryName = category == null ? \"Uncategorized\" : category.getName();\n\t\t\tLong amount = amountByCategoryName.get(categoryName);\n\t\t\tif (amount == null) {\n\t\t\t\tamount = 0L;\n\t\t\t}\n\t\t\tamountByCategoryName.put(categoryName, amount.longValue() + transaction.getAmount());\n\t\t}\n\t\tList<CategorySummary> categorySummaries = new ArrayList<>();\n\t\tfor (Entry<String, Long> entry : amountByCategoryName.entrySet()) {\n\t\t\tcategorySummaries.add(new CategorySummary(entry.getKey(), entry.getValue()));\n\t\t}\n\t\tCollections.sort(categorySummaries, new CategorySummaryAmountDescendingComparator());\n\t\treturn new PeriodDetails(monthName(yearMonth), categorySummaries);\n\t}", "signature": "PeriodDetails detailsForMonth(long yearMonth)", "full_signature": "public PeriodDetails detailsForMonth(long yearMonth)", "class_method_signature": "ReportsService.detailsForMonth(long yearMonth)", "testcase": false, "constructor": false, "invocations": ["normalize", "transactions", "getCategory", "getName", "get", "put", "longValue", "getAmount", "entrySet", "add", "getKey", "getValue", "sort", "monthName"]}, "repository": {"repo_id": 54854741, "url": "https://github.com/greensopinion/greenbeans", "language": "Java", "is_fork": false, "fork_count": 13, "stargazer_count": 30, "size": 1684, "license": "licensed"}}